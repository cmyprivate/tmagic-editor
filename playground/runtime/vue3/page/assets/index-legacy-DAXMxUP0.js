(function(){System.register([],(function(exports,module){"use strict";return{execute:function(){var __vite_style__=document.createElement("style");function getDefaultExportFromCjs(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}__vite_style__.textContent='html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td,article,aside,canvas,details,embed,figure,figcaption,footer,header,hgroup,menu,nav,output,ruby,section,summary,time,mark,audio,video{margin:0;padding:0;border:0;font-size:100%;font:inherit;vertical-align:baseline}:focus{outline:0}article,aside,details,figcaption,figure,footer,header,hgroup,menu,nav,section{display:block}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:"";content:none}input[type=search]::-webkit-search-cancel-button,input[type=search]::-webkit-search-decoration,input[type=search]::-webkit-search-results-button,input[type=search]::-webkit-search-results-decoration{-webkit-appearance:none;-moz-appearance:none}input[type=search]{-webkit-appearance:none;-moz-appearance:none;-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box}textarea{overflow:auto;vertical-align:top;resize:vertical}audio,canvas,video{display:inline-block;*display: inline;*zoom: 1;max-width:100%}audio:not([controls]){display:none;height:0}[hidden]{display:none}html{font-size:100%;-webkit-text-size-adjust:100%;-ms-text-size-adjust:100%}a:focus{outline:thin dotted}a:active,a:hover{outline:0}img{border:0;-ms-interpolation-mode:bicubic}figure{margin:0}form{margin:0}fieldset{border:1px solid #c0c0c0;margin:0 2px;padding:.35em .625em .75em}legend{border:0;padding:0;white-space:normal;*margin-left: -7px}button,input,select,textarea{font-size:100%;margin:0;vertical-align:baseline;*vertical-align: middle}button,input{line-height:normal}button,select{text-transform:none}button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer;*overflow: visible}button[disabled],html input[disabled]{cursor:default}input[type=checkbox],input[type=radio]{box-sizing:border-box;padding:0;*height: 13px;*width: 13px}input[type=search]{-webkit-appearance:textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}input[type=search]::-webkit-search-cancel-button,input[type=search]::-webkit-search-decoration{-webkit-appearance:none}button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}textarea{overflow:auto;vertical-align:top}table{border-collapse:collapse;border-spacing:0}html,button,input,select,textarea{color:#222}::-moz-selection{background:#b3d4fc;text-shadow:none}::selection{background:#b3d4fc;text-shadow:none}img{vertical-align:middle}fieldset{border:0;margin:0;padding:0}textarea{resize:vertical}.chromeframe{margin:.2em 0;background:#ccc;color:#000;padding:.2em 0}\n/*$vite$:1*/',document.head.appendChild(__vite_style__),exports({c:cloneDeep$1,g:getDefaultExportFromCjs,s:set});var events={exports:{}},hasRequiredEvents;function requireEvents(){if(hasRequiredEvents)return events.exports;hasRequiredEvents=1;var e,t="object"==typeof Reflect?Reflect:null,r=t&&"function"==typeof t.apply?t.apply:function(e,t,r){return Function.prototype.apply.call(e,t,r)};e=t&&"function"==typeof t.ownKeys?t.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var a=Number.isNaN||function(e){return e!=e};function n(){n.init.call(this)}events.exports=n,events.exports.once=function(e,t){return new Promise((function(r,a){function n(r){e.removeListener(t,s),a(r)}function s(){"function"==typeof e.removeListener&&e.removeListener("error",n),r([].slice.call(arguments))}f(e,t,s,{once:!0}),"error"!==t&&function(e,t,r){"function"==typeof e.on&&f(e,"error",t,r)}(e,n,{once:!0})}))},n.EventEmitter=n,n.prototype._events=void 0,n.prototype._eventsCount=0,n.prototype._maxListeners=void 0;var s=10;function o(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function i(e){return void 0===e._maxListeners?n.defaultMaxListeners:e._maxListeners}function c(e,t,r,a){var n,s,c,u;if(o(r),void 0===(s=e._events)?(s=e._events=Object.create(null),e._eventsCount=0):(void 0!==s.newListener&&(e.emit("newListener",t,r.listener?r.listener:r),s=e._events),c=s[t]),void 0===c)c=s[t]=r,++e._eventsCount;else if("function"==typeof c?c=s[t]=a?[r,c]:[c,r]:a?c.unshift(r):c.push(r),(n=i(e))>0&&c.length>n&&!c.warned){c.warned=!0;var l=new Error("Possible EventEmitter memory leak detected. "+c.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");l.name="MaxListenersExceededWarning",l.emitter=e,l.type=t,l.count=c.length,u=l,console&&console.warn&&console.warn(u)}return e}function u(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function l(e,t,r){var a={fired:!1,wrapFn:void 0,target:e,type:t,listener:r},n=u.bind(a);return n.listener=r,a.wrapFn=n,n}function d(e,t,r){var a=e._events;if(void 0===a)return[];var n=a[t];return void 0===n?[]:"function"==typeof n?r?[n.listener||n]:[n]:r?function(e){for(var t=new Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}(n):h(n,n.length)}function p(e){var t=this._events;if(void 0!==t){var r=t[e];if("function"==typeof r)return 1;if(void 0!==r)return r.length}return 0}function h(e,t){for(var r=new Array(t),a=0;a<t;++a)r[a]=e[a];return r}function f(e,t,r,a){if("function"==typeof e.on)a.once?e.once(t,r):e.on(t,r);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function n(s){a.once&&e.removeEventListener(t,n),r(s)}))}}return Object.defineProperty(n,"defaultMaxListeners",{enumerable:!0,get:function(){return s},set:function(e){if("number"!=typeof e||e<0||a(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");s=e}}),n.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},n.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||a(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},n.prototype.getMaxListeners=function(){return i(this)},n.prototype.emit=function(e){for(var t=[],a=1;a<arguments.length;a++)t.push(arguments[a]);var n="error"===e,s=this._events;if(void 0!==s)n=n&&void 0===s.error;else if(!n)return!1;if(n){var o;if(t.length>0&&(o=t[0]),o instanceof Error)throw o;var i=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw i.context=o,i}var c=s[e];if(void 0===c)return!1;if("function"==typeof c)r(c,this,t);else{var u=c.length,l=h(c,u);for(a=0;a<u;++a)r(l[a],this,t)}return!0},n.prototype.addListener=function(e,t){return c(this,e,t,!1)},n.prototype.on=n.prototype.addListener,n.prototype.prependListener=function(e,t){return c(this,e,t,!0)},n.prototype.once=function(e,t){return o(t),this.on(e,l(this,e,t)),this},n.prototype.prependOnceListener=function(e,t){return o(t),this.prependListener(e,l(this,e,t)),this},n.prototype.removeListener=function(e,t){var r,a,n,s,i;if(o(t),void 0===(a=this._events))return this;if(void 0===(r=a[e]))return this;if(r===t||r.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete a[e],a.removeListener&&this.emit("removeListener",e,r.listener||t));else if("function"!=typeof r){for(n=-1,s=r.length-1;s>=0;s--)if(r[s]===t||r[s].listener===t){i=r[s].listener,n=s;break}if(n<0)return this;0===n?r.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(r,n),1===r.length&&(a[e]=r[0]),void 0!==a.removeListener&&this.emit("removeListener",e,i||t)}return this},n.prototype.off=n.prototype.removeListener,n.prototype.removeAllListeners=function(e){var t,r,a;if(void 0===(r=this._events))return this;if(void 0===r.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==r[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete r[e]),this;if(0===arguments.length){var n,s=Object.keys(r);for(a=0;a<s.length;++a)"removeListener"!==(n=s[a])&&this.removeAllListeners(n);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=r[e]))this.removeListener(e,t);else if(void 0!==t)for(a=t.length-1;a>=0;a--)this.removeListener(e,t[a]);return this},n.prototype.listeners=function(e){return d(this,e,!0)},n.prototype.rawListeners=function(e){return d(this,e,!1)},n.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):p.call(e,t)},n.prototype.listenerCount=p,n.prototype.eventNames=function(){return this._eventsCount>0?e(this._events):[]},events.exports}var eventsExports=exports("e",requireEvents());const EventEmitter$1=exports("E",getDefaultExportFromCjs(eventsExports));var freeGlobal$1="object"==typeof global&&global&&global.Object===Object&&global,freeSelf$1="object"==typeof self&&self&&self.Object===Object&&self,root$1=freeGlobal$1||freeSelf$1||Function("return this")(),Symbol$2=root$1.Symbol,objectProto$q=Object.prototype,hasOwnProperty$k=objectProto$q.hasOwnProperty,nativeObjectToString$3=objectProto$q.toString,symToStringTag$3=Symbol$2?Symbol$2.toStringTag:void 0;function getRawTag$1(e){var t=hasOwnProperty$k.call(e,symToStringTag$3),r=e[symToStringTag$3];try{e[symToStringTag$3]=void 0;var a=!0}catch(s){}var n=nativeObjectToString$3.call(e);return a&&(t?e[symToStringTag$3]=r:delete e[symToStringTag$3]),n}var objectProto$p=Object.prototype,nativeObjectToString$2=objectProto$p.toString;function objectToString$1(e){return nativeObjectToString$2.call(e)}var nullTag$1="[object Null]",undefinedTag$1="[object Undefined]",symToStringTag$2=Symbol$2?Symbol$2.toStringTag:void 0;function baseGetTag$1(e){return null==e?void 0===e?undefinedTag$1:nullTag$1:symToStringTag$2&&symToStringTag$2 in Object(e)?getRawTag$1(e):objectToString$1(e)}function isObjectLike$1(e){return null!=e&&"object"==typeof e}var symbolTag$4="[object Symbol]";function isSymbol(e){return"symbol"==typeof e||isObjectLike$1(e)&&baseGetTag$1(e)==symbolTag$4}function arrayMap(e,t){for(var r=-1,a=null==e?0:e.length,n=Array(a);++r<a;)n[r]=t(e[r],r,e);return n}var isArray$1=Array.isArray,INFINITY$2=1/0,symbolProto$2=Symbol$2?Symbol$2.prototype:void 0,symbolToString=symbolProto$2?symbolProto$2.toString:void 0;function baseToString(e){if("string"==typeof e)return e;if(isArray$1(e))return arrayMap(e,baseToString)+"";if(isSymbol(e))return symbolToString?symbolToString.call(e):"";var t=e+"";return"0"==t&&1/e==-INFINITY$2?"-0":t}function isObject$3(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}var asyncTag$1="[object AsyncFunction]",funcTag$5="[object Function]",genTag$3="[object GeneratorFunction]",proxyTag$1="[object Proxy]";function isFunction$1(e){if(!isObject$3(e))return!1;var t=baseGetTag$1(e);return t==funcTag$5||t==genTag$3||t==asyncTag$1||t==proxyTag$1}var coreJsData$1=root$1["__core-js_shared__"],maskSrcKey$1=(uid=/[^.]+$/.exec(coreJsData$1&&coreJsData$1.keys&&coreJsData$1.keys.IE_PROTO||""),uid?"Symbol(src)_1."+uid:""),uid;function isMasked$1(e){return!!maskSrcKey$1&&maskSrcKey$1 in e}var funcProto$3=Function.prototype,funcToString$3=funcProto$3.toString;function toSource$1(e){if(null!=e){try{return funcToString$3.call(e)}catch(t){}try{return e+""}catch(t){}}return""}var reRegExpChar$1=/[\\^$.*+?()[\]{}|]/g,reIsHostCtor$1=/^\[object .+?Constructor\]$/,funcProto$2=Function.prototype,objectProto$o=Object.prototype,funcToString$2=funcProto$2.toString,hasOwnProperty$j=objectProto$o.hasOwnProperty,reIsNative$1=RegExp("^"+funcToString$2.call(hasOwnProperty$j).replace(reRegExpChar$1,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function baseIsNative$1(e){return!(!isObject$3(e)||isMasked$1(e))&&(isFunction$1(e)?reIsNative$1:reIsHostCtor$1).test(toSource$1(e))}function getValue$1(e,t){return null==e?void 0:e[t]}function getNative$1(e,t){var r=getValue$1(e,t);return baseIsNative$1(r)?r:void 0}var WeakMap$2=getNative$1(root$1,"WeakMap"),objectCreate$1=Object.create,baseCreate$1=function(){function e(){}return function(t){if(!isObject$3(t))return{};if(objectCreate$1)return objectCreate$1(t);e.prototype=t;var r=new e;return e.prototype=void 0,r}}();function copyArray(e,t){var r=-1,a=e.length;for(t||(t=Array(a));++r<a;)t[r]=e[r];return t}var defineProperty$1=function(){try{var e=getNative$1(Object,"defineProperty");return e({},"",{}),e}catch(t){}}();function arrayEach$1(e,t){for(var r=-1,a=null==e?0:e.length;++r<a&&!1!==t(e[r],r,e););return e}var MAX_SAFE_INTEGER$3=9007199254740991,reIsUint$1=/^(?:0|[1-9]\d*)$/;function isIndex$1(e,t){var r=typeof e;return!!(t=null==t?MAX_SAFE_INTEGER$3:t)&&("number"==r||"symbol"!=r&&reIsUint$1.test(e))&&e>-1&&e%1==0&&e<t}function baseAssignValue$1(e,t,r){"__proto__"==t&&defineProperty$1?defineProperty$1(e,t,{configurable:!0,enumerable:!0,value:r,writable:!0}):e[t]=r}function eq$1(e,t){return e===t||e!=e&&t!=t}var objectProto$n=Object.prototype,hasOwnProperty$i=objectProto$n.hasOwnProperty;function assignValue$1(e,t,r){var a=e[t];hasOwnProperty$i.call(e,t)&&eq$1(a,r)&&(void 0!==r||t in e)||baseAssignValue$1(e,t,r)}function copyObject(e,t,r,a){var n=!r;r||(r={});for(var s=-1,o=t.length;++s<o;){var i=t[s],c=void 0;void 0===c&&(c=e[i]),n?baseAssignValue$1(r,i,c):assignValue$1(r,i,c)}return r}var MAX_SAFE_INTEGER$2=9007199254740991;function isLength$1(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=MAX_SAFE_INTEGER$2}function isArrayLike$1(e){return null!=e&&isLength$1(e.length)&&!isFunction$1(e)}var objectProto$m=Object.prototype;function isPrototype$1(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||objectProto$m)}function baseTimes$1(e,t){for(var r=-1,a=Array(e);++r<e;)a[r]=t(r);return a}var argsTag$5="[object Arguments]";function baseIsArguments$1(e){return isObjectLike$1(e)&&baseGetTag$1(e)==argsTag$5}var objectProto$l=Object.prototype,hasOwnProperty$h=objectProto$l.hasOwnProperty,propertyIsEnumerable$3=objectProto$l.propertyIsEnumerable,isArguments$1=baseIsArguments$1(function(){return arguments}())?baseIsArguments$1:function(e){return isObjectLike$1(e)&&hasOwnProperty$h.call(e,"callee")&&!propertyIsEnumerable$3.call(e,"callee")};function stubFalse$1(){return!1}var freeExports$5="object"==typeof exports&&exports&&!exports.nodeType&&exports,freeModule$5=freeExports$5&&"object"==typeof module&&module&&!module.nodeType&&module,moduleExports$5=freeModule$5&&freeModule$5.exports===freeExports$5,Buffer$3=moduleExports$5?root$1.Buffer:void 0,nativeIsBuffer$1=Buffer$3?Buffer$3.isBuffer:void 0,isBuffer$1=nativeIsBuffer$1||stubFalse$1,argsTag$4="[object Arguments]",arrayTag$3="[object Array]",boolTag$5="[object Boolean]",dateTag$5="[object Date]",errorTag$3="[object Error]",funcTag$4="[object Function]",mapTag$a="[object Map]",numberTag$5="[object Number]",objectTag$5="[object Object]",regexpTag$5="[object RegExp]",setTag$a="[object Set]",stringTag$5="[object String]",weakMapTag$5="[object WeakMap]",arrayBufferTag$5="[object ArrayBuffer]",dataViewTag$7="[object DataView]",float32Tag$5="[object Float32Array]",float64Tag$5="[object Float64Array]",int8Tag$5="[object Int8Array]",int16Tag$5="[object Int16Array]",int32Tag$5="[object Int32Array]",uint8Tag$5="[object Uint8Array]",uint8ClampedTag$5="[object Uint8ClampedArray]",uint16Tag$5="[object Uint16Array]",uint32Tag$5="[object Uint32Array]",typedArrayTags$1={};function baseIsTypedArray$1(e){return isObjectLike$1(e)&&isLength$1(e.length)&&!!typedArrayTags$1[baseGetTag$1(e)]}function baseUnary$1(e){return function(t){return e(t)}}typedArrayTags$1[float32Tag$5]=typedArrayTags$1[float64Tag$5]=typedArrayTags$1[int8Tag$5]=typedArrayTags$1[int16Tag$5]=typedArrayTags$1[int32Tag$5]=typedArrayTags$1[uint8Tag$5]=typedArrayTags$1[uint8ClampedTag$5]=typedArrayTags$1[uint16Tag$5]=typedArrayTags$1[uint32Tag$5]=!0,typedArrayTags$1[argsTag$4]=typedArrayTags$1[arrayTag$3]=typedArrayTags$1[arrayBufferTag$5]=typedArrayTags$1[boolTag$5]=typedArrayTags$1[dataViewTag$7]=typedArrayTags$1[dateTag$5]=typedArrayTags$1[errorTag$3]=typedArrayTags$1[funcTag$4]=typedArrayTags$1[mapTag$a]=typedArrayTags$1[numberTag$5]=typedArrayTags$1[objectTag$5]=typedArrayTags$1[regexpTag$5]=typedArrayTags$1[setTag$a]=typedArrayTags$1[stringTag$5]=typedArrayTags$1[weakMapTag$5]=!1;var freeExports$4="object"==typeof exports&&exports&&!exports.nodeType&&exports,freeModule$4=freeExports$4&&"object"==typeof module&&module&&!module.nodeType&&module,moduleExports$4=freeModule$4&&freeModule$4.exports===freeExports$4,freeProcess$1=moduleExports$4&&freeGlobal$1.process,nodeUtil$1=function(){try{var e=freeModule$4&&freeModule$4.require&&freeModule$4.require("util").types;return e||freeProcess$1&&freeProcess$1.binding&&freeProcess$1.binding("util")}catch(t){}}(),nodeIsTypedArray$1=nodeUtil$1&&nodeUtil$1.isTypedArray,isTypedArray$1=nodeIsTypedArray$1?baseUnary$1(nodeIsTypedArray$1):baseIsTypedArray$1,objectProto$k=Object.prototype,hasOwnProperty$g=objectProto$k.hasOwnProperty;function arrayLikeKeys$1(e,t){var r=isArray$1(e),a=!r&&isArguments$1(e),n=!r&&!a&&isBuffer$1(e),s=!r&&!a&&!n&&isTypedArray$1(e),o=r||a||n||s,i=o?baseTimes$1(e.length,String):[],c=i.length;for(var u in e)!t&&!hasOwnProperty$g.call(e,u)||o&&("length"==u||n&&("offset"==u||"parent"==u)||s&&("buffer"==u||"byteLength"==u||"byteOffset"==u)||isIndex$1(u,c))||i.push(u);return i}function overArg$1(e,t){return function(r){return e(t(r))}}var nativeKeys$1=overArg$1(Object.keys,Object),objectProto$j=Object.prototype,hasOwnProperty$f=objectProto$j.hasOwnProperty;function baseKeys$1(e){if(!isPrototype$1(e))return nativeKeys$1(e);var t=[];for(var r in Object(e))hasOwnProperty$f.call(e,r)&&"constructor"!=r&&t.push(r);return t}function keys$1(e){return isArrayLike$1(e)?arrayLikeKeys$1(e):baseKeys$1(e)}function nativeKeysIn(e){var t=[];if(null!=e)for(var r in Object(e))t.push(r);return t}var objectProto$i=Object.prototype,hasOwnProperty$e=objectProto$i.hasOwnProperty;function baseKeysIn(e){if(!isObject$3(e))return nativeKeysIn(e);var t=isPrototype$1(e),r=[];for(var a in e)("constructor"!=a||!t&&hasOwnProperty$e.call(e,a))&&r.push(a);return r}function keysIn(e){return isArrayLike$1(e)?arrayLikeKeys$1(e,!0):baseKeysIn(e)}var reIsDeepProp=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,reIsPlainProp=/^\w*$/;function isKey(e,t){if(isArray$1(e))return!1;var r=typeof e;return!("number"!=r&&"symbol"!=r&&"boolean"!=r&&null!=e&&!isSymbol(e))||(reIsPlainProp.test(e)||!reIsDeepProp.test(e)||null!=t&&e in Object(t))}var nativeCreate$1=getNative$1(Object,"create");function hashClear$1(){this.__data__=nativeCreate$1?nativeCreate$1(null):{},this.size=0}function hashDelete$1(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}var HASH_UNDEFINED$4="__lodash_hash_undefined__",objectProto$h=Object.prototype,hasOwnProperty$d=objectProto$h.hasOwnProperty;function hashGet$1(e){var t=this.__data__;if(nativeCreate$1){var r=t[e];return r===HASH_UNDEFINED$4?void 0:r}return hasOwnProperty$d.call(t,e)?t[e]:void 0}var objectProto$g=Object.prototype,hasOwnProperty$c=objectProto$g.hasOwnProperty;function hashHas$1(e){var t=this.__data__;return nativeCreate$1?void 0!==t[e]:hasOwnProperty$c.call(t,e)}var HASH_UNDEFINED$3="__lodash_hash_undefined__";function hashSet$1(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=nativeCreate$1&&void 0===t?HASH_UNDEFINED$3:t,this}function Hash$1(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var a=e[t];this.set(a[0],a[1])}}function listCacheClear$1(){this.__data__=[],this.size=0}function assocIndexOf$1(e,t){for(var r=e.length;r--;)if(eq$1(e[r][0],t))return r;return-1}Hash$1.prototype.clear=hashClear$1,Hash$1.prototype.delete=hashDelete$1,Hash$1.prototype.get=hashGet$1,Hash$1.prototype.has=hashHas$1,Hash$1.prototype.set=hashSet$1;var arrayProto$1=Array.prototype,splice$1=arrayProto$1.splice;function listCacheDelete$1(e){var t=this.__data__,r=assocIndexOf$1(t,e);return!(r<0)&&(r==t.length-1?t.pop():splice$1.call(t,r,1),--this.size,!0)}function listCacheGet$1(e){var t=this.__data__,r=assocIndexOf$1(t,e);return r<0?void 0:t[r][1]}function listCacheHas$1(e){return assocIndexOf$1(this.__data__,e)>-1}function listCacheSet$1(e,t){var r=this.__data__,a=assocIndexOf$1(r,e);return a<0?(++this.size,r.push([e,t])):r[a][1]=t,this}function ListCache$1(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var a=e[t];this.set(a[0],a[1])}}ListCache$1.prototype.clear=listCacheClear$1,ListCache$1.prototype.delete=listCacheDelete$1,ListCache$1.prototype.get=listCacheGet$1,ListCache$1.prototype.has=listCacheHas$1,ListCache$1.prototype.set=listCacheSet$1;var Map$2=getNative$1(root$1,"Map");function mapCacheClear$1(){this.size=0,this.__data__={hash:new Hash$1,map:new(Map$2||ListCache$1),string:new Hash$1}}function isKeyable$1(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e}function getMapData$1(e,t){var r=e.__data__;return isKeyable$1(t)?r["string"==typeof t?"string":"hash"]:r.map}function mapCacheDelete$1(e){var t=getMapData$1(this,e).delete(e);return this.size-=t?1:0,t}function mapCacheGet$1(e){return getMapData$1(this,e).get(e)}function mapCacheHas$1(e){return getMapData$1(this,e).has(e)}function mapCacheSet$1(e,t){var r=getMapData$1(this,e),a=r.size;return r.set(e,t),this.size+=r.size==a?0:1,this}function MapCache$1(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var a=e[t];this.set(a[0],a[1])}}MapCache$1.prototype.clear=mapCacheClear$1,MapCache$1.prototype.delete=mapCacheDelete$1,MapCache$1.prototype.get=mapCacheGet$1,MapCache$1.prototype.has=mapCacheHas$1,MapCache$1.prototype.set=mapCacheSet$1;var FUNC_ERROR_TEXT="Expected a function";function memoize(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new TypeError(FUNC_ERROR_TEXT);var r=function(){var a=arguments,n=t?t.apply(this,a):a[0],s=r.cache;if(s.has(n))return s.get(n);var o=e.apply(this,a);return r.cache=s.set(n,o)||s,o};return r.cache=new(memoize.Cache||MapCache$1),r}memoize.Cache=MapCache$1;var MAX_MEMOIZE_SIZE=500;function memoizeCapped(e){var t=memoize(e,(function(e){return r.size===MAX_MEMOIZE_SIZE&&r.clear(),e})),r=t.cache;return t}var rePropName=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,reEscapeChar=/\\(\\)?/g,stringToPath=memoizeCapped((function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(rePropName,(function(e,r,a,n){t.push(a?n.replace(reEscapeChar,"$1"):r||e)})),t}));function toString(e){return null==e?"":baseToString(e)}function castPath(e,t){return isArray$1(e)?e:isKey(e,t)?[e]:stringToPath(toString(e))}var INFINITY$1=1/0;function toKey(e){if("string"==typeof e||isSymbol(e))return e;var t=e+"";return"0"==t&&1/e==-INFINITY$1?"-0":t}function arrayPush$1(e,t){for(var r=-1,a=t.length,n=e.length;++r<a;)e[n+r]=t[r];return e}var getPrototype$1=overArg$1(Object.getPrototypeOf,Object);function stackClear$1(){this.__data__=new ListCache$1,this.size=0}function stackDelete$1(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r}function stackGet$1(e){return this.__data__.get(e)}function stackHas$1(e){return this.__data__.has(e)}var LARGE_ARRAY_SIZE$2=200;function stackSet$1(e,t){var r=this.__data__;if(r instanceof ListCache$1){var a=r.__data__;if(!Map$2||a.length<LARGE_ARRAY_SIZE$2-1)return a.push([e,t]),this.size=++r.size,this;r=this.__data__=new MapCache$1(a)}return r.set(e,t),this.size=r.size,this}function Stack$1(e){var t=this.__data__=new ListCache$1(e);this.size=t.size}function baseAssign(e,t){return e&&copyObject(t,keys$1(t),e)}function baseAssignIn(e,t){return e&&copyObject(t,keysIn(t),e)}Stack$1.prototype.clear=stackClear$1,Stack$1.prototype.delete=stackDelete$1,Stack$1.prototype.get=stackGet$1,Stack$1.prototype.has=stackHas$1,Stack$1.prototype.set=stackSet$1;var freeExports$3="object"==typeof exports&&exports&&!exports.nodeType&&exports,freeModule$3=freeExports$3&&"object"==typeof module&&module&&!module.nodeType&&module,moduleExports$3=freeModule$3&&freeModule$3.exports===freeExports$3,Buffer$2=moduleExports$3?root$1.Buffer:void 0,allocUnsafe=Buffer$2?Buffer$2.allocUnsafe:void 0;function cloneBuffer$1(e,t){if(t)return e.slice();var r=e.length,a=allocUnsafe?allocUnsafe(r):new e.constructor(r);return e.copy(a),a}function arrayFilter$1(e,t){for(var r=-1,a=null==e?0:e.length,n=0,s=[];++r<a;){var o=e[r];t(o,r,e)&&(s[n++]=o)}return s}function stubArray$1(){return[]}var objectProto$f=Object.prototype,propertyIsEnumerable$2=objectProto$f.propertyIsEnumerable,nativeGetSymbols$2=Object.getOwnPropertySymbols,getSymbols$1=nativeGetSymbols$2?function(e){return null==e?[]:(e=Object(e),arrayFilter$1(nativeGetSymbols$2(e),(function(t){return propertyIsEnumerable$2.call(e,t)})))}:stubArray$1;function copySymbols(e,t){return copyObject(e,getSymbols$1(e),t)}var nativeGetSymbols=Object.getOwnPropertySymbols,getSymbolsIn=nativeGetSymbols?function(e){for(var t=[];e;)arrayPush$1(t,getSymbols$1(e)),e=getPrototype$1(e);return t}:stubArray$1;function copySymbolsIn(e,t){return copyObject(e,getSymbolsIn(e),t)}function baseGetAllKeys$1(e,t,r){var a=t(e);return isArray$1(e)?a:arrayPush$1(a,r(e))}function getAllKeys$1(e){return baseGetAllKeys$1(e,keys$1,getSymbols$1)}function getAllKeysIn(e){return baseGetAllKeys$1(e,keysIn,getSymbolsIn)}var DataView$1=getNative$1(root$1,"DataView"),Promise$2=getNative$1(root$1,"Promise"),Set$2=getNative$1(root$1,"Set"),mapTag$9="[object Map]",objectTag$4="[object Object]",promiseTag$1="[object Promise]",setTag$9="[object Set]",weakMapTag$4="[object WeakMap]",dataViewTag$6="[object DataView]",dataViewCtorString$1=toSource$1(DataView$1),mapCtorString$1=toSource$1(Map$2),promiseCtorString$1=toSource$1(Promise$2),setCtorString$1=toSource$1(Set$2),weakMapCtorString$1=toSource$1(WeakMap$2),getTag$1=baseGetTag$1;(DataView$1&&getTag$1(new DataView$1(new ArrayBuffer(1)))!=dataViewTag$6||Map$2&&getTag$1(new Map$2)!=mapTag$9||Promise$2&&getTag$1(Promise$2.resolve())!=promiseTag$1||Set$2&&getTag$1(new Set$2)!=setTag$9||WeakMap$2&&getTag$1(new WeakMap$2)!=weakMapTag$4)&&(getTag$1=function(e){var t=baseGetTag$1(e),r=t==objectTag$4?e.constructor:void 0,a=r?toSource$1(r):"";if(a)switch(a){case dataViewCtorString$1:return dataViewTag$6;case mapCtorString$1:return mapTag$9;case promiseCtorString$1:return promiseTag$1;case setCtorString$1:return setTag$9;case weakMapCtorString$1:return weakMapTag$4}return t});var objectProto$e=Object.prototype,hasOwnProperty$b=objectProto$e.hasOwnProperty;function initCloneArray$1(e){var t=e.length,r=new e.constructor(t);return t&&"string"==typeof e[0]&&hasOwnProperty$b.call(e,"index")&&(r.index=e.index,r.input=e.input),r}var Uint8Array$2=root$1.Uint8Array;function cloneArrayBuffer$1(e){var t=new e.constructor(e.byteLength);return new Uint8Array$2(t).set(new Uint8Array$2(e)),t}function cloneDataView$1(e,t){var r=t?cloneArrayBuffer$1(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.byteLength)}var reFlags$1=/\w*$/;function cloneRegExp$1(e){var t=new e.constructor(e.source,reFlags$1.exec(e));return t.lastIndex=e.lastIndex,t}var symbolProto$1=Symbol$2?Symbol$2.prototype:void 0,symbolValueOf$1=symbolProto$1?symbolProto$1.valueOf:void 0;function cloneSymbol$1(e){return symbolValueOf$1?Object(symbolValueOf$1.call(e)):{}}function cloneTypedArray$1(e,t){var r=t?cloneArrayBuffer$1(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.length)}var boolTag$4="[object Boolean]",dateTag$4="[object Date]",mapTag$8="[object Map]",numberTag$4="[object Number]",regexpTag$4="[object RegExp]",setTag$8="[object Set]",stringTag$4="[object String]",symbolTag$3="[object Symbol]",arrayBufferTag$4="[object ArrayBuffer]",dataViewTag$5="[object DataView]",float32Tag$4="[object Float32Array]",float64Tag$4="[object Float64Array]",int8Tag$4="[object Int8Array]",int16Tag$4="[object Int16Array]",int32Tag$4="[object Int32Array]",uint8Tag$4="[object Uint8Array]",uint8ClampedTag$4="[object Uint8ClampedArray]",uint16Tag$4="[object Uint16Array]",uint32Tag$4="[object Uint32Array]";function initCloneByTag$1(e,t,r){var a=e.constructor;switch(t){case arrayBufferTag$4:return cloneArrayBuffer$1(e);case boolTag$4:case dateTag$4:return new a(+e);case dataViewTag$5:return cloneDataView$1(e,r);case float32Tag$4:case float64Tag$4:case int8Tag$4:case int16Tag$4:case int32Tag$4:case uint8Tag$4:case uint8ClampedTag$4:case uint16Tag$4:case uint32Tag$4:return cloneTypedArray$1(e,r);case mapTag$8:return new a;case numberTag$4:case stringTag$4:return new a(e);case regexpTag$4:return cloneRegExp$1(e);case setTag$8:return new a;case symbolTag$3:return cloneSymbol$1(e)}}function initCloneObject$1(e){return"function"!=typeof e.constructor||isPrototype$1(e)?{}:baseCreate$1(getPrototype$1(e))}var mapTag$7="[object Map]";function baseIsMap$1(e){return isObjectLike$1(e)&&getTag$1(e)==mapTag$7}var nodeIsMap$1=nodeUtil$1&&nodeUtil$1.isMap,isMap$1=nodeIsMap$1?baseUnary$1(nodeIsMap$1):baseIsMap$1,setTag$7="[object Set]";function baseIsSet$1(e){return isObjectLike$1(e)&&getTag$1(e)==setTag$7}var nodeIsSet$1=nodeUtil$1&&nodeUtil$1.isSet,isSet$1=nodeIsSet$1?baseUnary$1(nodeIsSet$1):baseIsSet$1,CLONE_DEEP_FLAG$2=1,CLONE_FLAT_FLAG=2,CLONE_SYMBOLS_FLAG$2=4,argsTag$3="[object Arguments]",arrayTag$2="[object Array]",boolTag$3="[object Boolean]",dateTag$3="[object Date]",errorTag$2="[object Error]",funcTag$3="[object Function]",genTag$2="[object GeneratorFunction]",mapTag$6="[object Map]",numberTag$3="[object Number]",objectTag$3="[object Object]",regexpTag$3="[object RegExp]",setTag$6="[object Set]",stringTag$3="[object String]",symbolTag$2="[object Symbol]",weakMapTag$3="[object WeakMap]",arrayBufferTag$3="[object ArrayBuffer]",dataViewTag$4="[object DataView]",float32Tag$3="[object Float32Array]",float64Tag$3="[object Float64Array]",int8Tag$3="[object Int8Array]",int16Tag$3="[object Int16Array]",int32Tag$3="[object Int32Array]",uint8Tag$3="[object Uint8Array]",uint8ClampedTag$3="[object Uint8ClampedArray]",uint16Tag$3="[object Uint16Array]",uint32Tag$3="[object Uint32Array]",cloneableTags$1={};function baseClone$1(e,t,r,a,n,s){var o,i=t&CLONE_DEEP_FLAG$2,c=t&CLONE_FLAT_FLAG,u=t&CLONE_SYMBOLS_FLAG$2;if(void 0!==o)return o;if(!isObject$3(e))return e;var l=isArray$1(e);if(l){if(o=initCloneArray$1(e),!i)return copyArray(e,o)}else{var d=getTag$1(e),p=d==funcTag$3||d==genTag$2;if(isBuffer$1(e))return cloneBuffer$1(e,i);if(d==objectTag$3||d==argsTag$3||p&&!n){if(o=c||p?{}:initCloneObject$1(e),!i)return c?copySymbolsIn(e,baseAssignIn(o,e)):copySymbols(e,baseAssign(o,e))}else{if(!cloneableTags$1[d])return n?e:{};o=initCloneByTag$1(e,d,i)}}s||(s=new Stack$1);var h=s.get(e);if(h)return h;s.set(e,o),isSet$1(e)?e.forEach((function(a){o.add(baseClone$1(a,t,r,a,e,s))})):isMap$1(e)&&e.forEach((function(a,n){o.set(n,baseClone$1(a,t,r,n,e,s))}));var f=l?void 0:(u?c?getAllKeysIn:getAllKeys$1:c?keysIn:keys$1)(e);return arrayEach$1(f||e,(function(a,n){f&&(a=e[n=a]),assignValue$1(o,n,baseClone$1(a,t,r,n,e,s))})),o}cloneableTags$1[argsTag$3]=cloneableTags$1[arrayTag$2]=cloneableTags$1[arrayBufferTag$3]=cloneableTags$1[dataViewTag$4]=cloneableTags$1[boolTag$3]=cloneableTags$1[dateTag$3]=cloneableTags$1[float32Tag$3]=cloneableTags$1[float64Tag$3]=cloneableTags$1[int8Tag$3]=cloneableTags$1[int16Tag$3]=cloneableTags$1[int32Tag$3]=cloneableTags$1[mapTag$6]=cloneableTags$1[numberTag$3]=cloneableTags$1[objectTag$3]=cloneableTags$1[regexpTag$3]=cloneableTags$1[setTag$6]=cloneableTags$1[stringTag$3]=cloneableTags$1[symbolTag$2]=cloneableTags$1[uint8Tag$3]=cloneableTags$1[uint8ClampedTag$3]=cloneableTags$1[uint16Tag$3]=cloneableTags$1[uint32Tag$3]=!0,cloneableTags$1[errorTag$2]=cloneableTags$1[funcTag$3]=cloneableTags$1[weakMapTag$3]=!1;var CLONE_DEEP_FLAG$1=1,CLONE_SYMBOLS_FLAG$1=4;function cloneDeep$1(e){return baseClone$1(e,CLONE_DEEP_FLAG$1|CLONE_SYMBOLS_FLAG$1)}function hasPath(e,t,r){for(var a=-1,n=(t=castPath(t,e)).length,s=!1;++a<n;){var o=toKey(t[a]);if(!(s=null!=e&&r(e,o)))break;e=e[o]}return s||++a!=n?s:!!(n=null==e?0:e.length)&&isLength$1(n)&&isIndex$1(o,n)&&(isArray$1(e)||isArguments$1(e))}var objectProto$d=Object.prototype,hasOwnProperty$a=objectProto$d.hasOwnProperty;function baseHas(e,t){return null!=e&&hasOwnProperty$a.call(e,t)}function has(e,t){return null!=e&&hasPath(e,t,baseHas)}var mapTag$5="[object Map]",setTag$5="[object Set]",objectProto$4=Object.prototype,hasOwnProperty$3=objectProto$4.hasOwnProperty;function isEmpty(e){if(null==e)return!0;if(isArrayLike$1(e)&&(isArray$1(e)||"string"==typeof e||"function"==typeof e.splice||isBuffer$1(e)||isTypedArray$1(e)||isArguments$1(e)))return!e.length;var t=getTag$1(e);if(t==mapTag$5||t==setTag$5)return!e.size;if(isPrototype$1(e))return!baseKeys$1(e).length;for(var r in e)if(hasOwnProperty$3.call(e,r))return!1;return!0}function baseSet(e,t,r,a){if(!isObject$3(e))return e;for(var n=-1,s=(t=castPath(t,e)).length,o=s-1,i=e;null!=i&&++n<s;){var c=toKey(t[n]),u=r;if("__proto__"===c||"constructor"===c||"prototype"===c)return e;if(n!=o){var l=i[c];void 0===(u=void 0)&&(u=isObject$3(l)?l:isIndex$1(t[n+1])?[]:{})}assignValue$1(i,c,u),i=i[c]}return e}function set(e,t,r){return null==e?e:baseSet(e,t,r)}
/*! *****************************************************************************
      Copyright (c) Microsoft Corporation.

      Permission to use, copy, modify, and/or distribute this software for any
      purpose with or without fee is hereby granted.

      THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
      REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
      AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
      INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
      LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
      OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
      PERFORMANCE OF THIS SOFTWARE.
      ***************************************************************************** */function __awaiter(e,t,r,a){return new(r||(r=Promise))((function(t,n){function s(e){try{i(a.next(e))}catch(t){n(t)}}function o(e){try{i(a.throw(e))}catch(t){n(t)}}function i(e){var a;e.done?t(e.value):(a=e.value,a instanceof r?a:new r((function(e){e(a)}))).then(s,o)}i((a=a.apply(e,[])).next())}))}const segments=[];function Match(e,t,r="*"){if(e===r)return!0;segments.length=0;let a=0,n=0,s=0,o=0;for(let d=0,p=e.length;d<p;d+=1){const t=e[d];t===r&&(a+=1,d>o&&segments.push(e.substring(o,d)),segments.push(t),o=d+1)}if(o<e.length&&segments.push(e.substring(o)),a?(n=e.length-a,s=1/0):s=n=e.length,0===segments.length)return e===t;const i=t.length;if(i<n||i>s)return!1;let c=segments.length-1,u=t.length-1,l=!1;for(;;){const e=segments[c];if(c-=1,e===r)l=!0;else{const r=u+1-e.length,a=t.lastIndexOf(e,r);if(-1===a||a>r)return!1;if(l)u=a-1,l=!1;else{if(a!==r)return!1;u-=e.length}}if(0>c)break}return!0}class WildcardObject{constructor(e,t,r,a=void 0){this.obj=e,this.delimiter=t,this.wildcard=r,this.is_match=a}shortMatch(e,t){if(e===t)return!0;if(e===this.wildcard)return!0;if(this.is_match)return this.is_match(e,t);const r=e.indexOf(this.wildcard);if(r>-1){const a=e.substr(r+1);if(0===r||t.substring(0,r)===e.substring(0,r)){const e=a.length;return!(e>0)||t.substr(-e)===a}}return!1}match(e,t){return this.is_match?this.is_match(e,t):e===t||e===this.wildcard||t===this.wildcard||this.shortMatch(e,t)||Match(e,t,this.wildcard)}handleArray(e,t,r,a,n={}){let s=e.indexOf(this.delimiter,r),o=!1;-1===s&&(o=!0,s=e.length);const i=e.substring(r,s);let c=0;for(const u of t){const t=c.toString(),r=""===a?t:a+this.delimiter+c;(i===this.wildcard||i===t||this.shortMatch(i,t))&&(o?n[r]=u:this.goFurther(e,u,s+1,r,n)),c++}return n}handleObject(e,t,r,a,n={}){let s=e.indexOf(this.delimiter,r),o=!1;-1===s&&(o=!0,s=e.length);const i=e.substring(r,s);for(let c in t){c=c.toString();const r=""===a?c:a+this.delimiter+c;(i===this.wildcard||i===c||this.shortMatch(i,c))&&(o?n[r]=t[c]:this.goFurther(e,t[c],s+1,r,n))}return n}goFurther(e,t,r,a,n={}){return Array.isArray(t)?this.handleArray(e,t,r,a,n):this.handleObject(e,t,r,a,n)}get(e){return this.goFurther(e,this.obj,0,"")}}class ObjectPath{static get(e,t,r=!1){if(!t)return;let a=t;for(const n of e)if(n in a)a=a[n];else{if(!r)return;a[n]=Object.create({}),a=a[n]}return a}static set(e,t,r){if(!r)return;if(0===e.length){for(const e in r)delete r[e];for(const e in t)r[e]=t[e];return}const a=e.slice(),n=a.pop(),s=ObjectPath.get(a,r,!0);return"object"==typeof s&&(s[n]=t),t}}let wasm,WASM_VECTOR_LEN=0,cachegetUint8Memory0=null;function getUint8Memory0(){return null!==cachegetUint8Memory0&&cachegetUint8Memory0.buffer===wasm.memory.buffer||(cachegetUint8Memory0=new Uint8Array(wasm.memory.buffer)),cachegetUint8Memory0}let cachedTextEncoder=new TextEncoder("utf-8");const encodeString="function"==typeof cachedTextEncoder.encodeInto?function(e,t){return cachedTextEncoder.encodeInto(e,t)}:function(e,t){const r=cachedTextEncoder.encode(e);return t.set(r),{read:e.length,written:r.length}};function passStringToWasm0(e,t,r){if(void 0===r){const r=cachedTextEncoder.encode(e),a=t(r.length);return getUint8Memory0().subarray(a,a+r.length).set(r),WASM_VECTOR_LEN=r.length,a}let a=e.length,n=t(a);const s=getUint8Memory0();let o=0;for(;o<a;o++){const t=e.charCodeAt(o);if(t>127)break;s[n+o]=t}if(o!==a){0!==o&&(e=e.slice(o)),n=r(n,a,a=o+3*e.length);const t=getUint8Memory0().subarray(n+o,n+a);o+=encodeString(e,t).written}return WASM_VECTOR_LEN=o,n}function is_match(e,t){var r=passStringToWasm0(e,wasm.__wbindgen_malloc,wasm.__wbindgen_realloc),a=WASM_VECTOR_LEN,n=passStringToWasm0(t,wasm.__wbindgen_malloc,wasm.__wbindgen_realloc),s=WASM_VECTOR_LEN;return 0!==wasm.is_match(r,a,n,s)}async function load(e,t){if("function"==typeof Response&&e instanceof Response){if("function"==typeof WebAssembly.instantiateStreaming)try{return await WebAssembly.instantiateStreaming(e,t)}catch(r){if("application/wasm"==e.headers.get("Content-Type"))throw r;console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",r)}const a=await e.arrayBuffer();return await WebAssembly.instantiate(a,t)}{const r=await WebAssembly.instantiate(e,t);return r instanceof WebAssembly.Instance?{instance:r,module:e}:r}}async function init(e){("string"==typeof e||"function"==typeof Request&&e instanceof Request||"function"==typeof URL&&e instanceof URL)&&(e=fetch(e));const{instance:t,module:r}=await load(await e,{});return wasm=t.exports,init.__wbindgen_wasm_module=r,wasm}const defaultUpdateOptions={only:[],source:"",debug:!1,data:void 0,queue:!1,force:!1};function log(e,t){console.debug(e,t)}function getDefaultOptions(){return{delimiter:".",debug:!1,extraDebug:!1,useMute:!0,notRecursive:";",param:":",wildcard:"*",experimentalMatch:!1,queue:!1,defaultBulkValue:!0,useCache:!1,useSplitCache:!1,useIndicesCache:!1,maxSimultaneousJobs:1e3,maxQueueRuns:1e3,log:log,Promise:Promise}}function isObject$2(e){return e&&e.constructor?"Object"===e.constructor.name:"object"==typeof e&&null!==e}class DeepState{constructor(e={},t={}){this.jobsRunning=0,this.updateQueue=[],this.subscribeQueue=[],this.listenersIgnoreCache=new WeakMap,this.is_match=null,this.destroyed=!1,this.queueRuns=0,this.groupId=0,this.namedGroups=[],this.numberGroups=[],this.traceId=0,this.traceMap=new Map,this.tracing=[],this.savedTrace=[],this.collection=null,this.collections=0,this.cache=new Map,this.splitCache=new Map,this.indices=new Map,this.indicesCount=new Map,this.lastExecs=new WeakMap,this.listeners=new Map,this.waitingListeners=new Map,this.options=Object.assign(Object.assign({},getDefaultOptions()),t),this.data=e,this.id=0,this.options.useCache?(this.pathGet=this.cacheGet,this.pathSet=this.cacheSet):(this.pathGet=ObjectPath.get,this.pathSet=ObjectPath.set),t.Promise?this.resolved=t.Promise.resolve():this.resolved=Promise.resolve(),this.muted=new Set,this.mutedListeners=new Set,this.scan=new WildcardObject(this.data,this.options.delimiter,this.options.wildcard),this.destroyed=!1}getDefaultListenerOptions(){return{bulk:!1,bulkValue:this.options.defaultBulkValue,debug:!1,source:"",data:void 0,queue:!1,group:!1}}cacheGet(e,t=this.data,r=!1){const a=e.join(this.options.delimiter),n=this.cache.get(a);if(n){const e=n.deref();if(e)return e}const s=ObjectPath.get(e,t,r);return(isObject$2(s)||Array.isArray(s))&&this.cache.set(a,new WeakRef(s)),s}cacheSet(e,t,r=this.data){const a=e.join(this.options.delimiter);return isObject$2(t)||Array.isArray(t)?this.cache.set(a,new WeakRef(t)):this.cache.delete(a),ObjectPath.set(e,t,r)}silentSet(e,t){return this.pathSet(this.split(e),t,this.data)}loadWasmMatcher(e){return __awaiter(this,void 0,void 0,(function*(){yield init(e),this.is_match=is_match,this.scan=new WildcardObject(this.data,this.options.delimiter,this.options.wildcard,this.is_match)}))}same(e,t){return(["number","string","undefined","boolean"].includes(typeof e)||null===e)&&t===e}getListeners(){return this.listeners}destroy(){this.destroyed=!0,this.data=void 0,this.listeners=new Map,this.waitingListeners=new Map,this.updateQueue=[],this.jobsRunning=0}match(e,t,r=!0){return this.is_match?this.is_match(e,t):e===t||(e===this.options.wildcard||t===this.options.wildcard||!(!r&&this.getIndicesCount(this.options.delimiter,e)<this.getIndicesCount(this.options.delimiter,t))&&this.scan.match(e,t))}getIndicesOf(e,t){if(this.options.useIndicesCache&&this.indices.has(t))return this.indices.get(t);const r=e.length;if(0==r)return[];let a,n=0,s=[];for(;(a=t.indexOf(e,n))>-1;)s.push(a),n=a+r;return this.options.useIndicesCache&&this.indices.set(t,s),s}getIndicesCount(e,t){if(this.options.useIndicesCache&&this.indicesCount.has(t))return this.indicesCount.get(t);const r=e.length;if(0==r)return 0;let a,n=0,s=0;for(;(a=t.indexOf(e,n))>-1;)s++,n=a+r;return this.options.useIndicesCache&&this.indicesCount.set(t,s),s}cutPath(e,t){if(""===t)return"";if((e=this.cleanNotRecursivePath(e))===(t=this.cleanNotRecursivePath(t)))return e;const r=this.getIndicesCount(this.options.delimiter,t),a=this.getIndicesOf(this.options.delimiter,e);return e.substring(0,a[r])}trimPath(e){return(e=this.cleanNotRecursivePath(e)).charAt(0)===this.options.delimiter?e.substr(1):e}split(e){if(""===e)return[];if(!this.options.useSplitCache)return e.split(this.options.delimiter);const t=this.splitCache.get(e);if(t)return t.slice();const r=e.split(this.options.delimiter);return this.splitCache.set(e,r.slice()),r}isWildcard(e){return e.includes(this.options.wildcard)||this.hasParams(e)}isNotRecursive(e){return e.endsWith(this.options.notRecursive)}cleanNotRecursivePath(e){return this.isNotRecursive(e)?e.substring(0,e.length-1):e}hasParams(e){return e.includes(this.options.param)}getParamsInfo(e){let t={replaced:"",original:e,params:{}},r=0,a=[];for(const n of this.split(e)){t.params[r]={original:n,replaced:"",name:""};const e=new RegExp(`\\${this.options.param}([^\\${this.options.delimiter}\\${this.options.param}]+)`,"g");let s=e.exec(n);s?(t.params[r].name=s[1],e.lastIndex=0,t.params[r].replaced=n.replace(e,this.options.wildcard),a.push(t.params[r].replaced),r++):(delete t.params[r],a.push(n),r++)}return t.replaced=a.join(this.options.delimiter),t}getParams(e,t){if(!e)return;const r=this.split(t),a={};for(const n in e.params){a[e.params[n].name]=r[n]}return a}waitForAll(e,t){const r={};for(let a of e)r[a]={dirty:!1},this.hasParams(a)&&(r[a].paramsInfo=this.getParamsInfo(a)),r[a].isWildcard=this.isWildcard(a),r[a].isRecursive=!this.isNotRecursive(a);return this.waitingListeners.set(e,{fn:t,paths:r}),t(r),function(){this.waitingListeners.delete(e)}}executeWaitingListeners(e){if(!this.destroyed)for(const t of this.waitingListeners.values()){const{fn:r,paths:a}=t;let n=0,s=0;for(let t in a){const r=a[t];let o=!1;r.isRecursive&&(e=this.cutPath(e,t)),r.isWildcard&&this.match(t,e)&&(o=!0),e===t&&(o=!0),o&&(r.dirty=!0),r.dirty&&n++,s++}n===s&&r(a)}}subscribeAll(e,t,r=this.getDefaultListenerOptions()){if(this.destroyed)return()=>{};let a=[],n=0,s=null;"boolean"==typeof r.group&&r.group?(this.groupId++,s=this.groupId,r.bulk=!0):"string"==typeof r.group&&(r.bulk=!0,s=r.group);for(const o of e)a.push(this.subscribe(o,t,r,{all:e,index:n,groupId:s})),n++;return function(){for(const e of a)e()}}getCleanListenersCollection(e={}){return Object.assign({listeners:new Map,isRecursive:!1,isWildcard:!1,hasParams:!1,match:void 0,paramsInfo:void 0,path:void 0,originalPath:void 0,count:0},e)}getCleanListener(e,t=this.getDefaultListenerOptions()){return{fn:e,options:Object.assign(Object.assign({},this.getDefaultListenerOptions()),t),groupId:null}}getListenerCollectionMatch(e,t,r){e=this.cleanNotRecursivePath(e);const a=this;return function(n,s=!1){let o=e;return t?n=a.cutPath(n,e):o=a.cutPath(a.cleanNotRecursivePath(e),n),s&&console.log("[getListenerCollectionMatch]",{listenerPath:e,scopedListenerPath:o,path:n,isRecursive:t,isWildcard:r}),!(!r||!a.match(o,n,t))||o===n}}getListenersCollection(e,t){if(this.listeners.has(e)){let r=this.listeners.get(e);return r.listeners.set(++this.id,t),t.id=this.id,r}const r=this.hasParams(e);let a;r&&(a=this.getParamsInfo(e));let n={isRecursive:!this.isNotRecursive(e),isWildcard:this.isWildcard(e),hasParams:r,paramsInfo:a,originalPath:e,path:r?a.replaced:e};n.isRecursive||(n.path=this.cleanNotRecursivePath(n.path));let s=this.getCleanListenersCollection(Object.assign(Object.assign({},n),{match:this.getListenerCollectionMatch(n.path,n.isRecursive,n.isWildcard)}));return this.id++,s.listeners.set(this.id,t),t.id=this.id,this.listeners.set(n.originalPath,s),s}subscribe(e,t,r=this.getDefaultListenerOptions(),a={all:[e],index:0,groupId:null}){if(this.destroyed)return()=>{};this.jobsRunning++;const n="subscribe";let s=this.getCleanListener(t,r);r.group&&(r.bulk=!0,"string"==typeof r.group?s.groupId=r.group:a.groupId&&(s.groupId=a.groupId)),this.listenersIgnoreCache.set(s,{truthy:[],falsy:[]});const o=this.getListenersCollection(e,s);r.debug&&console.log("[subscribe]",{listenerPath:e,options:r}),o.count++;let i=!0;if(s.groupId&&("string"==typeof s.groupId?this.namedGroups.includes(s.groupId)?i=!1:this.namedGroups.push(s.groupId):"number"==typeof s.groupId&&(this.numberGroups.includes(s.groupId)?i=!1:this.numberGroups.push(s.groupId))),i){const a=this.cleanNotRecursivePath(o.path),i=this.split(a);if(o.isWildcard){const i=this.scan.get(a);if(r.bulk){const a=[];for(const e in i)this.isMuted(e)||a.push({path:e,params:this.getParams(o.paramsInfo,e),value:i[e]});this.isMuted(t)||t(a,{type:n,listener:s,listenersCollection:o,path:{listener:e,update:void 0,resolved:void 0},options:r,params:void 0})}else for(const a in i)this.isMuted(a)||this.isMuted(t)||t(i[a],{type:n,listener:s,listenersCollection:o,path:{listener:e,update:void 0,resolved:this.cleanNotRecursivePath(a)},params:this.getParams(o.paramsInfo,a),options:r})}else this.isMuted(a)||this.isMuted(t)||t(this.pathGet(i,this.data),{type:n,listener:s,listenersCollection:o,path:{listener:e,update:void 0,resolved:this.cleanNotRecursivePath(e)},params:this.getParams(o.paramsInfo,a),options:r})}return this.debugSubscribe(s,o,e),this.jobsRunning--,this.unsubscribe(e,this.id)}unsubscribe(e,t){const r=this.listeners,a=r.get(e);return function(){a.listeners.delete(t),a.count--,0===a.count&&r.delete(e)}}runQueuedListeners(){if(!this.destroyed&&0!==this.subscribeQueue.length)if(0===this.jobsRunning){this.queueRuns=0;const e=[...this.subscribeQueue];for(let t=0,r=e.length;t<r;t++)e[t]();this.subscribeQueue.length=0}else{if(this.queueRuns++,this.queueRuns>=this.options.maxQueueRuns)throw this.queueRuns=0,new Error("Maximal number of queue runs exhausted.");Promise.resolve().then((()=>this.runQueuedListeners())).catch((e=>{throw e}))}}getQueueNotifyListeners(e,t=[]){for(const r in e){if(this.isMuted(r))continue;let{single:a,bulk:n}=e[r];for(const e of a){let r=!1,a=e.listener.id+":"+e.eventInfo.path.resolved;e.eventInfo.path.resolved||(a=e.listener.id+":"+e.eventInfo.path.listener);for(const e of t)if(a===e.resolvedIdPath){r=!0;break}if(r)continue;const n=this.debugTime(e);if(!this.isMuted(e.listener.fn))if(e.listener.options.queue&&this.jobsRunning)this.subscribeQueue.push((()=>{e.listener.fn(e.value?e.value():void 0,e.eventInfo)}));else{let r=e.listener.id+":"+e.eventInfo.path.resolved;e.eventInfo.path.resolved||(r=e.listener.id+":"+e.eventInfo.path.listener),t.push({id:e.listener.id,resolvedPath:e.eventInfo.path.resolved,resolvedIdPath:r,originalFn:e.listener.fn,fn:()=>{e.listener.fn(e.value?e.value():void 0,e.eventInfo)},options:e.listener.options,groupId:e.listener.groupId})}this.debugListener(n,e)}for(const e of n){let r=!1;for(const s of t)if(s.id===e.listener.id){r=!0;break}if(r)continue;const a=this.debugTime(e),n=[];for(const t of e.value)n.push(Object.assign(Object.assign({},t),{value:t.value?t.value():void 0}));if(!this.isMuted(e.listener.fn))if(e.listener.options.queue&&this.jobsRunning)this.subscribeQueue.push((()=>!this.jobsRunning&&(e.listener.fn(n,e.eventInfo),!0)));else{let r=e.listener.id+":"+e.eventInfo.path.resolved;e.eventInfo.path.resolved||(r=e.listener.id+":"+e.eventInfo.path.listener),t.push({id:e.listener.id,resolvedPath:e.eventInfo.path.resolved,resolvedIdPath:r,originalFn:e.listener.fn,fn:()=>{e.listener.fn(n,e.eventInfo)},options:e.listener.options,groupId:e.listener.groupId})}this.debugListener(a,e)}}return Promise.resolve().then((()=>this.runQueuedListeners())),t}shouldIgnore(e,t){if(!e.options.ignore)return!1;for(const r of e.options.ignore){if(t.startsWith(r))return!0;if(this.is_match&&this.is_match(r,t))return!0;{const e=this.cutPath(t,r);if(this.match(r,e))return!0}}return!1}getSubscribedListeners(e,t,r,a="update",n=null){r=Object.assign(Object.assign({},defaultUpdateOptions),r);const s={};for(let[o,i]of this.listeners)if(i.match(e)){s[o]={single:[],bulk:[],bulkData:[]};const c=i.paramsInfo?this.getParams(i.paramsInfo,e):void 0,u=this.cutPath(e,o),l=i.isRecursive||i.isWildcard?()=>this.get(u):()=>t,d=[{value:l,path:e,params:c}];for(const t of i.listeners.values())this.shouldIgnore(t,e)?t.options.debug&&console.log("[getSubscribedListeners] Listener was not fired because it was ignored.",{listener:t,listenersCollection:i}):t.options.bulk?s[o].bulk.push({listener:t,listenersCollection:i,eventInfo:{type:a,listener:t,path:{listener:o,update:n||e,resolved:void 0},params:c,options:r},value:d}):s[o].single.push({listener:t,listenersCollection:i,eventInfo:{type:a,listener:t,path:{listener:o,update:n||e,resolved:this.cleanNotRecursivePath(e)},params:c,options:r},value:l})}else if(this.options.extraDebug){let t=!1;for(const r of i.listeners.values())r.options.debug&&(t=!0,console.log("[getSubscribedListeners] Listener was not fired because there was no match.",{listener:r,listenersCollection:i,updatePath:e}));t&&i.match(e,!0)}return s}notifySubscribedListeners(e,t,r,a="update",n=null){return this.getQueueNotifyListeners(this.getSubscribedListeners(e,t,r,a,n))}useBulkValue(e){for(const[t,r]of e.listeners){if(r.options.bulk&&r.options.bulkValue)return!0;if(!r.options.bulk)return!0}return!1}getNestedListeners(e,t,r,a="update",n=null){const s={},o={};for(let[i,c]of this.listeners){if(!c.isRecursive)continue;const u=this.cutPath(i,e);if(this.match(u,e)){s[i]={single:[],bulk:[]};const l=this.trimPath(i.substr(u.length)),d=this.useBulkValue(c);let p;d&&(p=o[l]?o[l]:new WildcardObject(t,this.options.delimiter,this.options.wildcard).get(l),o[l]=p);const h=c.paramsInfo?this.getParams(c.paramsInfo,e):void 0,f=[],g={};for(const[t,o]of c.listeners)if(d)for(const u in p){const l=()=>p[u],d=[e,u].join(this.options.delimiter),y={type:a,listener:o,listenersCollection:c,path:{listener:i,update:n||e,resolved:this.cleanNotRecursivePath(d)},params:h,options:r};this.shouldIgnore(o,e)||(o.options.bulk?(f.push({value:l,path:d,params:h}),g[t]=o):s[i].single.push({listener:o,listenersCollection:c,eventInfo:y,value:l}))}else{const u={type:a,listener:o,listenersCollection:c,path:{listener:i,update:n||e,resolved:void 0},params:h,options:r};if(this.shouldIgnore(o,e))continue;o.options.bulk?(f.push({value:void 0,path:void 0,params:h}),g[t]=o):s[i].single.push({listener:o,listenersCollection:c,eventInfo:u,value:void 0})}for(const t in g){const n=g[t],o={type:a,listener:n,listenersCollection:c,path:{listener:i,update:e,resolved:void 0},options:r,params:h};s[i].bulk.push({listener:n,listenersCollection:c,eventInfo:o,value:f})}}else if(this.options.extraDebug)for(const t of c.listeners.values())t.options.debug&&console.log("[getNestedListeners] Listener was not fired because there was no match.",{listener:t,listenersCollection:c,currentCutPath:u,updatePath:e})}return s}notifyNestedListeners(e,t,r,a="update",n,s=null){return this.getQueueNotifyListeners(this.getNestedListeners(e,t,r,a,s),n)}getNotifyOnlyListeners(e,t,r,a="update",n=null){const s={};if("object"!=typeof r.only||!Array.isArray(r.only)||void 0===r.only[0]||!this.canBeNested(t))return s;for(const o of r.only){const i=new WildcardObject(t,this.options.delimiter,this.options.wildcard).get(o);s[o]={bulk:[],single:[]};for(const t in i){const c=e+this.options.delimiter+t;for(const[u,l]of this.listeners){const d=l.paramsInfo?this.getParams(l.paramsInfo,c):void 0;if(this.match(u,c)){const p=()=>i[t],h=[{value:p,path:c,params:d}];for(const t of l.listeners.values()){const i={type:a,listener:t,listenersCollection:l,path:{listener:u,update:n||e,resolved:this.cleanNotRecursivePath(c)},params:d,options:r};this.shouldIgnore(t,e)||(t.options.bulk?s[o].bulk.some((e=>e.listener===t))||s[o].bulk.push({listener:t,listenersCollection:l,eventInfo:i,value:h}):s[o].single.push({listener:t,listenersCollection:l,eventInfo:i,value:p}))}}}}}return s}runQueue(e){const t=[];for(const r of e)r.options.group?t.includes(r.groupId)||(r.fn(),t.push(r.groupId)):r.fn()}sortAndRunQueue(e,t){e.sort((function(e,t){return e.id-t.id})),this.options.debug&&console.log(`[deep-state-observer] queue for ${t}`,e),this.runQueue(e)}notifyOnly(e,t,r,a="update",n=""){const s=this.getQueueNotifyListeners(this.getNotifyOnlyListeners(e,t,r,a,n));this.sortAndRunQueue(s,e)}canBeNested(e){return"object"==typeof e&&null!==e}getUpdateValues(e,t){let r=t;return"function"==typeof t&&(r=t(e)),{newValue:r,oldValue:e}}wildcardNotify(e,t){let r=[];for(const a of e)this.getQueueNotifyListeners(a,r);for(const a of t)this.executeWaitingListeners(a);return this.jobsRunning--,r}wildcardUpdate(e,t,r=defaultUpdateOptions,a=!1){++this.jobsRunning,r=Object.assign(Object.assign({},defaultUpdateOptions),r);const n=this.scan.get(e),s={};for(const u in n){const e=this.split(u),{oldValue:a,newValue:o}=this.getUpdateValues(n[u],t);this.same(o,a)&&!r.force||(this.pathSet(e,o,this.data),s[u]=o)}const o=[],i=[];for(const u in s){const t=s[u];r.only.length?o.push(this.getNotifyOnlyListeners(u,t,r,"update",e)):(o.push(this.getSubscribedListeners(u,t,r,"update",e)),this.canBeNested(t)&&o.push(this.getNestedListeners(u,t,r,"update",e))),r.debug&&this.options.log("Wildcard update",{path:u,newValue:t}),i.push(u)}if(a){const t=this;return function(){const r=t.wildcardNotify(o,i);t.sortAndRunQueue(r,e)}}const c=this.wildcardNotify(o,i);this.sortAndRunQueue(c,e)}runUpdateQueue(){if(!this.destroyed)for(;this.updateQueue.length&&this.updateQueue.length<this.options.maxSimultaneousJobs;){const e=this.updateQueue.shift();e.options.queue=!1,this.update(e.updatePath,e.fnOrValue,e.options,e.multi)}}updateNotify(e,t,r){const a=this.notifySubscribedListeners(e,t,r);this.canBeNested(t)&&this.notifyNestedListeners(e,t,r,"update",a),this.sortAndRunQueue(a,e),this.executeWaitingListeners(e)}updateNotifyAll(e){let t=[];for(const r of e){const e=r.newValue;if(this.tracing.length){const t=this.tracing[this.tracing.length-1],a=this.traceMap.get(t);a.changed.push({traceId:t,updatePath:r.updatePath,fnOrValue:e,options:r.options}),this.traceMap.set(t,a)}t=t.concat(this.notifySubscribedListeners(r.updatePath,e,r.options)),this.canBeNested(r.newValue)&&this.notifyNestedListeners(r.updatePath,e,r.options,"update",t)}this.runQueue(t)}updateNotifyOnly(e,t,r){this.notifyOnly(e,t,r),this.executeWaitingListeners(e)}update(e,t,r=Object.assign({},defaultUpdateOptions),a=!1){if(this.destroyed)return;if(this.collection)return this.collection.update(e,t,r);if(this.tracing.length){const a=this.tracing[this.tracing.length-1],n=this.traceMap.get(a);n.changed.push({traceId:a,updatePath:e,fnOrValue:t,options:r}),this.traceMap.set(a,n)}const n=this.jobsRunning;if((this.options.queue||r.queue)&&n){if(n>this.options.maxSimultaneousJobs)throw new Error("Maximal simultaneous jobs limit reached.");this.updateQueue.push({updatePath:e,fnOrValue:t,options:r,multi:a});const s=Promise.resolve().then((()=>{this.runUpdateQueue()}));return a?function(){return s}:s}if(this.isWildcard(e))return this.wildcardUpdate(e,t,r,a);++this.jobsRunning;const s=this.split(e),o=this.pathGet(s,this.data);let{oldValue:i,newValue:c}=this.getUpdateValues(o,t);if(r.debug&&this.options.log(`Updating ${e} ${r.source?`from ${r.source}`:""}`,{oldValue:i,newValue:c}),this.same(c,i)&&!r.force)return--this.jobsRunning,a?function(){return c}:c;if(this.pathSet(s,c,this.data),null===(r=Object.assign(Object.assign({},defaultUpdateOptions),r)).only)return--this.jobsRunning,a?function(){}:c;if(r.only.length){if(--this.jobsRunning,a){const t=this;return function(){return t.updateNotifyOnly(e,c,r)}}return this.updateNotifyOnly(e,c,r),c}if(a){--this.jobsRunning;const t=this;return function(){return t.updateNotify(e,c,r)}}return this.updateNotify(e,c,r),--this.jobsRunning,c}multi(e=!1){if(this.destroyed)return{update(){return this},done(){},getStack:()=>[]};if(this.collection)return this.collection;const t=this,r=[],a=[];return{update(n,s,o=defaultUpdateOptions){if(e){const e=t.split(n);let a=s;const i=t.pathGet(e,t.data);"function"==typeof a&&(a=a(i)),t.pathSet(e,a,t.data),r.push({updatePath:n,newValue:a,options:o})}else a.push(t.update(n,s,o,!0));return this},done(){if(0===t.collections){if(e)t.updateNotifyAll(r);else for(const e of a)e();r.length=0}},getStack:()=>r}}collect(){return this.collections++,this.collection||(this.collection=this.multi(!0)),this.collection}executeCollected(){if(this.collections--,0===this.collections&&this.collection){const e=this.collection;this.collection=null,e.done()}}getCollectedCount(){return this.collections}getCollectedStack(){return this.collection?this.collection.getStack():[]}get(e=void 0){if(!this.destroyed)return void 0===e||""===e?this.data:this.isWildcard(e)?this.scan.get(e):this.pathGet(this.split(e),this.data)}last(e){let t=this.lastExecs.get(e);t||(t={calls:0},this.lastExecs.set(e,t));const r=++t.calls;this.resolved.then((()=>{r===t.calls&&(this.lastExecs.set(e,{calls:0}),e())}))}isMuted(e){if(!this.options.useMute)return!1;if("function"==typeof e)return this.isMutedListener(e);for(const t of this.muted){const r=!this.isNotRecursive(t),a=this.trimPath(t);if(this.match(e,a))return!0;if(this.match(a,e))return!0;if(r){const r=this.cutPath(a,e);if(this.match(r,t))return!0;if(this.match(t,r))return!0}}return!1}isMutedListener(e){return this.mutedListeners.has(e)}mute(e){if("function"==typeof e)return this.mutedListeners.add(e);this.muted.add(e)}unmute(e){if("function"==typeof e)return this.mutedListeners.delete(e);this.muted.delete(e)}debugSubscribe(e,t,r){e.options.debug&&this.options.log("listener subscribed",{listenerPath:r,listener:e,listenersCollection:t})}debugListener(e,t){(t.eventInfo.options.debug||t.listener.options.debug)&&this.options.log("Listener fired",{time:Date.now()-e,info:t})}debugTime(e){return e.listener.options.debug||e.eventInfo.options.debug?Date.now():0}startTrace(e,t=null){this.traceId++;const r=this.traceId+":"+e;return this.traceMap.set(r,{id:r,sort:this.traceId,stack:this.tracing.map((e=>e)),additionalData:t,changed:[]}),this.tracing.push(r),r}stopTrace(e){const t=this.traceMap.get(e);return this.tracing.pop(),this.traceMap.delete(e),t}saveTrace(e){const t=this.traceMap.get(e);return this.tracing.pop(),this.traceMap.delete(e),this.savedTrace.push(t),t}getSavedTraces(){const e=this.savedTrace.map((e=>e));return e.sort(((e,t)=>e.sort-t.sort)),this.savedTrace=[],e}}var freeGlobal="object"==typeof global&&global&&global.Object===Object&&global,freeSelf="object"==typeof self&&self&&self.Object===Object&&self,root=freeGlobal||freeSelf||Function("return this")(),Symbol$1=root.Symbol,objectProto$c=Object.prototype,hasOwnProperty$9=objectProto$c.hasOwnProperty,nativeObjectToString$1=objectProto$c.toString,symToStringTag$1=Symbol$1?Symbol$1.toStringTag:void 0;function getRawTag(e){var t=hasOwnProperty$9.call(e,symToStringTag$1),r=e[symToStringTag$1];try{e[symToStringTag$1]=void 0;var a=!0}catch(s){}var n=nativeObjectToString$1.call(e);return a&&(t?e[symToStringTag$1]=r:delete e[symToStringTag$1]),n}var objectProto$b=Object.prototype,nativeObjectToString=objectProto$b.toString;function objectToString(e){return nativeObjectToString.call(e)}var nullTag="[object Null]",undefinedTag="[object Undefined]",symToStringTag=Symbol$1?Symbol$1.toStringTag:void 0;function baseGetTag(e){return null==e?void 0===e?undefinedTag:nullTag:symToStringTag&&symToStringTag in Object(e)?getRawTag(e):objectToString(e)}function isObjectLike(e){return null!=e&&"object"==typeof e}var isArray=Array.isArray;function isObject$1(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}function identity(e){return e}var asyncTag="[object AsyncFunction]",funcTag$2="[object Function]",genTag$1="[object GeneratorFunction]",proxyTag="[object Proxy]";function isFunction(e){if(!isObject$1(e))return!1;var t=baseGetTag(e);return t==funcTag$2||t==genTag$1||t==asyncTag||t==proxyTag}var coreJsData=root["__core-js_shared__"],maskSrcKey=function(){var e=/[^.]+$/.exec(coreJsData&&coreJsData.keys&&coreJsData.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();function isMasked(e){return!!maskSrcKey&&maskSrcKey in e}var funcProto$1=Function.prototype,funcToString$1=funcProto$1.toString;function toSource(e){if(null!=e){try{return funcToString$1.call(e)}catch(t){}try{return e+""}catch(t){}}return""}var reRegExpChar=/[\\^$.*+?()[\]{}|]/g,reIsHostCtor=/^\[object .+?Constructor\]$/,funcProto=Function.prototype,objectProto$a=Object.prototype,funcToString=funcProto.toString,hasOwnProperty$8=objectProto$a.hasOwnProperty,reIsNative=RegExp("^"+funcToString.call(hasOwnProperty$8).replace(reRegExpChar,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function baseIsNative(e){return!(!isObject$1(e)||isMasked(e))&&(isFunction(e)?reIsNative:reIsHostCtor).test(toSource(e))}function getValue(e,t){return null==e?void 0:e[t]}function getNative(e,t){var r=getValue(e,t);return baseIsNative(r)?r:void 0}var WeakMap$1=getNative(root,"WeakMap"),objectCreate=Object.create,baseCreate=function(){function e(){}return function(t){if(!isObject$1(t))return{};if(objectCreate)return objectCreate(t);e.prototype=t;var r=new e;return e.prototype=void 0,r}}();function apply(e,t,r){switch(r.length){case 0:return e.call(t);case 1:return e.call(t,r[0]);case 2:return e.call(t,r[0],r[1]);case 3:return e.call(t,r[0],r[1],r[2])}return e.apply(t,r)}function noop(){}var HOT_COUNT=800,HOT_SPAN=16,nativeNow=Date.now;function shortOut(e){var t=0,r=0;return function(){var a=nativeNow(),n=HOT_SPAN-(a-r);if(r=a,n>0){if(++t>=HOT_COUNT)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}function constant(e){return function(){return e}}var defineProperty=function(){try{var e=getNative(Object,"defineProperty");return e({},"",{}),e}catch(t){}}(),baseSetToString=defineProperty?function(e,t){return defineProperty(e,"toString",{configurable:!0,enumerable:!1,value:constant(t),writable:!0})}:identity,setToString=shortOut(baseSetToString);function arrayEach(e,t){for(var r=-1,a=null==e?0:e.length;++r<a&&!1!==t(e[r],r,e););return e}function baseFindIndex(e,t,r,a){for(var n=e.length,s=r+-1;++s<n;)if(t(e[s],s,e))return s;return-1}function baseIsNaN(e){return e!=e}function strictIndexOf(e,t,r){for(var a=r-1,n=e.length;++a<n;)if(e[a]===t)return a;return-1}function baseIndexOf(e,t,r){return t==t?strictIndexOf(e,t,r):baseFindIndex(e,baseIsNaN,r)}function arrayIncludes(e,t){return!!(null==e?0:e.length)&&baseIndexOf(e,t,0)>-1}var MAX_SAFE_INTEGER$1=9007199254740991,reIsUint=/^(?:0|[1-9]\d*)$/;function isIndex(e,t){var r=typeof e;return!!(t=null==t?MAX_SAFE_INTEGER$1:t)&&("number"==r||"symbol"!=r&&reIsUint.test(e))&&e>-1&&e%1==0&&e<t}function baseAssignValue(e,t,r){"__proto__"==t&&defineProperty?defineProperty(e,t,{configurable:!0,enumerable:!0,value:r,writable:!0}):e[t]=r}function eq(e,t){return e===t||e!=e&&t!=t}var objectProto$9=Object.prototype,hasOwnProperty$7=objectProto$9.hasOwnProperty;function assignValue(e,t,r){var a=e[t];hasOwnProperty$7.call(e,t)&&eq(a,r)&&(void 0!==r||t in e)||baseAssignValue(e,t,r)}var nativeMax=Math.max;function overRest(e,t,r){return t=nativeMax(void 0===t?e.length-1:t,0),function(){for(var a=arguments,n=-1,s=nativeMax(a.length-t,0),o=Array(s);++n<s;)o[n]=a[t+n];n=-1;for(var i=Array(t+1);++n<t;)i[n]=a[n];return i[t]=r(o),apply(e,this,i)}}function baseRest(e,t){return setToString(overRest(e,t,identity),e+"")}var MAX_SAFE_INTEGER=9007199254740991;function isLength(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=MAX_SAFE_INTEGER}function isArrayLike(e){return null!=e&&isLength(e.length)&&!isFunction(e)}var objectProto$8=Object.prototype;function isPrototype(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||objectProto$8)}function baseTimes(e,t){for(var r=-1,a=Array(e);++r<e;)a[r]=t(r);return a}var argsTag$2="[object Arguments]";function baseIsArguments(e){return isObjectLike(e)&&baseGetTag(e)==argsTag$2}var objectProto$7=Object.prototype,hasOwnProperty$6=objectProto$7.hasOwnProperty,propertyIsEnumerable$1=objectProto$7.propertyIsEnumerable,isArguments=baseIsArguments(function(){return arguments}())?baseIsArguments:function(e){return isObjectLike(e)&&hasOwnProperty$6.call(e,"callee")&&!propertyIsEnumerable$1.call(e,"callee")};function stubFalse(){return!1}var freeExports$2="object"==typeof exports&&exports&&!exports.nodeType&&exports,freeModule$2=freeExports$2&&"object"==typeof module&&module&&!module.nodeType&&module,moduleExports$2=freeModule$2&&freeModule$2.exports===freeExports$2,Buffer$1=moduleExports$2?root.Buffer:void 0,nativeIsBuffer=Buffer$1?Buffer$1.isBuffer:void 0,isBuffer=nativeIsBuffer||stubFalse,argsTag$1="[object Arguments]",arrayTag$1="[object Array]",boolTag$2="[object Boolean]",dateTag$2="[object Date]",errorTag$1="[object Error]",funcTag$1="[object Function]",mapTag$4="[object Map]",numberTag$2="[object Number]",objectTag$2="[object Object]",regexpTag$2="[object RegExp]",setTag$4="[object Set]",stringTag$2="[object String]",weakMapTag$2="[object WeakMap]",arrayBufferTag$2="[object ArrayBuffer]",dataViewTag$3="[object DataView]",float32Tag$2="[object Float32Array]",float64Tag$2="[object Float64Array]",int8Tag$2="[object Int8Array]",int16Tag$2="[object Int16Array]",int32Tag$2="[object Int32Array]",uint8Tag$2="[object Uint8Array]",uint8ClampedTag$2="[object Uint8ClampedArray]",uint16Tag$2="[object Uint16Array]",uint32Tag$2="[object Uint32Array]",typedArrayTags={};function baseIsTypedArray(e){return isObjectLike(e)&&isLength(e.length)&&!!typedArrayTags[baseGetTag(e)]}function baseUnary(e){return function(t){return e(t)}}typedArrayTags[float32Tag$2]=typedArrayTags[float64Tag$2]=typedArrayTags[int8Tag$2]=typedArrayTags[int16Tag$2]=typedArrayTags[int32Tag$2]=typedArrayTags[uint8Tag$2]=typedArrayTags[uint8ClampedTag$2]=typedArrayTags[uint16Tag$2]=typedArrayTags[uint32Tag$2]=!0,typedArrayTags[argsTag$1]=typedArrayTags[arrayTag$1]=typedArrayTags[arrayBufferTag$2]=typedArrayTags[boolTag$2]=typedArrayTags[dataViewTag$3]=typedArrayTags[dateTag$2]=typedArrayTags[errorTag$1]=typedArrayTags[funcTag$1]=typedArrayTags[mapTag$4]=typedArrayTags[numberTag$2]=typedArrayTags[objectTag$2]=typedArrayTags[regexpTag$2]=typedArrayTags[setTag$4]=typedArrayTags[stringTag$2]=typedArrayTags[weakMapTag$2]=!1;var freeExports$1="object"==typeof exports&&exports&&!exports.nodeType&&exports,freeModule$1=freeExports$1&&"object"==typeof module&&module&&!module.nodeType&&module,moduleExports$1=freeModule$1&&freeModule$1.exports===freeExports$1,freeProcess=moduleExports$1&&freeGlobal.process,nodeUtil=function(){try{var e=freeModule$1&&freeModule$1.require&&freeModule$1.require("util").types;return e||freeProcess&&freeProcess.binding&&freeProcess.binding("util")}catch(t){}}(),nodeIsTypedArray=nodeUtil&&nodeUtil.isTypedArray,isTypedArray=nodeIsTypedArray?baseUnary(nodeIsTypedArray):baseIsTypedArray,objectProto$6=Object.prototype,hasOwnProperty$5=objectProto$6.hasOwnProperty;function arrayLikeKeys(e,t){var r=isArray(e),a=!r&&isArguments(e),n=!r&&!a&&isBuffer(e),s=!r&&!a&&!n&&isTypedArray(e),o=r||a||n||s,i=o?baseTimes(e.length,String):[],c=i.length;for(var u in e)!hasOwnProperty$5.call(e,u)||o&&("length"==u||n&&("offset"==u||"parent"==u)||s&&("buffer"==u||"byteLength"==u||"byteOffset"==u)||isIndex(u,c))||i.push(u);return i}function overArg(e,t){return function(r){return e(t(r))}}var nativeKeys=overArg(Object.keys,Object),objectProto$5=Object.prototype,hasOwnProperty$4=objectProto$5.hasOwnProperty;function baseKeys(e){if(!isPrototype(e))return nativeKeys(e);var t=[];for(var r in Object(e))hasOwnProperty$4.call(e,r)&&"constructor"!=r&&t.push(r);return t}function keys(e){return isArrayLike(e)?arrayLikeKeys(e):baseKeys(e)}var nativeCreate=getNative(Object,"create");function hashClear(){this.__data__=nativeCreate?nativeCreate(null):{},this.size=0}function hashDelete(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}var HASH_UNDEFINED$2="__lodash_hash_undefined__",objectProto$3=Object.prototype,hasOwnProperty$2=objectProto$3.hasOwnProperty;function hashGet(e){var t=this.__data__;if(nativeCreate){var r=t[e];return r===HASH_UNDEFINED$2?void 0:r}return hasOwnProperty$2.call(t,e)?t[e]:void 0}var objectProto$2=Object.prototype,hasOwnProperty$1=objectProto$2.hasOwnProperty;function hashHas(e){var t=this.__data__;return nativeCreate?void 0!==t[e]:hasOwnProperty$1.call(t,e)}var HASH_UNDEFINED$1="__lodash_hash_undefined__";function hashSet(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=nativeCreate&&void 0===t?HASH_UNDEFINED$1:t,this}function Hash(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var a=e[t];this.set(a[0],a[1])}}function listCacheClear(){this.__data__=[],this.size=0}function assocIndexOf(e,t){for(var r=e.length;r--;)if(eq(e[r][0],t))return r;return-1}Hash.prototype.clear=hashClear,Hash.prototype.delete=hashDelete,Hash.prototype.get=hashGet,Hash.prototype.has=hashHas,Hash.prototype.set=hashSet;var arrayProto=Array.prototype,splice=arrayProto.splice;function listCacheDelete(e){var t=this.__data__,r=assocIndexOf(t,e);return!(r<0)&&(r==t.length-1?t.pop():splice.call(t,r,1),--this.size,!0)}function listCacheGet(e){var t=this.__data__,r=assocIndexOf(t,e);return r<0?void 0:t[r][1]}function listCacheHas(e){return assocIndexOf(this.__data__,e)>-1}function listCacheSet(e,t){var r=this.__data__,a=assocIndexOf(r,e);return a<0?(++this.size,r.push([e,t])):r[a][1]=t,this}function ListCache(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var a=e[t];this.set(a[0],a[1])}}ListCache.prototype.clear=listCacheClear,ListCache.prototype.delete=listCacheDelete,ListCache.prototype.get=listCacheGet,ListCache.prototype.has=listCacheHas,ListCache.prototype.set=listCacheSet;var Map$1=getNative(root,"Map");function mapCacheClear(){this.size=0,this.__data__={hash:new Hash,map:new(Map$1||ListCache),string:new Hash}}function isKeyable(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e}function getMapData(e,t){var r=e.__data__;return isKeyable(t)?r["string"==typeof t?"string":"hash"]:r.map}function mapCacheDelete(e){var t=getMapData(this,e).delete(e);return this.size-=t?1:0,t}function mapCacheGet(e){return getMapData(this,e).get(e)}function mapCacheHas(e){return getMapData(this,e).has(e)}function mapCacheSet(e,t){var r=getMapData(this,e),a=r.size;return r.set(e,t),this.size+=r.size==a?0:1,this}function MapCache(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var a=e[t];this.set(a[0],a[1])}}function arrayPush(e,t){for(var r=-1,a=t.length,n=e.length;++r<a;)e[n+r]=t[r];return e}MapCache.prototype.clear=mapCacheClear,MapCache.prototype.delete=mapCacheDelete,MapCache.prototype.get=mapCacheGet,MapCache.prototype.has=mapCacheHas,MapCache.prototype.set=mapCacheSet;var spreadableSymbol=Symbol$1?Symbol$1.isConcatSpreadable:void 0;function isFlattenable(e){return isArray(e)||isArguments(e)||!!(spreadableSymbol&&e&&e[spreadableSymbol])}function baseFlatten(e,t,r,a,n){var s=-1,o=e.length;for(r||(r=isFlattenable),n||(n=[]);++s<o;){var i=e[s];r(i)&&arrayPush(n,i)}return n}var getPrototype=overArg(Object.getPrototypeOf,Object);function stackClear(){this.__data__=new ListCache,this.size=0}function stackDelete(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r}function stackGet(e){return this.__data__.get(e)}function stackHas(e){return this.__data__.has(e)}var LARGE_ARRAY_SIZE$1=200;function stackSet(e,t){var r=this.__data__;if(r instanceof ListCache){var a=r.__data__;if(!Map$1||a.length<LARGE_ARRAY_SIZE$1-1)return a.push([e,t]),this.size=++r.size,this;r=this.__data__=new MapCache(a)}return r.set(e,t),this.size=r.size,this}function Stack(e){var t=this.__data__=new ListCache(e);this.size=t.size}Stack.prototype.clear=stackClear,Stack.prototype.delete=stackDelete,Stack.prototype.get=stackGet,Stack.prototype.has=stackHas,Stack.prototype.set=stackSet;var freeExports="object"==typeof exports&&exports&&!exports.nodeType&&exports,freeModule=freeExports&&"object"==typeof module&&module&&!module.nodeType&&module,moduleExports=freeModule&&freeModule.exports===freeExports,Buffer=moduleExports?root.Buffer:void 0;function cloneBuffer(e,t){return e.slice()}function arrayFilter(e,t){for(var r=-1,a=null==e?0:e.length,n=0,s=[];++r<a;){var o=e[r];t(o,r,e)&&(s[n++]=o)}return s}function stubArray(){return[]}Buffer&&Buffer.allocUnsafe;var objectProto$1=Object.prototype,propertyIsEnumerable=objectProto$1.propertyIsEnumerable,nativeGetSymbols$1=Object.getOwnPropertySymbols,getSymbols=nativeGetSymbols$1?function(e){return null==e?[]:(e=Object(e),arrayFilter(nativeGetSymbols$1(e),(function(t){return propertyIsEnumerable.call(e,t)})))}:stubArray;function baseGetAllKeys(e,t,r){var a=t(e);return isArray(e)?a:arrayPush(a,r(e))}function getAllKeys(e){return baseGetAllKeys(e,keys,getSymbols)}var DataView=getNative(root,"DataView"),Promise$1=getNative(root,"Promise"),Set$1=getNative(root,"Set"),mapTag$3="[object Map]",objectTag$1="[object Object]",promiseTag="[object Promise]",setTag$3="[object Set]",weakMapTag$1="[object WeakMap]",dataViewTag$2="[object DataView]",dataViewCtorString=toSource(DataView),mapCtorString=toSource(Map$1),promiseCtorString=toSource(Promise$1),setCtorString=toSource(Set$1),weakMapCtorString=toSource(WeakMap$1),getTag=baseGetTag;(DataView&&getTag(new DataView(new ArrayBuffer(1)))!=dataViewTag$2||Map$1&&getTag(new Map$1)!=mapTag$3||Promise$1&&getTag(Promise$1.resolve())!=promiseTag||Set$1&&getTag(new Set$1)!=setTag$3||WeakMap$1&&getTag(new WeakMap$1)!=weakMapTag$1)&&(getTag=function(e){var t=baseGetTag(e),r=t==objectTag$1?e.constructor:void 0,a=r?toSource(r):"";if(a)switch(a){case dataViewCtorString:return dataViewTag$2;case mapCtorString:return mapTag$3;case promiseCtorString:return promiseTag;case setCtorString:return setTag$3;case weakMapCtorString:return weakMapTag$1}return t});var objectProto=Object.prototype,hasOwnProperty=objectProto.hasOwnProperty;function initCloneArray(e){var t=e.length,r=new e.constructor(t);return t&&"string"==typeof e[0]&&hasOwnProperty.call(e,"index")&&(r.index=e.index,r.input=e.input),r}var Uint8Array$1=root.Uint8Array;function cloneArrayBuffer(e){var t=new e.constructor(e.byteLength);return new Uint8Array$1(t).set(new Uint8Array$1(e)),t}function cloneDataView(e,t){var r=cloneArrayBuffer(e.buffer);return new e.constructor(r,e.byteOffset,e.byteLength)}var reFlags=/\w*$/;function cloneRegExp(e){var t=new e.constructor(e.source,reFlags.exec(e));return t.lastIndex=e.lastIndex,t}var symbolProto=Symbol$1?Symbol$1.prototype:void 0,symbolValueOf=symbolProto?symbolProto.valueOf:void 0;function cloneSymbol(e){return symbolValueOf?Object(symbolValueOf.call(e)):{}}function cloneTypedArray(e,t){var r=cloneArrayBuffer(e.buffer);return new e.constructor(r,e.byteOffset,e.length)}var boolTag$1="[object Boolean]",dateTag$1="[object Date]",mapTag$2="[object Map]",numberTag$1="[object Number]",regexpTag$1="[object RegExp]",setTag$2="[object Set]",stringTag$1="[object String]",symbolTag$1="[object Symbol]",arrayBufferTag$1="[object ArrayBuffer]",dataViewTag$1="[object DataView]",float32Tag$1="[object Float32Array]",float64Tag$1="[object Float64Array]",int8Tag$1="[object Int8Array]",int16Tag$1="[object Int16Array]",int32Tag$1="[object Int32Array]",uint8Tag$1="[object Uint8Array]",uint8ClampedTag$1="[object Uint8ClampedArray]",uint16Tag$1="[object Uint16Array]",uint32Tag$1="[object Uint32Array]";function initCloneByTag(e,t,r){var a=e.constructor;switch(t){case arrayBufferTag$1:return cloneArrayBuffer(e);case boolTag$1:case dateTag$1:return new a(+e);case dataViewTag$1:return cloneDataView(e);case float32Tag$1:case float64Tag$1:case int8Tag$1:case int16Tag$1:case int32Tag$1:case uint8Tag$1:case uint8ClampedTag$1:case uint16Tag$1:case uint32Tag$1:return cloneTypedArray(e);case mapTag$2:return new a;case numberTag$1:case stringTag$1:return new a(e);case regexpTag$1:return cloneRegExp(e);case setTag$2:return new a;case symbolTag$1:return cloneSymbol(e)}}function initCloneObject(e){return"function"!=typeof e.constructor||isPrototype(e)?{}:baseCreate(getPrototype(e))}var mapTag$1="[object Map]";function baseIsMap(e){return isObjectLike(e)&&getTag(e)==mapTag$1}var nodeIsMap=nodeUtil&&nodeUtil.isMap,isMap=nodeIsMap?baseUnary(nodeIsMap):baseIsMap,setTag$1="[object Set]";function baseIsSet(e){return isObjectLike(e)&&getTag(e)==setTag$1}var nodeIsSet=nodeUtil&&nodeUtil.isSet,isSet=nodeIsSet?baseUnary(nodeIsSet):baseIsSet,argsTag="[object Arguments]",arrayTag="[object Array]",boolTag="[object Boolean]",dateTag="[object Date]",errorTag="[object Error]",funcTag="[object Function]",genTag="[object GeneratorFunction]",mapTag="[object Map]",numberTag="[object Number]",objectTag="[object Object]",regexpTag="[object RegExp]",setTag="[object Set]",stringTag="[object String]",symbolTag="[object Symbol]",weakMapTag="[object WeakMap]",arrayBufferTag="[object ArrayBuffer]",dataViewTag="[object DataView]",float32Tag="[object Float32Array]",float64Tag="[object Float64Array]",int8Tag="[object Int8Array]",int16Tag="[object Int16Array]",int32Tag="[object Int32Array]",uint8Tag="[object Uint8Array]",uint8ClampedTag="[object Uint8ClampedArray]",uint16Tag="[object Uint16Array]",uint32Tag="[object Uint32Array]",cloneableTags={};function baseClone(e,t,r,a,n,s){var o;if(void 0!==o)return o;if(!isObject$1(e))return e;var i=isArray(e);if(i)o=initCloneArray(e);else{var c=getTag(e),u=c==funcTag||c==genTag;if(isBuffer(e))return cloneBuffer(e);if(c==objectTag||c==argsTag||u&&!n)o=u?{}:initCloneObject(e);else{if(!cloneableTags[c])return n?e:{};o=initCloneByTag(e,c)}}s||(s=new Stack);var l=s.get(e);if(l)return l;s.set(e,o),isSet(e)?e.forEach((function(a){o.add(baseClone(a,t,r,a,e,s))})):isMap(e)&&e.forEach((function(a,n){o.set(n,baseClone(a,t,r,n,e,s))}));var d=i?void 0:getAllKeys(e);return arrayEach(d||e,(function(a,n){d&&(a=e[n=a]),assignValue(o,n,baseClone(a,t,r,n,e,s))})),o}cloneableTags[argsTag]=cloneableTags[arrayTag]=cloneableTags[arrayBufferTag]=cloneableTags[dataViewTag]=cloneableTags[boolTag]=cloneableTags[dateTag]=cloneableTags[float32Tag]=cloneableTags[float64Tag]=cloneableTags[int8Tag]=cloneableTags[int16Tag]=cloneableTags[int32Tag]=cloneableTags[mapTag]=cloneableTags[numberTag]=cloneableTags[objectTag]=cloneableTags[regexpTag]=cloneableTags[setTag]=cloneableTags[stringTag]=cloneableTags[symbolTag]=cloneableTags[uint8Tag]=cloneableTags[uint8ClampedTag]=cloneableTags[uint16Tag]=cloneableTags[uint32Tag]=!0,cloneableTags[errorTag]=cloneableTags[funcTag]=cloneableTags[weakMapTag]=!1;var CLONE_DEEP_FLAG=1,CLONE_SYMBOLS_FLAG=4;function cloneDeep(e){return baseClone(e,CLONE_DEEP_FLAG|CLONE_SYMBOLS_FLAG)}var HASH_UNDEFINED="__lodash_hash_undefined__";function setCacheAdd(e){return this.__data__.set(e,HASH_UNDEFINED),this}function setCacheHas(e){return this.__data__.has(e)}function SetCache(e){var t=-1,r=null==e?0:e.length;for(this.__data__=new MapCache;++t<r;)this.add(e[t])}function cacheHas(e,t){return e.has(t)}function setToArray(e){var t=-1,r=Array(e.size);return e.forEach((function(e){r[++t]=e})),r}function isArrayLikeObject(e){return isObjectLike(e)&&isArrayLike(e)}SetCache.prototype.add=SetCache.prototype.push=setCacheAdd,SetCache.prototype.has=setCacheHas;var INFINITY=1/0,createSet=Set$1&&1/setToArray(new Set$1([,-0]))[1]==INFINITY?function(e){return new Set$1(e)}:noop,LARGE_ARRAY_SIZE=200;function baseUniq(e,t,r){var a=-1,n=arrayIncludes,s=e.length,o=!0,i=[],c=i;if(s>=LARGE_ARRAY_SIZE){var u=createSet(e);if(u)return setToArray(u);o=!1,n=cacheHas,c=new SetCache}else c=i;e:for(;++a<s;){var l=e[a],d=l;if(l=0!==l?l:0,o&&d==d){for(var p=c.length;p--;)if(c[p]===d)continue e;i.push(l)}else n(c,d,r)||(c!==i&&c.push(d),i.push(l))}return i}var union=baseRest((function(e){return baseUniq(baseFlatten(e,1,isArrayLikeObject))}));class ObservedData{}class SimpleObservedData extends ObservedData{data={};event=(()=>new eventsExports.EventEmitter)();constructor(e){super(),this.data=e}update(e,t){t?setValueByKeyPath(t,e,this.data):this.data=e;const r={updateData:e,path:t??""};t&&this.event.emit(t,r),this.event.emit("",r)}on(e,t){this.event.on(e,t)}off(e,t){this.event.off(e,t)}getData(e){return e?getValueByKeyPath(e,this.data):this.data}destroy(){}}class DataSource extends EventEmitter$1{isInit=!1;app;mockData;#e="base";#t;#r;#a;#n=[];#s=[];constructor(e){super(),this.#t=e.schema.id,this.#r=e.schema,this.app=e.app,this.setFields(e.schema.fields),this.setMethods(e.schema.methods||[]);let t=e.initialData;const r=e.ObservedDataClass||SimpleObservedData;if("editor"===this.app.platform)this.mockData=e.schema.mocks?.find((e=>e.useInEditor))?.data||this.getDefaultData(),t=cloneDeep(this.mockData);else if("boolean"==typeof e.useMock&&e.useMock)this.mockData=e.schema.mocks?.find((e=>e.enable))?.data,t=this.mockData||this.getDefaultData();else{if(e.initialData)return this.#a=new r(e.initialData??{}),void(this.isInit=!0);t=this.getDefaultData()}this.#a=new r(t??{})}get id(){return this.#t}get type(){return this.#e}get schema(){return this.#r}get fields(){return this.#n}get methods(){return this.#s}setFields(e){this.#n=e}setMethods(e){this.#s=e}get data(){return this.#a.getData("")}setData(e,t){this.#a.update(e,t);const r={updateData:e,path:t};this.emit("change",r)}setValue(e,t){return this.setData(t,e)}onDataChange(e,t){this.#a.on(e,t)}offDataChange(e,t){this.#a.off(e,t)}getDefaultData(){return getDefaultValueFromFields(this.#n)}async init(){this.isInit=!0}destroy(){this.#n=[],this.removeAllListeners(),this.#a.destroy()}}const urlencoded=e=>Object.entries(e).reduce(((e,[t,r])=>{let a=r;return"object"==typeof r&&(a=JSON.stringify(r)),void 0!==r?`${e}${e?"&":""}${globalThis.encodeURIComponent(t)}=${globalThis.encodeURIComponent(`${a}`)}`:e}),""),webRequest=async e=>{const{url:t,method:r="GET",headers:a={},params:n={},data:s={},...o}=e,i=urlencoded(n);let c=JSON.stringify(s);a["Content-Type"]?.includes("application/x-www-form-urlencoded")&&(c=urlencoded(s));return(await globalThis.fetch(i?`${t}?${i}`:t,{method:r,headers:a,body:"GET"===r?void 0:c,...o})).json()};class HttpDataSource extends DataSource{isLoading=!1;error;httpOptions;#o;#i=[];#c=[];#e="http";constructor(e){const{options:t}=e.schema;super(e),this.httpOptions=t,"function"==typeof e.request?this.#o=e.request:"function"==typeof globalThis.fetch&&(this.#o=webRequest),this.methods.forEach((e=>{"function"==typeof e.content&&("beforeRequest"===e.timing&&this.#i.push(e.content),"afterRequest"===e.timing&&this.#c.push(e.content))}))}get type(){return this.#e}async init(){this.schema.autoFetch&&await this.request(),super.init()}async request(e={}){this.isLoading=!0;const{url:t,params:r,data:a,headers:n,...s}=this.httpOptions;let o={url:"function"==typeof t?t({app:this.app,dataSource:this}):t,params:"function"==typeof r?r({app:this.app,dataSource:this}):r,data:"function"==typeof a?a({app:this.app,dataSource:this}):a,headers:"function"==typeof n?n({app:this.app,dataSource:this}):n,...s,...e};try{for(const e of this.#i)await e({options:o,params:{},dataSource:this,app:this.app});if("function"==typeof this.schema.beforeRequest&&(o=await this.schema.beforeRequest(o,{app:this.app,dataSource:this})),this.mockData)this.setData(this.mockData);else{let e=await(this.#o?.(o));for(const t of this.#c)await t({res:e,options:o,params:{},dataSource:this,app:this.app});if("function"==typeof this.schema.afterResponse&&(e=await this.schema.afterResponse(e,{app:this.app,dataSource:this,options:o})),this.schema.responseOptions?.dataPath){const t=getValueByKeyPath(this.schema.responseOptions.dataPath,e);this.setData(t)}else this.setData(e)}this.error=void 0}catch(i){this.error={msg:i.message},this.emit("error",i)}this.isLoading=!1}get(e){return this.request({...e,method:"GET"})}post(e){return this.request({...e,method:"POST"})}}const cache=new Map,getDeps=(e,t,r)=>{let a;if(r){const r=[];t.forEach((e=>{traverseNode(e,(e=>{r.push(e.id)}))})),a=`${e.id}:${r.join(":")}`}else a=`${e.id}:${t.map((e=>e.id)).join(":")}`;if(cache.has(a))return cache.get(a);const n=new Watcher;n.addTarget(new Target({id:e.id,type:"data-source",isTarget:(t,r)=>!`${t}`.includes(DSL_NODE_KEY_COPY_PREFIX)&&isDataSourceTarget(e,t,r,!0)})),n.addTarget(new Target({id:e.id,type:"cond",isTarget:(t,r)=>isDataSourceCondTarget(e,t,r,!0)})),n.collect(t,{},!0);const{deps:s}=n.getTarget(e.id,"data-source"),{deps:o}=n.getTarget(e.id,"cond"),i={deps:s,condDeps:o};return cache.set(a,i),i},compiledCondition=(e,t)=>{let r=!0;for(const{op:n,value:s,range:o,field:i}of e){const[e,...c]=i,u=t[e];if(!u||!c.length)break;try{const e=getValueByKeyPath(c.join("."),u);if(!compiledCond(n,e,s,o)){r=!1;break}}catch(a){console.warn(a)}}return r},compliedConditions=(e,t)=>{if(!e[C]||!Array.isArray(e[C])||!e[C].length)return!0;for(const{cond:r}of e[C])if(r&&compiledCondition(r,t))return!0;return!1},updateNode=(e,t)=>{if(isPage(e)||isPageFragment(e)){const r=t.items?.findIndex((t=>t.id===e.id));t.items.splice(r,1,e)}else replaceChildNode(e,t.items)},createIteratorContentData=(e,t,r=[],a={})=>{const n={...a,[t]:{}};let s=cloneDeep(a[t]),o=n[t];return r.forEach(((t,a)=>{Object.assign(o,s),a!==r.length-1?(Array.isArray(s[t])&&(s[t]={},o[t]={}),s=s[t],o=o[t]):o[t]=e})),n},compliedDataSourceField=(e,t)=>{const[r,...a]=e,n=r.indexOf(DATA_SOURCE_FIELDS_SELECT_VALUE_PREFIX);if(n>-1){const o=t[r.substring(n+DATA_SOURCE_FIELDS_SELECT_VALUE_PREFIX.length)];if(!o)return e;try{return getValueByKeyPath(a.join("."),o)}catch(s){return e}}return e},template=(e,t)=>e.replaceAll(dataSourceTemplateRegExp,((e,r)=>{try{return getValueByKeyPath(r,t)}catch(a){return e}})),compiledNodeField=(e,t)=>"string"==typeof e?template(e,t):e?.isBindDataSource&&e.dataSourceId?t[e.dataSourceId]:e?.isBindDataSourceField&&e.dataSourceId&&"string"==typeof e.template?template(e.template,t[e.dataSourceId]):Array.isArray(e)&&"string"==typeof e[0]?compliedDataSourceField(e,t):e,compliedIteratorItem=({compile:e,dsId:t,item:r,deps:a,condDeps:n,inEditor:s,ctxData:o})=>{const{items:i,...c}=r,u=cloneDeep(c);return n[c.id]?.keys.length&&!s&&(u.condResult=compliedConditions(c,o)),Array.isArray(i)&&i.length?u.items=i.map((r=>compliedIteratorItem({compile:e,dsId:t,item:r,deps:a,condDeps:n,inEditor:s,ctxData:o}))):i&&(u.items=i),a[u.id]?.keys.length?compiledNode(e,u,{[t]:a},t):u},registerDataSourceOnDemand=async(e,t)=>{const{dataSourceMethodsDeps:r={},dataSourceCondDeps:a={},dataSourceDeps:n={},dataSources:s=[]}=e,o={};s.forEach((e=>{let s=a[e.id]||{};Object.keys(s).length||(s=n[e.id]||{}),Object.keys(s).length||(s=r[e.id]||{}),Object.keys(s).length&&t[e.type]&&(o[e.type]=t[e.type])}));const i=await Promise.all(Object.values(o).map((e=>e()))),c={};return i.forEach(((e,t)=>{const r=Object.keys(o)[t];c[r]=e.default})),c};class DataSourceManager extends EventEmitter$1{static dataSourceClassMap=(()=>new Map)();static ObservedDataClass=(()=>SimpleObservedData)();static register(e,t){DataSourceManager.dataSourceClassMap.set(e,t)}static getDataSourceClass(e){return DataSourceManager.dataSourceClassMap.get(e)}static registerObservedData(e){DataSourceManager.ObservedDataClass=e}app;dataSourceMap=(()=>new Map)();data={};useMock=!1;constructor({app:e,useMock:t,initialData:r}){super(),this.app=e,this.useMock=t,r&&(this.data=r),e.dsl?.dataSources?.forEach((e=>{this.addDataSource(e)}));const a=Array.from(this.dataSourceMap);"function"==typeof Promise.allSettled?Promise.allSettled(a.map((([,e])=>this.init(e)))).then((e=>{const t={},r={};e.forEach(((e,n)=>{const s=a[n][0];"fulfilled"===e.status?this.data[s]?t[s]=this.data[s]:delete t[s]:"rejected"===e.status&&(delete t[s],r[s]=e.reason)})),this.emit("init",t,r)})):Promise.all(a.map((([,e])=>this.init(e)))).then((()=>{this.emit("init",this.data)})).catch((()=>{this.emit("init",this.data)}))}async init(e){if(!(e.isInit||this.app.jsEngine&&e.schema.disabledInitInJsEngine?.includes(this.app.jsEngine))){for(const t of e.methods){if("function"!=typeof t.content)return;"beforeInit"===t.timing&&await t.content({params:{},dataSource:e,app:this.app})}await e.init();for(const t of e.methods){if("function"!=typeof t.content)return;"afterInit"===t.timing&&await t.content({params:{},dataSource:e,app:this.app})}}}get(e){return this.dataSourceMap.get(e)}async addDataSource(e){if(!e)return;const t=new(DataSourceManager.dataSourceClassMap.get(e.type)||DataSource)({app:this.app,schema:e,request:this.app.request,useMock:this.useMock,initialData:this.data[e.id],ObservedDataClass:DataSourceManager.ObservedDataClass});this.dataSourceMap.set(e.id,t),this.data[t.id]=t.data,t.on("change",(e=>{this.setData(t,e)}))}setData(e,t){this.data[e.id]=e.data,this.emit("change",e.id,t)}removeDataSource(e){this.get(e)?.destroy(),delete this.data[e],this.dataSourceMap.delete(e)}updateSchema(e){e.forEach((e=>{if(!this.get(e.id))return;this.removeDataSource(e.id),this.addDataSource(e);const t=this.get(e.id);t&&this.init(t)}))}compiledNode({items:e,...t},r,a=!1){const n=cloneDeep(t);return e&&(n.items=Array.isArray(e)&&a?e.map((e=>this.compiledNode(e,r,a))):e),!1===t.condResult||!1===t.visible?n:compiledNode((e=>compiledNodeField(e,this.data)),n,this.app.dsl?.dataSourceDeps||{},r)}compliedConds(e){return compliedConditions(e,this.data)}compliedIteratorItemConds(e,t,r=[]){const[a,...n]=r,s=this.get(a);if(!s)return!0;const o=createIteratorContentData(e,s.id,n,this.data);return compliedConditions(t,o)}compliedIteratorItems(e,t,r=[]){const[a,...n]=r,s=this.get(a);if(!s)return t;const o="editor"===this.app.platform,i=createIteratorContentData(e,s.id,n,this.data),{deps:c={},condDeps:u={}}=getDeps(s.schema,t,o);return Object.keys(c).length||Object.keys(u).length?t.map((e=>compliedIteratorItem({compile:e=>compiledNodeField(e,i),dsId:s.id,item:e,deps:c,condDeps:u,inEditor:o,ctxData:i}))):t}destroy(){this.removeAllListeners(),this.data={},this.dataSourceMap.forEach((e=>{e.destroy()})),this.dataSourceMap.clear()}onDataChange(e,t,r){return this.get(e)?.onDataChange(t,r)}offDataChange(e,t,r){return this.get(e)?.offDataChange(t,r)}}DataSourceManager.register("http",HttpDataSource);const createDataSourceManager=(e,t,r)=>{const{dsl:a,platform:n}=e;if(!a?.dataSources)return;const s=new DataSourceManager({app:e,useMock:t,initialData:r});return a.dataSources&&a.dataSourceCondDeps&&"editor"!==n&&getNodes(getDepNodeIds(a.dataSourceCondDeps),a.items).forEach((e=>{e.condResult=s.compliedConds(e),updateNode(e,a)})),a.dataSources&&a.dataSourceDeps&&getNodes(getDepNodeIds(a.dataSourceDeps),a.items).forEach((e=>{updateNode(s.compiledNode(e),a)})),"nodejs"!==e.jsEngine&&s.on("change",((t,r)=>{const n=a.dataSourceDeps?.[t]||{},o=a.dataSourceCondDeps?.[t]||{},i=union([...Object.keys(o),...Object.keys(n)]),c=e.page?.data&&"editor"!==e.platform?[e.page.data]:a.items;s.emit("update-data",getNodes(i,c).map((t=>{"editor"!==e.platform&&(t.condResult=s.compliedConds(t));const r=s.compiledNode(t);if("function"==typeof e.page?.setData)if(isPage(r))e.page.setData(r);else{const a=e.page.getNode(t.id);a?.setData(r)}return r})),t,r)})),s},ignoreFirstCall=e=>{let t=0;return(...r)=>{if(0!==t)return e(...r);t+=1}};class DeepObservedData extends ObservedData{state;subscribers=(()=>new Map)();constructor(e){super(),this.state=new DeepState(e)}update=(e,t)=>{this.state?.update(t??"",e)};on=(e,t)=>{const r=this.state.subscribe(e,ignoreFirstCall(t)),a=this.subscribers.get(e)??new Map;a.set(t,r),this.subscribers.set(e,a)};off=(e,t)=>{const r=this.subscribers.get(e);r&&(r.get(t)?.(),r.delete(t))};getData=e=>this.state?this.state?.get(e):{};destroy=()=>{this.subscribers.forEach((e=>{e.forEach((e=>e()))}))}}var a=(e=>(e.CONTAINER="container",e.PAGE="page",e.ROOT="app",e.PAGE_FRAGMENT="page-fragment",e))(a||{});const C="displayConds";var E=(e=>(e.COMP="comp",e.CODE="code",e.DATA_SOURCE="data-source",e))(E||{}),O=(e=>(e.CODE="code",e))(O||{}),t=(e=>(e.CODE="code",e.DATA_SOURCE_METHOD="data-source-method",e))(t||{});const dslDomRelateConfig={getIdFromEl:e=>e?.dataset?.tmagicId,getElById:(e,t)=>e?.querySelector(`[data-tmagic-id="${t}"]`),setIdToEl:(e,t)=>{e.dataset.tmagicId=`${t}`}},getIdFromEl=()=>dslDomRelateConfig.getIdFromEl,toLine=exports("t",((e="")=>e.replace(/\B([A-Z])/g,"-$1").toLowerCase())),getNodePath=(e,t=[])=>{const r=[],a=function(e,t){if(!Array.isArray(t))return null;for(let n=0,s=t.length;n<s;n++){const s=t[n];if(r.push(s),`${s.id}`==`${e}`)return s;if(s.items){const t=a(e,s.items);if(t)return t}r.pop()}return null};return a(e,t),r},filterXSS=e=>e.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;"),getUrlParam=(e,t)=>{const r=location.href,a=new RegExp(`[?&#]${e}=([^&#]+)`,"gi"),n=r.match(a);let s;return n&&n.length>0?(s=n[n.length-1].split("="),s&&s.length>1?filterXSS(s[1]):""):""},isObject=e=>"[object Object]"===Object.prototype.toString.call(e),isPage=e=>!!e&&Boolean(e.type?.toLowerCase()===a.PAGE),isPageFragment=e=>!!e&&Boolean(e.type?.toLowerCase()===a.PAGE_FRAGMENT),isNumber=e=>/^(-?\d+)(\.\d+)?$/.test(e),getKeysArray=e=>`${e}`.replaceAll(/\[(\d+)\]/g,".$1").split("."),getValueByKeyPath=(e="",t={})=>(Array.isArray(e)?e:getKeysArray(e)).reduce(((r,a)=>{if(isObject(r))return r[a];if(Array.isArray(r)&&/^\d*$/.test(`${a}`))return r[a];throw new Error(`${t}中不存在${e}`)}),t),setValueByKeyPath=(e,t,r={})=>set(r,e,t),getNodes=(e,t=[])=>{const r=[],a=function(e,t){if(Array.isArray(t))for(let n=0,s=t.length;n<s;n++){const s=t[n],o=e.findIndex((e=>`${e}`==`${s.id}`));o>-1&&(e.slice(o,1),r.push(s)),s.items&&a(e,s.items)}};return a(e,t),r},getDepKeys=(e={},t)=>Array.from(Object.values(e).reduce(((e,r)=>((r[t]?.keys||[]).forEach((t=>e.add(t))),e)),new Set)),getDepNodeIds=(e={})=>Array.from(Object.values(e).reduce(((e,t)=>(Object.keys(t).forEach((t=>{e.add(t)})),e)),new Set)),replaceChildNode=(e,t,r)=>{const a=getNodePath(e.id,t),n=a.pop();let s=a.pop();if(!n)throw new Error("未找到目标节点");if(!s)throw new Error("未找到父节点");const o=s.items?.findIndex((e=>e.id===n.id));s.items.splice(o,1,e)},DSL_NODE_KEY_COPY_PREFIX="__tmagic__",IS_DSL_NODE_KEY="__tmagic__dslNode",compiledNode=(e,t,r={},a)=>{let n=[];if(a){const e=r[a];n=e?.[t.id].keys||[]}else n=getDepKeys(r,t.id);return n.forEach((r=>{const a=getKeysArray(r),n=a.map(((e,t)=>t<a.length-1?e:`${DSL_NODE_KEY_COPY_PREFIX}${e}`));let s,o=getValueByKeyPath(n,t);if(void 0===o)try{const e=getValueByKeyPath(r,t);setValueByKeyPath(n.join("."),e,t),o=e}catch(i){return void console.warn(i)}try{s=e(o)}catch(i){console.error(i),s=""}setValueByKeyPath(r,s,t)})),t},compiledCond=(e,t,r,a=[])=>{switch("string"==typeof t&&void 0===r&&(r=""),e){case"is":case"=":return t===r;case"not":case"!=":return t!==r;case">":return t>r;case">=":return t>=r;case"<":return t<r;case"<=":return t<=r;case"between":return a.length>1&&t>=a[0]&&t<=a[1];case"not_between":return a.length<2||t<a[0]||t>a[1];case"include":return t?.includes?.(r);case"not_include":return void 0===t||!t.includes?.(r)}return!1},getDefaultValueFromFields=e=>{const t={},r={string:void 0,object:{},array:[],boolean:void 0,number:void 0,null:null,any:void 0};return e.forEach((e=>{if(void 0===e.defaultValue)"object"!==e.type?e.type?t[e.name]=r[e.type]:t[e.name]=void 0:t[e.name]=e.fields?getDefaultValueFromFields(e.fields):r.object;else{if("array"===e.type&&!Array.isArray(e.defaultValue))return void(t[e.name]=r.array);if("object"===e.type&&!isObject(e.defaultValue)){if("string"==typeof e.defaultValue){try{t[e.name]=JSON.parse(e.defaultValue)}catch(a){t[e.name]=r.object}return}return void(t[e.name]=r.object)}t[e.name]=cloneDeep$1(e.defaultValue)}})),t},DATA_SOURCE_FIELDS_SELECT_VALUE_PREFIX="ds-field::",DATA_SOURCE_FIELDS_CHANGE_EVENT_PREFIX="ds-field-changed",addParamToUrl=(e,t=globalThis,r=!0)=>{const a=new URL(t.location.href),{searchParams:n}=a;for(const[o,i]of Object.entries(e))n.set(o,i);const s=a.toString();r?t.location.href=s:t.history.pushState({},"",a)},dataSourceTemplateRegExp=/\$\{([\s\S]+?)\}/g,isDslNode=exports("i",(e=>void 0===e[IS_DSL_NODE_KEY]||!0===e[IS_DSL_NODE_KEY])),traverseNode=(e,t,r=[])=>{t(e,r),Array.isArray(e.items)&&e.items.length&&(r.push(e),e.items.forEach((e=>{traverseNode(e,t,[...r])})))};var DepTargetType=(e=>(e.DEFAULT="default",e.CODE_BLOCK="code-block",e.DATA_SOURCE="data-source",e.DATA_SOURCE_METHOD="data-source-method",e.DATA_SOURCE_COND="data-source-cond",e))(DepTargetType||{});class Target{isTarget;id;name;type=(()=>DepTargetType.DEFAULT)();deps={};isCollectByDefault;constructor(e){this.isTarget=e.isTarget,this.id=e.id,this.name=e.name,this.isCollectByDefault=e.isCollectByDefault??!0,e.type&&(this.type=e.type),e.initialDeps&&(this.deps=e.initialDeps)}updateDep({id:e,name:t,key:r,data:a}){const n=this.deps[e]||{name:t,keys:[]};n.name=t,n.data=a,this.deps[e]=n,-1===n.keys.indexOf(r)&&n.keys.push(r)}removeDep(e,t){if(void 0===e)return void Object.keys(this.deps).forEach((e=>{delete this.deps[e]}));const r=this.deps[e];if(r)if(t){const a=r.keys.indexOf(t);r.keys.splice(a,1),0===r.keys.length&&delete this.deps[e]}else delete this.deps[e]}hasDep(e,t){const r=this.deps[e];return Boolean(r?.keys.find((e=>e===t)))}destroy(){this.deps={}}}const isIncludeArrayField=(e,t)=>{let r=t;return e.some(((t,a)=>{const n=r.find((({name:e})=>e===t));return r=n?.fields||[],n&&"array"===n.type&&/^(?!\d+$).*$/.test(`${e[a+1]}`)&&a<e.length-1}))},isDataSourceTemplate=(e,t,r=!1)=>{const a=e.match(dataSourceTemplateRegExp)||[];if(a.length<=0)return!1;const n=[],s=[];return a.forEach((e=>{const r=e.substring(2,e.length-1),a=getKeysArray(r),o=a.shift();o&&o===t.id&&(isIncludeArrayField(a,t.fields)?n.push(e):s.push(e))})),r?n.length>0:s.length>0},isSpecificDataSourceTemplate=(e,t)=>e?.isBindDataSourceField&&e.dataSourceId&&e.dataSourceId===t&&"string"==typeof e.template,isUseDataSourceField=(e,t)=>{if(!Array.isArray(e)||"string"!=typeof e[0])return!1;const[r]=e,a=r.indexOf(DATA_SOURCE_FIELDS_SELECT_VALUE_PREFIX);if(-1===a)return!1;return r.substring(a+DATA_SOURCE_FIELDS_SELECT_VALUE_PREFIX.length)===t},isDataSourceTarget=(e,t,r,a=!1)=>{if(`${t}`.startsWith(C))return!1;if("string"==typeof r)return isDataSourceTemplate(r,e,a);if(isObject(r)&&r?.isBindDataSource&&r.dataSourceId&&r.dataSourceId===e.id)return!0;if(isSpecificDataSourceTemplate(r,e.id))return!0;if(isUseDataSourceField(r,e.id)){const[,...t]=r,n=isIncludeArrayField(t,e.fields);return a?n:!n}return!1},isDataSourceCondTarget=(e,t,r,a=!1)=>{if(!Array.isArray(r)||!e)return!1;const[n,...s]=r;if(n!==e.id||!`${t}`.startsWith(C))return!1;if(e.fields?.find((e=>e.name===s[0]))){const t=isIncludeArrayField(s,e.fields);return a?t:!t}return!1},traverseTarget=(e,t,r)=>{Object.values(e).forEach((e=>{Object.values(e).forEach((e=>{r&&e.type!==r||t(e)}))}))};class Watcher{targetsList={};childrenProp="items";idProp="id";nameProp="name";constructor(e){e?.initialTargets&&(this.targetsList=e.initialTargets),e?.childrenProp&&(this.childrenProp=e.childrenProp)}getTargetsList(){return this.targetsList}getTargets(e=DepTargetType.DEFAULT){return this.targetsList[e]||{}}addTarget(e){const t=this.getTargets(e.type)||{};this.targetsList[e.type]=t,t[e.id]=e}getTarget(e,t=DepTargetType.DEFAULT){return this.getTargets(t)[e]}hasTarget(e,t=DepTargetType.DEFAULT){return Boolean(this.getTarget(e,t))}hasSpecifiedTypeTarget(e=DepTargetType.DEFAULT){return Object.keys(this.getTargets(e)).length>0}removeTarget(e,t=DepTargetType.DEFAULT){const r=this.getTargets(t);r[e]&&(r[e].destroy(),delete r[e])}removeTargets(e=DepTargetType.DEFAULT){const t=this.targetsList[e];if(t){for(const e of Object.values(t))e.destroy();delete this.targetsList[e]}}clearTargets(){Object.keys(this.targetsList).forEach((e=>{delete this.targetsList[e]}))}collect(e,t={},r=!1,a){this.collectByCallback(e,a,(({node:e,target:a})=>{this.removeTargetDep(a,e),this.collectItem(e,a,t,r)}))}collectByCallback(e,t,r){traverseTarget(this.targetsList,(a=>{(t||a.isCollectByDefault)&&e.forEach((e=>{r({node:e,target:a})}))}),t)}clear(e,t){let{targetsList:r}=this;t&&(r={[t]:this.getTargets(t)});const a=[];traverseTarget(r,(t=>{e?e.forEach((e=>{t.removeDep(e[this.idProp]),Array.isArray(e[this.childrenProp])&&e[this.childrenProp].length&&!a.includes(e[this.idProp])&&(a.push(e[this.idProp]),this.clear(e[this.childrenProp]))})):t.removeDep()}))}clearByType(e,t){this.clear(t,e)}collectItem(e,t,r={},a=!1){const n=(s,o="")=>{const i=(s,i)=>{const c=s===this.childrenProp,u=o?`${o}.${s}`:s;t.isTarget(u,i)?t.updateDep({id:e[this.idProp],name:`${e[this.nameProp]||e[this.idProp]}`,data:r,key:u}):!c&&Array.isArray(i)?i.forEach(((e,t)=>{isObject(e)&&n(e,`${u}[${t}]`)})):isObject(i)&&n(i,u),c&&a&&Array.isArray(i)&&i.forEach((e=>{this.collectItem(e,t,r,a)}))};Object.entries(s).forEach((([e,t])=>{void 0!==t&&""!==t&&i(e,t)}))};n(e)}removeTargetDep(e,t,r){e.removeDep(t[this.idProp],r),void 0===r&&Array.isArray(t[this.childrenProp])&&t[this.childrenProp].length&&t[this.childrenProp].forEach((t=>{this.removeTargetDep(e,t,r)}))}}class Env{isIos=!1;isIphone=!1;isIpad=!1;isAndroid=!1;isAndroidPad=!1;isMac=!1;isWin=!1;isMqq=!1;isWechat=!1;isWeb=!1;isOpenHarmony=!1;constructor(e=globalThis.navigator.userAgent,t={}){this.isIphone=e.indexOf("iPhone")>=0,this.isIpad=/(iPad).*OS\s([\d_]+)/.test(e),this.isIos=this.isIphone||this.isIpad,this.isAndroid=e.indexOf("Android")>=0,this.isAndroidPad=this.isAndroid&&e.indexOf("Mobile")<0,this.isMac=e.indexOf("Macintosh")>=0,this.isWin=e.indexOf("Windows")>=0,this.isMqq=/QQ\/([\d.]+)/.test(e),this.isWechat=e.indexOf("MicroMessenger")>=0&&e.indexOf("wxwork")<0,this.isOpenHarmony=e.includes("OpenHarmony"),this.isWeb=!(this.isIos||this.isAndroid||this.isOpenHarmony||/(WebOS|BlackBerry)/.test(e)),Object.entries(t).forEach((([e,t])=>{this[e]=t}))}}class FlowState{isAbort;constructor(){this.isAbort=!1}abort(){this.isAbort=!0}reset(){this.isAbort=!1}}const style2Obj=e=>{if("string"!=typeof e)return e;const t={};return e.split(";").forEach((e=>{if(!e)return;const r=e.split(":");let a=r.shift(),n=r.join(":");a&&(a=a.replace(/^\s*/,"").replace(/\s*$/,""),n=n.replace(/^\s*/,"").replace(/\s*$/,""),a=a.split("-").map(((e,t)=>t>0?`${e[0].toUpperCase()}${e.substr(1)}`:e)).join(""),t[a]=n)})),t},fillBackgroundImage=e=>!e||/^url/.test(e)||/^linear-gradient/.test(e)?e:`url(${e})`,getTransform=(e,t)=>{if(!e)return[];const r=Object.entries(e).map((([e,r])=>r.trim()?("rotate"===e&&isNumber(r)&&(r=`${r}deg`),"hippy"!==t?`${e}(${r})`:{[e]:r}):""));if("hippy"===t)return r;const a=r.join(" ");return a.trim()?a:"none"},transformStyle=(e,t)=>{if(!e)return{};let r={};const a={};r="string"==typeof e?style2Obj(e):{...e};const n="hippy"===t,s=["zIndex","opacity","fontWeight"];return Object.entries(r).forEach((([e,r])=>{"scale"===e&&!a.transform&&n?a.transform=[{scale:r}]:"backgroundImage"!==e||n?"transform"===e&&"string"!=typeof r?a[e]=getTransform(r,t):!s.includes(e)&&r&&/^[-]?[0-9]*[.]?[0-9]*$/.test(r)?a[e]=n?r:r/100+"rem":a[e]=r:r&&(a[e]=fillBackgroundImage(r))})),a},COMMON_EVENT_PREFIX="magic:common:events:",COMMON_METHOD_PREFIX="magic:common:actions:",CommonMethod={SHOW:"show",HIDE:"hide",SCROLL_TO_VIEW:"scrollIntoView",SCROLL_TO_TOP:"scrollToTop"},isCommonMethod=e=>e.startsWith(COMMON_METHOD_PREFIX),triggerCommonMethod=(e,t)=>{const{instance:r}=t;if(r)switch(e.replace(COMMON_METHOD_PREFIX,"")){case CommonMethod.SHOW:r.show();break;case CommonMethod.HIDE:r.hide();break;case CommonMethod.SCROLL_TO_VIEW:r.$el?.scrollIntoView({behavior:"smooth"});break;case CommonMethod.SCROLL_TO_TOP:window.scrollTo({top:0,behavior:"smooth"})}},getCommonEventName=e=>e.startsWith(COMMON_EVENT_PREFIX)?e:`${COMMON_EVENT_PREFIX}${e}`,getDirectComponent=(e,t)=>{if(!e)return;const r=getIdFromEl()(e);if(!r)return getDirectComponent(e.parentElement,t);return t.getNode(r,e.dataset.tmagicIteratorContainerId?.split(","),e.dataset.tmagicIteratorIndex?.split(",").map((e=>globalThis.parseInt(e,10))))};class EventHelper extends eventsExports.EventEmitter{app;nodeEventList=(()=>new Map)();dataSourceEventList=(()=>new Map)();constructor({app:e}){super(),this.app=e,globalThis.document.body.addEventListener("click",this.commonClickEventHandler)}destroy(){this.removeNodeEvents(),this.removeAllListeners(),globalThis.document.body.removeEventListener("click",this.commonClickEventHandler)}bindNodeEvents(e){e.events?.forEach(((t,r)=>{let a=`${t.name}_${e.data.id}`;const n=t.name.split(".");n.length>1&&(a=`${n[1]}_${n[0]}`);let s=Symbol(a);e.eventKeys.has(a)?s=e.eventKeys.get(a):e.eventKeys.set(a,s);const o=(t,...a)=>{this.eventHandler(r,e,a)};this.nodeEventList.set(o,s),this.on(s,o)}))}removeNodeEvents(){Array.from(this.nodeEventList.keys()).forEach((e=>{const t=this.nodeEventList.get(e);t&&this.off(t,e)})),this.nodeEventList.clear()}bindDataSourceEvents(e){this.removeDataSourceEvents(e),e.forEach((e=>{const t=this.dataSourceEventList.get(e.id)??new Map;(e.schema.events||[]).forEach((r=>{const[a,...n]=r.name?.split(".")||[];if(!a)return;const s=(...t)=>{this.eventHandler(r,e,t)};t.set(r.name,s),a===DATA_SOURCE_FIELDS_CHANGE_EVENT_PREFIX?e?.onDataChange(n.join("."),s):e.on(a,s)})),this.dataSourceEventList.set(e.id,t)}))}removeDataSourceEvents(e){this.dataSourceEventList.size&&(e.forEach((e=>{const t=this.dataSourceEventList.get(e.id);t&&Array.from(t.keys()).forEach((r=>{const[a,...n]=r.split(".");a===DATA_SOURCE_FIELDS_CHANGE_EVENT_PREFIX?e.offDataChange(n.join("."),t.get(r)):e.off(a,t.get(r))}))})),this.dataSourceEventList.clear())}async eventHandler(e,t,r){const a="number"==typeof e?t.events[e]:e;if(has(a,"actions")){const n=new FlowState,{actions:s}=a;for(let a=0;a<s.length&&!n?.isAbort;a++)if("number"==typeof e){const s=t.events[e].actions[a];this.actionHandler(s,t,r,n)}else this.actionHandler(s[a],t,r,n);n.reset()}else await this.compActionHandler(a,t,r)}async actionHandler(e,t,r,a){if(e.actionType===E.COMP){const a=e;await this.compActionHandler(a,t,r)}else if(e.actionType===E.CODE){const t=e;await this.app.runCode(t.codeId,t.params||{},r,a)}else if(e.actionType===E.DATA_SOURCE){const t=e,[n,s]=t.dataSourceMethod;await this.app.runDataSourceMethod(n,s,t.params||{},r,a)}}async compActionHandler(e,t,r){if(!this.app.page)throw new Error("当前没有页面");let{method:a,to:n}=e;Array.isArray(a)&&([n,a]=a);const s=this.app.getNode(n);if(!s)throw`ID为${n}的组件不存在`;if(isCommonMethod(a))return triggerCommonMethod(a,s);s.instance?"function"==typeof s.instance[a]&&await s.instance[a](t,...r):s.addEventToQueue({method:a,fromCpt:t,args:r})}commonClickEventHandler=e=>{if(!e.target)return;const t=getDirectComponent(e.target,this.app),r=`${getCommonEventName("click")}_${t?.data.id}`;t?.eventKeys.has(r)&&this.emit(t.eventKeys.get(r),t)}}class Flexible{designWidth=375;tid;constructor(e){"complete"===globalThis.document.readyState?this.setBodyFontSize():globalThis.document.addEventListener("DOMContentLoaded",this.setBodyFontSize,!1),globalThis.addEventListener("resize",this.resizeHandler,!1),globalThis.addEventListener("pageshow",this.pageshowHandler,!1),void 0!==e?.designWidth&&this.setDesignWidth(e.designWidth)}destroy(){globalThis.document.removeEventListener("DOMContentLoaded",this.setBodyFontSize,!1),globalThis.removeEventListener("resize",this.resizeHandler,!1),globalThis.removeEventListener("pageshow",this.pageshowHandler,!1)}setDesignWidth(e){this.designWidth=e,this.refreshRem()}setBodyFontSize(){globalThis.document.body.style.fontSize=".12rem"}refreshRem(){const{width:e}=document.documentElement.getBoundingClientRect(),t=e/(this.designWidth/100);globalThis.document.documentElement.style.fontSize=`${t}px`,globalThis.document.documentElement.style.fontSize=`${this.correctRem(t)}px`}correctRem(e){const{document:t}=globalThis,r=t.createElement("div");r.style.cssText="width:1rem;height:0;overflow:hidden;position:absolute;z-index:-1;visibility:hidden;",t.documentElement.appendChild(r);const a=r.offsetWidth;return t.documentElement.removeChild(r),Math.abs(a-e)>1?e**2/a:e}resizeHandler=()=>{clearTimeout(this.tid),this.tid=setTimeout((()=>{this.refreshRem(),this.tid=void 0}),300)};pageshowHandler=e=>{e.persisted&&this.resizeHandler()}}class Store{data={};set(e,t){this.data[e]=t}get(e){return this.data[e]}}class Node extends eventsExports.EventEmitter{data;style;events=[];instance;page;parent;app;store=(()=>new Store)();eventKeys=(()=>new Map)();eventQueue=[];constructor(e){super(),this.page=e.page,this.parent=e.parent,this.app=e.app,this.setData(e.config),this.listenLifeSafe()}setData(e){this.data=e;const{events:t,style:r}=e;this.events=t||[],this.style=r||{},this.emit("update-data",e)}addEventToQueue(e){this.eventQueue.push(e)}async runHookCode(e,r){if("function"==typeof this.data[e])return void(await this.data[e](this));const a=this.data[e];if(a?.hookType===O.CODE)for(const n of a.hookData){const{codeType:e=t.CODE,codeId:a,params:s={}}=n;let o;const i={app:this.app,params:r||s};if(e===t.CODE&&"string"==typeof a&&this.app.codeDsl?.[a])o=this.app.codeDsl[a].content;else if(e===t.DATA_SOURCE_METHOD&&Array.isArray(a)&&a.length>1){const e=this.app.dataSourceManager?.get(a[0]);o=e?.methods.find((e=>e.name===a[1]))?.content,i.dataSource=e}o&&"function"==typeof o&&await o(i)}}destroy(){this.removeAllListeners()}listenLifeSafe(){this.once("created",(async e=>{this.once("destroy",(()=>{this.instance=null,"function"==typeof this.data.destroy&&this.data.destroy(this),this.listenLifeSafe()})),this.instance=e,await this.runHookCode("created")})),this.once("mounted",(async e=>{this.instance=e;for(let t=this.eventQueue.shift();t;t=this.eventQueue.shift())"function"==typeof e[t.method]&&await e[t.method](t.fromCpt,...t.args);await this.runHookCode("mounted")}))}}class IteratorContainer extends Node{nodes=[];setData(e){this.resetNodes(),super.setData(e)}resetNodes(){this.nodes?.forEach((e=>{e.forEach((e=>{e.destroy()}))})),this.nodes=[]}initNode(e,t,r){if(r.has(e.id)&&r.get(e.id)?.destroy(),e.type&&this.app.iteratorContainerType.has(e.type)){const a=new IteratorContainer({config:e,parent:t,page:this.page,app:this.app});return r.set(e.id,a),void this.app.eventHelper?.bindNodeEvents(a)}const a=new Node({config:e,parent:t,page:this.page,app:this.app});if(this.app.eventHelper?.bindNodeEvents(a),r.set(e.id,a),e.type&&this.app.pageFragmentContainerType.has(e.type)&&e.pageFragmentId){const t=this.app.dsl?.items?.find((t=>t.id===e.pageFragmentId));t&&(e.items=[t])}e.items?.forEach((e=>{this.initNode(e,a,r)}))}setNodes(e,t){const r=this.nodes[t]||new Map;e.forEach((e=>{this.initNode(e,this,r)})),this.nodes[t]=r}getNode(e,t){return this.nodes[t]?.get(e)}destroy(){super.destroy(),this.resetNodes()}}class Page extends Node{nodes=(()=>new Map)();constructor(e){super(e),this.setNode(e.config.id,this),e.config.items.forEach((e=>{this.initNode(e,this)}))}initNode(e,t){if(e.type&&this.app.iteratorContainerType.has(e.type))return void this.setNode(e.id,new IteratorContainer({config:e,parent:t,page:this,app:this.app}));const r=new Node({config:e,parent:t,page:this,app:this.app});if(this.setNode(e.id,r),e.type&&this.app.pageFragmentContainerType.has(e.type)&&e.pageFragmentId){const t=this.app.dsl?.items?.find((t=>t.id===e.pageFragmentId));t&&(e.items=[t])}e.items?.forEach((e=>{this.initNode(e,r)}))}getNode(e,t,r){if(this.nodes.has(e))return this.nodes.get(e);if(Array.isArray(t)&&t.length&&Array.isArray(r)){let a=this.nodes.get(t[0]);for(let e=1,n=t.length;e<n;e++)a=a?.getNode(t[e],r[e-1]);return a?.getNode(e,r[r.length-1])}}setNode(e,t){this.nodes.set(e,t)}deleteNode(e){this.nodes.delete(e)}destroy(){super.destroy(),this.nodes.clear()}}class App extends eventsExports.EventEmitter{env=(()=>new Env)();dsl;codeDsl;dataSourceManager;page;useMock=!1;platform="mobile";jsEngine="browser";components=(()=>new Map)();pageFragmentContainerType=(()=>new Set(["page-fragment-container"]))();iteratorContainerType=(()=>new Set(["iterator-container"]))();request;transformStyle;eventHelper;flexible;constructor(e){if(super(),this.setEnv(e.ua),this.codeDsl=e.config?.codeBlocks,e.platform&&(this.platform=e.platform),e.jsEngine&&(this.jsEngine=e.jsEngine),e.pageFragmentContainerType){(Array.isArray(e.pageFragmentContainerType)?e.pageFragmentContainerType:[e.pageFragmentContainerType]).forEach((e=>{this.pageFragmentContainerType.add(e)}))}if(e.iteratorContainerType){(Array.isArray(e.iteratorContainerType)?e.iteratorContainerType:[e.iteratorContainerType]).forEach((e=>{this.iteratorContainerType.add(e)}))}"boolean"==typeof e.useMock&&(this.useMock=e.useMock),"browser"!==this.jsEngine||e.disabledFlexible||(this.flexible=new Flexible({designWidth:e.designWidth})),"editor"!==this.platform&&(this.eventHelper=new EventHelper({app:this})),this.transformStyle=e.transformStyle||(e=>transformStyle(e,this.jsEngine)),e.request&&(this.request=e.request),e.config&&this.setConfig(e.config,e.curPage)}setEnv(e){this.env=new Env(e)}setDesignWidth(e){this.flexible?.setDesignWidth(e)}setConfig(e,t){if(this.dsl=e,!t&&e.items.length&&(t=e.items[0].id),this.dataSourceManager&&this.dataSourceManager.destroy(),this.dataSourceManager=createDataSourceManager(this,this.useMock),this.codeDsl=e.codeBlocks,this.setPage(t||this.page?.data?.id),this.dataSourceManager){const e=Array.from(this.dataSourceManager.dataSourceMap.values());this.eventHelper?.bindDataSourceEvents(e)}}setPage(e){const t=this.dsl?.items.find((t=>`${t.id}`==`${e}`));if(!t)return this.deletePage(),void super.emit("page-change");t!==this.page?.data&&(this.page?.destroy(),this.page=new Page({config:t,app:this}),this.eventHelper?.removeNodeEvents(),this.page.nodes.forEach((e=>{this.eventHelper?.bindNodeEvents(e)})),super.emit("page-change",this.page))}deletePage(){this.page?.destroy(),this.eventHelper?.removeNodeEvents(),this.page=void 0}getPage(e){return e?this.page&&`${this.page.data.id}`==`${e}`?this.page:void 0:this.page}getNode(e,t,r){return this.page?.getNode(e,t,r)}registerComponent(e,t){this.components.set(e,t)}unregisterComponent(e){this.components.delete(e)}resolveComponent(e){return this.components.get(e)}emit(e,...t){const[r,...a]=t;return this.eventHelper&&r instanceof Node&&r.data?.id&&r.eventKeys.has(`${String(e)}_${r.data.id}`)?this.eventHelper?.emit(r.eventKeys.get(`${String(e)}_${r.data.id}`),r,...a):super.emit(e,...t)}async runCode(e,t,r,a){if(!e||isEmpty(this.codeDsl))return;const n=this.codeDsl?.[e]?.content;"function"==typeof n&&await n({app:this,params:t,eventParams:r,flowState:a})}async runDataSourceMethod(e,t,r,a,n){if(!e||!t)return;const s=this.dataSourceManager?.get(e);if(!s)return;const o=(s.methods||[]).find((e=>e.name===t));o&&"function"==typeof o.content&&await o.content({app:this,params:r,dataSource:s,eventParams:a,flowState:n})}destroy(){this.removeAllListeners(),this.page=void 0,this.flexible?.destroy(),this.flexible=void 0,this.eventHelper?.destroy()}}const scriptRel="modulepreload",assetsURL=function(e){return"/tmagic-editor/playground/runtime/vue3/page/"+e},seen={},__vitePreload=function(e,t,r){let a=Promise.resolve();function n(e){const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}return a.then((t=>{for(const e of t||[])"rejected"===e.status&&n(e.reason);return e().catch(n)}))},components={page:()=>__vitePreload((()=>module.import("./index-legacy-kHAfbwzq.js")),void 0),container:()=>__vitePreload((()=>module.import("./Container-legacy-DWhmnTtz.js")),void 0),button:()=>__vitePreload((()=>module.import("./index-legacy-CgFI5TvQ.js")),void 0),text:()=>__vitePreload((()=>module.import("./index-legacy-C7qlWYdV.js")),void 0),img:()=>__vitePreload((()=>module.import("./index-legacy-C14a0oeN.js")),void 0),qrcode:()=>__vitePreload((()=>module.import("./index-legacy-C6O57Gri.js")),void 0),overlay:()=>__vitePreload((()=>module.import("./index-legacy-9fhnM6HC.js")),void 0),"page-fragment-container":()=>__vitePreload((()=>module.import("./PageFragmentContainer-legacy-CPX0aCY7.js")),void 0),"page-fragment":()=>__vitePreload((()=>module.import("./PageFragment-legacy-Dd4HzPZt.js")),void 0),"iterator-container":()=>__vitePreload((()=>module.import("./IteratorContainer-legacy-C0ygUJbM.js")),void 0)},datasources={},plugins={};var axios$2={exports:{}},bind,hasRequiredBind,utils,hasRequiredUtils,buildURL,hasRequiredBuildURL,InterceptorManager_1,hasRequiredInterceptorManager,normalizeHeaderName,hasRequiredNormalizeHeaderName,enhanceError,hasRequiredEnhanceError,createError,hasRequiredCreateError,settle,hasRequiredSettle,cookies,hasRequiredCookies,isAbsoluteURL,hasRequiredIsAbsoluteURL,combineURLs,hasRequiredCombineURLs,buildFullPath,hasRequiredBuildFullPath,parseHeaders,hasRequiredParseHeaders,isURLSameOrigin,hasRequiredIsURLSameOrigin,Cancel_1,hasRequiredCancel,xhr,hasRequiredXhr,defaults_1,hasRequiredDefaults,transformData,hasRequiredTransformData,isCancel,hasRequiredIsCancel,dispatchRequest,hasRequiredDispatchRequest,mergeConfig,hasRequiredMergeConfig,data,hasRequiredData,validator,hasRequiredValidator,Axios_1,hasRequiredAxios$2,CancelToken_1,hasRequiredCancelToken,spread,hasRequiredSpread,isAxiosError,hasRequiredIsAxiosError,hasRequiredAxios$1,axios$1,hasRequiredAxios;function requireBind(){return hasRequiredBind||(hasRequiredBind=1,bind=function(e,t){return function(){for(var r=new Array(arguments.length),a=0;a<r.length;a++)r[a]=arguments[a];return e.apply(t,r)}}),bind}function requireUtils(){if(hasRequiredUtils)return utils;hasRequiredUtils=1;var e=requireBind(),t=Object.prototype.toString;function r(e){return Array.isArray(e)}function a(e){return void 0===e}function n(e){return"[object ArrayBuffer]"===t.call(e)}function s(e){return null!==e&&"object"==typeof e}function o(e){if("[object Object]"!==t.call(e))return!1;var r=Object.getPrototypeOf(e);return null===r||r===Object.prototype}function i(e){return"[object Function]"===t.call(e)}function c(e,t){if(null!=e)if("object"!=typeof e&&(e=[e]),r(e))for(var a=0,n=e.length;a<n;a++)t.call(null,e[a],a,e);else for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.call(null,e[s],s,e)}return utils={isArray:r,isArrayBuffer:n,isBuffer:function(e){return null!==e&&!a(e)&&null!==e.constructor&&!a(e.constructor)&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)},isFormData:function(e){return"[object FormData]"===t.call(e)},isArrayBufferView:function(e){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&n(e.buffer)},isString:function(e){return"string"==typeof e},isNumber:function(e){return"number"==typeof e},isObject:s,isPlainObject:o,isUndefined:a,isDate:function(e){return"[object Date]"===t.call(e)},isFile:function(e){return"[object File]"===t.call(e)},isBlob:function(e){return"[object Blob]"===t.call(e)},isFunction:i,isStream:function(e){return s(e)&&i(e.pipe)},isURLSearchParams:function(e){return"[object URLSearchParams]"===t.call(e)},isStandardBrowserEnv:function(){return("undefined"==typeof navigator||"ReactNative"!==navigator.product&&"NativeScript"!==navigator.product&&"NS"!==navigator.product)&&("undefined"!=typeof window&&"undefined"!=typeof document)},forEach:c,merge:function e(){var t={};function a(a,n){o(t[n])&&o(a)?t[n]=e(t[n],a):o(a)?t[n]=e({},a):r(a)?t[n]=a.slice():t[n]=a}for(var n=0,s=arguments.length;n<s;n++)c(arguments[n],a);return t},extend:function(t,r,a){return c(r,(function(r,n){t[n]=a&&"function"==typeof r?e(r,a):r})),t},trim:function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")},stripBOM:function(e){return 65279===e.charCodeAt(0)&&(e=e.slice(1)),e}},utils}function requireBuildURL(){if(hasRequiredBuildURL)return buildURL;hasRequiredBuildURL=1;var e=requireUtils();function t(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}return buildURL=function(r,a,n){if(!a)return r;var s;if(n)s=n(a);else if(e.isURLSearchParams(a))s=a.toString();else{var o=[];e.forEach(a,(function(r,a){null!=r&&(e.isArray(r)?a+="[]":r=[r],e.forEach(r,(function(r){e.isDate(r)?r=r.toISOString():e.isObject(r)&&(r=JSON.stringify(r)),o.push(t(a)+"="+t(r))})))})),s=o.join("&")}if(s){var i=r.indexOf("#");-1!==i&&(r=r.slice(0,i)),r+=(-1===r.indexOf("?")?"?":"&")+s}return r}}function requireInterceptorManager(){if(hasRequiredInterceptorManager)return InterceptorManager_1;hasRequiredInterceptorManager=1;var e=requireUtils();function t(){this.handlers=[]}return t.prototype.use=function(e,t,r){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!r&&r.synchronous,runWhen:r?r.runWhen:null}),this.handlers.length-1},t.prototype.eject=function(e){this.handlers[e]&&(this.handlers[e]=null)},t.prototype.forEach=function(t){e.forEach(this.handlers,(function(e){null!==e&&t(e)}))},InterceptorManager_1=t}function requireNormalizeHeaderName(){if(hasRequiredNormalizeHeaderName)return normalizeHeaderName;hasRequiredNormalizeHeaderName=1;var e=requireUtils();return normalizeHeaderName=function(t,r){e.forEach(t,(function(e,a){a!==r&&a.toUpperCase()===r.toUpperCase()&&(t[r]=e,delete t[a])}))}}function requireEnhanceError(){return hasRequiredEnhanceError||(hasRequiredEnhanceError=1,enhanceError=function(e,t,r,a,n){return e.config=t,r&&(e.code=r),e.request=a,e.response=n,e.isAxiosError=!0,e.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}},e}),enhanceError}function requireCreateError(){if(hasRequiredCreateError)return createError;hasRequiredCreateError=1;var e=requireEnhanceError();return createError=function(t,r,a,n,s){var o=new Error(t);return e(o,r,a,n,s)},createError}function requireSettle(){if(hasRequiredSettle)return settle;hasRequiredSettle=1;var e=requireCreateError();return settle=function(t,r,a){var n=a.config.validateStatus;a.status&&n&&!n(a.status)?r(e("Request failed with status code "+a.status,a.config,null,a.request,a)):t(a)}}function requireCookies(){if(hasRequiredCookies)return cookies;hasRequiredCookies=1;var e=requireUtils();return cookies=e.isStandardBrowserEnv()?{write:function(t,r,a,n,s,o){var i=[];i.push(t+"="+encodeURIComponent(r)),e.isNumber(a)&&i.push("expires="+new Date(a).toGMTString()),e.isString(n)&&i.push("path="+n),e.isString(s)&&i.push("domain="+s),!0===o&&i.push("secure"),document.cookie=i.join("; ")},read:function(e){var t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove:function(e){this.write(e,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}}}function requireIsAbsoluteURL(){return hasRequiredIsAbsoluteURL?isAbsoluteURL:(hasRequiredIsAbsoluteURL=1,isAbsoluteURL=function(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)})}function requireCombineURLs(){return hasRequiredCombineURLs?combineURLs:(hasRequiredCombineURLs=1,combineURLs=function(e,t){return t?e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):e})}function requireBuildFullPath(){if(hasRequiredBuildFullPath)return buildFullPath;hasRequiredBuildFullPath=1;var e=requireIsAbsoluteURL(),t=requireCombineURLs();return buildFullPath=function(r,a){return r&&!e(a)?t(r,a):a}}function requireParseHeaders(){if(hasRequiredParseHeaders)return parseHeaders;hasRequiredParseHeaders=1;var e=requireUtils(),t=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];return parseHeaders=function(r){var a,n,s,o={};return r?(e.forEach(r.split("\n"),(function(r){if(s=r.indexOf(":"),a=e.trim(r.substr(0,s)).toLowerCase(),n=e.trim(r.substr(s+1)),a){if(o[a]&&t.indexOf(a)>=0)return;o[a]="set-cookie"===a?(o[a]?o[a]:[]).concat([n]):o[a]?o[a]+", "+n:n}})),o):o}}function requireIsURLSameOrigin(){if(hasRequiredIsURLSameOrigin)return isURLSameOrigin;hasRequiredIsURLSameOrigin=1;var e=requireUtils();return isURLSameOrigin=e.isStandardBrowserEnv()?function(){var t,r=/(msie|trident)/i.test(navigator.userAgent),a=document.createElement("a");function n(e){var t=e;return r&&(a.setAttribute("href",t),t=a.href),a.setAttribute("href",t),{href:a.href,protocol:a.protocol?a.protocol.replace(/:$/,""):"",host:a.host,search:a.search?a.search.replace(/^\?/,""):"",hash:a.hash?a.hash.replace(/^#/,""):"",hostname:a.hostname,port:a.port,pathname:"/"===a.pathname.charAt(0)?a.pathname:"/"+a.pathname}}return t=n(window.location.href),function(r){var a=e.isString(r)?n(r):r;return a.protocol===t.protocol&&a.host===t.host}}():function(){return!0}}function requireCancel(){if(hasRequiredCancel)return Cancel_1;function e(e){this.message=e}return hasRequiredCancel=1,e.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},e.prototype.__CANCEL__=!0,Cancel_1=e}function requireXhr(){if(hasRequiredXhr)return xhr;hasRequiredXhr=1;var e=requireUtils(),t=requireSettle(),r=requireCookies(),a=requireBuildURL(),n=requireBuildFullPath(),s=requireParseHeaders(),o=requireIsURLSameOrigin(),i=requireCreateError(),c=requireDefaults(),u=requireCancel();return xhr=function(l){return new Promise((function(d,p){var h,f=l.data,g=l.headers,y=l.responseType;function b(){l.cancelToken&&l.cancelToken.unsubscribe(h),l.signal&&l.signal.removeEventListener("abort",h)}e.isFormData(f)&&delete g["Content-Type"];var m=new XMLHttpRequest;if(l.auth){var $=l.auth.username||"",v=l.auth.password?unescape(encodeURIComponent(l.auth.password)):"";g.Authorization="Basic "+btoa($+":"+v)}var T=n(l.baseURL,l.url);function S(){if(m){var e="getAllResponseHeaders"in m?s(m.getAllResponseHeaders()):null,r={data:y&&"text"!==y&&"json"!==y?m.response:m.responseText,status:m.status,statusText:m.statusText,headers:e,config:l,request:m};t((function(e){d(e),b()}),(function(e){p(e),b()}),r),m=null}}if(m.open(l.method.toUpperCase(),a(T,l.params,l.paramsSerializer),!0),m.timeout=l.timeout,"onloadend"in m?m.onloadend=S:m.onreadystatechange=function(){m&&4===m.readyState&&(0!==m.status||m.responseURL&&0===m.responseURL.indexOf("file:"))&&setTimeout(S)},m.onabort=function(){m&&(p(i("Request aborted",l,"ECONNABORTED",m)),m=null)},m.onerror=function(){p(i("Network Error",l,null,m)),m=null},m.ontimeout=function(){var e=l.timeout?"timeout of "+l.timeout+"ms exceeded":"timeout exceeded",t=l.transitional||c.transitional;l.timeoutErrorMessage&&(e=l.timeoutErrorMessage),p(i(e,l,t.clarifyTimeoutError?"ETIMEDOUT":"ECONNABORTED",m)),m=null},e.isStandardBrowserEnv()){var j=(l.withCredentials||o(T))&&l.xsrfCookieName?r.read(l.xsrfCookieName):void 0;j&&(g[l.xsrfHeaderName]=j)}"setRequestHeader"in m&&e.forEach(g,(function(e,t){void 0===f&&"content-type"===t.toLowerCase()?delete g[t]:m.setRequestHeader(t,e)})),e.isUndefined(l.withCredentials)||(m.withCredentials=!!l.withCredentials),y&&"json"!==y&&(m.responseType=l.responseType),"function"==typeof l.onDownloadProgress&&m.addEventListener("progress",l.onDownloadProgress),"function"==typeof l.onUploadProgress&&m.upload&&m.upload.addEventListener("progress",l.onUploadProgress),(l.cancelToken||l.signal)&&(h=function(e){m&&(p(!e||e&&e.type?new u("canceled"):e),m.abort(),m=null)},l.cancelToken&&l.cancelToken.subscribe(h),l.signal&&(l.signal.aborted?h():l.signal.addEventListener("abort",h))),f||(f=null),m.send(f)}))},xhr}function requireDefaults(){if(hasRequiredDefaults)return defaults_1;hasRequiredDefaults=1;var e=requireUtils(),t=requireNormalizeHeaderName(),r=requireEnhanceError(),a={"Content-Type":"application/x-www-form-urlencoded"};function n(t,r){!e.isUndefined(t)&&e.isUndefined(t["Content-Type"])&&(t["Content-Type"]=r)}var s,o={transitional:{silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},adapter:(("undefined"!=typeof XMLHttpRequest||"undefined"!=typeof process&&"[object process]"===Object.prototype.toString.call(process))&&(s=requireXhr()),s),transformRequest:[function(r,a){return t(a,"Accept"),t(a,"Content-Type"),e.isFormData(r)||e.isArrayBuffer(r)||e.isBuffer(r)||e.isStream(r)||e.isFile(r)||e.isBlob(r)?r:e.isArrayBufferView(r)?r.buffer:e.isURLSearchParams(r)?(n(a,"application/x-www-form-urlencoded;charset=utf-8"),r.toString()):e.isObject(r)||a&&"application/json"===a["Content-Type"]?(n(a,"application/json"),function(t,r){if(e.isString(t))try{return(r||JSON.parse)(t),e.trim(t)}catch(a){if("SyntaxError"!==a.name)throw a}return(0,JSON.stringify)(t)}(r)):r}],transformResponse:[function(t){var a=this.transitional||o.transitional,n=a&&a.silentJSONParsing,s=a&&a.forcedJSONParsing,i=!n&&"json"===this.responseType;if(i||s&&e.isString(t)&&t.length)try{return JSON.parse(t)}catch(c){if(i){if("SyntaxError"===c.name)throw r(c,this,"E_JSON_PARSE");throw c}}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};return e.forEach(["delete","get","head"],(function(e){o.headers[e]={}})),e.forEach(["post","put","patch"],(function(t){o.headers[t]=e.merge(a)})),defaults_1=o}function requireTransformData(){if(hasRequiredTransformData)return transformData;hasRequiredTransformData=1;var e=requireUtils(),t=requireDefaults();return transformData=function(r,a,n){var s=this||t;return e.forEach(n,(function(e){r=e.call(s,r,a)})),r},transformData}function requireIsCancel(){return hasRequiredIsCancel?isCancel:(hasRequiredIsCancel=1,isCancel=function(e){return!(!e||!e.__CANCEL__)})}function requireDispatchRequest(){if(hasRequiredDispatchRequest)return dispatchRequest;hasRequiredDispatchRequest=1;var e=requireUtils(),t=requireTransformData(),r=requireIsCancel(),a=requireDefaults(),n=requireCancel();function s(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new n("canceled")}return dispatchRequest=function(n){return s(n),n.headers=n.headers||{},n.data=t.call(n,n.data,n.headers,n.transformRequest),n.headers=e.merge(n.headers.common||{},n.headers[n.method]||{},n.headers),e.forEach(["delete","get","head","post","put","patch","common"],(function(e){delete n.headers[e]})),(n.adapter||a.adapter)(n).then((function(e){return s(n),e.data=t.call(n,e.data,e.headers,n.transformResponse),e}),(function(e){return r(e)||(s(n),e&&e.response&&(e.response.data=t.call(n,e.response.data,e.response.headers,n.transformResponse))),Promise.reject(e)}))}}function requireMergeConfig(){if(hasRequiredMergeConfig)return mergeConfig;hasRequiredMergeConfig=1;var e=requireUtils();return mergeConfig=function(t,r){r=r||{};var a={};function n(t,r){return e.isPlainObject(t)&&e.isPlainObject(r)?e.merge(t,r):e.isPlainObject(r)?e.merge({},r):e.isArray(r)?r.slice():r}function s(a){return e.isUndefined(r[a])?e.isUndefined(t[a])?void 0:n(void 0,t[a]):n(t[a],r[a])}function o(t){if(!e.isUndefined(r[t]))return n(void 0,r[t])}function i(a){return e.isUndefined(r[a])?e.isUndefined(t[a])?void 0:n(void 0,t[a]):n(void 0,r[a])}function c(e){return e in r?n(t[e],r[e]):e in t?n(void 0,t[e]):void 0}var u={url:o,method:o,data:o,baseURL:i,transformRequest:i,transformResponse:i,paramsSerializer:i,timeout:i,timeoutMessage:i,withCredentials:i,adapter:i,responseType:i,xsrfCookieName:i,xsrfHeaderName:i,onUploadProgress:i,onDownloadProgress:i,decompress:i,maxContentLength:i,maxBodyLength:i,transport:i,httpAgent:i,httpsAgent:i,cancelToken:i,socketPath:i,responseEncoding:i,validateStatus:c};return e.forEach(Object.keys(t).concat(Object.keys(r)),(function(t){var r=u[t]||s,n=r(t);e.isUndefined(n)&&r!==c||(a[t]=n)})),a}}function requireData(){return hasRequiredData?data:(hasRequiredData=1,data={version:"0.25.0"})}function requireValidator(){if(hasRequiredValidator)return validator;hasRequiredValidator=1;var e=requireData().version,t={};["object","boolean","number","function","string","symbol"].forEach((function(e,r){t[e]=function(t){return typeof t===e||"a"+(r<1?"n ":" ")+e}}));var r={};return t.transitional=function(t,a,n){function s(t,r){return"[Axios v"+e+"] Transitional option '"+t+"'"+r+(n?". "+n:"")}return function(e,n,o){if(!1===t)throw new Error(s(n," has been removed"+(a?" in "+a:"")));return a&&!r[n]&&(r[n]=!0,console.warn(s(n," has been deprecated since v"+a+" and will be removed in the near future"))),!t||t(e,n,o)}},validator={assertOptions:function(e,t,r){if("object"!=typeof e)throw new TypeError("options must be an object");for(var a=Object.keys(e),n=a.length;n-- >0;){var s=a[n],o=t[s];if(o){var i=e[s],c=void 0===i||o(i,s,e);if(!0!==c)throw new TypeError("option "+s+" must be "+c)}else if(!0!==r)throw Error("Unknown option "+s)}},validators:t},validator}function requireAxios$2(){if(hasRequiredAxios$2)return Axios_1;hasRequiredAxios$2=1;var e=requireUtils(),t=requireBuildURL(),r=requireInterceptorManager(),a=requireDispatchRequest(),n=requireMergeConfig(),s=requireValidator(),o=s.validators;function i(e){this.defaults=e,this.interceptors={request:new r,response:new r}}return i.prototype.request=function(e,t){if("string"==typeof e?(t=t||{}).url=e:t=e||{},!t.url)throw new Error("Provided config url is not valid");(t=n(this.defaults,t)).method?t.method=t.method.toLowerCase():this.defaults.method?t.method=this.defaults.method.toLowerCase():t.method="get";var r=t.transitional;void 0!==r&&s.assertOptions(r,{silentJSONParsing:o.transitional(o.boolean),forcedJSONParsing:o.transitional(o.boolean),clarifyTimeoutError:o.transitional(o.boolean)},!1);var i=[],c=!0;this.interceptors.request.forEach((function(e){"function"==typeof e.runWhen&&!1===e.runWhen(t)||(c=c&&e.synchronous,i.unshift(e.fulfilled,e.rejected))}));var u,l=[];if(this.interceptors.response.forEach((function(e){l.push(e.fulfilled,e.rejected)})),!c){var d=[a,void 0];for(Array.prototype.unshift.apply(d,i),d=d.concat(l),u=Promise.resolve(t);d.length;)u=u.then(d.shift(),d.shift());return u}for(var p=t;i.length;){var h=i.shift(),f=i.shift();try{p=h(p)}catch(g){f(g);break}}try{u=a(p)}catch(g){return Promise.reject(g)}for(;l.length;)u=u.then(l.shift(),l.shift());return u},i.prototype.getUri=function(e){if(!e.url)throw new Error("Provided config url is not valid");return e=n(this.defaults,e),t(e.url,e.params,e.paramsSerializer).replace(/^\?/,"")},e.forEach(["delete","get","head","options"],(function(e){i.prototype[e]=function(t,r){return this.request(n(r||{},{method:e,url:t,data:(r||{}).data}))}})),e.forEach(["post","put","patch"],(function(e){i.prototype[e]=function(t,r,a){return this.request(n(a||{},{method:e,url:t,data:r}))}})),Axios_1=i}function requireCancelToken(){if(hasRequiredCancelToken)return CancelToken_1;hasRequiredCancelToken=1;var e=requireCancel();function t(t){if("function"!=typeof t)throw new TypeError("executor must be a function.");var r;this.promise=new Promise((function(e){r=e}));var a=this;this.promise.then((function(e){if(a._listeners){var t,r=a._listeners.length;for(t=0;t<r;t++)a._listeners[t](e);a._listeners=null}})),this.promise.then=function(e){var t,r=new Promise((function(e){a.subscribe(e),t=e})).then(e);return r.cancel=function(){a.unsubscribe(t)},r},t((function(t){a.reason||(a.reason=new e(t),r(a.reason))}))}return t.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},t.prototype.subscribe=function(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]},t.prototype.unsubscribe=function(e){if(this._listeners){var t=this._listeners.indexOf(e);-1!==t&&this._listeners.splice(t,1)}},t.source=function(){var e;return{token:new t((function(t){e=t})),cancel:e}},CancelToken_1=t}function requireSpread(){return hasRequiredSpread?spread:(hasRequiredSpread=1,spread=function(e){return function(t){return e.apply(null,t)}})}function requireIsAxiosError(){if(hasRequiredIsAxiosError)return isAxiosError;hasRequiredIsAxiosError=1;var e=requireUtils();return isAxiosError=function(t){return e.isObject(t)&&!0===t.isAxiosError}}function requireAxios$1(){if(hasRequiredAxios$1)return axios$2.exports;hasRequiredAxios$1=1;var e=requireUtils(),t=requireBind(),r=requireAxios$2(),a=requireMergeConfig();var n=function n(s){var o=new r(s),i=t(r.prototype.request,o);return e.extend(i,r.prototype,o),e.extend(i,o),i.create=function(e){return n(a(s,e))},i}(requireDefaults());return n.Axios=r,n.Cancel=requireCancel(),n.CancelToken=requireCancelToken(),n.isCancel=requireIsCancel(),n.VERSION=requireData().version,n.all=function(e){return Promise.all(e)},n.spread=requireSpread(),n.isAxiosError=requireIsAxiosError(),axios$2.exports=n,axios$2.exports.default=n,axios$2.exports}function requireAxios(){return hasRequiredAxios?axios$1:(hasRequiredAxios=1,axios$1=requireAxios$1())}var axiosExports=requireAxios();const axios=getDefaultExportFromCjs(axiosExports),requestHandler=function(e){return e},responseHandler=function(e){return e},service=axios.create({withCredentials:!0,timeout:7e3});service.interceptors.request.use(requestHandler),service.interceptors.response.use(responseHandler);const request={install(e){e.provide("request",service)}},useDsl=e=>{const t=VueDemi.ref(e?.page?.data||{}),r=(r,a,n)=>{r.forEach((e=>{isPage(e)?t.value=e:replaceChildNode(VueDemi.reactive(e),[t.value])})),e&&VueDemi.nextTick((()=>{e.emit("replaced-node",{nodes:r,sourceId:a,...n})}))};return e?.dataSourceManager?.on("update-data",r),VueDemi.onBeforeUnmount((()=>{e?.dataSourceManager?.off("update-data",r)})),{pageConfig:t}};function useComponent(e=""){let t,r,a;return"string"==typeof e?t=e:({componentType:t,app:r}=e),t&&""!==t||(t="container"),r||(r=VueDemi.inject("app")),a=resolveComponent({componentType:t,app:r}),a||t.startsWith("magic-ui-")||(t=`magic-ui-${toLine(t)}`,a=resolveComponent({componentType:t,app:r})),a??t}function resolveComponent({componentType:e,app:t}){return t?.resolveComponent(e)}const _sfc_main=Vue.defineComponent({__name:"App",setup(e){const t=Vue.inject("app"),{pageConfig:r}=useDsl(t),a=useComponent("page");return t?.on("page-change",(e=>{if(!e)throw new Error("页面不存在");addParamToUrl({page:e.data.id},window)})),(e,t)=>(Vue.openBlock(),Vue.createBlock(Vue.resolveDynamicComponent(Vue.unref(a)),{config:Vue.unref(r)},null,8,["config"]))}}),getLocalConfig=()=>{const configStr=localStorage.getItem("magicDSL");if(!configStr)return[];try{return[eval(`(${configStr})`)]}catch(err){return[]}};DataSourceManager.registerObservedData(DeepObservedData);const vueApp=Vue.createApp(_sfc_main);vueApp.use(request);const dsl=((getUrlParam("localPreview")?getLocalConfig():window.magicDSL)||[])[0]||{},app=new App({ua:window.navigator.userAgent,config:dsl,request:service,curPage:getUrlParam("page"),useMock:Boolean(getUrlParam("useMock"))});app.setDesignWidth(app.env.isWeb?window.document.documentElement.getBoundingClientRect().width:375),Object.entries(components).forEach((([e,t])=>{app.registerComponent(e,Vue.defineAsyncComponent(t))})),Object.values(plugins).forEach((e=>{vueApp.use(e,{app:app})})),registerDataSourceOnDemand(dsl,datasources).then((e=>{Object.entries(e).forEach((([e,t])=>{DataSourceManager.register(e,t)})),vueApp.config.globalProperties.app=app,vueApp.provide("app",app),vueApp.mount("#app")}))}}}))})();
//# sourceMappingURL=index-legacy-DAXMxUP0.js.map
