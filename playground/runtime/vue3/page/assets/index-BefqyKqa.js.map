{"version":3,"file":"index-BefqyKqa.js","sources":["../../../../../../vue-components/overlay/src/index.vue"],"sourcesContent":["<template>\n  <component v-if=\"visible\" :is=\"containerComponent\" :config=\"{ items: config.items }\">\n    <slot></slot>\n  </component>\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent, onBeforeUnmount, type PropType, ref } from 'vue-demi';\n\nimport type { Id, MContainer, MNode, MPage } from '@tmagic/core';\nimport { useApp, useComponent } from '@tmagic/vue-runtime-help';\n\ninterface OverlaySchema extends Omit<MContainer, 'id'> {\n  id?: Id;\n  type?: 'overlay';\n}\n\nexport default defineComponent({\n  props: {\n    config: {\n      type: Object as PropType<OverlaySchema>,\n      required: true,\n    },\n    iteratorIndex: Array as PropType<number[]>,\n    iteratorContainerId: Array as PropType<Id[]>,\n    model: {\n      type: Object,\n      default: () => ({}),\n    },\n  },\n\n  setup(props) {\n    const visible = ref(false);\n\n    const { app, node } = useApp({\n      config: props.config,\n      iteratorContainerId: props.iteratorContainerId,\n      iteratorIndex: props.iteratorIndex,\n      methods: {\n        openOverlay() {\n          visible.value = true;\n          app?.emit('overlay:open', node);\n        },\n        closeOverlay() {\n          visible.value = false;\n          app?.emit('overlay:close', node);\n        },\n      },\n    });\n\n    const containerComponent = useComponent({ componentType: 'container', app });\n\n    const editorSelectHandler = (\n      info: {\n        node: MNode;\n        page: MPage;\n        parent: MContainer;\n      },\n      path: MNode[],\n    ) => {\n      if (path.find((node: MNode) => node.id === props.config.id)) {\n        node?.instance.openOverlay();\n      } else {\n        node?.instance.closeOverlay();\n      }\n    };\n\n    app?.page?.on('editor:select', editorSelectHandler);\n\n    onBeforeUnmount(() => {\n      app?.page?.off('editor:select', editorSelectHandler);\n    });\n\n    return {\n      containerComponent,\n      visible,\n    };\n  },\n});\n</script>\n"],"names":["_sfc_main","props","visible","app","node","useApp","containerComponent","useComponent","editorSelectHandler","info","path","node2","_a","_sfc_render","_ctx","_cache","$props","$setup","$data","$options","config"],"mappings":"0IAiBA,MAAeA,EAAA,QAAgB,gBAAA,CAAA,MAAA,CACtB,OAAA,CACG,KAAA,OACA,SAAA,EACI,EACZ,cAAA,MACe,oBAAA,MACM,MAAA,CACd,KAAA,OACC,QAAA,KAAA,CAAA,EACW,CACnB,EACF,MAAAC,EAAA,OAGE,MAAAC,EAAgB,gBAEhB,CAAA,IAAAC,EAAA,KAAAC,CAAA,EAAAC,EAAA,CAA6B,OAAAJ,EAAA,OACb,oBAAAA,EAAA,oBACa,cAAAA,EAAA,cACN,QAAA,CACZ,aAAA,CAELC,EAAA,MAAA,GACAC,GAAA,MAAAA,EAAA,KAAA,eAAAC,EAA8B,EAChC,cAAA,CAEEF,EAAA,MAAA,GACAC,GAAA,MAAAA,EAAA,KAAA,gBAAAC,EAA+B,CACjC,CACF,CAAA,EAGFE,EAAAC,EAAA,CAAA,cAAA,YAAA,IAAAJ,CAAA,CAAA,EAEAK,EAAA,CAAAC,EAAAC,IAAA,CAQEA,EAAA,KAAAC,GAAAA,EAAA,KAAAV,EAAA,OAAA,EAAA,EACEG,GAAA,MAAAA,EAAA,SAAA,cAEAA,GAAA,MAAAA,EAAA,SAAA,cACF,EAGF,OAAAQ,EAAAT,GAAA,YAAAA,EAAA,OAAA,MAAAS,EAAA,GAAA,gBAAAJ,GAEA,QAAA,gBAAA,IAAA,QACEI,EAAAT,GAAA,YAAAA,EAAA,OAAA,MAAAS,EAAA,IAAA,gBAAAJ,EAAmD,CAAA,EAGrD,CAAO,mBAAAF,EACL,QAAAJ,CACA,CACF,CAEJ,CAAA,EA7EE,SAAAW,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAA,CADF,OAAAL,EAAA,SAAA,IAAA,UAAA,kBACuEM,IAAY,wBAAAN,EAAA,kBAAA,EAAA,CAAA,IAAA,+BAClE,EAAA,0BAFjB,IAAA,WAAAA,EAAA,OAAA,SAAA,CAAA,CAAA,EAAA,EAAA,CAAA,EAAA,EAAA,CAAA,QAAA,CAAA,GAAA,IAAA,mBAAA,GAAA,EAAA"}