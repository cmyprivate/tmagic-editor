{"version":3,"file":"IteratorContainer-BzvKmQpC.js","sources":["../../../../../../vue-components/iterator-container/src/IteratorContainer.vue"],"sourcesContent":["<template>\n  <div>\n    <component\n      :is=\"containerComponent\"\n      v-for=\"(item, index) in configs\"\n      :iterator-index=\"[...(iteratorIndex || []), index]\"\n      :iterator-container-id=\"[...(iteratorContainerId || []), config.id]\"\n      :key=\"index\"\n      :config=\"item\"\n    ></component>\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport { computed, defineComponent, type PropType, watch } from 'vue-demi';\n\nimport type { Id, IteratorContainer as TMagicIteratorContainer, MIteratorContainer, MNode } from '@tmagic/core';\nimport { useApp, useComponent } from '@tmagic/vue-runtime-help';\n\ninterface IteratorContainerSchema extends Omit<MIteratorContainer, 'id'> {\n  id?: Id;\n  type?: 'iterator-container';\n}\n\ninterface IteratorItemSchema {\n  items: MNode[];\n  condResult: boolean;\n  style: {\n    [key: string]: any;\n  };\n}\n\nexport default defineComponent({\n  props: {\n    config: {\n      type: Object as PropType<IteratorContainerSchema>,\n      required: true,\n    },\n    iteratorIndex: Array as PropType<number[]>,\n    iteratorContainerId: Array as PropType<Id[]>,\n    model: {\n      type: Object,\n      default: () => ({}),\n    },\n  },\n\n  setup(props) {\n    const { app } = useApp({\n      config: props.config,\n      iteratorContainerId: props.iteratorContainerId,\n      iteratorIndex: props.iteratorIndex,\n      methods: {},\n    });\n\n    const containerComponent = useComponent({ componentType: 'container', app });\n\n    const configs = computed<IteratorItemSchema[]>(() => {\n      let { iteratorData = [] } = props.config;\n      const { itemConfig, dsField, items } = props.config;\n\n      if (!Array.isArray(iteratorData)) {\n        iteratorData = [];\n      }\n\n      if (app?.platform === 'editor' && !iteratorData.length) {\n        iteratorData.push({});\n      }\n\n      return iteratorData.map((itemData: any) => {\n        const condResult =\n          app?.platform !== 'editor'\n            ? app?.dataSourceManager?.compliedIteratorItemConds(itemData, itemConfig, dsField) ?? true\n            : true;\n\n        const newItems = app?.dataSourceManager?.compliedIteratorItems(itemData, items, dsField) ?? items;\n\n        return {\n          items: newItems,\n          condResult,\n          style: {\n            position: 'relative',\n            left: 0,\n            top: 0,\n            ...itemConfig.style,\n          },\n        };\n      });\n    });\n\n    watch(\n      configs,\n      (configs) => {\n        if (!props.config.id) {\n          return;\n        }\n\n        const iteratorContainerNode = app?.getNode<TMagicIteratorContainer>(\n          props.config.id,\n          props.iteratorContainerId,\n          props.iteratorIndex,\n        );\n\n        if (!iteratorContainerNode) {\n          return;\n        }\n\n        iteratorContainerNode.resetNodes();\n\n        configs.forEach((config, index) => {\n          iteratorContainerNode.setNodes(config.items, index);\n        });\n      },\n      {\n        immediate: true,\n      },\n    );\n\n    return {\n      configs,\n      containerComponent,\n    };\n  },\n});\n</script>\n"],"names":["_sfc_main","props","app","useApp","containerComponent","useComponent","configs","iteratorData","itemConfig","dsField","items","itemData","condResult","_b","_a","_d","_c","configs2","iteratorContainerNode","config","index","_sfc_render","_ctx","_cache","$props","$setup","$data","$options","iteratorIndex","item","iteratorContainerId"],"mappings":"+IAgCA,MAAeA,EAAA,QAAgB,gBAAA,CAAA,MAAA,CACtB,OAAA,CACG,KAAA,OACA,SAAA,EACI,EACZ,cAAA,MACe,oBAAA,MACM,MAAA,CACd,KAAA,OACC,QAAA,KAAA,CAAA,EACW,CACnB,EACF,MAAAC,EAAA,CAGE,KAAA,CAAA,IAAAC,CAAA,EAAAC,EAAA,CAAuB,OAAAF,EAAA,OACP,oBAAAA,EAAA,oBACa,cAAAA,EAAA,cACN,QAAA,CAAA,CACX,CAAA,EAGZG,EAAAC,EAAA,CAAA,cAAA,YAAA,IAAAH,CAAA,CAAA,EAEAI,EAAgB,sBACd,GAAA,CAAA,aAAAC,EAAA,EAAA,EAAAN,EAAA,OACA,KAAA,CAAA,WAAAO,EAAA,QAAAC,EAAA,MAAAC,CAAA,EAAAT,EAAA,OAEA,OAAA,MAAA,QAAAM,CAAA,IACEA,EAAA,CAAA,IAGFL,GAAA,YAAAA,EAAA,YAAA,UAAA,CAAAK,EAAA,QACEA,EAAA,KAAA,EAAA,EAGFA,EAAA,IAAAI,GAAA,aACE,MAAAC,GAAAV,GAAA,YAAAA,EAAA,YAAA,WAAAW,GAAAC,EAAAZ,GAAA,YAAAA,EAAA,oBAAA,YAAAY,EAAA,0BAAAH,EAAAH,EAAAC,KAAA,KAAAI,EAAA,GAOA,MAAA,CAAO,OAFPE,GAAAC,EAAAd,GAAA,YAAAA,EAAA,oBAAA,YAAAc,EAAA,sBAAAL,EAAAD,EAAAD,KAAA,KAAAM,EAAAL,EAGS,WAAAE,EACP,MAAA,CACO,SAAA,WACK,KAAA,EACJ,IAAA,EACD,GAAAJ,EAAA,KACS,CAChB,CACF,CAAA,CACD,CAAA,EAGH,eAAA,MAAAF,EACEW,GAAA,CAEE,GAAA,CAAAhB,EAAA,OAAA,GACE,OAGF,MAAAiB,EAAAhB,GAAA,YAAAA,EAAA,QAAmCD,EAAA,OAAA,GACpBA,EAAA,oBACPA,EAAA,eAIRiB,IAIAA,EAAA,WAAA,EAEAD,EAAA,QAAA,CAAAE,EAAAC,IAAA,CACEF,EAAA,SAAAC,EAAA,MAAAC,CAAA,CAAkD,CAAA,EACnD,EACH,CACA,UAAA,EACa,CACb,EAGF,CAAO,QAAAd,EACL,mBAAAF,CACA,CACF,CAEJ,CAAA,EAxHI,SAAAiB,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAA,CAFJ,OAAA,IAAA,YAAA,IAAA,mBAAA,MAAA,KAAA,EAKO,cAAA,EAAA,EAAA,IAAA,mBAAqBC,IAAAA,cAAsB,IAAK,WAAAN,EAAA,QAAA,CAAAO,EAAAT,KAChD,IAA4BU,UAAAA,EAAAA,IAAAA,YAAAA,IAAAA,wBAAAA,EAAAA,kBAAAA,EAAAA,CAAqC,iBAAA,CAAA,GAAAR,EAAA,eAAA,CAAA,EAAAF,CAAA,EACvD,wBAAA,CAAA,GAAAE,EAAA,qBAAA,CAAA,EAAAA,EAAA,OAAA,EAAA,EACE,IAAAF"}