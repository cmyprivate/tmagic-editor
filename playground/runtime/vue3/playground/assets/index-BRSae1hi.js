const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/comp-entry-CkpRydtZ.js","assets/comp-entry-Db09S4Ne.css"])))=>i.map(i=>d[i]);
var ds=Object.defineProperty;var qt=e=>{throw TypeError(e)};var ps=(e,r,t)=>r in e?ds(e,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[r]=t;var g=(e,r,t)=>ps(e,typeof r!="symbol"?r+"":r,t),Kt=(e,r,t)=>r.has(e)||qt("Cannot "+t);var x=(e,r,t)=>(Kt(e,r,"read from private field"),t?t.call(e):r.get(e)),D=(e,r,t)=>r.has(e)?qt("Cannot add the same private member more than once"):r instanceof WeakSet?r.add(e):r.set(e,t),P=(e,r,t,n)=>(Kt(e,r,"write to private field"),n?n.call(e,t):r.set(e,t),t);function od(){import.meta.url,import("_").catch(()=>1),async function*(){}().next()}(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}})();const gs="modulepreload",ms=function(e){return"/tmagic-editor/playground/runtime/vue3/playground/"+e},Qt={},ut=function(r,t,n){let s=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),a=(o==null?void 0:o.nonce)||(o==null?void 0:o.getAttribute("nonce"));s=Promise.allSettled(t.map(c=>{if(c=ms(c),c in Qt)return;Qt[c]=!0;const u=c.endsWith(".css"),f=u?'[rel="stylesheet"]':"";if(document.querySelector('link[href="'.concat(c,'"]').concat(f)))return;const l=document.createElement("link");if(l.rel=u?"stylesheet":gs,u||(l.as="script"),l.crossOrigin="",l.href=c,a&&l.setAttribute("nonce",a),document.head.appendChild(l),u)return new Promise((h,y)=>{l.addEventListener("load",h),l.addEventListener("error",()=>y(new Error("Unable to preload CSS for ".concat(c))))})}))}function i(o){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=o,window.dispatchEvent(a),!a.defaultPrevented)throw o}return s.then(o=>{for(const a of o||[])a.status==="rejected"&&i(a.reason);return r().catch(i)})};function ys(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Ue={exports:{}},Vt;function bs(){if(Vt)return Ue.exports;Vt=1;var e=typeof Reflect=="object"?Reflect:null,r=e&&typeof e.apply=="function"?e.apply:function(d,m,v){return Function.prototype.apply.call(d,m,v)},t;e&&typeof e.ownKeys=="function"?t=e.ownKeys:Object.getOwnPropertySymbols?t=function(d){return Object.getOwnPropertyNames(d).concat(Object.getOwnPropertySymbols(d))}:t=function(d){return Object.getOwnPropertyNames(d)};function n(p){console&&console.warn&&console.warn(p)}var s=Number.isNaN||function(d){return d!==d};function i(){i.init.call(this)}Ue.exports=i,Ue.exports.once=C,i.EventEmitter=i,i.prototype._events=void 0,i.prototype._eventsCount=0,i.prototype._maxListeners=void 0;var o=10;function a(p){if(typeof p!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof p)}Object.defineProperty(i,"defaultMaxListeners",{enumerable:!0,get:function(){return o},set:function(p){if(typeof p!="number"||p<0||s(p))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+p+".");o=p}}),i.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},i.prototype.setMaxListeners=function(d){if(typeof d!="number"||d<0||s(d))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+d+".");return this._maxListeners=d,this};function c(p){return p._maxListeners===void 0?i.defaultMaxListeners:p._maxListeners}i.prototype.getMaxListeners=function(){return c(this)},i.prototype.emit=function(d){for(var m=[],v=1;v<arguments.length;v++)m.push(arguments[v]);var $=d==="error",T=this._events;if(T!==void 0)$=$&&T.error===void 0;else if(!$)return!1;if($){var w;if(m.length>0&&(w=m[0]),w instanceof Error)throw w;var L=new Error("Unhandled error."+(w?" ("+w.message+")":""));throw L.context=w,L}var $e=T[d];if($e===void 0)return!1;if(typeof $e=="function")r($e,this,m);else for(var Gt=$e.length,hs=b($e,Gt),v=0;v<Gt;++v)r(hs[v],this,m);return!0};function u(p,d,m,v){var $,T,w;if(a(m),T=p._events,T===void 0?(T=p._events=Object.create(null),p._eventsCount=0):(T.newListener!==void 0&&(p.emit("newListener",d,m.listener?m.listener:m),T=p._events),w=T[d]),w===void 0)w=T[d]=m,++p._eventsCount;else if(typeof w=="function"?w=T[d]=v?[m,w]:[w,m]:v?w.unshift(m):w.push(m),$=c(p),$>0&&w.length>$&&!w.warned){w.warned=!0;var L=new Error("Possible EventEmitter memory leak detected. "+w.length+" "+String(d)+" listeners added. Use emitter.setMaxListeners() to increase limit");L.name="MaxListenersExceededWarning",L.emitter=p,L.type=d,L.count=w.length,n(L)}return p}i.prototype.addListener=function(d,m){return u(this,d,m,!1)},i.prototype.on=i.prototype.addListener,i.prototype.prependListener=function(d,m){return u(this,d,m,!0)};function f(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function l(p,d,m){var v={fired:!1,wrapFn:void 0,target:p,type:d,listener:m},$=f.bind(v);return $.listener=m,v.wrapFn=$,$}i.prototype.once=function(d,m){return a(m),this.on(d,l(this,d,m)),this},i.prototype.prependOnceListener=function(d,m){return a(m),this.prependListener(d,l(this,d,m)),this},i.prototype.removeListener=function(d,m){var v,$,T,w,L;if(a(m),$=this._events,$===void 0)return this;if(v=$[d],v===void 0)return this;if(v===m||v.listener===m)--this._eventsCount===0?this._events=Object.create(null):(delete $[d],$.removeListener&&this.emit("removeListener",d,v.listener||m));else if(typeof v!="function"){for(T=-1,w=v.length-1;w>=0;w--)if(v[w]===m||v[w].listener===m){L=v[w].listener,T=w;break}if(T<0)return this;T===0?v.shift():S(v,T),v.length===1&&($[d]=v[0]),$.removeListener!==void 0&&this.emit("removeListener",d,L||m)}return this},i.prototype.off=i.prototype.removeListener,i.prototype.removeAllListeners=function(d){var m,v,$;if(v=this._events,v===void 0)return this;if(v.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):v[d]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete v[d]),this;if(arguments.length===0){var T=Object.keys(v),w;for($=0;$<T.length;++$)w=T[$],w!=="removeListener"&&this.removeAllListeners(w);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(m=v[d],typeof m=="function")this.removeListener(d,m);else if(m!==void 0)for($=m.length-1;$>=0;$--)this.removeListener(d,m[$]);return this};function h(p,d,m){var v=p._events;if(v===void 0)return[];var $=v[d];return $===void 0?[]:typeof $=="function"?m?[$.listener||$]:[$]:m?_($):b($,$.length)}i.prototype.listeners=function(d){return h(this,d,!0)},i.prototype.rawListeners=function(d){return h(this,d,!1)},i.listenerCount=function(p,d){return typeof p.listenerCount=="function"?p.listenerCount(d):y.call(p,d)},i.prototype.listenerCount=y;function y(p){var d=this._events;if(d!==void 0){var m=d[p];if(typeof m=="function")return 1;if(m!==void 0)return m.length}return 0}i.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]};function b(p,d){for(var m=new Array(d),v=0;v<d;++v)m[v]=p[v];return m}function S(p,d){for(;d+1<p.length;d++)p[d]=p[d+1];p.pop()}function _(p){for(var d=new Array(p.length),m=0;m<d.length;++m)d[m]=p[m].listener||p[m];return d}function C(p,d){return new Promise(function(m,v){function $(w){p.removeListener(d,T),v(w)}function T(){typeof p.removeListener=="function"&&p.removeListener("error",$),m([].slice.call(arguments))}U(p,d,T,{once:!0}),d!=="error"&&I(p,$,{once:!0})})}function I(p,d,m){typeof p.on=="function"&&U(p,"error",d,m)}function U(p,d,m,v){if(typeof p.on=="function")v.once?p.once(d,m):p.on(d,m);else if(typeof p.addEventListener=="function")p.addEventListener(d,function $(T){v.once&&p.removeEventListener(d,$),m(T)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof p)}return Ue.exports}var Re=bs();const sn=ys(Re);var on=typeof global=="object"&&global&&global.Object===Object&&global,vs=typeof self=="object"&&self&&self.Object===Object&&self,R=on||vs||Function("return this")(),q=R.Symbol,an=Object.prototype,$s=an.hasOwnProperty,ws=an.toString,we=q?q.toStringTag:void 0;function _s(e){var r=$s.call(e,we),t=e[we];try{e[we]=void 0;var n=!0}catch(i){}var s=ws.call(e);return n&&(r?e[we]=t:delete e[we]),s}var Ts=Object.prototype,Es=Ts.toString;function Os(e){return Es.call(e)}var js="[object Null]",As="[object Undefined]",Yt=q?q.toStringTag:void 0;function ge(e){return e==null?e===void 0?As:js:Yt&&Yt in Object(e)?_s(e):Os(e)}function me(e){return e!=null&&typeof e=="object"}var Ss="[object Symbol]";function jt(e){return typeof e=="symbol"||me(e)&&ge(e)==Ss}function Is(e,r){for(var t=-1,n=e==null?0:e.length,s=Array(n);++t<n;)s[t]=r(e[t],t,e);return s}var Q=Array.isArray,Cs=1/0,Xt=q?q.prototype:void 0,Jt=Xt?Xt.toString:void 0;function cn(e){if(typeof e=="string")return e;if(Q(e))return Is(e,cn)+"";if(jt(e))return Jt?Jt.call(e):"";var r=e+"";return r=="0"&&1/e==-Cs?"-0":r}function J(e){var r=typeof e;return e!=null&&(r=="object"||r=="function")}var xs="[object AsyncFunction]",Ls="[object Function]",Ds="[object GeneratorFunction]",Ps="[object Proxy]";function un(e){if(!J(e))return!1;var r=ge(e);return r==Ls||r==Ds||r==xs||r==Ps}var ft=R["__core-js_shared__"],Zt=function(){var e=/[^.]+$/.exec(ft&&ft.keys&&ft.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();function Ms(e){return!!Zt&&Zt in e}var Ns=Function.prototype,Rs=Ns.toString;function re(e){if(e!=null){try{return Rs.call(e)}catch(r){}try{return e+""}catch(r){}}return""}var Fs=/[\\^$.*+?()[\]{}|]/g,Us=/^\[object .+?Constructor\]$/,Bs=Function.prototype,Ws=Object.prototype,Hs=Bs.toString,ks=Ws.hasOwnProperty,zs=RegExp("^"+Hs.call(ks).replace(Fs,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function Gs(e){if(!J(e)||Ms(e))return!1;var r=un(e)?zs:Us;return r.test(re(e))}function qs(e,r){return e==null?void 0:e[r]}function ne(e,r){var t=qs(e,r);return Gs(t)?t:void 0}var yt=ne(R,"WeakMap"),er=Object.create,Ks=function(){function e(){}return function(r){if(!J(r))return{};if(er)return er(r);e.prototype=r;var t=new e;return e.prototype=void 0,t}}();function Qs(e,r){var t=-1,n=e.length;for(r||(r=Array(n));++t<n;)r[t]=e[t];return r}var tr=function(){try{var e=ne(Object,"defineProperty");return e({},"",{}),e}catch(r){}}();function Vs(e,r){for(var t=-1,n=e==null?0:e.length;++t<n&&r(e[t],t,e)!==!1;);return e}var Ys=9007199254740991,Xs=/^(?:0|[1-9]\d*)$/;function At(e,r){var t=typeof e;return r=r==null?Ys:r,!!r&&(t=="number"||t!="symbol"&&Xs.test(e))&&e>-1&&e%1==0&&e<r}function fn(e,r,t){r=="__proto__"&&tr?tr(e,r,{configurable:!0,enumerable:!0,value:t,writable:!0}):e[r]=t}function ln(e,r){return e===r||e!==e&&r!==r}var Js=Object.prototype,Zs=Js.hasOwnProperty;function St(e,r,t){var n=e[r];(!(Zs.call(e,r)&&ln(n,t))||t===void 0&&!(r in e))&&fn(e,r,t)}function et(e,r,t,n){var s=!t;t||(t={});for(var i=-1,o=r.length;++i<o;){var a=r[i],c=void 0;c===void 0&&(c=e[a]),s?fn(t,a,c):St(t,a,c)}return t}var ei=9007199254740991;function It(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=ei}function Ct(e){return e!=null&&It(e.length)&&!un(e)}var ti=Object.prototype;function tt(e){var r=e&&e.constructor,t=typeof r=="function"&&r.prototype||ti;return e===t}function ri(e,r){for(var t=-1,n=Array(e);++t<e;)n[t]=r(t);return n}var ni="[object Arguments]";function rr(e){return me(e)&&ge(e)==ni}var hn=Object.prototype,si=hn.hasOwnProperty,ii=hn.propertyIsEnumerable,xt=rr(function(){return arguments}())?rr:function(e){return me(e)&&si.call(e,"callee")&&!ii.call(e,"callee")};function oi(){return!1}var dn=typeof exports=="object"&&exports&&!exports.nodeType&&exports,nr=dn&&typeof module=="object"&&module&&!module.nodeType&&module,ai=nr&&nr.exports===dn,sr=ai?R.Buffer:void 0,ci=sr?sr.isBuffer:void 0,Lt=ci||oi,ui="[object Arguments]",fi="[object Array]",li="[object Boolean]",hi="[object Date]",di="[object Error]",pi="[object Function]",gi="[object Map]",mi="[object Number]",yi="[object Object]",bi="[object RegExp]",vi="[object Set]",$i="[object String]",wi="[object WeakMap]",_i="[object ArrayBuffer]",Ti="[object DataView]",Ei="[object Float32Array]",Oi="[object Float64Array]",ji="[object Int8Array]",Ai="[object Int16Array]",Si="[object Int32Array]",Ii="[object Uint8Array]",Ci="[object Uint8ClampedArray]",xi="[object Uint16Array]",Li="[object Uint32Array]",j={};j[Ei]=j[Oi]=j[ji]=j[Ai]=j[Si]=j[Ii]=j[Ci]=j[xi]=j[Li]=!0;j[ui]=j[fi]=j[_i]=j[li]=j[Ti]=j[hi]=j[di]=j[pi]=j[gi]=j[mi]=j[yi]=j[bi]=j[vi]=j[$i]=j[wi]=!1;function Di(e){return me(e)&&It(e.length)&&!!j[ge(e)]}function Dt(e){return function(r){return e(r)}}var pn=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Te=pn&&typeof module=="object"&&module&&!module.nodeType&&module,Pi=Te&&Te.exports===pn,lt=Pi&&on.process,he=function(){try{var e=Te&&Te.require&&Te.require("util").types;return e||lt&&lt.binding&&lt.binding("util")}catch(r){}}(),ir=he&&he.isTypedArray,gn=ir?Dt(ir):Di,Mi=Object.prototype,Ni=Mi.hasOwnProperty;function mn(e,r){var t=Q(e),n=!t&&xt(e),s=!t&&!n&&Lt(e),i=!t&&!n&&!s&&gn(e),o=t||n||s||i,a=o?ri(e.length,String):[],c=a.length;for(var u in e)(r||Ni.call(e,u))&&!(o&&(u=="length"||s&&(u=="offset"||u=="parent")||i&&(u=="buffer"||u=="byteLength"||u=="byteOffset")||At(u,c)))&&a.push(u);return a}function yn(e,r){return function(t){return e(r(t))}}var Ri=yn(Object.keys,Object),Fi=Object.prototype,Ui=Fi.hasOwnProperty;function bn(e){if(!tt(e))return Ri(e);var r=[];for(var t in Object(e))Ui.call(e,t)&&t!="constructor"&&r.push(t);return r}function Pt(e){return Ct(e)?mn(e):bn(e)}function Bi(e){var r=[];if(e!=null)for(var t in Object(e))r.push(t);return r}var Wi=Object.prototype,Hi=Wi.hasOwnProperty;function ki(e){if(!J(e))return Bi(e);var r=tt(e),t=[];for(var n in e)n=="constructor"&&(r||!Hi.call(e,n))||t.push(n);return t}function Mt(e){return Ct(e)?mn(e,!0):ki(e)}var zi=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Gi=/^\w*$/;function qi(e,r){if(Q(e))return!1;var t=typeof e;return t=="number"||t=="symbol"||t=="boolean"||e==null||jt(e)?!0:Gi.test(e)||!zi.test(e)||r!=null&&e in Object(r)}var je=ne(Object,"create");function Ki(){this.__data__=je?je(null):{},this.size=0}function Qi(e){var r=this.has(e)&&delete this.__data__[e];return this.size-=r?1:0,r}var Vi="__lodash_hash_undefined__",Yi=Object.prototype,Xi=Yi.hasOwnProperty;function Ji(e){var r=this.__data__;if(je){var t=r[e];return t===Vi?void 0:t}return Xi.call(r,e)?r[e]:void 0}var Zi=Object.prototype,eo=Zi.hasOwnProperty;function to(e){var r=this.__data__;return je?r[e]!==void 0:eo.call(r,e)}var ro="__lodash_hash_undefined__";function no(e,r){var t=this.__data__;return this.size+=this.has(e)?0:1,t[e]=je&&r===void 0?ro:r,this}function Z(e){var r=-1,t=e==null?0:e.length;for(this.clear();++r<t;){var n=e[r];this.set(n[0],n[1])}}Z.prototype.clear=Ki;Z.prototype.delete=Qi;Z.prototype.get=Ji;Z.prototype.has=to;Z.prototype.set=no;function so(){this.__data__=[],this.size=0}function rt(e,r){for(var t=e.length;t--;)if(ln(e[t][0],r))return t;return-1}var io=Array.prototype,oo=io.splice;function ao(e){var r=this.__data__,t=rt(r,e);if(t<0)return!1;var n=r.length-1;return t==n?r.pop():oo.call(r,t,1),--this.size,!0}function co(e){var r=this.__data__,t=rt(r,e);return t<0?void 0:r[t][1]}function uo(e){return rt(this.__data__,e)>-1}function fo(e,r){var t=this.__data__,n=rt(t,e);return n<0?(++this.size,t.push([e,r])):t[n][1]=r,this}function k(e){var r=-1,t=e==null?0:e.length;for(this.clear();++r<t;){var n=e[r];this.set(n[0],n[1])}}k.prototype.clear=so;k.prototype.delete=ao;k.prototype.get=co;k.prototype.has=uo;k.prototype.set=fo;var Ae=ne(R,"Map");function lo(){this.size=0,this.__data__={hash:new Z,map:new(Ae||k),string:new Z}}function ho(e){var r=typeof e;return r=="string"||r=="number"||r=="symbol"||r=="boolean"?e!=="__proto__":e===null}function nt(e,r){var t=e.__data__;return ho(r)?t[typeof r=="string"?"string":"hash"]:t.map}function po(e){var r=nt(this,e).delete(e);return this.size-=r?1:0,r}function go(e){return nt(this,e).get(e)}function mo(e){return nt(this,e).has(e)}function yo(e,r){var t=nt(this,e),n=t.size;return t.set(e,r),this.size+=t.size==n?0:1,this}function V(e){var r=-1,t=e==null?0:e.length;for(this.clear();++r<t;){var n=e[r];this.set(n[0],n[1])}}V.prototype.clear=lo;V.prototype.delete=po;V.prototype.get=go;V.prototype.has=mo;V.prototype.set=yo;var bo="Expected a function";function Nt(e,r){if(typeof e!="function"||r!=null&&typeof r!="function")throw new TypeError(bo);var t=function(){var n=arguments,s=r?r.apply(this,n):n[0],i=t.cache;if(i.has(s))return i.get(s);var o=e.apply(this,n);return t.cache=i.set(s,o)||i,o};return t.cache=new(Nt.Cache||V),t}Nt.Cache=V;var vo=500;function $o(e){var r=Nt(e,function(n){return t.size===vo&&t.clear(),n}),t=r.cache;return r}var wo=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,_o=/\\(\\)?/g,To=$o(function(e){var r=[];return e.charCodeAt(0)===46&&r.push(""),e.replace(wo,function(t,n,s,i){r.push(s?i.replace(_o,"$1"):n||t)}),r});function Eo(e){return e==null?"":cn(e)}function vn(e,r){return Q(e)?e:qi(e,r)?[e]:To(Eo(e))}var Oo=1/0;function $n(e){if(typeof e=="string"||jt(e))return e;var r=e+"";return r=="0"&&1/e==-Oo?"-0":r}function wn(e,r){for(var t=-1,n=r.length,s=e.length;++t<n;)e[s+t]=r[t];return e}var _n=yn(Object.getPrototypeOf,Object);function jo(){this.__data__=new k,this.size=0}function Ao(e){var r=this.__data__,t=r.delete(e);return this.size=r.size,t}function So(e){return this.__data__.get(e)}function Io(e){return this.__data__.has(e)}var Co=200;function xo(e,r){var t=this.__data__;if(t instanceof k){var n=t.__data__;if(!Ae||n.length<Co-1)return n.push([e,r]),this.size=++t.size,this;t=this.__data__=new V(n)}return t.set(e,r),this.size=t.size,this}function ye(e){var r=this.__data__=new k(e);this.size=r.size}ye.prototype.clear=jo;ye.prototype.delete=Ao;ye.prototype.get=So;ye.prototype.has=Io;ye.prototype.set=xo;function Lo(e,r){return e&&et(r,Pt(r),e)}function Do(e,r){return e&&et(r,Mt(r),e)}var Tn=typeof exports=="object"&&exports&&!exports.nodeType&&exports,or=Tn&&typeof module=="object"&&module&&!module.nodeType&&module,Po=or&&or.exports===Tn,ar=Po?R.Buffer:void 0,cr=ar?ar.allocUnsafe:void 0;function Mo(e,r){if(r)return e.slice();var t=e.length,n=cr?cr(t):new e.constructor(t);return e.copy(n),n}function No(e,r){for(var t=-1,n=e==null?0:e.length,s=0,i=[];++t<n;){var o=e[t];r(o,t,e)&&(i[s++]=o)}return i}function En(){return[]}var Ro=Object.prototype,Fo=Ro.propertyIsEnumerable,ur=Object.getOwnPropertySymbols,Rt=ur?function(e){return e==null?[]:(e=Object(e),No(ur(e),function(r){return Fo.call(e,r)}))}:En;function Uo(e,r){return et(e,Rt(e),r)}var Bo=Object.getOwnPropertySymbols,On=Bo?function(e){for(var r=[];e;)wn(r,Rt(e)),e=_n(e);return r}:En;function Wo(e,r){return et(e,On(e),r)}function jn(e,r,t){var n=r(e);return Q(e)?n:wn(n,t(e))}function Ho(e){return jn(e,Pt,Rt)}function ko(e){return jn(e,Mt,On)}var bt=ne(R,"DataView"),vt=ne(R,"Promise"),$t=ne(R,"Set"),fr="[object Map]",zo="[object Object]",lr="[object Promise]",hr="[object Set]",dr="[object WeakMap]",pr="[object DataView]",Go=re(bt),qo=re(Ae),Ko=re(vt),Qo=re($t),Vo=re(yt),N=ge;(bt&&N(new bt(new ArrayBuffer(1)))!=pr||Ae&&N(new Ae)!=fr||vt&&N(vt.resolve())!=lr||$t&&N(new $t)!=hr||yt&&N(new yt)!=dr)&&(N=function(e){var r=ge(e),t=r==zo?e.constructor:void 0,n=t?re(t):"";if(n)switch(n){case Go:return pr;case qo:return fr;case Ko:return lr;case Qo:return hr;case Vo:return dr}return r});var Yo=Object.prototype,Xo=Yo.hasOwnProperty;function Jo(e){var r=e.length,t=new e.constructor(r);return r&&typeof e[0]=="string"&&Xo.call(e,"index")&&(t.index=e.index,t.input=e.input),t}var gr=R.Uint8Array;function Ft(e){var r=new e.constructor(e.byteLength);return new gr(r).set(new gr(e)),r}function Zo(e,r){var t=r?Ft(e.buffer):e.buffer;return new e.constructor(t,e.byteOffset,e.byteLength)}var ea=/\w*$/;function ta(e){var r=new e.constructor(e.source,ea.exec(e));return r.lastIndex=e.lastIndex,r}var mr=q?q.prototype:void 0,yr=mr?mr.valueOf:void 0;function ra(e){return yr?Object(yr.call(e)):{}}function na(e,r){var t=r?Ft(e.buffer):e.buffer;return new e.constructor(t,e.byteOffset,e.length)}var sa="[object Boolean]",ia="[object Date]",oa="[object Map]",aa="[object Number]",ca="[object RegExp]",ua="[object Set]",fa="[object String]",la="[object Symbol]",ha="[object ArrayBuffer]",da="[object DataView]",pa="[object Float32Array]",ga="[object Float64Array]",ma="[object Int8Array]",ya="[object Int16Array]",ba="[object Int32Array]",va="[object Uint8Array]",$a="[object Uint8ClampedArray]",wa="[object Uint16Array]",_a="[object Uint32Array]";function Ta(e,r,t){var n=e.constructor;switch(r){case ha:return Ft(e);case sa:case ia:return new n(+e);case da:return Zo(e,t);case pa:case ga:case ma:case ya:case ba:case va:case $a:case wa:case _a:return na(e,t);case oa:return new n;case aa:case fa:return new n(e);case ca:return ta(e);case ua:return new n;case la:return ra(e)}}function Ea(e){return typeof e.constructor=="function"&&!tt(e)?Ks(_n(e)):{}}var Oa="[object Map]";function ja(e){return me(e)&&N(e)==Oa}var br=he&&he.isMap,Aa=br?Dt(br):ja,Sa="[object Set]";function Ia(e){return me(e)&&N(e)==Sa}var vr=he&&he.isSet,Ca=vr?Dt(vr):Ia,xa=1,La=2,Da=4,An="[object Arguments]",Pa="[object Array]",Ma="[object Boolean]",Na="[object Date]",Ra="[object Error]",Sn="[object Function]",Fa="[object GeneratorFunction]",Ua="[object Map]",Ba="[object Number]",In="[object Object]",Wa="[object RegExp]",Ha="[object Set]",ka="[object String]",za="[object Symbol]",Ga="[object WeakMap]",qa="[object ArrayBuffer]",Ka="[object DataView]",Qa="[object Float32Array]",Va="[object Float64Array]",Ya="[object Int8Array]",Xa="[object Int16Array]",Ja="[object Int32Array]",Za="[object Uint8Array]",ec="[object Uint8ClampedArray]",tc="[object Uint16Array]",rc="[object Uint32Array]",E={};E[An]=E[Pa]=E[qa]=E[Ka]=E[Ma]=E[Na]=E[Qa]=E[Va]=E[Ya]=E[Xa]=E[Ja]=E[Ua]=E[Ba]=E[In]=E[Wa]=E[Ha]=E[ka]=E[za]=E[Za]=E[ec]=E[tc]=E[rc]=!0;E[Ra]=E[Sn]=E[Ga]=!1;function ke(e,r,t,n,s,i){var o,a=r&xa,c=r&La,u=r&Da;if(o!==void 0)return o;if(!J(e))return e;var f=Q(e);if(f){if(o=Jo(e),!a)return Qs(e,o)}else{var l=N(e),h=l==Sn||l==Fa;if(Lt(e))return Mo(e,a);if(l==In||l==An||h&&!s){if(o=c||h?{}:Ea(e),!a)return c?Wo(e,Do(o,e)):Uo(e,Lo(o,e))}else{if(!E[l])return s?e:{};o=Ta(e,l,a)}}i||(i=new ye);var y=i.get(e);if(y)return y;i.set(e,o),Ca(e)?e.forEach(function(_){o.add(ke(_,r,t,_,e,i))}):Aa(e)&&e.forEach(function(_,C){o.set(C,ke(_,r,t,C,e,i))});var b=u?c?ko:Ho:c?Mt:Pt,S=f?void 0:b(e);return Vs(S||e,function(_,C){S&&(C=_,_=e[C]),St(o,C,ke(_,r,t,C,e,i))}),o}var nc=1,sc=4;function ic(e){return ke(e,nc|sc)}function oc(e,r,t){r=vn(r,e);for(var n=-1,s=r.length,i=!1;++n<s;){var o=$n(r[n]);if(!(i=e!=null&&t(e,o)))break;e=e[o]}return i||++n!=s?i:(s=e==null?0:e.length,!!s&&It(s)&&At(o,s)&&(Q(e)||xt(e)))}var ac=Object.prototype,cc=ac.hasOwnProperty;function uc(e,r){return e!=null&&cc.call(e,r)}function fc(e,r){return e!=null&&oc(e,r,uc)}var lc="[object Map]",hc="[object Set]",dc=Object.prototype,pc=dc.hasOwnProperty;function gc(e){if(e==null)return!0;if(Ct(e)&&(Q(e)||typeof e=="string"||typeof e.splice=="function"||Lt(e)||gn(e)||xt(e)))return!e.length;var r=N(e);if(r==lc||r==hc)return!e.size;if(tt(e))return!bn(e).length;for(var t in e)if(pc.call(e,t))return!1;return!0}function mc(e,r,t,n){if(!J(e))return e;r=vn(r,e);for(var s=-1,i=r.length,o=i-1,a=e;a!=null&&++s<i;){var c=$n(r[s]),u=t;if(c==="__proto__"||c==="constructor"||c==="prototype")return e;if(s!=o){var f=a[c];u=void 0,u===void 0&&(u=J(f)?f:At(r[s+1])?[]:{})}St(a,c,u),a=a[c]}return e}function yc(e,r,t){return e==null?e:mc(e,r,t)}/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */function bc(e,r,t,n){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(f){try{u(n.next(f))}catch(l){o(l)}}function c(f){try{u(n.throw(f))}catch(l){o(l)}}function u(f){f.done?i(f.value):s(f.value).then(a,c)}u((n=n.apply(e,[])).next())})}const Y=[];function vc(e,r,t="*"){if(e===t)return!0;Y.length=0;let n=0,s=0,i=0,o=0;for(let h=0,y=e.length;h<y;h+=1){const b=e[h];b===t&&(n+=1,h>o&&Y.push(e.substring(o,h)),Y.push(b),o=h+1)}if(o<e.length&&Y.push(e.substring(o)),n?(s=e.length-n,i=1/0):i=s=e.length,Y.length===0)return e===r;const a=r.length;if(a<s||a>i)return!1;let c=0,u=Y.length-1,f=r.length-1,l=!1;for(;;){const h=Y[u];if(u-=1,h===t)l=!0;else{const y=f+1-h.length,b=r.lastIndexOf(h,y);if(b===-1||b>y)return!1;if(l)f=b-1,l=!1;else{if(b!==y)return!1;f-=h.length}}if(c>u)break}return!0}class Be{constructor(r,t,n,s=void 0){this.obj=r,this.delimiter=t,this.wildcard=n,this.is_match=s}shortMatch(r,t){if(r===t||r===this.wildcard)return!0;if(this.is_match)return this.is_match(r,t);const n=r.indexOf(this.wildcard);if(n>-1){const s=r.substr(n+1);if(n===0||t.substring(0,n)===r.substring(0,n)){const i=s.length;return i>0?t.substr(-i)===s:!0}}return!1}match(r,t){return this.is_match?this.is_match(r,t):r===t||r===this.wildcard||t===this.wildcard||this.shortMatch(r,t)||vc(r,t,this.wildcard)}handleArray(r,t,n,s,i={}){let o=r.indexOf(this.delimiter,n),a=!1;o===-1&&(a=!0,o=r.length);const c=r.substring(n,o);let u=0;for(const f of t){const l=u.toString(),h=s===""?l:s+this.delimiter+u;(c===this.wildcard||c===l||this.shortMatch(c,l))&&(a?i[h]=f:this.goFurther(r,f,o+1,h,i)),u++}return i}handleObject(r,t,n,s,i={}){let o=r.indexOf(this.delimiter,n),a=!1;o===-1&&(a=!0,o=r.length);const c=r.substring(n,o);for(let u in t){u=u.toString();const f=s===""?u:s+this.delimiter+u;(c===this.wildcard||c===u||this.shortMatch(c,u))&&(a?i[f]=t[u]:this.goFurther(r,t[u],o+1,f,i))}return i}goFurther(r,t,n,s,i={}){return Array.isArray(t)?this.handleArray(r,t,n,s,i):this.handleObject(r,t,n,s,i)}get(r){return this.goFurther(r,this.obj,0,"")}}class ce{static get(r,t,n=!1){if(!t)return;let s=t;for(const i of r)if(i in s)s=s[i];else if(n)s[i]=Object.create({}),s=s[i];else return;return s}static set(r,t,n){if(!n)return;if(r.length===0){for(const a in n)delete n[a];for(const a in t)n[a]=t[a];return}const s=r.slice(),i=s.pop(),o=ce.get(s,n,!0);return typeof o=="object"&&(o[i]=t),t}}let H,Qe=0,We=null;function ht(){return(We===null||We.buffer!==H.memory.buffer)&&(We=new Uint8Array(H.memory.buffer)),We}let ze=new TextEncoder("utf-8");const $c=typeof ze.encodeInto=="function"?function(e,r){return ze.encodeInto(e,r)}:function(e,r){const t=ze.encode(e);return r.set(t),{read:e.length,written:t.length}};function $r(e,r,t){if(t===void 0){const a=ze.encode(e),c=r(a.length);return ht().subarray(c,c+a.length).set(a),Qe=a.length,c}let n=e.length,s=r(n);const i=ht();let o=0;for(;o<n;o++){const a=e.charCodeAt(o);if(a>127)break;i[s+o]=a}if(o!==n){o!==0&&(e=e.slice(o)),s=t(s,n,n=o+e.length*3);const a=ht().subarray(s+o,s+n),c=$c(e,a);o+=c.written}return Qe=o,s}function wc(e,r){var t=$r(e,H.__wbindgen_malloc,H.__wbindgen_realloc),n=Qe,s=$r(r,H.__wbindgen_malloc,H.__wbindgen_realloc),i=Qe,o=H.is_match(t,n,s,i);return o!==0}async function _c(e,r){if(typeof Response=="function"&&e instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(e,r)}catch(n){if(e.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",n);else throw n}const t=await e.arrayBuffer();return await WebAssembly.instantiate(t,r)}else{const t=await WebAssembly.instantiate(e,r);return t instanceof WebAssembly.Instance?{instance:t,module:e}:t}}async function Cn(e){const r={};(typeof e=="string"||typeof Request=="function"&&e instanceof Request||typeof URL=="function"&&e instanceof URL)&&(e=fetch(e));const{instance:t,module:n}=await _c(await e,r);return H=t.exports,Cn.__wbindgen_wasm_module=n,H}const ae={only:[],source:"",debug:!1,data:void 0,queue:!1,force:!1};function Tc(e,r){console.debug(e,r)}function Ec(){return{delimiter:".",debug:!1,extraDebug:!1,useMute:!0,notRecursive:";",param:":",wildcard:"*",experimentalMatch:!1,queue:!1,defaultBulkValue:!0,useCache:!1,useSplitCache:!1,useIndicesCache:!1,maxSimultaneousJobs:1e3,maxQueueRuns:1e3,log:Tc,Promise}}function wr(e){return e&&e.constructor?e.constructor.name==="Object":typeof e=="object"&&e!==null}class Oc{constructor(r={},t={}){this.jobsRunning=0,this.updateQueue=[],this.subscribeQueue=[],this.listenersIgnoreCache=new WeakMap,this.is_match=null,this.destroyed=!1,this.queueRuns=0,this.groupId=0,this.namedGroups=[],this.numberGroups=[],this.traceId=0,this.traceMap=new Map,this.tracing=[],this.savedTrace=[],this.collection=null,this.collections=0,this.cache=new Map,this.splitCache=new Map,this.indices=new Map,this.indicesCount=new Map,this.lastExecs=new WeakMap,this.listeners=new Map,this.waitingListeners=new Map,this.options=Object.assign(Object.assign({},Ec()),t),this.data=r,this.id=0,this.options.useCache?(this.pathGet=this.cacheGet,this.pathSet=this.cacheSet):(this.pathGet=ce.get,this.pathSet=ce.set),t.Promise?this.resolved=t.Promise.resolve():this.resolved=Promise.resolve(),this.muted=new Set,this.mutedListeners=new Set,this.scan=new Be(this.data,this.options.delimiter,this.options.wildcard),this.destroyed=!1}getDefaultListenerOptions(){return{bulk:!1,bulkValue:this.options.defaultBulkValue,debug:!1,source:"",data:void 0,queue:!1,group:!1}}cacheGet(r,t=this.data,n=!1){const s=r.join(this.options.delimiter),i=this.cache.get(s);if(i){const a=i.deref();if(a)return a}const o=ce.get(r,t,n);return(wr(o)||Array.isArray(o))&&this.cache.set(s,new WeakRef(o)),o}cacheSet(r,t,n=this.data){const s=r.join(this.options.delimiter);return wr(t)||Array.isArray(t)?this.cache.set(s,new WeakRef(t)):this.cache.delete(s),ce.set(r,t,n)}silentSet(r,t){return this.pathSet(this.split(r),t,this.data)}loadWasmMatcher(r){return bc(this,void 0,void 0,function*(){yield Cn(r),this.is_match=wc,this.scan=new Be(this.data,this.options.delimiter,this.options.wildcard,this.is_match)})}same(r,t){return(["number","string","undefined","boolean"].includes(typeof r)||r===null)&&t===r}getListeners(){return this.listeners}destroy(){this.destroyed=!0,this.data=void 0,this.listeners=new Map,this.waitingListeners=new Map,this.updateQueue=[],this.jobsRunning=0}match(r,t,n=!0){return this.is_match?this.is_match(r,t):r===t||r===this.options.wildcard||t===this.options.wildcard?!0:!n&&this.getIndicesCount(this.options.delimiter,r)<this.getIndicesCount(this.options.delimiter,t)?!1:this.scan.match(r,t)}getIndicesOf(r,t){if(this.options.useIndicesCache&&this.indices.has(t))return this.indices.get(t);const n=r.length;if(n==0)return[];let s=0,i,o=[];for(;(i=t.indexOf(r,s))>-1;)o.push(i),s=i+n;return this.options.useIndicesCache&&this.indices.set(t,o),o}getIndicesCount(r,t){if(this.options.useIndicesCache&&this.indicesCount.has(t))return this.indicesCount.get(t);const n=r.length;if(n==0)return 0;let s=0,i,o=0;for(;(i=t.indexOf(r,s))>-1;)o++,s=i+n;return this.options.useIndicesCache&&this.indicesCount.set(t,o),o}cutPath(r,t){if(t==="")return"";if(r=this.cleanNotRecursivePath(r),t=this.cleanNotRecursivePath(t),r===t)return r;const n=this.getIndicesCount(this.options.delimiter,t),s=this.getIndicesOf(this.options.delimiter,r);return r.substring(0,s[n])}trimPath(r){return r=this.cleanNotRecursivePath(r),r.charAt(0)===this.options.delimiter?r.substr(1):r}split(r){if(r==="")return[];if(!this.options.useSplitCache)return r.split(this.options.delimiter);const t=this.splitCache.get(r);if(t)return t.slice();const n=r.split(this.options.delimiter);return this.splitCache.set(r,n.slice()),n}isWildcard(r){return r.includes(this.options.wildcard)||this.hasParams(r)}isNotRecursive(r){return r.endsWith(this.options.notRecursive)}cleanNotRecursivePath(r){return this.isNotRecursive(r)?r.substring(0,r.length-1):r}hasParams(r){return r.includes(this.options.param)}getParamsInfo(r){let t={replaced:"",original:r,params:{}},n=0,s=[];for(const i of this.split(r)){t.params[n]={original:i,replaced:"",name:""};const o=new RegExp("\\".concat(this.options.param,"([^\\").concat(this.options.delimiter,"\\").concat(this.options.param,"]+)"),"g");let a=o.exec(i);if(a)t.params[n].name=a[1];else{delete t.params[n],s.push(i),n++;continue}o.lastIndex=0,t.params[n].replaced=i.replace(o,this.options.wildcard),s.push(t.params[n].replaced),n++}return t.replaced=s.join(this.options.delimiter),t}getParams(r,t){if(!r)return;const n=this.split(t),s={};for(const i in r.params){const o=r.params[i];s[o.name]=n[i]}return s}waitForAll(r,t){const n={};for(let s of r)n[s]={dirty:!1},this.hasParams(s)&&(n[s].paramsInfo=this.getParamsInfo(s)),n[s].isWildcard=this.isWildcard(s),n[s].isRecursive=!this.isNotRecursive(s);return this.waitingListeners.set(r,{fn:t,paths:n}),t(n),function(){this.waitingListeners.delete(r)}}executeWaitingListeners(r){if(!this.destroyed)for(const t of this.waitingListeners.values()){const{fn:n,paths:s}=t;let i=0,o=0;for(let a in s){const c=s[a];let u=!1;c.isRecursive&&(r=this.cutPath(r,a)),c.isWildcard&&this.match(a,r)&&(u=!0),r===a&&(u=!0),u&&(c.dirty=!0),c.dirty&&i++,o++}i===o&&n(s)}}subscribeAll(r,t,n=this.getDefaultListenerOptions()){if(this.destroyed)return()=>{};let s=[],i=0,o=null;typeof n.group=="boolean"&&n.group?(this.groupId++,o=this.groupId,n.bulk=!0):typeof n.group=="string"&&(n.bulk=!0,o=n.group);for(const a of r)s.push(this.subscribe(a,t,n,{all:r,index:i,groupId:o})),i++;return function(){for(const c of s)c()}}getCleanListenersCollection(r={}){return Object.assign({listeners:new Map,isRecursive:!1,isWildcard:!1,hasParams:!1,match:void 0,paramsInfo:void 0,path:void 0,originalPath:void 0,count:0},r)}getCleanListener(r,t=this.getDefaultListenerOptions()){return{fn:r,options:Object.assign(Object.assign({},this.getDefaultListenerOptions()),t),groupId:null}}getListenerCollectionMatch(r,t,n){r=this.cleanNotRecursivePath(r);const s=this;return function(o,a=!1){let c=r;return t?o=s.cutPath(o,r):c=s.cutPath(s.cleanNotRecursivePath(r),o),a&&console.log("[getListenerCollectionMatch]",{listenerPath:r,scopedListenerPath:c,path:o,isRecursive:t,isWildcard:n}),n&&s.match(c,o,t)?!0:c===o}}getListenersCollection(r,t){if(this.listeners.has(r)){let a=this.listeners.get(r);return a.listeners.set(++this.id,t),t.id=this.id,a}const n=this.hasParams(r);let s;n&&(s=this.getParamsInfo(r));let i={isRecursive:!this.isNotRecursive(r),isWildcard:this.isWildcard(r),hasParams:n,paramsInfo:s,originalPath:r,path:n?s.replaced:r};i.isRecursive||(i.path=this.cleanNotRecursivePath(i.path));let o=this.getCleanListenersCollection(Object.assign(Object.assign({},i),{match:this.getListenerCollectionMatch(i.path,i.isRecursive,i.isWildcard)}));return this.id++,o.listeners.set(this.id,t),t.id=this.id,this.listeners.set(i.originalPath,o),o}subscribe(r,t,n=this.getDefaultListenerOptions(),s={all:[r],index:0,groupId:null}){if(this.destroyed)return()=>{};this.jobsRunning++;const i="subscribe";let o=this.getCleanListener(t,n);n.group&&(n.bulk=!0,typeof n.group=="string"?o.groupId=n.group:s.groupId&&(o.groupId=s.groupId)),this.listenersIgnoreCache.set(o,{truthy:[],falsy:[]});const a=this.getListenersCollection(r,o);n.debug&&console.log("[subscribe]",{listenerPath:r,options:n}),a.count++;let c=!0;if(o.groupId&&(typeof o.groupId=="string"?this.namedGroups.includes(o.groupId)?c=!1:this.namedGroups.push(o.groupId):typeof o.groupId=="number"&&(this.numberGroups.includes(o.groupId)?c=!1:this.numberGroups.push(o.groupId))),c){const u=this.cleanNotRecursivePath(a.path),f=this.split(u);if(!a.isWildcard)!this.isMuted(u)&&!this.isMuted(t)&&t(this.pathGet(f,this.data),{type:i,listener:o,listenersCollection:a,path:{listener:r,update:void 0,resolved:this.cleanNotRecursivePath(r)},params:this.getParams(a.paramsInfo,u),options:n});else{const l=this.scan.get(u);if(n.bulk){const h=[];for(const y in l)this.isMuted(y)||h.push({path:y,params:this.getParams(a.paramsInfo,y),value:l[y]});this.isMuted(t)||t(h,{type:i,listener:o,listenersCollection:a,path:{listener:r,update:void 0,resolved:void 0},options:n,params:void 0})}else for(const h in l)!this.isMuted(h)&&!this.isMuted(t)&&t(l[h],{type:i,listener:o,listenersCollection:a,path:{listener:r,update:void 0,resolved:this.cleanNotRecursivePath(h)},params:this.getParams(a.paramsInfo,h),options:n})}}return this.debugSubscribe(o,a,r),this.jobsRunning--,this.unsubscribe(r,this.id)}unsubscribe(r,t){const n=this.listeners,s=n.get(r);return function(){s.listeners.delete(t),s.count--,s.count===0&&n.delete(r)}}runQueuedListeners(){if(!this.destroyed&&this.subscribeQueue.length!==0)if(this.jobsRunning===0){this.queueRuns=0;const r=[...this.subscribeQueue];for(let t=0,n=r.length;t<n;t++)r[t]();this.subscribeQueue.length=0}else{if(this.queueRuns++,this.queueRuns>=this.options.maxQueueRuns)throw this.queueRuns=0,new Error("Maximal number of queue runs exhausted.");Promise.resolve().then(()=>this.runQueuedListeners()).catch(r=>{throw r})}}getQueueNotifyListeners(r,t=[]){for(const n in r){if(this.isMuted(n))continue;let{single:s,bulk:i}=r[n];for(const o of s){let a=!1,c=o.listener.id+":"+o.eventInfo.path.resolved;o.eventInfo.path.resolved||(c=o.listener.id+":"+o.eventInfo.path.listener);for(const f of t)if(c===f.resolvedIdPath){a=!0;break}if(a)continue;const u=this.debugTime(o);if(!this.isMuted(o.listener.fn))if(o.listener.options.queue&&this.jobsRunning)this.subscribeQueue.push(()=>{o.listener.fn(o.value?o.value():void 0,o.eventInfo)});else{let f=o.listener.id+":"+o.eventInfo.path.resolved;o.eventInfo.path.resolved||(f=o.listener.id+":"+o.eventInfo.path.listener),t.push({id:o.listener.id,resolvedPath:o.eventInfo.path.resolved,resolvedIdPath:f,originalFn:o.listener.fn,fn:()=>{o.listener.fn(o.value?o.value():void 0,o.eventInfo)},options:o.listener.options,groupId:o.listener.groupId})}this.debugListener(u,o)}for(const o of i){let a=!1;for(const f of t)if(f.id===o.listener.id){a=!0;break}if(a)continue;const c=this.debugTime(o),u=[];for(const f of o.value)u.push(Object.assign(Object.assign({},f),{value:f.value?f.value():void 0}));if(!this.isMuted(o.listener.fn))if(o.listener.options.queue&&this.jobsRunning)this.subscribeQueue.push(()=>this.jobsRunning?!1:(o.listener.fn(u,o.eventInfo),!0));else{let f=o.listener.id+":"+o.eventInfo.path.resolved;o.eventInfo.path.resolved||(f=o.listener.id+":"+o.eventInfo.path.listener),t.push({id:o.listener.id,resolvedPath:o.eventInfo.path.resolved,resolvedIdPath:f,originalFn:o.listener.fn,fn:()=>{o.listener.fn(u,o.eventInfo)},options:o.listener.options,groupId:o.listener.groupId})}this.debugListener(c,o)}}return Promise.resolve().then(()=>this.runQueuedListeners()),t}shouldIgnore(r,t){if(!r.options.ignore)return!1;for(const n of r.options.ignore){if(t.startsWith(n)||this.is_match&&this.is_match(n,t))return!0;{const s=this.cutPath(t,n);if(this.match(n,s))return!0}}return!1}getSubscribedListeners(r,t,n,s="update",i=null){n=Object.assign(Object.assign({},ae),n);const o={};for(let[a,c]of this.listeners)if(c.match(r)){o[a]={single:[],bulk:[],bulkData:[]};const u=c.paramsInfo?this.getParams(c.paramsInfo,r):void 0,f=this.cutPath(r,a),h=c.isRecursive||c.isWildcard?()=>this.get(f):()=>t,y=[{value:h,path:r,params:u}];for(const b of c.listeners.values()){if(this.shouldIgnore(b,r)){b.options.debug&&console.log("[getSubscribedListeners] Listener was not fired because it was ignored.",{listener:b,listenersCollection:c});continue}b.options.bulk?o[a].bulk.push({listener:b,listenersCollection:c,eventInfo:{type:s,listener:b,path:{listener:a,update:i||r,resolved:void 0},params:u,options:n},value:y}):o[a].single.push({listener:b,listenersCollection:c,eventInfo:{type:s,listener:b,path:{listener:a,update:i||r,resolved:this.cleanNotRecursivePath(r)},params:u,options:n},value:h})}}else if(this.options.extraDebug){let u=!1;for(const f of c.listeners.values())f.options.debug&&(u=!0,console.log("[getSubscribedListeners] Listener was not fired because there was no match.",{listener:f,listenersCollection:c,updatePath:r}));u&&c.match(r,!0)}return o}notifySubscribedListeners(r,t,n,s="update",i=null){return this.getQueueNotifyListeners(this.getSubscribedListeners(r,t,n,s,i))}useBulkValue(r){for(const[t,n]of r.listeners)if(n.options.bulk&&n.options.bulkValue||!n.options.bulk)return!0;return!1}getNestedListeners(r,t,n,s="update",i=null){const o={},a={};for(let[c,u]of this.listeners){if(!u.isRecursive)continue;const f=this.cutPath(c,r);if(this.match(f,r)){o[c]={single:[],bulk:[]};const l=this.trimPath(c.substr(f.length)),h=this.useBulkValue(u);let y;h&&(y=a[l]?a[l]:new Be(t,this.options.delimiter,this.options.wildcard).get(l),a[l]=y);const b=u.paramsInfo?this.getParams(u.paramsInfo,r):void 0,S=[],_={};for(const[C,I]of u.listeners)if(h)for(const U in y){const p=()=>y[U],d=[r,U].join(this.options.delimiter),m={type:s,listener:I,listenersCollection:u,path:{listener:c,update:i||r,resolved:this.cleanNotRecursivePath(d)},params:b,options:n};this.shouldIgnore(I,r)||(I.options.bulk?(S.push({value:p,path:d,params:b}),_[C]=I):o[c].single.push({listener:I,listenersCollection:u,eventInfo:m,value:p}))}else{const U={type:s,listener:I,listenersCollection:u,path:{listener:c,update:i||r,resolved:void 0},params:b,options:n};if(this.shouldIgnore(I,r))continue;I.options.bulk?(S.push({value:void 0,path:void 0,params:b}),_[C]=I):o[c].single.push({listener:I,listenersCollection:u,eventInfo:U,value:void 0})}for(const C in _){const I=_[C],U={type:s,listener:I,listenersCollection:u,path:{listener:c,update:r,resolved:void 0},options:n,params:b};o[c].bulk.push({listener:I,listenersCollection:u,eventInfo:U,value:S})}}else if(this.options.extraDebug)for(const l of u.listeners.values())l.options.debug&&console.log("[getNestedListeners] Listener was not fired because there was no match.",{listener:l,listenersCollection:u,currentCutPath:f,updatePath:r})}return o}notifyNestedListeners(r,t,n,s="update",i,o=null){return this.getQueueNotifyListeners(this.getNestedListeners(r,t,n,s,o),i)}getNotifyOnlyListeners(r,t,n,s="update",i=null){const o={};if(typeof n.only!="object"||!Array.isArray(n.only)||typeof n.only[0]>"u"||!this.canBeNested(t))return o;for(const a of n.only){const c=new Be(t,this.options.delimiter,this.options.wildcard).get(a);o[a]={bulk:[],single:[]};for(const u in c){const f=r+this.options.delimiter+u;for(const[l,h]of this.listeners){const y=h.paramsInfo?this.getParams(h.paramsInfo,f):void 0;if(this.match(l,f)){const b=()=>c[u],S=[{value:b,path:f,params:y}];for(const _ of h.listeners.values()){const C={type:s,listener:_,listenersCollection:h,path:{listener:l,update:i||r,resolved:this.cleanNotRecursivePath(f)},params:y,options:n};this.shouldIgnore(_,r)||(_.options.bulk?o[a].bulk.some(I=>I.listener===_)||o[a].bulk.push({listener:_,listenersCollection:h,eventInfo:C,value:S}):o[a].single.push({listener:_,listenersCollection:h,eventInfo:C,value:b}))}}}}}return o}runQueue(r){const t=[];for(const n of r)n.options.group?t.includes(n.groupId)||(n.fn(),t.push(n.groupId)):n.fn()}sortAndRunQueue(r,t){r.sort(function(n,s){return n.id-s.id}),this.options.debug&&console.log("[deep-state-observer] queue for ".concat(t),r),this.runQueue(r)}notifyOnly(r,t,n,s="update",i=""){const o=this.getQueueNotifyListeners(this.getNotifyOnlyListeners(r,t,n,s,i));this.sortAndRunQueue(o,r)}canBeNested(r){return typeof r=="object"&&r!==null}getUpdateValues(r,t){let n=t;return typeof t=="function"&&(n=t(r)),{newValue:n,oldValue:r}}wildcardNotify(r,t){let n=[];for(const s of r)this.getQueueNotifyListeners(s,n);for(const s of t)this.executeWaitingListeners(s);return this.jobsRunning--,n}wildcardUpdate(r,t,n=ae,s=!1){++this.jobsRunning,n=Object.assign(Object.assign({},ae),n);const i=this.scan.get(r),o={};for(const f in i){const l=this.split(f),{oldValue:h,newValue:y}=this.getUpdateValues(i[f],t);(!this.same(y,h)||n.force)&&(this.pathSet(l,y,this.data),o[f]=y)}const a=[],c=[];for(const f in o){const l=o[f];n.only.length?a.push(this.getNotifyOnlyListeners(f,l,n,"update",r)):(a.push(this.getSubscribedListeners(f,l,n,"update",r)),this.canBeNested(l)&&a.push(this.getNestedListeners(f,l,n,"update",r))),n.debug&&this.options.log("Wildcard update",{path:f,newValue:l}),c.push(f)}if(s){const f=this;return function(){const l=f.wildcardNotify(a,c);f.sortAndRunQueue(l,r)}}const u=this.wildcardNotify(a,c);this.sortAndRunQueue(u,r)}runUpdateQueue(){if(!this.destroyed)for(;this.updateQueue.length&&this.updateQueue.length<this.options.maxSimultaneousJobs;){const r=this.updateQueue.shift();r.options.queue=!1,this.update(r.updatePath,r.fnOrValue,r.options,r.multi)}}updateNotify(r,t,n){const s=this.notifySubscribedListeners(r,t,n);this.canBeNested(t)&&this.notifyNestedListeners(r,t,n,"update",s),this.sortAndRunQueue(s,r),this.executeWaitingListeners(r)}updateNotifyAll(r){let t=[];for(const n of r){const s=n.newValue;if(this.tracing.length){const i=this.tracing[this.tracing.length-1],o=this.traceMap.get(i);o.changed.push({traceId:i,updatePath:n.updatePath,fnOrValue:s,options:n.options}),this.traceMap.set(i,o)}t=t.concat(this.notifySubscribedListeners(n.updatePath,s,n.options)),this.canBeNested(n.newValue)&&this.notifyNestedListeners(n.updatePath,s,n.options,"update",t)}this.runQueue(t)}updateNotifyOnly(r,t,n){this.notifyOnly(r,t,n),this.executeWaitingListeners(r)}update(r,t,n=Object.assign({},ae),s=!1){if(this.destroyed)return;if(this.collection)return this.collection.update(r,t,n);if(this.tracing.length){const f=this.tracing[this.tracing.length-1],l=this.traceMap.get(f);l.changed.push({traceId:f,updatePath:r,fnOrValue:t,options:n}),this.traceMap.set(f,l)}const i=this.jobsRunning;if((this.options.queue||n.queue)&&i){if(i>this.options.maxSimultaneousJobs)throw new Error("Maximal simultaneous jobs limit reached.");this.updateQueue.push({updatePath:r,fnOrValue:t,options:n,multi:s});const f=Promise.resolve().then(()=>{this.runUpdateQueue()});return s?function(){return f}:f}if(this.isWildcard(r))return this.wildcardUpdate(r,t,n,s);++this.jobsRunning;const o=this.split(r),a=this.pathGet(o,this.data);let{oldValue:c,newValue:u}=this.getUpdateValues(a,t);if(n.debug&&this.options.log("Updating ".concat(r," ").concat(n.source?"from ".concat(n.source):""),{oldValue:c,newValue:u}),this.same(u,c)&&!n.force)return--this.jobsRunning,s?function(){return u}:u;if(this.pathSet(o,u,this.data),n=Object.assign(Object.assign({},ae),n),n.only===null)return--this.jobsRunning,s?function(){}:u;if(n.only.length){if(--this.jobsRunning,s){const f=this;return function(){return f.updateNotifyOnly(r,u,n)}}return this.updateNotifyOnly(r,u,n),u}if(s){--this.jobsRunning;const f=this;return function(){return f.updateNotify(r,u,n)}}return this.updateNotify(r,u,n),--this.jobsRunning,u}multi(r=!1){if(this.destroyed)return{update(){return this},done(){},getStack(){return[]}};if(this.collection)return this.collection;const t=this,n=[],s=[];return{update(o,a,c=ae){if(r){const u=t.split(o);let f=a;const l=t.pathGet(u,t.data);typeof f=="function"&&(f=f(l)),t.pathSet(u,f,t.data),n.push({updatePath:o,newValue:f,options:c})}else s.push(t.update(o,a,c,!0));return this},done(){if(t.collections===0){if(r)t.updateNotifyAll(n);else for(const o of s)o();n.length=0}},getStack(){return n}}}collect(){return this.collections++,this.collection||(this.collection=this.multi(!0)),this.collection}executeCollected(){if(this.collections--,this.collections===0&&this.collection){const r=this.collection;this.collection=null,r.done()}}getCollectedCount(){return this.collections}getCollectedStack(){return this.collection?this.collection.getStack():[]}get(r=void 0){if(!this.destroyed)return r===void 0||r===""?this.data:this.isWildcard(r)?this.scan.get(r):this.pathGet(this.split(r),this.data)}last(r){let t=this.lastExecs.get(r);t||(t={calls:0},this.lastExecs.set(r,t));const n=++t.calls;this.resolved.then(()=>{n===t.calls&&(this.lastExecs.set(r,{calls:0}),r())})}isMuted(r){if(!this.options.useMute)return!1;if(typeof r=="function")return this.isMutedListener(r);for(const t of this.muted){const n=!this.isNotRecursive(t),s=this.trimPath(t);if(this.match(r,s)||this.match(s,r))return!0;if(n){const i=this.cutPath(s,r);if(this.match(i,t)||this.match(t,i))return!0}}return!1}isMutedListener(r){return this.mutedListeners.has(r)}mute(r){if(typeof r=="function")return this.mutedListeners.add(r);this.muted.add(r)}unmute(r){if(typeof r=="function")return this.mutedListeners.delete(r);this.muted.delete(r)}debugSubscribe(r,t,n){r.options.debug&&this.options.log("listener subscribed",{listenerPath:n,listener:r,listenersCollection:t})}debugListener(r,t){(t.eventInfo.options.debug||t.listener.options.debug)&&this.options.log("Listener fired",{time:Date.now()-r,info:t})}debugTime(r){return r.listener.options.debug||r.eventInfo.options.debug?Date.now():0}startTrace(r,t=null){this.traceId++;const n=this.traceId+":"+r;return this.traceMap.set(n,{id:n,sort:this.traceId,stack:this.tracing.map(s=>s),additionalData:t,changed:[]}),this.tracing.push(n),n}stopTrace(r){const t=this.traceMap.get(r);return this.tracing.pop(),this.traceMap.delete(r),t}saveTrace(r){const t=this.traceMap.get(r);return this.tracing.pop(),this.traceMap.delete(r),this.savedTrace.push(t),t}getSavedTraces(){const r=this.savedTrace.map(t=>t);return r.sort((t,n)=>t.sort-n.sort),this.savedTrace=[],r}}var xn=typeof global=="object"&&global&&global.Object===Object&&global,jc=typeof self=="object"&&self&&self.Object===Object&&self,F=xn||jc||Function("return this")(),K=F.Symbol,Ln=Object.prototype,Ac=Ln.hasOwnProperty,Sc=Ln.toString,_e=K?K.toStringTag:void 0;function Ic(e){var r=Ac.call(e,_e),t=e[_e];try{e[_e]=void 0;var n=!0}catch(i){}var s=Sc.call(e);return n&&(r?e[_e]=t:delete e[_e]),s}var Cc=Object.prototype,xc=Cc.toString;function Lc(e){return xc.call(e)}var Dc="[object Null]",Pc="[object Undefined]",_r=K?K.toStringTag:void 0;function Fe(e){return e==null?e===void 0?Pc:Dc:_r&&_r in Object(e)?Ic(e):Lc(e)}function be(e){return e!=null&&typeof e=="object"}var st=Array.isArray;function it(e){var r=typeof e;return e!=null&&(r=="object"||r=="function")}function Dn(e){return e}var Mc="[object AsyncFunction]",Nc="[object Function]",Rc="[object GeneratorFunction]",Fc="[object Proxy]";function Pn(e){if(!it(e))return!1;var r=Fe(e);return r==Nc||r==Rc||r==Mc||r==Fc}var dt=F["__core-js_shared__"],Tr=function(){var e=/[^.]+$/.exec(dt&&dt.keys&&dt.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();function Uc(e){return!!Tr&&Tr in e}var Bc=Function.prototype,Wc=Bc.toString;function se(e){if(e!=null){try{return Wc.call(e)}catch(r){}try{return e+""}catch(r){}}return""}var Hc=/[\\^$.*+?()[\]{}|]/g,kc=/^\[object .+?Constructor\]$/,zc=Function.prototype,Gc=Object.prototype,qc=zc.toString,Kc=Gc.hasOwnProperty,Qc=RegExp("^"+qc.call(Kc).replace(Hc,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function Vc(e){if(!it(e)||Uc(e))return!1;var r=Pn(e)?Qc:kc;return r.test(se(e))}function Yc(e,r){return e==null?void 0:e[r]}function ie(e,r){var t=Yc(e,r);return Vc(t)?t:void 0}var wt=ie(F,"WeakMap"),Er=Object.create,Xc=function(){function e(){}return function(r){if(!it(r))return{};if(Er)return Er(r);e.prototype=r;var t=new e;return e.prototype=void 0,t}}();function Jc(e,r,t){switch(t.length){case 0:return e.call(r);case 1:return e.call(r,t[0]);case 2:return e.call(r,t[0],t[1]);case 3:return e.call(r,t[0],t[1],t[2])}return e.apply(r,t)}function Zc(){}var eu=800,tu=16,ru=Date.now;function nu(e){var r=0,t=0;return function(){var n=ru(),s=tu-(n-t);if(t=n,s>0){if(++r>=eu)return arguments[0]}else r=0;return e.apply(void 0,arguments)}}function su(e){return function(){return e}}var Ve=function(){try{var e=ie(Object,"defineProperty");return e({},"",{}),e}catch(r){}}(),iu=Ve?function(e,r){return Ve(e,"toString",{configurable:!0,enumerable:!1,value:su(r),writable:!0})}:Dn,ou=nu(iu);function au(e,r){for(var t=-1,n=e==null?0:e.length;++t<n&&r(e[t],t,e)!==!1;);return e}function cu(e,r,t,n){for(var s=e.length,i=t+-1;++i<s;)if(r(e[i],i,e))return i;return-1}function uu(e){return e!==e}function fu(e,r,t){for(var n=t-1,s=e.length;++n<s;)if(e[n]===r)return n;return-1}function lu(e,r,t){return r===r?fu(e,r,t):cu(e,uu,t)}function hu(e,r){var t=e==null?0:e.length;return!!t&&lu(e,r,0)>-1}var du=9007199254740991,pu=/^(?:0|[1-9]\d*)$/;function gu(e,r){var t=typeof e;return r=r==null?du:r,!!r&&(t=="number"||t!="symbol"&&pu.test(e))&&e>-1&&e%1==0&&e<r}function mu(e,r,t){r=="__proto__"&&Ve?Ve(e,r,{configurable:!0,enumerable:!0,value:t,writable:!0}):e[r]=t}function Mn(e,r){return e===r||e!==e&&r!==r}var yu=Object.prototype,bu=yu.hasOwnProperty;function vu(e,r,t){var n=e[r];(!(bu.call(e,r)&&Mn(n,t))||t===void 0&&!(r in e))&&mu(e,r,t)}var Or=Math.max;function $u(e,r,t){return r=Or(r===void 0?e.length-1:r,0),function(){for(var n=arguments,s=-1,i=Or(n.length-r,0),o=Array(i);++s<i;)o[s]=n[r+s];s=-1;for(var a=Array(r+1);++s<r;)a[s]=n[s];return a[r]=t(o),Jc(e,this,a)}}function wu(e,r){return ou($u(e,r,Dn),e+"")}var _u=9007199254740991;function Nn(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=_u}function Rn(e){return e!=null&&Nn(e.length)&&!Pn(e)}var Tu=Object.prototype;function Fn(e){var r=e&&e.constructor,t=typeof r=="function"&&r.prototype||Tu;return e===t}function Eu(e,r){for(var t=-1,n=Array(e);++t<e;)n[t]=r(t);return n}var Ou="[object Arguments]";function jr(e){return be(e)&&Fe(e)==Ou}var Un=Object.prototype,ju=Un.hasOwnProperty,Au=Un.propertyIsEnumerable,Bn=jr(function(){return arguments}())?jr:function(e){return be(e)&&ju.call(e,"callee")&&!Au.call(e,"callee")};function Su(){return!1}var Wn=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Ar=Wn&&typeof module=="object"&&module&&!module.nodeType&&module,Iu=Ar&&Ar.exports===Wn,Sr=Iu?F.Buffer:void 0,Cu=Sr?Sr.isBuffer:void 0,Hn=Cu||Su,xu="[object Arguments]",Lu="[object Array]",Du="[object Boolean]",Pu="[object Date]",Mu="[object Error]",Nu="[object Function]",Ru="[object Map]",Fu="[object Number]",Uu="[object Object]",Bu="[object RegExp]",Wu="[object Set]",Hu="[object String]",ku="[object WeakMap]",zu="[object ArrayBuffer]",Gu="[object DataView]",qu="[object Float32Array]",Ku="[object Float64Array]",Qu="[object Int8Array]",Vu="[object Int16Array]",Yu="[object Int32Array]",Xu="[object Uint8Array]",Ju="[object Uint8ClampedArray]",Zu="[object Uint16Array]",ef="[object Uint32Array]",A={};A[qu]=A[Ku]=A[Qu]=A[Vu]=A[Yu]=A[Xu]=A[Ju]=A[Zu]=A[ef]=!0;A[xu]=A[Lu]=A[zu]=A[Du]=A[Gu]=A[Pu]=A[Mu]=A[Nu]=A[Ru]=A[Fu]=A[Uu]=A[Bu]=A[Wu]=A[Hu]=A[ku]=!1;function tf(e){return be(e)&&Nn(e.length)&&!!A[Fe(e)]}function Ut(e){return function(r){return e(r)}}var kn=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Ee=kn&&typeof module=="object"&&module&&!module.nodeType&&module,rf=Ee&&Ee.exports===kn,pt=rf&&xn.process,de=function(){try{var e=Ee&&Ee.require&&Ee.require("util").types;return e||pt&&pt.binding&&pt.binding("util")}catch(r){}}(),Ir=de&&de.isTypedArray,nf=Ir?Ut(Ir):tf,sf=Object.prototype,of=sf.hasOwnProperty;function af(e,r){var t=st(e),n=!t&&Bn(e),s=!t&&!n&&Hn(e),i=!t&&!n&&!s&&nf(e),o=t||n||s||i,a=o?Eu(e.length,String):[],c=a.length;for(var u in e)of.call(e,u)&&!(o&&(u=="length"||s&&(u=="offset"||u=="parent")||i&&(u=="buffer"||u=="byteLength"||u=="byteOffset")||gu(u,c)))&&a.push(u);return a}function zn(e,r){return function(t){return e(r(t))}}var cf=zn(Object.keys,Object),uf=Object.prototype,ff=uf.hasOwnProperty;function lf(e){if(!Fn(e))return cf(e);var r=[];for(var t in Object(e))ff.call(e,t)&&t!="constructor"&&r.push(t);return r}function hf(e){return Rn(e)?af(e):lf(e)}var Se=ie(Object,"create");function df(){this.__data__=Se?Se(null):{},this.size=0}function pf(e){var r=this.has(e)&&delete this.__data__[e];return this.size-=r?1:0,r}var gf="__lodash_hash_undefined__",mf=Object.prototype,yf=mf.hasOwnProperty;function bf(e){var r=this.__data__;if(Se){var t=r[e];return t===gf?void 0:t}return yf.call(r,e)?r[e]:void 0}var vf=Object.prototype,$f=vf.hasOwnProperty;function wf(e){var r=this.__data__;return Se?r[e]!==void 0:$f.call(r,e)}var _f="__lodash_hash_undefined__";function Tf(e,r){var t=this.__data__;return this.size+=this.has(e)?0:1,t[e]=Se&&r===void 0?_f:r,this}function ee(e){var r=-1,t=e==null?0:e.length;for(this.clear();++r<t;){var n=e[r];this.set(n[0],n[1])}}ee.prototype.clear=df;ee.prototype.delete=pf;ee.prototype.get=bf;ee.prototype.has=wf;ee.prototype.set=Tf;function Ef(){this.__data__=[],this.size=0}function ot(e,r){for(var t=e.length;t--;)if(Mn(e[t][0],r))return t;return-1}var Of=Array.prototype,jf=Of.splice;function Af(e){var r=this.__data__,t=ot(r,e);if(t<0)return!1;var n=r.length-1;return t==n?r.pop():jf.call(r,t,1),--this.size,!0}function Sf(e){var r=this.__data__,t=ot(r,e);return t<0?void 0:r[t][1]}function If(e){return ot(this.__data__,e)>-1}function Cf(e,r){var t=this.__data__,n=ot(t,e);return n<0?(++this.size,t.push([e,r])):t[n][1]=r,this}function z(e){var r=-1,t=e==null?0:e.length;for(this.clear();++r<t;){var n=e[r];this.set(n[0],n[1])}}z.prototype.clear=Ef;z.prototype.delete=Af;z.prototype.get=Sf;z.prototype.has=If;z.prototype.set=Cf;var Ie=ie(F,"Map");function xf(){this.size=0,this.__data__={hash:new ee,map:new(Ie||z),string:new ee}}function Lf(e){var r=typeof e;return r=="string"||r=="number"||r=="symbol"||r=="boolean"?e!=="__proto__":e===null}function at(e,r){var t=e.__data__;return Lf(r)?t[typeof r=="string"?"string":"hash"]:t.map}function Df(e){var r=at(this,e).delete(e);return this.size-=r?1:0,r}function Pf(e){return at(this,e).get(e)}function Mf(e){return at(this,e).has(e)}function Nf(e,r){var t=at(this,e),n=t.size;return t.set(e,r),this.size+=t.size==n?0:1,this}function oe(e){var r=-1,t=e==null?0:e.length;for(this.clear();++r<t;){var n=e[r];this.set(n[0],n[1])}}oe.prototype.clear=xf;oe.prototype.delete=Df;oe.prototype.get=Pf;oe.prototype.has=Mf;oe.prototype.set=Nf;function Gn(e,r){for(var t=-1,n=r.length,s=e.length;++t<n;)e[s+t]=r[t];return e}var Cr=K?K.isConcatSpreadable:void 0;function Rf(e){return st(e)||Bn(e)||!!(Cr&&e&&e[Cr])}function Ff(e,r,t,n,s){var i=-1,o=e.length;for(t||(t=Rf),s||(s=[]);++i<o;){var a=e[i];t(a)&&Gn(s,a)}return s}var Uf=zn(Object.getPrototypeOf,Object);function Bf(){this.__data__=new z,this.size=0}function Wf(e){var r=this.__data__,t=r.delete(e);return this.size=r.size,t}function Hf(e){return this.__data__.get(e)}function kf(e){return this.__data__.has(e)}var zf=200;function Gf(e,r){var t=this.__data__;if(t instanceof z){var n=t.__data__;if(!Ie||n.length<zf-1)return n.push([e,r]),this.size=++t.size,this;t=this.__data__=new oe(n)}return t.set(e,r),this.size=t.size,this}function ve(e){var r=this.__data__=new z(e);this.size=r.size}ve.prototype.clear=Bf;ve.prototype.delete=Wf;ve.prototype.get=Hf;ve.prototype.has=kf;ve.prototype.set=Gf;var qn=typeof exports=="object"&&exports&&!exports.nodeType&&exports,xr=qn&&typeof module=="object"&&module&&!module.nodeType&&module,qf=xr&&xr.exports===qn,Lr=qf?F.Buffer:void 0;Lr&&Lr.allocUnsafe;function Kf(e,r){return e.slice()}function Qf(e,r){for(var t=-1,n=e==null?0:e.length,s=0,i=[];++t<n;){var o=e[t];r(o,t,e)&&(i[s++]=o)}return i}function Vf(){return[]}var Yf=Object.prototype,Xf=Yf.propertyIsEnumerable,Dr=Object.getOwnPropertySymbols,Jf=Dr?function(e){return e==null?[]:(e=Object(e),Qf(Dr(e),function(r){return Xf.call(e,r)}))}:Vf;function Zf(e,r,t){var n=r(e);return st(e)?n:Gn(n,t(e))}function el(e){return Zf(e,hf,Jf)}var _t=ie(F,"DataView"),Tt=ie(F,"Promise"),fe=ie(F,"Set"),Pr="[object Map]",tl="[object Object]",Mr="[object Promise]",Nr="[object Set]",Rr="[object WeakMap]",Fr="[object DataView]",rl=se(_t),nl=se(Ie),sl=se(Tt),il=se(fe),ol=se(wt),W=Fe;(_t&&W(new _t(new ArrayBuffer(1)))!=Fr||Ie&&W(new Ie)!=Pr||Tt&&W(Tt.resolve())!=Mr||fe&&W(new fe)!=Nr||wt&&W(new wt)!=Rr)&&(W=function(e){var r=Fe(e),t=r==tl?e.constructor:void 0,n=t?se(t):"";if(n)switch(n){case rl:return Fr;case nl:return Pr;case sl:return Mr;case il:return Nr;case ol:return Rr}return r});var al=Object.prototype,cl=al.hasOwnProperty;function ul(e){var r=e.length,t=new e.constructor(r);return r&&typeof e[0]=="string"&&cl.call(e,"index")&&(t.index=e.index,t.input=e.input),t}var Ur=F.Uint8Array;function Bt(e){var r=new e.constructor(e.byteLength);return new Ur(r).set(new Ur(e)),r}function fl(e,r){var t=Bt(e.buffer);return new e.constructor(t,e.byteOffset,e.byteLength)}var ll=/\w*$/;function hl(e){var r=new e.constructor(e.source,ll.exec(e));return r.lastIndex=e.lastIndex,r}var Br=K?K.prototype:void 0,Wr=Br?Br.valueOf:void 0;function dl(e){return Wr?Object(Wr.call(e)):{}}function pl(e,r){var t=Bt(e.buffer);return new e.constructor(t,e.byteOffset,e.length)}var gl="[object Boolean]",ml="[object Date]",yl="[object Map]",bl="[object Number]",vl="[object RegExp]",$l="[object Set]",wl="[object String]",_l="[object Symbol]",Tl="[object ArrayBuffer]",El="[object DataView]",Ol="[object Float32Array]",jl="[object Float64Array]",Al="[object Int8Array]",Sl="[object Int16Array]",Il="[object Int32Array]",Cl="[object Uint8Array]",xl="[object Uint8ClampedArray]",Ll="[object Uint16Array]",Dl="[object Uint32Array]";function Pl(e,r,t){var n=e.constructor;switch(r){case Tl:return Bt(e);case gl:case ml:return new n(+e);case El:return fl(e);case Ol:case jl:case Al:case Sl:case Il:case Cl:case xl:case Ll:case Dl:return pl(e);case yl:return new n;case bl:case wl:return new n(e);case vl:return hl(e);case $l:return new n;case _l:return dl(e)}}function Ml(e){return typeof e.constructor=="function"&&!Fn(e)?Xc(Uf(e)):{}}var Nl="[object Map]";function Rl(e){return be(e)&&W(e)==Nl}var Hr=de&&de.isMap,Fl=Hr?Ut(Hr):Rl,Ul="[object Set]";function Bl(e){return be(e)&&W(e)==Ul}var kr=de&&de.isSet,Wl=kr?Ut(kr):Bl,Kn="[object Arguments]",Hl="[object Array]",kl="[object Boolean]",zl="[object Date]",Gl="[object Error]",Qn="[object Function]",ql="[object GeneratorFunction]",Kl="[object Map]",Ql="[object Number]",Vn="[object Object]",Vl="[object RegExp]",Yl="[object Set]",Xl="[object String]",Jl="[object Symbol]",Zl="[object WeakMap]",eh="[object ArrayBuffer]",th="[object DataView]",rh="[object Float32Array]",nh="[object Float64Array]",sh="[object Int8Array]",ih="[object Int16Array]",oh="[object Int32Array]",ah="[object Uint8Array]",ch="[object Uint8ClampedArray]",uh="[object Uint16Array]",fh="[object Uint32Array]",O={};O[Kn]=O[Hl]=O[eh]=O[th]=O[kl]=O[zl]=O[rh]=O[nh]=O[sh]=O[ih]=O[oh]=O[Kl]=O[Ql]=O[Vn]=O[Vl]=O[Yl]=O[Xl]=O[Jl]=O[ah]=O[ch]=O[uh]=O[fh]=!0;O[Gl]=O[Qn]=O[Zl]=!1;function Ge(e,r,t,n,s,i){var o;if(o!==void 0)return o;if(!it(e))return e;var a=st(e);if(a)o=ul(e);else{var c=W(e),u=c==Qn||c==ql;if(Hn(e))return Kf(e);if(c==Vn||c==Kn||u&&!s)o=u?{}:Ml(e);else{if(!O[c])return s?e:{};o=Pl(e,c)}}i||(i=new ve);var f=i.get(e);if(f)return f;i.set(e,o),Wl(e)?e.forEach(function(y){o.add(Ge(y,r,t,y,e,i))}):Fl(e)&&e.forEach(function(y,b){o.set(b,Ge(y,r,t,b,e,i))});var l=el,h=a?void 0:l(e);return au(h||e,function(y,b){h&&(b=y,y=e[b]),vu(o,b,Ge(y,r,t,b,e,i))}),o}var lh=1,hh=4;function ct(e){return Ge(e,lh|hh)}var dh="__lodash_hash_undefined__";function ph(e){return this.__data__.set(e,dh),this}function gh(e){return this.__data__.has(e)}function Ye(e){var r=-1,t=e==null?0:e.length;for(this.__data__=new oe;++r<t;)this.add(e[r])}Ye.prototype.add=Ye.prototype.push=ph;Ye.prototype.has=gh;function mh(e,r){return e.has(r)}function Yn(e){var r=-1,t=Array(e.size);return e.forEach(function(n){t[++r]=n}),t}function yh(e){return be(e)&&Rn(e)}var bh=1/0,vh=fe&&1/Yn(new fe([,-0]))[1]==bh?function(e){return new fe(e)}:Zc,$h=200;function wh(e,r,t){var n=-1,s=hu,i=e.length,o=!0,a=[],c=a;if(i>=$h){var u=vh(e);if(u)return Yn(u);o=!1,s=mh,c=new Ye}else c=a;e:for(;++n<i;){var f=e[n],l=f;if(f=f!==0?f:0,o&&l===l){for(var h=c.length;h--;)if(c[h]===l)continue e;a.push(f)}else s(c,l,t)||(c!==a&&c.push(l),a.push(f))}return a}var _h=wu(function(e){return wh(Ff(e,1,yh))});class Xn{}class Jn extends Xn{constructor(t){super();g(this,"data",{});g(this,"event",new Re.EventEmitter);this.data=t}update(t,n){n?Ot(n,t,this.data):this.data=t;const s={updateData:t,path:n!=null?n:""};n&&this.event.emit(n,s),this.event.emit("",s)}on(t,n){this.event.on(t,n)}off(t,n){this.event.off(t,n)}getData(t){return t?te(t,this.data):this.data}destroy(){}}var Je,Le,De,M,X,Pe;class Zn extends sn{constructor(t){var i,o,a,c,u;super();g(this,"isInit",!1);g(this,"app");g(this,"mockData");D(this,Je,"base");D(this,Le);D(this,De);D(this,M);D(this,X,[]);D(this,Pe,[]);P(this,Le,t.schema.id),P(this,De,t.schema),this.app=t.app,this.setFields(t.schema.fields),this.setMethods(t.schema.methods||[]);let n=t.initialData;const s=t.ObservedDataClass||Jn;if(this.app.platform==="editor")this.mockData=((o=(i=t.schema.mocks)==null?void 0:i.find(f=>f.useInEditor))==null?void 0:o.data)||this.getDefaultData(),n=ct(this.mockData);else if(typeof t.useMock=="boolean"&&t.useMock)this.mockData=(c=(a=t.schema.mocks)==null?void 0:a.find(f=>f.enable))==null?void 0:c.data,n=this.mockData||this.getDefaultData();else if(!t.initialData)n=this.getDefaultData();else{P(this,M,new s((u=t.initialData)!=null?u:{})),this.isInit=!0;return}P(this,M,new s(n!=null?n:{}))}get id(){return x(this,Le)}get type(){return x(this,Je)}get schema(){return x(this,De)}get fields(){return x(this,X)}get methods(){return x(this,Pe)}setFields(t){P(this,X,t)}setMethods(t){P(this,Pe,t)}get data(){return x(this,M).getData("")}setData(t,n){x(this,M).update(t,n);const s={updateData:t,path:n};this.emit("change",s)}setValue(t,n){return this.setData(n,t)}onDataChange(t,n){x(this,M).on(t,n)}offDataChange(t,n){x(this,M).off(t,n)}getDefaultData(){return as(x(this,X))}async init(){this.isInit=!0}destroy(){P(this,X,[]),this.removeAllListeners(),x(this,M).destroy()}}Je=new WeakMap,Le=new WeakMap,De=new WeakMap,M=new WeakMap,X=new WeakMap,Pe=new WeakMap;const zr=e=>Object.entries(e).reduce((r,[t,n])=>{let s=n;return typeof n=="object"&&(s=JSON.stringify(n)),typeof n<"u"?"".concat(r).concat(r?"&":"").concat(globalThis.encodeURIComponent(t),"=").concat(globalThis.encodeURIComponent("".concat(s))):r},""),Th=async e=>{var f;const{url:r,method:t="GET",headers:n={},params:s={},data:i={},...o}=e,a=zr(s);let c=JSON.stringify(i);return(f=n["Content-Type"])!=null&&f.includes("application/x-www-form-urlencoded")&&(c=zr(i)),(await globalThis.fetch(a?"".concat(r,"?").concat(a):r,{method:t,headers:n,body:t==="GET"?void 0:c,...o})).json()};var le,Me,Ne,Ze;class Eh extends Zn{constructor(t){const{options:n}=t.schema;super(t);g(this,"isLoading",!1);g(this,"error");g(this,"httpOptions");D(this,le);D(this,Me,[]);D(this,Ne,[]);D(this,Ze,"http");this.httpOptions=n,typeof t.request=="function"?P(this,le,t.request):typeof globalThis.fetch=="function"&&P(this,le,Th),this.methods.forEach(s=>{typeof s.content=="function"&&(s.timing==="beforeRequest"&&x(this,Me).push(s.content),s.timing==="afterRequest"&&x(this,Ne).push(s.content))})}get type(){return x(this,Ze)}async init(){this.schema.autoFetch&&await this.request(),super.init()}async request(t={}){var u,f;this.isLoading=!0;const{url:n,params:s,data:i,headers:o,...a}=this.httpOptions;let c={url:typeof n=="function"?n({app:this.app,dataSource:this}):n,params:typeof s=="function"?s({app:this.app,dataSource:this}):s,data:typeof i=="function"?i({app:this.app,dataSource:this}):i,headers:typeof o=="function"?o({app:this.app,dataSource:this}):o,...a,...t};try{for(const l of x(this,Me))await l({options:c,params:{},dataSource:this,app:this.app});if(typeof this.schema.beforeRequest=="function"&&(c=await this.schema.beforeRequest(c,{app:this.app,dataSource:this})),this.mockData)this.setData(this.mockData);else{let l=await((u=x(this,le))==null?void 0:u.call(this,c));for(const h of x(this,Ne))await h({res:l,options:c,params:{},dataSource:this,app:this.app});if(typeof this.schema.afterResponse=="function"&&(l=await this.schema.afterResponse(l,{app:this.app,dataSource:this,options:c})),(f=this.schema.responseOptions)!=null&&f.dataPath){const h=te(this.schema.responseOptions.dataPath,l);this.setData(h)}else this.setData(l)}this.error=void 0}catch(l){this.error={msg:l.message},this.emit("error",l)}this.isLoading=!1}get(t){return this.request({...t,method:"GET"})}post(t){return this.request({...t,method:"POST"})}}le=new WeakMap,Me=new WeakMap,Ne=new WeakMap,Ze=new WeakMap;const gt=new Map,Oh=(e,r,t)=>{let n;if(t){const c=[];r.forEach(u=>{us(u,f=>{c.push(f.id)})}),n="".concat(e.id,":").concat(c.join(":"))}else n="".concat(e.id,":").concat(r.map(c=>c.id).join(":"));if(gt.has(n))return gt.get(n);const s=new Hh;s.addTarget(new Zr({id:e.id,type:"data-source",isTarget:(c,u)=>"".concat(c).includes(is)?!1:Bh(e,c,u,!0)})),s.addTarget(new Zr({id:e.id,type:"cond",isTarget:(c,u)=>Wh(e,c,u,!0)})),s.collect(r,{},!0);const{deps:i}=s.getTarget(e.id,"data-source"),{deps:o}=s.getTarget(e.id,"cond"),a={deps:i,condDeps:o};return gt.set(n,a),a},jh=(e,r)=>{let t=!0;for(const{op:n,value:s,range:i,field:o}of e){const[a,...c]=o,u=r[a];if(!u||!c.length)break;try{const f=te(c.join("."),u);if(!Nh(n,f,s,i)){t=!1;break}}catch(f){console.warn(f)}}return t},Et=(e,r)=>{if(!e[ue]||!Array.isArray(e[ue])||!e[ue].length)return!0;for(const{cond:t}of e[ue])if(t&&jh(t,r))return!0;return!1},Gr=(e,r)=>{var t;if(ns(e)||Dh(e)){const n=(t=r.items)==null?void 0:t.findIndex(s=>s.id===e.id);r.items.splice(n,1,e)}else ss(e,r.items)},qr=(e,r,t=[],n={})=>{const s={...n,[r]:{}};let i=ct(n[r]),o=s[r];return t.forEach((a,c)=>{if(Object.assign(o,i),c===t.length-1){o[a]=e;return}Array.isArray(i[a])&&(i[a]={},o[a]={}),i=i[a],o=o[a]}),s},Ah=(e,r)=>{const[t,...n]=e,s=t.indexOf(Xe);if(s>-1){const i=t.substring(s+Xe.length),o=r[i];if(!o)return e;try{return te(n.join("."),o)}catch(a){return e}}return e},Kr=(e,r)=>e.replaceAll(cs,(t,n)=>{try{return te(n,r)}catch(s){return t}}),Qr=(e,r)=>typeof e=="string"?Kr(e,r):e!=null&&e.isBindDataSource&&e.dataSourceId?r[e.dataSourceId]:e!=null&&e.isBindDataSourceField&&e.dataSourceId&&typeof e.template=="string"?Kr(e.template,r[e.dataSourceId]):Array.isArray(e)&&typeof e[0]=="string"?Ah(e,r):e,es=({compile:e,dsId:r,item:t,deps:n,condDeps:s,inEditor:i,ctxData:o})=>{var f,l;const{items:a,...c}=t,u=ct(c);return(f=s[c.id])!=null&&f.keys.length&&!i&&(u.condResult=Et(c,o)),Array.isArray(a)&&a.length?u.items=a.map(h=>es({compile:e,dsId:r,item:h,deps:n,condDeps:s,inEditor:i,ctxData:o})):a&&(u.items=a),(l=n[u.id])!=null&&l.keys.length?os(e,u,{[r]:n},r):u},B=class B extends sn{constructor({app:t,useMock:n,initialData:s}){var o,a;super();g(this,"app");g(this,"dataSourceMap",new Map);g(this,"data",{});g(this,"useMock",!1);this.app=t,this.useMock=n,s&&(this.data=s),(a=(o=t.dsl)==null?void 0:o.dataSources)==null||a.forEach(c=>{this.addDataSource(c)});const i=Array.from(this.dataSourceMap);typeof Promise.allSettled=="function"?Promise.allSettled(i.map(([,c])=>this.init(c))).then(c=>{const u={},f={};c.forEach((l,h)=>{const y=i[h][0];l.status==="fulfilled"?this.data[y]?u[y]=this.data[y]:delete u[y]:l.status==="rejected"&&(delete u[y],f[y]=l.reason)}),this.emit("init",u,f)}):Promise.all(i.map(([,c])=>this.init(c))).then(()=>{this.emit("init",this.data)}).catch(()=>{this.emit("init",this.data)})}static register(t,n){B.dataSourceClassMap.set(t,n)}static getDataSourceClass(t){return B.dataSourceClassMap.get(t)}static registerObservedData(t){B.ObservedDataClass=t}async init(t){var n;if(!t.isInit&&!(this.app.jsEngine&&((n=t.schema.disabledInitInJsEngine)!=null&&n.includes(this.app.jsEngine)))){for(const s of t.methods){if(typeof s.content!="function")return;s.timing==="beforeInit"&&await s.content({params:{},dataSource:t,app:this.app})}await t.init();for(const s of t.methods){if(typeof s.content!="function")return;s.timing==="afterInit"&&await s.content({params:{},dataSource:t,app:this.app})}}}get(t){return this.dataSourceMap.get(t)}async addDataSource(t){if(!t)return;const n=B.dataSourceClassMap.get(t.type)||Zn,s=new n({app:this.app,schema:t,request:this.app.request,useMock:this.useMock,initialData:this.data[t.id],ObservedDataClass:B.ObservedDataClass});this.dataSourceMap.set(t.id,s),this.data[s.id]=s.data,s.on("change",i=>{this.setData(s,i)})}setData(t,n){this.data[t.id]=t.data,this.emit("change",t.id,n)}removeDataSource(t){var n;(n=this.get(t))==null||n.destroy(),delete this.data[t],this.dataSourceMap.delete(t)}updateSchema(t){t.forEach(n=>{if(!this.get(n.id))return;this.removeDataSource(n.id),this.addDataSource(n);const i=this.get(n.id);i&&this.init(i)})}compiledNode({items:t,...n},s,i=!1){var a;const o=ct(n);return t&&(o.items=Array.isArray(t)&&i?t.map(c=>this.compiledNode(c,s,i)):t),n.condResult===!1||n.visible===!1?o:os(c=>Qr(c,this.data),o,((a=this.app.dsl)==null?void 0:a.dataSourceDeps)||{},s)}compliedConds(t){return Et(t,this.data)}compliedIteratorItemConds(t,n,s=[]){const[i,...o]=s,a=this.get(i);if(!a)return!0;const c=qr(t,a.id,o,this.data);return Et(n,c)}compliedIteratorItems(t,n,s=[]){const[i,...o]=s,a=this.get(i);if(!a)return n;const c=this.app.platform==="editor",u=qr(t,a.id,o,this.data),{deps:f={},condDeps:l={}}=Oh(a.schema,n,c);return!Object.keys(f).length&&!Object.keys(l).length?n:n.map(h=>es({compile:y=>Qr(y,u),dsId:a.id,item:h,deps:f,condDeps:l,inEditor:c,ctxData:u}))}destroy(){this.removeAllListeners(),this.data={},this.dataSourceMap.forEach(t=>{t.destroy()}),this.dataSourceMap.clear()}onDataChange(t,n,s){var i;return(i=this.get(t))==null?void 0:i.onDataChange(n,s)}offDataChange(t,n,s){var i;return(i=this.get(t))==null?void 0:i.offDataChange(n,s)}};g(B,"dataSourceClassMap",new Map),g(B,"ObservedDataClass",Jn);let pe=B;pe.register("http",Eh);const Sh=(e,r,t)=>{const{dsl:n,platform:s}=e;if(!(n!=null&&n.dataSources))return;const i=new pe({app:e,useMock:r,initialData:t});return n.dataSources&&n.dataSourceCondDeps&&s!=="editor"&&mt(Yr(n.dataSourceCondDeps),n.items).forEach(o=>{o.condResult=i.compliedConds(o),Gr(o,n)}),n.dataSources&&n.dataSourceDeps&&mt(Yr(n.dataSourceDeps),n.items).forEach(o=>{Gr(i.compiledNode(o),n)}),e.jsEngine!=="nodejs"&&i.on("change",(o,a)=>{var h,y,b;const c=((h=n.dataSourceDeps)==null?void 0:h[o])||{},u=((y=n.dataSourceCondDeps)==null?void 0:y[o])||{},f=_h([...Object.keys(u),...Object.keys(c)]),l=(b=e.page)!=null&&b.data&&e.platform!=="editor"?[e.page.data]:n.items;i.emit("update-data",mt(f,l).map(S=>{var C;e.platform!=="editor"&&(S.condResult=i.compliedConds(S));const _=i.compiledNode(S);if(typeof((C=e.page)==null?void 0:C.setData)=="function")if(ns(_))e.page.setData(_);else{const I=e.page.getNode(S.id);I==null||I.setData(_)}return _}),o,a)}),i},Ih=e=>{let r=0;return(...t)=>{if(r===0){r+=1;return}return e(...t)}};class Ch extends Xn{constructor(t){super();g(this,"state");g(this,"subscribers",new Map);g(this,"update",(t,n)=>{var s;(s=this.state)==null||s.update(n!=null?n:"",t)});g(this,"on",(t,n)=>{var o;const s=this.state.subscribe(t,Ih(n)),i=(o=this.subscribers.get(t))!=null?o:new Map;i.set(n,s),this.subscribers.set(t,i)});g(this,"off",(t,n)=>{var i;const s=this.subscribers.get(t);s&&((i=s.get(n))==null||i(),s.delete(n))});g(this,"getData",t=>{var n;return this.state?(n=this.state)==null?void 0:n.get(t):{}});g(this,"destroy",()=>{this.subscribers.forEach(t=>{t.forEach(n=>n())})});this.state=new Oc(t)}}var Wt=(e=>(e.CONTAINER="container",e.PAGE="page",e.ROOT="app",e.PAGE_FRAGMENT="page-fragment",e))(Wt||{});const ue="displayConds";var qe=(e=>(e.COMP="comp",e.CODE="code",e.DATA_SOURCE="data-source",e))(qe||{}),ts=(e=>(e.CODE="code",e))(ts||{}),Ke=(e=>(e.CODE="code",e.DATA_SOURCE_METHOD="data-source-method",e))(Ke||{});const rs={getIdFromEl:e=>{var r;return(r=e==null?void 0:e.dataset)==null?void 0:r.tmagicId},getElById:(e,r)=>e==null?void 0:e.querySelector('[data-tmagic-id="'.concat(r,'"]')),setIdToEl:(e,r)=>{e.dataset.tmagicId="".concat(r)}},xh=()=>rs.getIdFromEl,Vr=()=>rs.getElById,Lh=(e="")=>e.replace(/\B([A-Z])/g,"-$1").toLowerCase(),Oe=(e,r=[])=>{const t=[],n=function(s,i){if(!Array.isArray(i))return null;for(let o=0,a=i.length;o<a;o++){const c=i[o];if(t.push(c),"".concat(c.id)==="".concat(s))return c;if(c.items){const u=n(s,c.items);if(u)return u}t.pop()}return null};return n(e,r),t},Ce=e=>Object.prototype.toString.call(e)==="[object Object]",ns=e=>{var r;return e?((r=e.type)==null?void 0:r.toLowerCase())===Wt.PAGE:!1},Dh=e=>{var r;return e?((r=e.type)==null?void 0:r.toLowerCase())===Wt.PAGE_FRAGMENT:!1},Ph=e=>/^(-?\d+)(\.\d+)?$/.test(e),Ht=e=>"".concat(e).replaceAll(/\[(\d+)\]/g,".$1").split("."),te=(e="",r={})=>(Array.isArray(e)?e:Ht(e)).reduce((n,s)=>{if(Ce(n)||Array.isArray(n)&&/^\d*$/.test("".concat(s)))return n[s];throw new Error("".concat(r,"中不存在").concat(e))},r),Ot=(e,r,t={})=>yc(t,e,r),mt=(e,r=[])=>{const t=[],n=function(s,i){if(Array.isArray(i))for(let o=0,a=i.length;o<a;o++){const c=i[o],u=s.findIndex(f=>"".concat(f)==="".concat(c.id));u>-1&&(s.slice(u,1),t.push(c)),c.items&&n(s,c.items)}};return n(e,r),t},Mh=(e={},r)=>Array.from(Object.values(e).reduce((t,n)=>{var s;return(((s=n[r])==null?void 0:s.keys)||[]).forEach(i=>t.add(i)),t},new Set)),Yr=(e={})=>Array.from(Object.values(e).reduce((r,t)=>(Object.keys(t).forEach(n=>{r.add(n)}),r),new Set)),ss=(e,r,t)=>{var a;const n=Oe(e.id,r),s=n.pop();let i=n.pop();if(t&&(i=Oe(t,r).pop()),!s)throw new Error("未找到目标节点");if(!i)throw new Error("未找到父节点");const o=(a=i.items)==null?void 0:a.findIndex(c=>c.id===s.id);i.items.splice(o,1,e)},is="__tmagic__",Xr="__tmagic__dslNode",os=(e,r,t={},n)=>{let s=[];if(!n)s=Mh(t,r.id);else{const i=t[n];s=(i==null?void 0:i[r.id].keys)||[]}return s.forEach(i=>{const o=Ht(i),a=o.map((f,l)=>l<o.length-1?f:"".concat(is).concat(f));let c=te(a,r);if(typeof c>"u")try{const f=te(i,r);Ot(a.join("."),f,r),c=f}catch(f){console.warn(f);return}let u;try{u=e(c)}catch(f){console.error(f),u=""}Ot(i,u,r)}),r},Nh=(e,r,t,n=[])=>{var s,i;switch(typeof r=="string"&&typeof t>"u"&&(t=""),e){case"is":return r===t;case"not":return r!==t;case"=":return r===t;case"!=":return r!==t;case">":return r>t;case">=":return r>=t;case"<":return r<t;case"<=":return r<=t;case"between":return n.length>1&&r>=n[0]&&r<=n[1];case"not_between":return n.length<2||r<n[0]||r>n[1];case"include":return(s=r==null?void 0:r.includes)==null?void 0:s.call(r,t);case"not_include":return typeof r>"u"||!((i=r.includes)!=null&&i.call(r,t))}return!1},as=e=>{const r={},t={string:void 0,object:{},array:[],boolean:void 0,number:void 0,null:null,any:void 0};return e.forEach(n=>{if(typeof n.defaultValue<"u"){if(n.type==="array"&&!Array.isArray(n.defaultValue)){r[n.name]=t.array;return}if(n.type==="object"&&!Ce(n.defaultValue)){if(typeof n.defaultValue=="string"){try{r[n.name]=JSON.parse(n.defaultValue)}catch(s){r[n.name]=t.object}return}r[n.name]=t.object;return}r[n.name]=ic(n.defaultValue);return}if(n.type==="object"){r[n.name]=n.fields?as(n.fields):t.object;return}if(n.type){r[n.name]=t[n.type];return}r[n.name]=void 0}),r},Xe="ds-field::",Jr="ds-field-changed",cs=/\$\{([\s\S]+?)\}/g,ad=e=>typeof e[Xr]>"u"||e[Xr]===!0,us=(e,r,t=[])=>{r(e,t),Array.isArray(e.items)&&e.items.length&&(t.push(e),e.items.forEach(n=>{us(n,r,[...t])}))};var G=(e=>(e.DEFAULT="default",e.CODE_BLOCK="code-block",e.DATA_SOURCE="data-source",e.DATA_SOURCE_METHOD="data-source-method",e.DATA_SOURCE_COND="data-source-cond",e))(G||{});class Zr{constructor(r){g(this,"isTarget");g(this,"id");g(this,"name");g(this,"type",G.DEFAULT);g(this,"deps",{});g(this,"isCollectByDefault");var t;this.isTarget=r.isTarget,this.id=r.id,this.name=r.name,this.isCollectByDefault=(t=r.isCollectByDefault)!=null?t:!0,r.type&&(this.type=r.type),r.initialDeps&&(this.deps=r.initialDeps)}updateDep({id:r,name:t,key:n,data:s}){const i=this.deps[r]||{name:t,keys:[]};i.name=t,i.data=s,this.deps[r]=i,i.keys.indexOf(n)===-1&&i.keys.push(n)}removeDep(r,t){if(typeof r>"u"){Object.keys(this.deps).forEach(s=>{delete this.deps[s]});return}const n=this.deps[r];if(n)if(t){const s=n.keys.indexOf(t);n.keys.splice(s,1),n.keys.length===0&&delete this.deps[r]}else delete this.deps[r]}hasDep(r,t){const n=this.deps[r];return!!(n!=null&&n.keys.find(s=>s===t))}destroy(){this.deps={}}}const kt=(e,r)=>{let t=r;return e.some((n,s)=>{const i=t.find(({name:o})=>o===n);return t=(i==null?void 0:i.fields)||[],i&&i.type==="array"&&/^(?!\d+$).*$/.test("".concat(e[s+1]))&&s<e.length-1})},Rh=(e,r,t=!1)=>{const n=e.match(cs)||[];if(n.length<=0)return!1;const s=[],i=[];return n.forEach(o=>{const a=o.substring(2,o.length-1),c=Ht(a),u=c.shift();!u||u!==r.id||(kt(c,r.fields)?s.push(o):i.push(o))}),t?s.length>0:i.length>0},Fh=(e,r)=>(e==null?void 0:e.isBindDataSourceField)&&e.dataSourceId&&e.dataSourceId===r&&typeof e.template=="string",Uh=(e,r)=>{if(!Array.isArray(e)||typeof e[0]!="string")return!1;const[t]=e,n=t.indexOf(Xe);return n===-1?!1:t.substring(n+Xe.length)===r},Bh=(e,r,t,n=!1)=>{if("".concat(r).startsWith(ue))return!1;if(typeof t=="string")return Rh(t,e,n);if(Ce(t)&&(t!=null&&t.isBindDataSource)&&t.dataSourceId&&t.dataSourceId===e.id||Fh(t,e.id))return!0;if(Uh(t,e.id)){const[,...s]=t,i=kt(s,e.fields);return n?i:!i}return!1},Wh=(e,r,t,n=!1)=>{var o;if(!Array.isArray(t)||!e)return!1;const[s,...i]=t;if(s!==e.id||!"".concat(r).startsWith(ue))return!1;if((o=e.fields)!=null&&o.find(a=>a.name===i[0])){const a=kt(i,e.fields);return n?a:!a}return!1},en=(e,r,t)=>{Object.values(e).forEach(n=>{Object.values(n).forEach(s=>{t&&s.type!==t||r(s)})})};class Hh{constructor(r){g(this,"targetsList",{});g(this,"childrenProp","items");g(this,"idProp","id");g(this,"nameProp","name");r!=null&&r.initialTargets&&(this.targetsList=r.initialTargets),r!=null&&r.childrenProp&&(this.childrenProp=r.childrenProp)}getTargetsList(){return this.targetsList}getTargets(r=G.DEFAULT){return this.targetsList[r]||{}}addTarget(r){const t=this.getTargets(r.type)||{};this.targetsList[r.type]=t,t[r.id]=r}getTarget(r,t=G.DEFAULT){return this.getTargets(t)[r]}hasTarget(r,t=G.DEFAULT){return!!this.getTarget(r,t)}hasSpecifiedTypeTarget(r=G.DEFAULT){return Object.keys(this.getTargets(r)).length>0}removeTarget(r,t=G.DEFAULT){const n=this.getTargets(t);n[r]&&(n[r].destroy(),delete n[r])}removeTargets(r=G.DEFAULT){const t=this.targetsList[r];if(t){for(const n of Object.values(t))n.destroy();delete this.targetsList[r]}}clearTargets(){Object.keys(this.targetsList).forEach(r=>{delete this.targetsList[r]})}collect(r,t={},n=!1,s){this.collectByCallback(r,s,({node:i,target:o})=>{this.removeTargetDep(o,i),this.collectItem(i,o,t,n)})}collectByCallback(r,t,n){en(this.targetsList,s=>{!t&&!s.isCollectByDefault||r.forEach(i=>{n({node:i,target:s})})},t)}clear(r,t){let{targetsList:n}=this;t&&(n={[t]:this.getTargets(t)});const s=[];en(n,i=>{r?r.forEach(o=>{i.removeDep(o[this.idProp]),Array.isArray(o[this.childrenProp])&&o[this.childrenProp].length&&!s.includes(o[this.idProp])&&(s.push(o[this.idProp]),this.clear(o[this.childrenProp]))}):i.removeDep()})}clearByType(r,t){this.clear(t,r)}collectItem(r,t,n={},s=!1){const i=(o,a="")=>{const c=(u,f)=>{const l=u===this.childrenProp,h=a?"".concat(a,".").concat(u):u;t.isTarget(h,f)?t.updateDep({id:r[this.idProp],name:"".concat(r[this.nameProp]||r[this.idProp]),data:n,key:h}):!l&&Array.isArray(f)?f.forEach((y,b)=>{Ce(y)&&i(y,"".concat(h,"[").concat(b,"]"))}):Ce(f)&&i(f,h),l&&s&&Array.isArray(f)&&f.forEach(y=>{this.collectItem(y,t,n,s)})};Object.entries(o).forEach(([u,f])=>{typeof f>"u"||f===""||c(u,f)})};i(r)}removeTargetDep(r,t,n){r.removeDep(t[this.idProp],n),typeof n>"u"&&Array.isArray(t[this.childrenProp])&&t[this.childrenProp].length&&t[this.childrenProp].forEach(s=>{this.removeTargetDep(r,s,n)})}}class tn{constructor(r=globalThis.navigator.userAgent,t={}){g(this,"isIos",!1);g(this,"isIphone",!1);g(this,"isIpad",!1);g(this,"isAndroid",!1);g(this,"isAndroidPad",!1);g(this,"isMac",!1);g(this,"isWin",!1);g(this,"isMqq",!1);g(this,"isWechat",!1);g(this,"isWeb",!1);g(this,"isOpenHarmony",!1);this.isIphone=r.indexOf("iPhone")>=0,this.isIpad=/(iPad).*OS\s([\d_]+)/.test(r),this.isIos=this.isIphone||this.isIpad,this.isAndroid=r.indexOf("Android")>=0,this.isAndroidPad=this.isAndroid&&r.indexOf("Mobile")<0,this.isMac=r.indexOf("Macintosh")>=0,this.isWin=r.indexOf("Windows")>=0,this.isMqq=/QQ\/([\d.]+)/.test(r),this.isWechat=r.indexOf("MicroMessenger")>=0&&r.indexOf("wxwork")<0,this.isOpenHarmony=r.includes("OpenHarmony"),this.isWeb=!this.isIos&&!this.isAndroid&&!this.isOpenHarmony&&!/(WebOS|BlackBerry)/.test(r),Object.entries(t).forEach(([n,s])=>{this[n]=s})}}class kh{constructor(){g(this,"isAbort");this.isAbort=!1}abort(){this.isAbort=!0}reset(){this.isAbort=!1}}const zh=e=>{if(typeof e!="string")return e;const r={};return e.split(";").forEach(t=>{if(!t)return;const n=t.split(":");let s=n.shift(),i=n.join(":");s&&(s=s.replace(/^\s*/,"").replace(/\s*$/,""),i=i.replace(/^\s*/,"").replace(/\s*$/,""),s=s.split("-").map((o,a)=>a>0?"".concat(o[0].toUpperCase()).concat(o.substr(1)):o).join(""),r[s]=i)}),r},Gh=e=>e&&!/^url/.test(e)&&!/^linear-gradient/.test(e)?"url(".concat(e,")"):e,qh=(e,r)=>{if(!e)return[];const t=Object.entries(e).map(([s,i])=>i.trim()?(s==="rotate"&&Ph(i)&&(i="".concat(i,"deg")),r!=="hippy"?"".concat(s,"(").concat(i,")"):{[s]:i}):"");if(r==="hippy")return t;const n=t.join(" ");return n.trim()?n:"none"},Kh=(e,r)=>{if(!e)return{};let t={};const n={};typeof e=="string"?t=zh(e):t={...e};const s=r==="hippy",i=["zIndex","opacity","fontWeight"];return Object.entries(t).forEach(([o,a])=>{o==="scale"&&!n.transform&&s?n.transform=[{scale:a}]:o==="backgroundImage"&&!s?a&&(n[o]=Gh(a)):o==="transform"&&typeof a!="string"?n[o]=qh(a,r):!i.includes(o)&&a&&/^[-]?[0-9]*[.]?[0-9]*$/.test(a)?n[o]=s?a:"".concat(a/100,"rem"):n[o]=a}),n},rn="magic:common:events:",fs="magic:common:actions:",He={SHOW:"show",HIDE:"hide",SCROLL_TO_VIEW:"scrollIntoView",SCROLL_TO_TOP:"scrollToTop"},Qh=e=>e.startsWith(fs),Vh=(e,r)=>{var n;const{instance:t}=r;if(t)switch(e.replace(fs,"")){case He.SHOW:t.show();break;case He.HIDE:t.hide();break;case He.SCROLL_TO_VIEW:(n=t.$el)==null||n.scrollIntoView({behavior:"smooth"});break;case He.SCROLL_TO_TOP:window.scrollTo({top:0,behavior:"smooth"});break}},Yh=e=>e.startsWith(rn)?e:"".concat(rn).concat(e),ls=(e,r)=>{var s,i;if(!e)return;const t=xh()(e);return t?r.getNode(t,(s=e.dataset.tmagicIteratorContainerId)==null?void 0:s.split(","),(i=e.dataset.tmagicIteratorIndex)==null?void 0:i.split(",").map(o=>globalThis.parseInt(o,10))):ls(e.parentElement,r)};class Xh extends Re.EventEmitter{constructor({app:t}){super();g(this,"app");g(this,"nodeEventList",new Map);g(this,"dataSourceEventList",new Map);g(this,"commonClickEventHandler",t=>{if(!t.target)return;const n=ls(t.target,this.app),s="".concat(Yh("click"),"_").concat(n==null?void 0:n.data.id);n!=null&&n.eventKeys.has(s)&&this.emit(n.eventKeys.get(s),n)});this.app=t,globalThis.document.body.addEventListener("click",this.commonClickEventHandler)}destroy(){this.removeNodeEvents(),this.removeAllListeners(),globalThis.document.body.removeEventListener("click",this.commonClickEventHandler)}bindNodeEvents(t){var n;(n=t.events)==null||n.forEach((s,i)=>{let o="".concat(s.name,"_").concat(t.data.id);const a=s.name.split(".");a.length>1&&(o="".concat(a[1],"_").concat(a[0]));let c=Symbol(o);t.eventKeys.has(o)?c=t.eventKeys.get(o):t.eventKeys.set(o,c);const u=(f,...l)=>{this.eventHandler(i,t,l)};this.nodeEventList.set(u,c),this.on(c,u)})}removeNodeEvents(){Array.from(this.nodeEventList.keys()).forEach(t=>{const n=this.nodeEventList.get(t);n&&this.off(n,t)}),this.nodeEventList.clear()}bindDataSourceEvents(t){this.removeDataSourceEvents(t),t.forEach(n=>{var i;const s=(i=this.dataSourceEventList.get(n.id))!=null?i:new Map;(n.schema.events||[]).forEach(o=>{var f;const[a,...c]=((f=o.name)==null?void 0:f.split("."))||[];if(!a)return;const u=(...l)=>{this.eventHandler(o,n,l)};s.set(o.name,u),a===Jr?n==null||n.onDataChange(c.join("."),u):n.on(a,u)}),this.dataSourceEventList.set(n.id,s)})}removeDataSourceEvents(t){this.dataSourceEventList.size&&(t.forEach(n=>{const s=this.dataSourceEventList.get(n.id);s&&Array.from(s.keys()).forEach(i=>{const[o,...a]=i.split(".");o===Jr?n.offDataChange(a.join("."),s.get(i)):n.off(o,s.get(i))})}),this.dataSourceEventList.clear())}async eventHandler(t,n,s){const i=typeof t=="number"?n.events[t]:t;if(fc(i,"actions")){const o=new kh,{actions:a}=i;for(let c=0;c<a.length&&!(o!=null&&o.isAbort);c++)if(typeof t=="number"){const u=n.events[t].actions[c];this.actionHandler(u,n,s,o)}else this.actionHandler(a[c],n,s,o);o.reset()}else await this.compActionHandler(i,n,s)}async actionHandler(t,n,s,i){if(t.actionType===qe.COMP){const o=t;await this.compActionHandler(o,n,s)}else if(t.actionType===qe.CODE){const o=t;await this.app.runCode(o.codeId,o.params||{},s,i)}else if(t.actionType===qe.DATA_SOURCE){const o=t,[a,c]=o.dataSourceMethod;await this.app.runDataSourceMethod(a,c,o.params||{},s,i)}}async compActionHandler(t,n,s){if(!this.app.page)throw new Error("当前没有页面");let{method:i,to:o}=t;Array.isArray(i)&&([o,i]=i);const a=this.app.getNode(o);if(!a)throw"ID为".concat(o,"的组件不存在");if(Qh(i))return Vh(i,a);a.instance?typeof a.instance[i]=="function"&&await a.instance[i](n,...s):a.addEventToQueue({method:i,fromCpt:n,args:s})}}class Jh{constructor(r){g(this,"designWidth",375);g(this,"tid");g(this,"resizeHandler",()=>{clearTimeout(this.tid),this.tid=setTimeout(()=>{this.refreshRem(),this.tid=void 0},300)});g(this,"pageshowHandler",r=>{r.persisted&&this.resizeHandler()});globalThis.document.readyState==="complete"?this.setBodyFontSize():globalThis.document.addEventListener("DOMContentLoaded",this.setBodyFontSize,!1),globalThis.addEventListener("resize",this.resizeHandler,!1),globalThis.addEventListener("pageshow",this.pageshowHandler,!1),typeof(r==null?void 0:r.designWidth)<"u"&&this.setDesignWidth(r.designWidth)}destroy(){globalThis.document.removeEventListener("DOMContentLoaded",this.setBodyFontSize,!1),globalThis.removeEventListener("resize",this.resizeHandler,!1),globalThis.removeEventListener("pageshow",this.pageshowHandler,!1)}setDesignWidth(r){this.designWidth=r,this.refreshRem()}setBodyFontSize(){globalThis.document.body.style.fontSize=".12rem"}refreshRem(){const{width:r}=document.documentElement.getBoundingClientRect(),t=r/(this.designWidth/100);globalThis.document.documentElement.style.fontSize="".concat(t,"px"),globalThis.document.documentElement.style.fontSize="".concat(this.correctRem(t),"px")}correctRem(r){const{document:t}=globalThis,n=t.createElement("div");n.style.cssText="width:1rem;height:0;overflow:hidden;position:absolute;z-index:-1;visibility:hidden;",t.documentElement.appendChild(n);const s=n.offsetWidth;return t.documentElement.removeChild(n),Math.abs(s-r)>1?r**2/s:r}}class Zh{constructor(){g(this,"data",{})}set(r,t){this.data[r]=t}get(r){return this.data[r]}}class xe extends Re.EventEmitter{constructor(t){super();g(this,"data");g(this,"style");g(this,"events",[]);g(this,"instance");g(this,"page");g(this,"parent");g(this,"app");g(this,"store",new Zh);g(this,"eventKeys",new Map);g(this,"eventQueue",[]);this.page=t.page,this.parent=t.parent,this.app=t.app,this.setData(t.config),this.listenLifeSafe()}setData(t){this.data=t;const{events:n,style:s}=t;this.events=n||[],this.style=s||{},this.emit("update-data",t)}addEventToQueue(t){this.eventQueue.push(t)}async runHookCode(t,n){var i,o,a;if(typeof this.data[t]=="function"){await this.data[t](this);return}const s=this.data[t];if((s==null?void 0:s.hookType)===ts.CODE)for(const c of s.hookData){const{codeType:u=Ke.CODE,codeId:f,params:l={}}=c;let h;const y={app:this.app,params:n||l};if(u===Ke.CODE&&typeof f=="string"&&((i=this.app.codeDsl)!=null&&i[f]))h=this.app.codeDsl[f].content;else if(u===Ke.DATA_SOURCE_METHOD&&Array.isArray(f)&&f.length>1){const b=(o=this.app.dataSourceManager)==null?void 0:o.get(f[0]);h=(a=b==null?void 0:b.methods.find(S=>S.name===f[1]))==null?void 0:a.content,y.dataSource=b}h&&typeof h=="function"&&await h(y)}}destroy(){this.removeAllListeners()}listenLifeSafe(){this.once("created",async t=>{this.once("destroy",()=>{this.instance=null,typeof this.data.destroy=="function"&&this.data.destroy(this),this.listenLifeSafe()}),this.instance=t,await this.runHookCode("created")}),this.once("mounted",async t=>{this.instance=t;for(let n=this.eventQueue.shift();n;n=this.eventQueue.shift())typeof t[n.method]=="function"&&await t[n.method](n.fromCpt,...n.args);await this.runHookCode("mounted")})}}class zt extends xe{constructor(){super(...arguments);g(this,"nodes",[])}setData(t){this.resetNodes(),super.setData(t)}resetNodes(){var t;(t=this.nodes)==null||t.forEach(n=>{n.forEach(s=>{s.destroy()})}),this.nodes=[]}initNode(t,n,s){var o,a,c,u,f,l;if(s.has(t.id)&&((o=s.get(t.id))==null||o.destroy()),t.type&&this.app.iteratorContainerType.has(t.type)){const h=new zt({config:t,parent:n,page:this.page,app:this.app});s.set(t.id,h),(a=this.app.eventHelper)==null||a.bindNodeEvents(h);return}const i=new xe({config:t,parent:n,page:this.page,app:this.app});if((c=this.app.eventHelper)==null||c.bindNodeEvents(i),s.set(t.id,i),t.type&&this.app.pageFragmentContainerType.has(t.type)&&t.pageFragmentId){const h=(f=(u=this.app.dsl)==null?void 0:u.items)==null?void 0:f.find(y=>y.id===t.pageFragmentId);h&&(t.items=[h])}(l=t.items)==null||l.forEach(h=>{this.initNode(h,i,s)})}setNodes(t,n){const s=this.nodes[n]||new Map;t.forEach(i=>{this.initNode(i,this,s)}),this.nodes[n]=s}getNode(t,n){var s;return(s=this.nodes[n])==null?void 0:s.get(t)}destroy(){super.destroy(),this.resetNodes()}}class ed extends xe{constructor(t){super(t);g(this,"nodes",new Map);this.setNode(t.config.id,this),t.config.items.forEach(n=>{this.initNode(n,this)})}initNode(t,n){var i,o,a;if(t.type&&this.app.iteratorContainerType.has(t.type)){this.setNode(t.id,new zt({config:t,parent:n,page:this,app:this.app}));return}const s=new xe({config:t,parent:n,page:this,app:this.app});if(this.setNode(t.id,s),t.type&&this.app.pageFragmentContainerType.has(t.type)&&t.pageFragmentId){const c=(o=(i=this.app.dsl)==null?void 0:i.items)==null?void 0:o.find(u=>u.id===t.pageFragmentId);c&&(t.items=[c])}(a=t.items)==null||a.forEach(c=>{this.initNode(c,s)})}getNode(t,n,s){if(this.nodes.has(t))return this.nodes.get(t);if(Array.isArray(n)&&n.length&&Array.isArray(s)){let i=this.nodes.get(n[0]);for(let o=1,a=n.length;o<a;o++)i=i==null?void 0:i.getNode(n[o],s[o-1]);return i==null?void 0:i.getNode(t,s[s.length-1])}}setNode(t,n){this.nodes.set(t,n)}deleteNode(t){this.nodes.delete(t)}destroy(){super.destroy(),this.nodes.clear()}}class td extends Re.EventEmitter{constructor(t){var n;super();g(this,"env",new tn);g(this,"dsl");g(this,"codeDsl");g(this,"dataSourceManager");g(this,"page");g(this,"useMock",!1);g(this,"platform","mobile");g(this,"jsEngine","browser");g(this,"components",new Map);g(this,"pageFragmentContainerType",new Set(["page-fragment-container"]));g(this,"iteratorContainerType",new Set(["iterator-container"]));g(this,"request");g(this,"transformStyle");g(this,"eventHelper");g(this,"flexible");this.setEnv(t.ua),this.codeDsl=(n=t.config)==null?void 0:n.codeBlocks,t.platform&&(this.platform=t.platform),t.jsEngine&&(this.jsEngine=t.jsEngine),t.pageFragmentContainerType&&(Array.isArray(t.pageFragmentContainerType)?t.pageFragmentContainerType:[t.pageFragmentContainerType]).forEach(i=>{this.pageFragmentContainerType.add(i)}),t.iteratorContainerType&&(Array.isArray(t.iteratorContainerType)?t.iteratorContainerType:[t.iteratorContainerType]).forEach(i=>{this.iteratorContainerType.add(i)}),typeof t.useMock=="boolean"&&(this.useMock=t.useMock),this.jsEngine==="browser"&&!t.disabledFlexible&&(this.flexible=new Jh({designWidth:t.designWidth})),this.platform!=="editor"&&(this.eventHelper=new Xh({app:this})),this.transformStyle=t.transformStyle||(s=>Kh(s,this.jsEngine)),t.request&&(this.request=t.request),t.config&&this.setConfig(t.config,t.curPage)}setEnv(t){this.env=new tn(t)}setDesignWidth(t){var n;(n=this.flexible)==null||n.setDesignWidth(t)}setConfig(t,n){var s,i,o;if(this.dsl=t,!n&&t.items.length&&(n=t.items[0].id),this.dataSourceManager&&this.dataSourceManager.destroy(),this.dataSourceManager=Sh(this,this.useMock),this.codeDsl=t.codeBlocks,this.setPage(n||((i=(s=this.page)==null?void 0:s.data)==null?void 0:i.id)),this.dataSourceManager){const a=Array.from(this.dataSourceManager.dataSourceMap.values());(o=this.eventHelper)==null||o.bindDataSourceEvents(a)}}setPage(t){var s,i,o,a;const n=(s=this.dsl)==null?void 0:s.items.find(c=>"".concat(c.id)==="".concat(t));if(!n){this.deletePage(),super.emit("page-change");return}n!==((i=this.page)==null?void 0:i.data)&&((o=this.page)==null||o.destroy(),this.page=new ed({config:n,app:this}),(a=this.eventHelper)==null||a.removeNodeEvents(),this.page.nodes.forEach(c=>{var u;(u=this.eventHelper)==null||u.bindNodeEvents(c)}),super.emit("page-change",this.page))}deletePage(){var t,n;(t=this.page)==null||t.destroy(),(n=this.eventHelper)==null||n.removeNodeEvents(),this.page=void 0}getPage(t){if(!t)return this.page;if(this.page&&"".concat(this.page.data.id)==="".concat(t))return this.page}getNode(t,n,s){var i;return(i=this.page)==null?void 0:i.getNode(t,n,s)}registerComponent(t,n){this.components.set(t,n)}unregisterComponent(t){this.components.delete(t)}resolveComponent(t){return this.components.get(t)}emit(t,...n){var o,a;const[s,...i]=n;return this.eventHelper&&s instanceof xe&&((o=s.data)!=null&&o.id)&&s.eventKeys.has("".concat(String(t),"_").concat(s.data.id))?(a=this.eventHelper)==null?void 0:a.emit(s.eventKeys.get("".concat(String(t),"_").concat(s.data.id)),s,...i):super.emit(t,...n)}async runCode(t,n,s,i){var a,c;if(!t||gc(this.codeDsl))return;const o=(c=(a=this.codeDsl)==null?void 0:a[t])==null?void 0:c.content;typeof o=="function"&&await o({app:this,params:n,eventParams:s,flowState:i})}async runDataSourceMethod(t,n,s,i,o){var f;if(!t||!n)return;const a=(f=this.dataSourceManager)==null?void 0:f.get(t);if(!a)return;const u=(a.methods||[]).find(l=>l.name===n);u&&typeof u.content=="function"&&await u.content({app:this,params:s,dataSource:a,eventParams:i,flowState:o})}destroy(){var t,n;this.removeAllListeners(),this.page=void 0,(t=this.flexible)==null||t.destroy(),this.flexible=void 0,(n=this.eventHelper)==null||n.destroy()}}const rd=(e,r=window)=>{var o;const t=VueDemi.ref(),n=VueDemi.ref(),s=VueDemi.ref(),i=VueDemi.computed(()=>{var a,c,u,f;return((c=(a=t.value)==null?void 0:a.items)==null?void 0:c.find(l=>l.id===n.value))||((f=(u=t.value)==null?void 0:u.items)==null?void 0:f[0])});return VueDemi.watch(i,async()=>{var c;await VueDemi.nextTick();const a=document.querySelector(".magic-ui-page");a&&((c=r.magic)==null||c.onPageElUpdate(a))}),(o=r.magic)==null||o.onRuntimeReady({getApp(){return e},updateRootConfig(a){t.value=a,e==null||e.setConfig(a,n.value)},updatePageId(a){n.value=a,e==null||e.setPage(a)},select(a){var u;s.value=a,e!=null&&e.getPage(a)&&((u=this.updatePageId)==null||u.call(this,a));const c=Vr()(document,"".concat(a));return c||VueDemi.nextTick().then(()=>Vr()(document,"".concat(a)))},add({config:a,parentId:c}){var f,l,h,y,b;if(!t.value)throw new Error("error");if(!s.value)throw new Error("error");if(!c)throw new Error("error");const u=Oe(c,[t.value]).pop();if(!u)throw new Error("未找到父节点");if(a.type!=="page"){const S=(f=e==null?void 0:e.page)==null?void 0:f.getNode(u.id);S&&((l=e==null?void 0:e.page)==null||l.initNode(a,S))}if(u.id!==s.value){const S=(h=u.items)==null?void 0:h.findIndex(_=>_.id===s.value);(y=u.items)==null||y.splice(S+1,0,a)}else(b=u.items)==null||b.push(a)},update({config:a,parentId:c}){var l,h;if(!t.value||!e)throw new Error("error");const u=((l=e.dataSourceManager)==null?void 0:l.compiledNode(a,void 0,!0))||a;ss(VueDemi.reactive(u),[t.value],c);const f=e.getNode(a.id);f&&f.setData(u),((h=e.page)==null?void 0:h.data.id)===a.id&&e.page.setData(u)},remove({id:a,parentId:c}){var h,y;if(!t.value)throw new Error("error");const u=Oe(a,[t.value]).pop();if(!u)throw new Error("未找到目标元素");const f=Oe(c,[t.value]).pop();if(!f)throw new Error("未找到父元素");u.type==="page"?e==null||e.deletePage():(h=e==null?void 0:e.page)==null||h.deleteNode(u.id);const l=(y=f.items)==null?void 0:y.findIndex(b=>b.id===u.id);f.items.splice(l,1)}}),{pageConfig:i}};function nd(e=""){let r,t,n;return typeof e=="string"?r=e:{componentType:r,app:t}=e,(!r||r==="")&&(r="container"),t||(t=VueDemi.inject("app")),n=nn({componentType:r,app:t}),!n&&!r.startsWith("magic-ui-")&&(r="magic-ui-".concat(Lh(r)),n=nn({componentType:r,app:t})),n!=null?n:r}function nn({componentType:e,app:r}){return r==null?void 0:r.resolveComponent(e)}const sd=Vue.defineComponent({__name:"App",setup(e){const r=Vue.inject("app"),{pageConfig:t}=rd(r),n=nd("page");return(s,i)=>Vue.unref(t)?(Vue.openBlock(),Vue.createBlock(Vue.resolveDynamicComponent(Vue.unref(n)),{key:Vue.unref(t).id,config:Vue.unref(t)},null,8,["config"])):Vue.createCommentVNode("",!0)}});pe.registerObservedData(Ch);Promise.all([ut(()=>import("./comp-entry-CkpRydtZ.js"),__vite__mapDeps([0,1])),ut(()=>import("./plugin-entry-B1O5LaIO.js"),[]),ut(()=>import("./datasource-entry-yoD6TSFD.js"),[])]).then(([e,r,t])=>{const n=Vue.createApp(sd),s=new td({ua:window.navigator.userAgent,platform:"editor"});s.env.isWeb&&s.setDesignWidth(window.document.documentElement.getBoundingClientRect().width),Object.entries(e.default).forEach(([i,o])=>{s.registerComponent(i,o)}),Object.entries(t.default).forEach(([i,o])=>{pe.register(i,o)}),Object.values(r.default).forEach(i=>{n.use(i,{app:s})}),window.appInstance=s,n.config.globalProperties.app=s,n.provide("app",s),n.mount("#app")});export{sn as E,od as __vite_legacy_guard,ic as c,Re as e,ys as g,ad as i,yc as s,Lh as t};
//# sourceMappingURL=index-BRSae1hi.js.map
