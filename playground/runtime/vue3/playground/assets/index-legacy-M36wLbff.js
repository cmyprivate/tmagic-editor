System.register([],(function(t,e){"use strict";return{execute:function(){var n=document.createElement("style");n.textContent='html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td,article,aside,canvas,details,embed,figure,figcaption,footer,header,hgroup,menu,nav,output,ruby,section,summary,time,mark,audio,video{margin:0;padding:0;border:0;font-size:100%;font:inherit;vertical-align:baseline}:focus{outline:0}article,aside,details,figcaption,figure,footer,header,hgroup,menu,nav,section{display:block}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:"";content:none}input[type=search]::-webkit-search-cancel-button,input[type=search]::-webkit-search-decoration,input[type=search]::-webkit-search-results-button,input[type=search]::-webkit-search-results-decoration{-webkit-appearance:none;-moz-appearance:none}input[type=search]{-webkit-appearance:none;-moz-appearance:none;-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box}textarea{overflow:auto;vertical-align:top;resize:vertical}audio,canvas,video{display:inline-block;*display: inline;*zoom: 1;max-width:100%}audio:not([controls]){display:none;height:0}[hidden]{display:none}html{font-size:100%;-webkit-text-size-adjust:100%;-ms-text-size-adjust:100%}a:focus{outline:thin dotted}a:active,a:hover{outline:0}img{border:0;-ms-interpolation-mode:bicubic}figure{margin:0}form{margin:0}fieldset{border:1px solid #c0c0c0;margin:0 2px;padding:.35em .625em .75em}legend{border:0;padding:0;white-space:normal;*margin-left: -7px}button,input,select,textarea{font-size:100%;margin:0;vertical-align:baseline;*vertical-align: middle}button,input{line-height:normal}button,select{text-transform:none}button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer;*overflow: visible}button[disabled],html input[disabled]{cursor:default}input[type=checkbox],input[type=radio]{box-sizing:border-box;padding:0;*height: 13px;*width: 13px}input[type=search]{-webkit-appearance:textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}input[type=search]::-webkit-search-cancel-button,input[type=search]::-webkit-search-decoration{-webkit-appearance:none}button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}textarea{overflow:auto;vertical-align:top}table{border-collapse:collapse;border-spacing:0}html,button,input,select,textarea{color:#222}::-moz-selection{background:#b3d4fc;text-shadow:none}::selection{background:#b3d4fc;text-shadow:none}img{vertical-align:middle}fieldset{border:0;margin:0;padding:0}textarea{resize:vertical}.chromeframe{margin:.2em 0;background:#ccc;color:#000;padding:.2em 0}\n/*$vite$:1*/',document.head.appendChild(n),t({c:wn,g:i,s:Sn});const r=function(t,e,n){let r=Promise.resolve();function i(t){const e=new Event("vite:preloadError",{cancelable:!0});if(e.payload=t,window.dispatchEvent(e),!e.defaultPrevented)throw t}return r.then((e=>{for(const t of e||[])"rejected"===t.status&&i(t.reason);return t().catch(i)}))};function i(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var s,o={exports:{}},a=t("e",function(){if(s)return o.exports;s=1;var t,e="object"==typeof Reflect?Reflect:null,n=e&&"function"==typeof e.apply?e.apply:function(t,e,n){return Function.prototype.apply.call(t,e,n)};t=e&&"function"==typeof e.ownKeys?e.ownKeys:Object.getOwnPropertySymbols?function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:function(t){return Object.getOwnPropertyNames(t)};var r=Number.isNaN||function(t){return t!=t};function i(){i.init.call(this)}o.exports=i,o.exports.once=function(t,e){return new Promise((function(n,r){function i(n){t.removeListener(e,s),r(n)}function s(){"function"==typeof t.removeListener&&t.removeListener("error",i),n([].slice.call(arguments))}y(t,e,s,{once:!0}),"error"!==e&&function(t,e,n){"function"==typeof t.on&&y(t,"error",e,n)}(t,i,{once:!0})}))},i.EventEmitter=i,i.prototype._events=void 0,i.prototype._eventsCount=0,i.prototype._maxListeners=void 0;var a=10;function c(t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}function u(t){return void 0===t._maxListeners?i.defaultMaxListeners:t._maxListeners}function l(t,e,n,r){var i,s,o,a;if(c(n),void 0===(s=t._events)?(s=t._events=Object.create(null),t._eventsCount=0):(void 0!==s.newListener&&(t.emit("newListener",e,n.listener?n.listener:n),s=t._events),o=s[e]),void 0===o)o=s[e]=n,++t._eventsCount;else if("function"==typeof o?o=s[e]=r?[n,o]:[o,n]:r?o.unshift(n):o.push(n),(i=u(t))>0&&o.length>i&&!o.warned){o.warned=!0;var l=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");l.name="MaxListenersExceededWarning",l.emitter=t,l.type=e,l.count=o.length,a=l,console&&console.warn&&console.warn(a)}return t}function h(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function d(t,e,n){var r={fired:!1,wrapFn:void 0,target:t,type:e,listener:n},i=h.bind(r);return i.listener=n,r.wrapFn=i,i}function p(t,e,n){var r=t._events;if(void 0===r)return[];var i=r[e];return void 0===i?[]:"function"==typeof i?n?[i.listener||i]:[i]:n?function(t){for(var e=new Array(t.length),n=0;n<e.length;++n)e[n]=t[n].listener||t[n];return e}(i):g(i,i.length)}function f(t){var e=this._events;if(void 0!==e){var n=e[t];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function g(t,e){for(var n=new Array(e),r=0;r<e;++r)n[r]=t[r];return n}function y(t,e,n,r){if("function"==typeof t.on)r.once?t.once(e,n):t.on(e,n);else{if("function"!=typeof t.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof t);t.addEventListener(e,(function i(s){r.once&&t.removeEventListener(e,i),n(s)}))}}return Object.defineProperty(i,"defaultMaxListeners",{enumerable:!0,get:function(){return a},set:function(t){if("number"!=typeof t||t<0||r(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");a=t}}),i.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},i.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||r(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this},i.prototype.getMaxListeners=function(){return u(this)},i.prototype.emit=function(t){for(var e=[],r=1;r<arguments.length;r++)e.push(arguments[r]);var i="error"===t,s=this._events;if(void 0!==s)i=i&&void 0===s.error;else if(!i)return!1;if(i){var o;if(e.length>0&&(o=e[0]),o instanceof Error)throw o;var a=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw a.context=o,a}var c=s[t];if(void 0===c)return!1;if("function"==typeof c)n(c,this,e);else{var u=c.length,l=g(c,u);for(r=0;r<u;++r)n(l[r],this,e)}return!0},i.prototype.addListener=function(t,e){return l(this,t,e,!1)},i.prototype.on=i.prototype.addListener,i.prototype.prependListener=function(t,e){return l(this,t,e,!0)},i.prototype.once=function(t,e){return c(e),this.on(t,d(this,t,e)),this},i.prototype.prependOnceListener=function(t,e){return c(e),this.prependListener(t,d(this,t,e)),this},i.prototype.removeListener=function(t,e){var n,r,i,s,o;if(c(e),void 0===(r=this._events))return this;if(void 0===(n=r[t]))return this;if(n===e||n.listener===e)0==--this._eventsCount?this._events=Object.create(null):(delete r[t],r.removeListener&&this.emit("removeListener",t,n.listener||e));else if("function"!=typeof n){for(i=-1,s=n.length-1;s>=0;s--)if(n[s]===e||n[s].listener===e){o=n[s].listener,i=s;break}if(i<0)return this;0===i?n.shift():function(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}(n,i),1===n.length&&(r[t]=n[0]),void 0!==r.removeListener&&this.emit("removeListener",t,o||e)}return this},i.prototype.off=i.prototype.removeListener,i.prototype.removeAllListeners=function(t){var e,n,r;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[t]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[t]),this;if(0===arguments.length){var i,s=Object.keys(n);for(r=0;r<s.length;++r)"removeListener"!==(i=s[r])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(e=n[t]))this.removeListener(t,e);else if(void 0!==e)for(r=e.length-1;r>=0;r--)this.removeListener(t,e[r]);return this},i.prototype.listeners=function(t){return p(this,t,!0)},i.prototype.rawListeners=function(t){return p(this,t,!1)},i.listenerCount=function(t,e){return"function"==typeof t.listenerCount?t.listenerCount(e):f.call(t,e)},i.prototype.listenerCount=f,i.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]},o.exports}());const c=t("E",i(a));var u="object"==typeof global&&global&&global.Object===Object&&global,l="object"==typeof self&&self&&self.Object===Object&&self,h=u||l||Function("return this")(),d=h.Symbol,p=Object.prototype,f=p.hasOwnProperty,g=p.toString,y=d?d.toStringTag:void 0,b=Object.prototype.toString,m="[object Null]",v="[object Undefined]",j=d?d.toStringTag:void 0;function w(t){return null==t?void 0===t?v:m:j&&j in Object(t)?function(t){var e=f.call(t,y),n=t[y];try{t[y]=void 0;var r=!0}catch(s){}var i=g.call(t);return r&&(e?t[y]=n:delete t[y]),i}(t):function(t){return b.call(t)}(t)}function _(t){return null!=t&&"object"==typeof t}var O="[object Symbol]";function A(t){return"symbol"==typeof t||_(t)&&w(t)==O}var E=Array.isArray,S=1/0,D=d?d.prototype:void 0,I=D?D.toString:void 0;function C(t){if("string"==typeof t)return t;if(E(t))return function(t,e){for(var n=-1,r=null==t?0:t.length,i=Array(r);++n<r;)i[n]=e(t[n],n,t);return i}(t,C)+"";if(A(t))return I?I.call(t):"";var e=t+"";return"0"==e&&1/t==-S?"-0":e}function P(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}var L="[object AsyncFunction]",x="[object Function]",k="[object GeneratorFunction]",T="[object Proxy]";function M(t){if(!P(t))return!1;var e=w(t);return e==x||e==k||e==L||e==T}var R,N=h["__core-js_shared__"],$=(R=/[^.]+$/.exec(N&&N.keys&&N.keys.IE_PROTO||""))?"Symbol(src)_1."+R:"",z=Function.prototype.toString;function F(t){if(null!=t){try{return z.call(t)}catch(e){}try{return t+""}catch(e){}}return""}var W=/^\[object .+?Constructor\]$/,V=Function.prototype,U=Object.prototype,B=V.toString,q=U.hasOwnProperty,H=RegExp("^"+B.call(q).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function Q(t){return!(!P(t)||(e=t,$&&$ in e))&&(M(t)?H:W).test(F(t));var e}function G(t,e){var n=function(t,e){return null==t?void 0:t[e]}(t,e);return Q(n)?n:void 0}var K=G(h,"WeakMap"),J=Object.create,Z=function(){function t(){}return function(e){if(!P(e))return{};if(J)return J(e);t.prototype=e;var n=new t;return t.prototype=void 0,n}}(),X=function(){try{var t=G(Object,"defineProperty");return t({},"",{}),t}catch(e){}}(),Y=9007199254740991,tt=/^(?:0|[1-9]\d*)$/;function et(t,e){var n=typeof t;return!!(e=null==e?Y:e)&&("number"==n||"symbol"!=n&&tt.test(t))&&t>-1&&t%1==0&&t<e}function nt(t,e,n){"__proto__"==e&&X?X(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n}function rt(t,e){return t===e||t!=t&&e!=e}var it=Object.prototype.hasOwnProperty;function st(t,e,n){var r=t[e];it.call(t,e)&&rt(r,n)&&(void 0!==n||e in t)||nt(t,e,n)}function ot(t,e,n,r){var i=!n;n||(n={});for(var s=-1,o=e.length;++s<o;){var a=e[s],c=void 0;void 0===c&&(c=t[a]),i?nt(n,a,c):st(n,a,c)}return n}var at=9007199254740991;function ct(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=at}function ut(t){return null!=t&&ct(t.length)&&!M(t)}var lt=Object.prototype;function ht(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||lt)}function dt(t){return _(t)&&"[object Arguments]"==w(t)}var pt=Object.prototype,ft=pt.hasOwnProperty,gt=pt.propertyIsEnumerable,yt=dt(function(){return arguments}())?dt:function(t){return _(t)&&ft.call(t,"callee")&&!gt.call(t,"callee")},bt="object"==typeof t&&t&&!t.nodeType&&t,mt=bt&&"object"==typeof e&&e&&!e.nodeType&&e,vt=mt&&mt.exports===bt?h.Buffer:void 0,jt=(vt?vt.isBuffer:void 0)||function(){return!1},wt={};function _t(t){return function(e){return t(e)}}wt["[object Float32Array]"]=wt["[object Float64Array]"]=wt["[object Int8Array]"]=wt["[object Int16Array]"]=wt["[object Int32Array]"]=wt["[object Uint8Array]"]=wt["[object Uint8ClampedArray]"]=wt["[object Uint16Array]"]=wt["[object Uint32Array]"]=!0,wt["[object Arguments]"]=wt["[object Array]"]=wt["[object ArrayBuffer]"]=wt["[object Boolean]"]=wt["[object DataView]"]=wt["[object Date]"]=wt["[object Error]"]=wt["[object Function]"]=wt["[object Map]"]=wt["[object Number]"]=wt["[object Object]"]=wt["[object RegExp]"]=wt["[object Set]"]=wt["[object String]"]=wt["[object WeakMap]"]=!1;var Ot="object"==typeof t&&t&&!t.nodeType&&t,At=Ot&&"object"==typeof e&&e&&!e.nodeType&&e,Et=At&&At.exports===Ot&&u.process,St=function(){try{var t=At&&At.require&&At.require("util").types;return t||Et&&Et.binding&&Et.binding("util")}catch(e){}}(),Dt=St&&St.isTypedArray,It=Dt?_t(Dt):function(t){return _(t)&&ct(t.length)&&!!wt[w(t)]},Ct=Object.prototype.hasOwnProperty;function Pt(t,e){var n=E(t),r=!n&&yt(t),i=!n&&!r&&jt(t),s=!n&&!r&&!i&&It(t),o=n||r||i||s,a=o?function(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r}(t.length,String):[],c=a.length;for(var u in t)!e&&!Ct.call(t,u)||o&&("length"==u||i&&("offset"==u||"parent"==u)||s&&("buffer"==u||"byteLength"==u||"byteOffset"==u)||et(u,c))||a.push(u);return a}function Lt(t,e){return function(n){return t(e(n))}}var xt=Lt(Object.keys,Object),kt=Object.prototype.hasOwnProperty;function Tt(t){if(!ht(t))return xt(t);var e=[];for(var n in Object(t))kt.call(t,n)&&"constructor"!=n&&e.push(n);return e}function Mt(t){return ut(t)?Pt(t):Tt(t)}var Rt=Object.prototype.hasOwnProperty;function Nt(t){if(!P(t))return function(t){var e=[];if(null!=t)for(var n in Object(t))e.push(n);return e}(t);var e=ht(t),n=[];for(var r in t)("constructor"!=r||!e&&Rt.call(t,r))&&n.push(r);return n}function $t(t){return ut(t)?Pt(t,!0):Nt(t)}var zt=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Ft=/^\w*$/,Wt=G(Object,"create"),Vt=Object.prototype.hasOwnProperty,Ut=Object.prototype.hasOwnProperty;function Bt(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function qt(t,e){for(var n=t.length;n--;)if(rt(t[n][0],e))return n;return-1}Bt.prototype.clear=function(){this.__data__=Wt?Wt(null):{},this.size=0},Bt.prototype.delete=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},Bt.prototype.get=function(t){var e=this.__data__;if(Wt){var n=e[t];return"__lodash_hash_undefined__"===n?void 0:n}return Vt.call(e,t)?e[t]:void 0},Bt.prototype.has=function(t){var e=this.__data__;return Wt?void 0!==e[t]:Ut.call(e,t)},Bt.prototype.set=function(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=Wt&&void 0===e?"__lodash_hash_undefined__":e,this};var Ht=Array.prototype.splice;function Qt(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}Qt.prototype.clear=function(){this.__data__=[],this.size=0},Qt.prototype.delete=function(t){var e=this.__data__,n=qt(e,t);return!(n<0||(n==e.length-1?e.pop():Ht.call(e,n,1),--this.size,0))},Qt.prototype.get=function(t){var e=this.__data__,n=qt(e,t);return n<0?void 0:e[n][1]},Qt.prototype.has=function(t){return qt(this.__data__,t)>-1},Qt.prototype.set=function(t,e){var n=this.__data__,r=qt(n,t);return r<0?(++this.size,n.push([t,e])):n[r][1]=e,this};var Gt=G(h,"Map");function Kt(t,e){var n,r,i=t.__data__;return("string"==(r=typeof(n=e))||"number"==r||"symbol"==r||"boolean"==r?"__proto__"!==n:null===n)?i["string"==typeof e?"string":"hash"]:i.map}function Jt(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function Zt(t,e){if("function"!=typeof t||null!=e&&"function"!=typeof e)throw new TypeError("Expected a function");var n=function(){var r=arguments,i=e?e.apply(this,r):r[0],s=n.cache;if(s.has(i))return s.get(i);var o=t.apply(this,r);return n.cache=s.set(i,o)||s,o};return n.cache=new(Zt.Cache||Jt),n}Jt.prototype.clear=function(){this.size=0,this.__data__={hash:new Bt,map:new(Gt||Qt),string:new Bt}},Jt.prototype.delete=function(t){var e=Kt(this,t).delete(t);return this.size-=e?1:0,e},Jt.prototype.get=function(t){return Kt(this,t).get(t)},Jt.prototype.has=function(t){return Kt(this,t).has(t)},Jt.prototype.set=function(t,e){var n=Kt(this,t),r=n.size;return n.set(t,e),this.size+=n.size==r?0:1,this},Zt.Cache=Jt;var Xt=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Yt=/\\(\\)?/g,te=function(t){var e=Zt(t,(function(t){return 500===n.size&&n.clear(),t})),n=e.cache;return e}((function(t){var e=[];return 46===t.charCodeAt(0)&&e.push(""),t.replace(Xt,(function(t,n,r,i){e.push(r?i.replace(Yt,"$1"):n||t)})),e}));function ee(t,e){return E(t)?t:function(t,e){if(E(t))return!1;var n=typeof t;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=t&&!A(t))||Ft.test(t)||!zt.test(t)||null!=e&&t in Object(e)}(t,e)?[t]:te(function(t){return null==t?"":C(t)}(t))}var ne=1/0;function re(t){if("string"==typeof t||A(t))return t;var e=t+"";return"0"==e&&1/t==-ne?"-0":e}function ie(t,e){for(var n=-1,r=e.length,i=t.length;++n<r;)t[i+n]=e[n];return t}var se=Lt(Object.getPrototypeOf,Object);function oe(t){var e=this.__data__=new Qt(t);this.size=e.size}oe.prototype.clear=function(){this.__data__=new Qt,this.size=0},oe.prototype.delete=function(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n},oe.prototype.get=function(t){return this.__data__.get(t)},oe.prototype.has=function(t){return this.__data__.has(t)},oe.prototype.set=function(t,e){var n=this.__data__;if(n instanceof Qt){var r=n.__data__;if(!Gt||r.length<199)return r.push([t,e]),this.size=++n.size,this;n=this.__data__=new Jt(r)}return n.set(t,e),this.size=n.size,this};var ae="object"==typeof t&&t&&!t.nodeType&&t,ce=ae&&"object"==typeof e&&e&&!e.nodeType&&e,ue=ce&&ce.exports===ae?h.Buffer:void 0,le=ue?ue.allocUnsafe:void 0;function he(){return[]}var de=Object.prototype.propertyIsEnumerable,pe=Object.getOwnPropertySymbols,fe=pe?function(t){return null==t?[]:(t=Object(t),function(t,e){for(var n=-1,r=null==t?0:t.length,i=0,s=[];++n<r;){var o=t[n];e(o,n,t)&&(s[i++]=o)}return s}(pe(t),(function(e){return de.call(t,e)})))}:he,ge=Object.getOwnPropertySymbols?function(t){for(var e=[];t;)ie(e,fe(t)),t=se(t);return e}:he;function ye(t,e,n){var r=e(t);return E(t)?r:ie(r,n(t))}function be(t){return ye(t,Mt,fe)}function me(t){return ye(t,$t,ge)}var ve=G(h,"DataView"),je=G(h,"Promise"),we=G(h,"Set"),_e="[object Map]",Oe="[object Promise]",Ae="[object Set]",Ee="[object WeakMap]",Se="[object DataView]",De=F(ve),Ie=F(Gt),Ce=F(je),Pe=F(we),Le=F(K),xe=w;(ve&&xe(new ve(new ArrayBuffer(1)))!=Se||Gt&&xe(new Gt)!=_e||je&&xe(je.resolve())!=Oe||we&&xe(new we)!=Ae||K&&xe(new K)!=Ee)&&(xe=function(t){var e=w(t),n="[object Object]"==e?t.constructor:void 0,r=n?F(n):"";if(r)switch(r){case De:return Se;case Ie:return _e;case Ce:return Oe;case Pe:return Ae;case Le:return Ee}return e});var ke=Object.prototype.hasOwnProperty,Te=h.Uint8Array;function Me(t){var e=new t.constructor(t.byteLength);return new Te(e).set(new Te(t)),e}var Re=/\w*$/,Ne=d?d.prototype:void 0,$e=Ne?Ne.valueOf:void 0,ze="[object Boolean]",Fe="[object Date]",We="[object Map]",Ve="[object Number]",Ue="[object RegExp]",Be="[object Set]",qe="[object String]",He="[object Symbol]",Qe="[object ArrayBuffer]",Ge="[object DataView]",Ke="[object Float32Array]",Je="[object Float64Array]",Ze="[object Int8Array]",Xe="[object Int16Array]",Ye="[object Int32Array]",tn="[object Uint8Array]",en="[object Uint8ClampedArray]",nn="[object Uint16Array]",rn="[object Uint32Array]";function sn(t,e,n){var r,i,s,o=t.constructor;switch(e){case Qe:return Me(t);case ze:case Fe:return new o(+t);case Ge:return function(t,e){var n=e?Me(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.byteLength)}(t,n);case Ke:case Je:case Ze:case Xe:case Ye:case tn:case en:case nn:case rn:return function(t,e){var n=e?Me(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.length)}(t,n);case We:return new o;case Ve:case qe:return new o(t);case Ue:return(s=new(i=t).constructor(i.source,Re.exec(i))).lastIndex=i.lastIndex,s;case Be:return new o;case He:return r=t,$e?Object($e.call(r)):{}}}var on=St&&St.isMap,an=on?_t(on):function(t){return _(t)&&"[object Map]"==xe(t)},cn=St&&St.isSet,un=cn?_t(cn):function(t){return _(t)&&"[object Set]"==xe(t)},ln=1,hn=2,dn=4,pn="[object Arguments]",fn="[object Function]",gn="[object GeneratorFunction]",yn="[object Object]",bn={};function mn(t,e,n,r,i,s){var o,a=e&ln,c=e&hn,u=e&dn;if(void 0!==o)return o;if(!P(t))return t;var l=E(t);if(l){if(o=function(t){var e=t.length,n=new t.constructor(e);return e&&"string"==typeof t[0]&&ke.call(t,"index")&&(n.index=t.index,n.input=t.input),n}(t),!a)return function(t,e){var n=-1,r=t.length;for(e||(e=Array(r));++n<r;)e[n]=t[n];return e}(t,o)}else{var h=xe(t),d=h==fn||h==gn;if(jt(t))return function(t,e){if(e)return t.slice();var n=t.length,r=le?le(n):new t.constructor(n);return t.copy(r),r}(t,a);if(h==yn||h==pn||d&&!i){if(o=c||d?{}:function(t){return"function"!=typeof t.constructor||ht(t)?{}:Z(se(t))}(t),!a)return c?function(t,e){return ot(t,ge(t),e)}(t,function(t,e){return t&&ot(e,$t(e),t)}(o,t)):function(t,e){return ot(t,fe(t),e)}(t,function(t,e){return t&&ot(e,Mt(e),t)}(o,t))}else{if(!bn[h])return i?t:{};o=sn(t,h,a)}}s||(s=new oe);var p=s.get(t);if(p)return p;s.set(t,o),un(t)?t.forEach((function(r){o.add(mn(r,e,n,0,t,s))})):an(t)&&t.forEach((function(r,i){o.set(i,mn(r,e,n,0,t,s))}));var f=l?void 0:(u?c?me:be:c?$t:Mt)(t);return function(t,e){for(var n=-1,r=null==t?0:t.length;++n<r&&!1!==e(t[n],n,t););}(f||t,(function(r,i){f&&(r=t[i=r]),st(o,i,mn(r,e,n,0,t,s))})),o}bn[pn]=bn["[object Array]"]=bn["[object ArrayBuffer]"]=bn["[object DataView]"]=bn["[object Boolean]"]=bn["[object Date]"]=bn["[object Float32Array]"]=bn["[object Float64Array]"]=bn["[object Int8Array]"]=bn["[object Int16Array]"]=bn["[object Int32Array]"]=bn["[object Map]"]=bn["[object Number]"]=bn[yn]=bn["[object RegExp]"]=bn["[object Set]"]=bn["[object String]"]=bn["[object Symbol]"]=bn["[object Uint8Array]"]=bn["[object Uint8ClampedArray]"]=bn["[object Uint16Array]"]=bn["[object Uint32Array]"]=!0,bn["[object Error]"]=bn[fn]=bn["[object WeakMap]"]=!1;var vn=1,jn=4;function wn(t){return mn(t,vn|jn)}var _n=Object.prototype.hasOwnProperty;function On(t,e){return null!=t&&_n.call(t,e)}function An(t,e){return null!=t&&function(t,e,n){for(var r=-1,i=(e=ee(e,t)).length,s=!1;++r<i;){var o=re(e[r]);if(!(s=null!=t&&n(t,o)))break;t=t[o]}return s||++r!=i?s:!!(i=null==t?0:t.length)&&ct(i)&&et(o,i)&&(E(t)||yt(t))}(t,e,On)}var En=Object.prototype.hasOwnProperty;function Sn(t,e,n){return null==t?t:function(t,e,n){if(!P(t))return t;for(var r=-1,i=(e=ee(e,t)).length,s=i-1,o=t;null!=o&&++r<i;){var a=re(e[r]),c=n;if("__proto__"===a||"constructor"===a||"prototype"===a)return t;if(r!=s){var u=o[a];void 0===(c=void 0)&&(c=P(u)?u:et(e[r+1])?[]:{})}st(o,a,c),o=o[a]}return t}(t,e,n)}
/*! *****************************************************************************
      Copyright (c) Microsoft Corporation.

      Permission to use, copy, modify, and/or distribute this software for any
      purpose with or without fee is hereby granted.

      THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
      REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
      AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
      INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
      LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
      OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
      PERFORMANCE OF THIS SOFTWARE.
      ***************************************************************************** */function Dn(t,e,n,r){return new(n||(n=Promise))((function(e,i){function s(t){try{a(r.next(t))}catch(e){i(e)}}function o(t){try{a(r.throw(t))}catch(e){i(e)}}function a(t){var r;t.done?e(t.value):(r=t.value,r instanceof n?r:new n((function(t){t(r)}))).then(s,o)}a((r=r.apply(t,[])).next())}))}const In=[];class Cn{constructor(t,e,n,r=void 0){this.obj=t,this.delimiter=e,this.wildcard=n,this.is_match=r}shortMatch(t,e){if(t===e)return!0;if(t===this.wildcard)return!0;if(this.is_match)return this.is_match(t,e);const n=t.indexOf(this.wildcard);if(n>-1){const r=t.substr(n+1);if(0===n||e.substring(0,n)===t.substring(0,n)){const t=r.length;return!(t>0)||e.substr(-t)===r}}return!1}match(t,e){return this.is_match?this.is_match(t,e):t===e||t===this.wildcard||e===this.wildcard||this.shortMatch(t,e)||function(t,e,n="*"){if(t===n)return!0;In.length=0;let r=0,i=0,s=0,o=0;for(let h=0,d=t.length;h<d;h+=1){const e=t[h];e===n&&(r+=1,h>o&&In.push(t.substring(o,h)),In.push(e),o=h+1)}if(o<t.length&&In.push(t.substring(o)),r?(i=t.length-r,s=1/0):s=i=t.length,0===In.length)return t===e;const a=e.length;if(a<i||a>s)return!1;let c=In.length-1,u=e.length-1,l=!1;for(;;){const t=In[c];if(c-=1,t===n)l=!0;else{const n=u+1-t.length,r=e.lastIndexOf(t,n);if(-1===r||r>n)return!1;if(l)u=r-1,l=!1;else{if(r!==n)return!1;u-=t.length}}if(0>c)break}return!0}(t,e,this.wildcard)}handleArray(t,e,n,r,i={}){let s=t.indexOf(this.delimiter,n),o=!1;-1===s&&(o=!0,s=t.length);const a=t.substring(n,s);let c=0;for(const u of e){const e=c.toString(),n=""===r?e:r+this.delimiter+c;(a===this.wildcard||a===e||this.shortMatch(a,e))&&(o?i[n]=u:this.goFurther(t,u,s+1,n,i)),c++}return i}handleObject(t,e,n,r,i={}){let s=t.indexOf(this.delimiter,n),o=!1;-1===s&&(o=!0,s=t.length);const a=t.substring(n,s);for(let c in e){c=c.toString();const n=""===r?c:r+this.delimiter+c;(a===this.wildcard||a===c||this.shortMatch(a,c))&&(o?i[n]=e[c]:this.goFurther(t,e[c],s+1,n,i))}return i}goFurther(t,e,n,r,i={}){return Array.isArray(e)?this.handleArray(t,e,n,r,i):this.handleObject(t,e,n,r,i)}get(t){return this.goFurther(t,this.obj,0,"")}}class Pn{static get(t,e,n=!1){if(!e)return;let r=e;for(const i of t)if(i in r)r=r[i];else{if(!n)return;r[i]=Object.create({}),r=r[i]}return r}static set(t,e,n){if(!n)return;if(0===t.length){for(const t in n)delete n[t];for(const t in e)n[t]=e[t];return}const r=t.slice(),i=r.pop(),s=Pn.get(r,n,!0);return"object"==typeof s&&(s[i]=e),e}}let Ln,xn=0,kn=null;function Tn(){return null!==kn&&kn.buffer===Ln.memory.buffer||(kn=new Uint8Array(Ln.memory.buffer)),kn}let Mn=new TextEncoder("utf-8");const Rn="function"==typeof Mn.encodeInto?function(t,e){return Mn.encodeInto(t,e)}:function(t,e){const n=Mn.encode(t);return e.set(n),{read:t.length,written:n.length}};function Nn(t,e,n){if(void 0===n){const n=Mn.encode(t),r=e(n.length);return Tn().subarray(r,r+n.length).set(n),xn=n.length,r}let r=t.length,i=e(r);const s=Tn();let o=0;for(;o<r;o++){const e=t.charCodeAt(o);if(e>127)break;s[i+o]=e}if(o!==r){0!==o&&(t=t.slice(o)),i=n(i,r,r=o+3*t.length);const e=Tn().subarray(i+o,i+r);o+=Rn(t,e).written}return xn=o,i}function $n(t,e){var n=Nn(t,Ln.__wbindgen_malloc,Ln.__wbindgen_realloc),r=xn,i=Nn(e,Ln.__wbindgen_malloc,Ln.__wbindgen_realloc),s=xn;return 0!==Ln.is_match(n,r,i,s)}async function zn(t){("string"==typeof t||"function"==typeof Request&&t instanceof Request||"function"==typeof URL&&t instanceof URL)&&(t=fetch(t));const{instance:e,module:n}=await async function(t,e){if("function"==typeof Response&&t instanceof Response){if("function"==typeof WebAssembly.instantiateStreaming)try{return await WebAssembly.instantiateStreaming(t,e)}catch(n){if("application/wasm"==t.headers.get("Content-Type"))throw n;console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",n)}const r=await t.arrayBuffer();return await WebAssembly.instantiate(r,e)}{const n=await WebAssembly.instantiate(t,e);return n instanceof WebAssembly.Instance?{instance:n,module:t}:n}}(await t,{});return Ln=e.exports,zn.__wbindgen_wasm_module=n,Ln}const Fn={only:[],source:"",debug:!1,data:void 0,queue:!1,force:!1};function Wn(t,e){console.debug(t,e)}function Vn(t){return t&&t.constructor?"Object"===t.constructor.name:"object"==typeof t&&null!==t}class Un{constructor(t={},e={}){this.jobsRunning=0,this.updateQueue=[],this.subscribeQueue=[],this.listenersIgnoreCache=new WeakMap,this.is_match=null,this.destroyed=!1,this.queueRuns=0,this.groupId=0,this.namedGroups=[],this.numberGroups=[],this.traceId=0,this.traceMap=new Map,this.tracing=[],this.savedTrace=[],this.collection=null,this.collections=0,this.cache=new Map,this.splitCache=new Map,this.indices=new Map,this.indicesCount=new Map,this.lastExecs=new WeakMap,this.listeners=new Map,this.waitingListeners=new Map,this.options=Object.assign(Object.assign({},{delimiter:".",debug:!1,extraDebug:!1,useMute:!0,notRecursive:";",param:":",wildcard:"*",experimentalMatch:!1,queue:!1,defaultBulkValue:!0,useCache:!1,useSplitCache:!1,useIndicesCache:!1,maxSimultaneousJobs:1e3,maxQueueRuns:1e3,log:Wn,Promise:Promise}),e),this.data=t,this.id=0,this.options.useCache?(this.pathGet=this.cacheGet,this.pathSet=this.cacheSet):(this.pathGet=Pn.get,this.pathSet=Pn.set),e.Promise?this.resolved=e.Promise.resolve():this.resolved=Promise.resolve(),this.muted=new Set,this.mutedListeners=new Set,this.scan=new Cn(this.data,this.options.delimiter,this.options.wildcard),this.destroyed=!1}getDefaultListenerOptions(){return{bulk:!1,bulkValue:this.options.defaultBulkValue,debug:!1,source:"",data:void 0,queue:!1,group:!1}}cacheGet(t,e=this.data,n=!1){const r=t.join(this.options.delimiter),i=this.cache.get(r);if(i){const t=i.deref();if(t)return t}const s=Pn.get(t,e,n);return(Vn(s)||Array.isArray(s))&&this.cache.set(r,new WeakRef(s)),s}cacheSet(t,e,n=this.data){const r=t.join(this.options.delimiter);return Vn(e)||Array.isArray(e)?this.cache.set(r,new WeakRef(e)):this.cache.delete(r),Pn.set(t,e,n)}silentSet(t,e){return this.pathSet(this.split(t),e,this.data)}loadWasmMatcher(t){return Dn(this,0,void 0,(function*(){yield zn(t),this.is_match=$n,this.scan=new Cn(this.data,this.options.delimiter,this.options.wildcard,this.is_match)}))}same(t,e){return(["number","string","undefined","boolean"].includes(typeof t)||null===t)&&e===t}getListeners(){return this.listeners}destroy(){this.destroyed=!0,this.data=void 0,this.listeners=new Map,this.waitingListeners=new Map,this.updateQueue=[],this.jobsRunning=0}match(t,e,n=!0){return this.is_match?this.is_match(t,e):t===e||t===this.options.wildcard||e===this.options.wildcard||!(!n&&this.getIndicesCount(this.options.delimiter,t)<this.getIndicesCount(this.options.delimiter,e))&&this.scan.match(t,e)}getIndicesOf(t,e){if(this.options.useIndicesCache&&this.indices.has(e))return this.indices.get(e);const n=t.length;if(0==n)return[];let r,i=0,s=[];for(;(r=e.indexOf(t,i))>-1;)s.push(r),i=r+n;return this.options.useIndicesCache&&this.indices.set(e,s),s}getIndicesCount(t,e){if(this.options.useIndicesCache&&this.indicesCount.has(e))return this.indicesCount.get(e);const n=t.length;if(0==n)return 0;let r,i=0,s=0;for(;(r=e.indexOf(t,i))>-1;)s++,i=r+n;return this.options.useIndicesCache&&this.indicesCount.set(e,s),s}cutPath(t,e){if(""===e)return"";if((t=this.cleanNotRecursivePath(t))===(e=this.cleanNotRecursivePath(e)))return t;const n=this.getIndicesCount(this.options.delimiter,e),r=this.getIndicesOf(this.options.delimiter,t);return t.substring(0,r[n])}trimPath(t){return(t=this.cleanNotRecursivePath(t)).charAt(0)===this.options.delimiter?t.substr(1):t}split(t){if(""===t)return[];if(!this.options.useSplitCache)return t.split(this.options.delimiter);const e=this.splitCache.get(t);if(e)return e.slice();const n=t.split(this.options.delimiter);return this.splitCache.set(t,n.slice()),n}isWildcard(t){return t.includes(this.options.wildcard)||this.hasParams(t)}isNotRecursive(t){return t.endsWith(this.options.notRecursive)}cleanNotRecursivePath(t){return this.isNotRecursive(t)?t.substring(0,t.length-1):t}hasParams(t){return t.includes(this.options.param)}getParamsInfo(t){let e={replaced:"",original:t,params:{}},n=0,r=[];for(const i of this.split(t)){e.params[n]={original:i,replaced:"",name:""};const t=new RegExp(`\\${this.options.param}([^\\${this.options.delimiter}\\${this.options.param}]+)`,"g");let s=t.exec(i);s?(e.params[n].name=s[1],t.lastIndex=0,e.params[n].replaced=i.replace(t,this.options.wildcard),r.push(e.params[n].replaced),n++):(delete e.params[n],r.push(i),n++)}return e.replaced=r.join(this.options.delimiter),e}getParams(t,e){if(!t)return;const n=this.split(e),r={};for(const i in t.params)r[t.params[i].name]=n[i];return r}waitForAll(t,e){const n={};for(let r of t)n[r]={dirty:!1},this.hasParams(r)&&(n[r].paramsInfo=this.getParamsInfo(r)),n[r].isWildcard=this.isWildcard(r),n[r].isRecursive=!this.isNotRecursive(r);return this.waitingListeners.set(t,{fn:e,paths:n}),e(n),function(){this.waitingListeners.delete(t)}}executeWaitingListeners(t){if(!this.destroyed)for(const e of this.waitingListeners.values()){const{fn:n,paths:r}=e;let i=0,s=0;for(let e in r){const n=r[e];let o=!1;n.isRecursive&&(t=this.cutPath(t,e)),n.isWildcard&&this.match(e,t)&&(o=!0),t===e&&(o=!0),o&&(n.dirty=!0),n.dirty&&i++,s++}i===s&&n(r)}}subscribeAll(t,e,n=this.getDefaultListenerOptions()){if(this.destroyed)return()=>{};let r=[],i=0,s=null;"boolean"==typeof n.group&&n.group?(this.groupId++,s=this.groupId,n.bulk=!0):"string"==typeof n.group&&(n.bulk=!0,s=n.group);for(const o of t)r.push(this.subscribe(o,e,n,{all:t,index:i,groupId:s})),i++;return function(){for(const t of r)t()}}getCleanListenersCollection(t={}){return Object.assign({listeners:new Map,isRecursive:!1,isWildcard:!1,hasParams:!1,match:void 0,paramsInfo:void 0,path:void 0,originalPath:void 0,count:0},t)}getCleanListener(t,e=this.getDefaultListenerOptions()){return{fn:t,options:Object.assign(Object.assign({},this.getDefaultListenerOptions()),e),groupId:null}}getListenerCollectionMatch(t,e,n){t=this.cleanNotRecursivePath(t);const r=this;return function(i,s=!1){let o=t;return e?i=r.cutPath(i,t):o=r.cutPath(r.cleanNotRecursivePath(t),i),s&&console.log("[getListenerCollectionMatch]",{listenerPath:t,scopedListenerPath:o,path:i,isRecursive:e,isWildcard:n}),!(!n||!r.match(o,i,e))||o===i}}getListenersCollection(t,e){if(this.listeners.has(t)){let n=this.listeners.get(t);return n.listeners.set(++this.id,e),e.id=this.id,n}const n=this.hasParams(t);let r;n&&(r=this.getParamsInfo(t));let i={isRecursive:!this.isNotRecursive(t),isWildcard:this.isWildcard(t),hasParams:n,paramsInfo:r,originalPath:t,path:n?r.replaced:t};i.isRecursive||(i.path=this.cleanNotRecursivePath(i.path));let s=this.getCleanListenersCollection(Object.assign(Object.assign({},i),{match:this.getListenerCollectionMatch(i.path,i.isRecursive,i.isWildcard)}));return this.id++,s.listeners.set(this.id,e),e.id=this.id,this.listeners.set(i.originalPath,s),s}subscribe(t,e,n=this.getDefaultListenerOptions(),r={all:[t],index:0,groupId:null}){if(this.destroyed)return()=>{};this.jobsRunning++;const i="subscribe";let s=this.getCleanListener(e,n);n.group&&(n.bulk=!0,"string"==typeof n.group?s.groupId=n.group:r.groupId&&(s.groupId=r.groupId)),this.listenersIgnoreCache.set(s,{truthy:[],falsy:[]});const o=this.getListenersCollection(t,s);n.debug&&console.log("[subscribe]",{listenerPath:t,options:n}),o.count++;let a=!0;if(s.groupId&&("string"==typeof s.groupId?this.namedGroups.includes(s.groupId)?a=!1:this.namedGroups.push(s.groupId):"number"==typeof s.groupId&&(this.numberGroups.includes(s.groupId)?a=!1:this.numberGroups.push(s.groupId))),a){const r=this.cleanNotRecursivePath(o.path),a=this.split(r);if(o.isWildcard){const a=this.scan.get(r);if(n.bulk){const r=[];for(const t in a)this.isMuted(t)||r.push({path:t,params:this.getParams(o.paramsInfo,t),value:a[t]});this.isMuted(e)||e(r,{type:i,listener:s,listenersCollection:o,path:{listener:t,update:void 0,resolved:void 0},options:n,params:void 0})}else for(const r in a)this.isMuted(r)||this.isMuted(e)||e(a[r],{type:i,listener:s,listenersCollection:o,path:{listener:t,update:void 0,resolved:this.cleanNotRecursivePath(r)},params:this.getParams(o.paramsInfo,r),options:n})}else this.isMuted(r)||this.isMuted(e)||e(this.pathGet(a,this.data),{type:i,listener:s,listenersCollection:o,path:{listener:t,update:void 0,resolved:this.cleanNotRecursivePath(t)},params:this.getParams(o.paramsInfo,r),options:n})}return this.debugSubscribe(s,o,t),this.jobsRunning--,this.unsubscribe(t,this.id)}unsubscribe(t,e){const n=this.listeners,r=n.get(t);return function(){r.listeners.delete(e),r.count--,0===r.count&&n.delete(t)}}runQueuedListeners(){if(!this.destroyed&&0!==this.subscribeQueue.length)if(0===this.jobsRunning){this.queueRuns=0;const t=[...this.subscribeQueue];for(let e=0,n=t.length;e<n;e++)t[e]();this.subscribeQueue.length=0}else{if(this.queueRuns++,this.queueRuns>=this.options.maxQueueRuns)throw this.queueRuns=0,new Error("Maximal number of queue runs exhausted.");Promise.resolve().then((()=>this.runQueuedListeners())).catch((t=>{throw t}))}}getQueueNotifyListeners(t,e=[]){for(const n in t){if(this.isMuted(n))continue;let{single:r,bulk:i}=t[n];for(const t of r){let n=!1,r=t.listener.id+":"+t.eventInfo.path.resolved;t.eventInfo.path.resolved||(r=t.listener.id+":"+t.eventInfo.path.listener);for(const t of e)if(r===t.resolvedIdPath){n=!0;break}if(n)continue;const i=this.debugTime(t);if(!this.isMuted(t.listener.fn))if(t.listener.options.queue&&this.jobsRunning)this.subscribeQueue.push((()=>{t.listener.fn(t.value?t.value():void 0,t.eventInfo)}));else{let n=t.listener.id+":"+t.eventInfo.path.resolved;t.eventInfo.path.resolved||(n=t.listener.id+":"+t.eventInfo.path.listener),e.push({id:t.listener.id,resolvedPath:t.eventInfo.path.resolved,resolvedIdPath:n,originalFn:t.listener.fn,fn:()=>{t.listener.fn(t.value?t.value():void 0,t.eventInfo)},options:t.listener.options,groupId:t.listener.groupId})}this.debugListener(i,t)}for(const t of i){let n=!1;for(const s of e)if(s.id===t.listener.id){n=!0;break}if(n)continue;const r=this.debugTime(t),i=[];for(const e of t.value)i.push(Object.assign(Object.assign({},e),{value:e.value?e.value():void 0}));if(!this.isMuted(t.listener.fn))if(t.listener.options.queue&&this.jobsRunning)this.subscribeQueue.push((()=>!this.jobsRunning&&(t.listener.fn(i,t.eventInfo),!0)));else{let n=t.listener.id+":"+t.eventInfo.path.resolved;t.eventInfo.path.resolved||(n=t.listener.id+":"+t.eventInfo.path.listener),e.push({id:t.listener.id,resolvedPath:t.eventInfo.path.resolved,resolvedIdPath:n,originalFn:t.listener.fn,fn:()=>{t.listener.fn(i,t.eventInfo)},options:t.listener.options,groupId:t.listener.groupId})}this.debugListener(r,t)}}return Promise.resolve().then((()=>this.runQueuedListeners())),e}shouldIgnore(t,e){if(!t.options.ignore)return!1;for(const n of t.options.ignore){if(e.startsWith(n))return!0;if(this.is_match&&this.is_match(n,e))return!0;{const t=this.cutPath(e,n);if(this.match(n,t))return!0}}return!1}getSubscribedListeners(t,e,n,r="update",i=null){n=Object.assign(Object.assign({},Fn),n);const s={};for(let[o,a]of this.listeners)if(a.match(t)){s[o]={single:[],bulk:[],bulkData:[]};const c=a.paramsInfo?this.getParams(a.paramsInfo,t):void 0,u=this.cutPath(t,o),l=a.isRecursive||a.isWildcard?()=>this.get(u):()=>e,h=[{value:l,path:t,params:c}];for(const e of a.listeners.values())this.shouldIgnore(e,t)?e.options.debug&&console.log("[getSubscribedListeners] Listener was not fired because it was ignored.",{listener:e,listenersCollection:a}):e.options.bulk?s[o].bulk.push({listener:e,listenersCollection:a,eventInfo:{type:r,listener:e,path:{listener:o,update:i||t,resolved:void 0},params:c,options:n},value:h}):s[o].single.push({listener:e,listenersCollection:a,eventInfo:{type:r,listener:e,path:{listener:o,update:i||t,resolved:this.cleanNotRecursivePath(t)},params:c,options:n},value:l})}else if(this.options.extraDebug){let e=!1;for(const n of a.listeners.values())n.options.debug&&(e=!0,console.log("[getSubscribedListeners] Listener was not fired because there was no match.",{listener:n,listenersCollection:a,updatePath:t}));e&&a.match(t,!0)}return s}notifySubscribedListeners(t,e,n,r="update",i=null){return this.getQueueNotifyListeners(this.getSubscribedListeners(t,e,n,r,i))}useBulkValue(t){for(const[e,n]of t.listeners){if(n.options.bulk&&n.options.bulkValue)return!0;if(!n.options.bulk)return!0}return!1}getNestedListeners(t,e,n,r="update",i=null){const s={},o={};for(let[a,c]of this.listeners){if(!c.isRecursive)continue;const u=this.cutPath(a,t);if(this.match(u,t)){s[a]={single:[],bulk:[]};const l=this.trimPath(a.substr(u.length)),h=this.useBulkValue(c);let d;h&&(d=o[l]?o[l]:new Cn(e,this.options.delimiter,this.options.wildcard).get(l),o[l]=d);const p=c.paramsInfo?this.getParams(c.paramsInfo,t):void 0,f=[],g={};for(const[e,o]of c.listeners)if(h)for(const u in d){const l=()=>d[u],h=[t,u].join(this.options.delimiter),y={type:r,listener:o,listenersCollection:c,path:{listener:a,update:i||t,resolved:this.cleanNotRecursivePath(h)},params:p,options:n};this.shouldIgnore(o,t)||(o.options.bulk?(f.push({value:l,path:h,params:p}),g[e]=o):s[a].single.push({listener:o,listenersCollection:c,eventInfo:y,value:l}))}else{const u={type:r,listener:o,listenersCollection:c,path:{listener:a,update:i||t,resolved:void 0},params:p,options:n};if(this.shouldIgnore(o,t))continue;o.options.bulk?(f.push({value:void 0,path:void 0,params:p}),g[e]=o):s[a].single.push({listener:o,listenersCollection:c,eventInfo:u,value:void 0})}for(const e in g){const i=g[e],o={type:r,listener:i,listenersCollection:c,path:{listener:a,update:t,resolved:void 0},options:n,params:p};s[a].bulk.push({listener:i,listenersCollection:c,eventInfo:o,value:f})}}else if(this.options.extraDebug)for(const e of c.listeners.values())e.options.debug&&console.log("[getNestedListeners] Listener was not fired because there was no match.",{listener:e,listenersCollection:c,currentCutPath:u,updatePath:t})}return s}notifyNestedListeners(t,e,n,r="update",i,s=null){return this.getQueueNotifyListeners(this.getNestedListeners(t,e,n,r,s),i)}getNotifyOnlyListeners(t,e,n,r="update",i=null){const s={};if("object"!=typeof n.only||!Array.isArray(n.only)||void 0===n.only[0]||!this.canBeNested(e))return s;for(const o of n.only){const a=new Cn(e,this.options.delimiter,this.options.wildcard).get(o);s[o]={bulk:[],single:[]};for(const e in a){const c=t+this.options.delimiter+e;for(const[u,l]of this.listeners){const h=l.paramsInfo?this.getParams(l.paramsInfo,c):void 0;if(this.match(u,c)){const d=()=>a[e],p=[{value:d,path:c,params:h}];for(const e of l.listeners.values()){const a={type:r,listener:e,listenersCollection:l,path:{listener:u,update:i||t,resolved:this.cleanNotRecursivePath(c)},params:h,options:n};this.shouldIgnore(e,t)||(e.options.bulk?s[o].bulk.some((t=>t.listener===e))||s[o].bulk.push({listener:e,listenersCollection:l,eventInfo:a,value:p}):s[o].single.push({listener:e,listenersCollection:l,eventInfo:a,value:d}))}}}}}return s}runQueue(t){const e=[];for(const n of t)n.options.group?e.includes(n.groupId)||(n.fn(),e.push(n.groupId)):n.fn()}sortAndRunQueue(t,e){t.sort((function(t,e){return t.id-e.id})),this.options.debug&&console.log(`[deep-state-observer] queue for ${e}`,t),this.runQueue(t)}notifyOnly(t,e,n,r="update",i=""){const s=this.getQueueNotifyListeners(this.getNotifyOnlyListeners(t,e,n,r,i));this.sortAndRunQueue(s,t)}canBeNested(t){return"object"==typeof t&&null!==t}getUpdateValues(t,e){let n=e;return"function"==typeof e&&(n=e(t)),{newValue:n,oldValue:t}}wildcardNotify(t,e){let n=[];for(const r of t)this.getQueueNotifyListeners(r,n);for(const r of e)this.executeWaitingListeners(r);return this.jobsRunning--,n}wildcardUpdate(t,e,n=Fn,r=!1){++this.jobsRunning,n=Object.assign(Object.assign({},Fn),n);const i=this.scan.get(t),s={};for(const u in i){const t=this.split(u),{oldValue:r,newValue:o}=this.getUpdateValues(i[u],e);this.same(o,r)&&!n.force||(this.pathSet(t,o,this.data),s[u]=o)}const o=[],a=[];for(const u in s){const e=s[u];n.only.length?o.push(this.getNotifyOnlyListeners(u,e,n,"update",t)):(o.push(this.getSubscribedListeners(u,e,n,"update",t)),this.canBeNested(e)&&o.push(this.getNestedListeners(u,e,n,"update",t))),n.debug&&this.options.log("Wildcard update",{path:u,newValue:e}),a.push(u)}if(r){const e=this;return function(){const n=e.wildcardNotify(o,a);e.sortAndRunQueue(n,t)}}const c=this.wildcardNotify(o,a);this.sortAndRunQueue(c,t)}runUpdateQueue(){if(!this.destroyed)for(;this.updateQueue.length&&this.updateQueue.length<this.options.maxSimultaneousJobs;){const t=this.updateQueue.shift();t.options.queue=!1,this.update(t.updatePath,t.fnOrValue,t.options,t.multi)}}updateNotify(t,e,n){const r=this.notifySubscribedListeners(t,e,n);this.canBeNested(e)&&this.notifyNestedListeners(t,e,n,"update",r),this.sortAndRunQueue(r,t),this.executeWaitingListeners(t)}updateNotifyAll(t){let e=[];for(const n of t){const t=n.newValue;if(this.tracing.length){const e=this.tracing[this.tracing.length-1],r=this.traceMap.get(e);r.changed.push({traceId:e,updatePath:n.updatePath,fnOrValue:t,options:n.options}),this.traceMap.set(e,r)}e=e.concat(this.notifySubscribedListeners(n.updatePath,t,n.options)),this.canBeNested(n.newValue)&&this.notifyNestedListeners(n.updatePath,t,n.options,"update",e)}this.runQueue(e)}updateNotifyOnly(t,e,n){this.notifyOnly(t,e,n),this.executeWaitingListeners(t)}update(t,e,n=Object.assign({},Fn),r=!1){if(this.destroyed)return;if(this.collection)return this.collection.update(t,e,n);if(this.tracing.length){const r=this.tracing[this.tracing.length-1],i=this.traceMap.get(r);i.changed.push({traceId:r,updatePath:t,fnOrValue:e,options:n}),this.traceMap.set(r,i)}const i=this.jobsRunning;if((this.options.queue||n.queue)&&i){if(i>this.options.maxSimultaneousJobs)throw new Error("Maximal simultaneous jobs limit reached.");this.updateQueue.push({updatePath:t,fnOrValue:e,options:n,multi:r});const s=Promise.resolve().then((()=>{this.runUpdateQueue()}));return r?function(){return s}:s}if(this.isWildcard(t))return this.wildcardUpdate(t,e,n,r);++this.jobsRunning;const s=this.split(t),o=this.pathGet(s,this.data);let{oldValue:a,newValue:c}=this.getUpdateValues(o,e);if(n.debug&&this.options.log(`Updating ${t} ${n.source?`from ${n.source}`:""}`,{oldValue:a,newValue:c}),this.same(c,a)&&!n.force)return--this.jobsRunning,r?function(){return c}:c;if(this.pathSet(s,c,this.data),null===(n=Object.assign(Object.assign({},Fn),n)).only)return--this.jobsRunning,r?function(){}:c;if(n.only.length){if(--this.jobsRunning,r){const e=this;return function(){return e.updateNotifyOnly(t,c,n)}}return this.updateNotifyOnly(t,c,n),c}if(r){--this.jobsRunning;const e=this;return function(){return e.updateNotify(t,c,n)}}return this.updateNotify(t,c,n),--this.jobsRunning,c}multi(t=!1){if(this.destroyed)return{update(){return this},done(){},getStack:()=>[]};if(this.collection)return this.collection;const e=this,n=[],r=[];return{update(i,s,o=Fn){if(t){const t=e.split(i);let r=s;const a=e.pathGet(t,e.data);"function"==typeof r&&(r=r(a)),e.pathSet(t,r,e.data),n.push({updatePath:i,newValue:r,options:o})}else r.push(e.update(i,s,o,!0));return this},done(){if(0===e.collections){if(t)e.updateNotifyAll(n);else for(const t of r)t();n.length=0}},getStack:()=>n}}collect(){return this.collections++,this.collection||(this.collection=this.multi(!0)),this.collection}executeCollected(){if(this.collections--,0===this.collections&&this.collection){const t=this.collection;this.collection=null,t.done()}}getCollectedCount(){return this.collections}getCollectedStack(){return this.collection?this.collection.getStack():[]}get(t=void 0){if(!this.destroyed)return void 0===t||""===t?this.data:this.isWildcard(t)?this.scan.get(t):this.pathGet(this.split(t),this.data)}last(t){let e=this.lastExecs.get(t);e||(e={calls:0},this.lastExecs.set(t,e));const n=++e.calls;this.resolved.then((()=>{n===e.calls&&(this.lastExecs.set(t,{calls:0}),t())}))}isMuted(t){if(!this.options.useMute)return!1;if("function"==typeof t)return this.isMutedListener(t);for(const e of this.muted){const n=!this.isNotRecursive(e),r=this.trimPath(e);if(this.match(t,r))return!0;if(this.match(r,t))return!0;if(n){const n=this.cutPath(r,t);if(this.match(n,e))return!0;if(this.match(e,n))return!0}}return!1}isMutedListener(t){return this.mutedListeners.has(t)}mute(t){if("function"==typeof t)return this.mutedListeners.add(t);this.muted.add(t)}unmute(t){if("function"==typeof t)return this.mutedListeners.delete(t);this.muted.delete(t)}debugSubscribe(t,e,n){t.options.debug&&this.options.log("listener subscribed",{listenerPath:n,listener:t,listenersCollection:e})}debugListener(t,e){(e.eventInfo.options.debug||e.listener.options.debug)&&this.options.log("Listener fired",{time:Date.now()-t,info:e})}debugTime(t){return t.listener.options.debug||t.eventInfo.options.debug?Date.now():0}startTrace(t,e=null){this.traceId++;const n=this.traceId+":"+t;return this.traceMap.set(n,{id:n,sort:this.traceId,stack:this.tracing.map((t=>t)),additionalData:e,changed:[]}),this.tracing.push(n),n}stopTrace(t){const e=this.traceMap.get(t);return this.tracing.pop(),this.traceMap.delete(t),e}saveTrace(t){const e=this.traceMap.get(t);return this.tracing.pop(),this.traceMap.delete(t),this.savedTrace.push(e),e}getSavedTraces(){const t=this.savedTrace.map((t=>t));return t.sort(((t,e)=>t.sort-e.sort)),this.savedTrace=[],t}}var Bn="object"==typeof global&&global&&global.Object===Object&&global,qn="object"==typeof self&&self&&self.Object===Object&&self,Hn=Bn||qn||Function("return this")(),Qn=Hn.Symbol,Gn=Object.prototype,Kn=Gn.hasOwnProperty,Jn=Gn.toString,Zn=Qn?Qn.toStringTag:void 0,Xn=Object.prototype.toString,Yn=Qn?Qn.toStringTag:void 0;function tr(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":Yn&&Yn in Object(t)?function(t){var e=Kn.call(t,Zn),n=t[Zn];try{t[Zn]=void 0;var r=!0}catch(s){}var i=Jn.call(t);return r&&(e?t[Zn]=n:delete t[Zn]),i}(t):function(t){return Xn.call(t)}(t)}function er(t){return null!=t&&"object"==typeof t}var nr=Array.isArray;function rr(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}function ir(t){return t}function sr(t){if(!rr(t))return!1;var e=tr(t);return"[object Function]"==e||"[object GeneratorFunction]"==e||"[object AsyncFunction]"==e||"[object Proxy]"==e}var or=Hn["__core-js_shared__"],ar=function(){var t=/[^.]+$/.exec(or&&or.keys&&or.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}(),cr=Function.prototype.toString;function ur(t){if(null!=t){try{return cr.call(t)}catch(e){}try{return t+""}catch(e){}}return""}var lr=/^\[object .+?Constructor\]$/,hr=Function.prototype,dr=Object.prototype,pr=hr.toString,fr=dr.hasOwnProperty,gr=RegExp("^"+pr.call(fr).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function yr(t){return!(!rr(t)||(e=t,ar&&ar in e))&&(sr(t)?gr:lr).test(ur(t));var e}function br(t,e){var n=function(t,e){return null==t?void 0:t[e]}(t,e);return yr(n)?n:void 0}var mr,vr,jr,wr=br(Hn,"WeakMap"),_r=Object.create,Or=function(){function t(){}return function(e){if(!rr(e))return{};if(_r)return _r(e);t.prototype=e;var n=new t;return t.prototype=void 0,n}}(),Ar=Date.now,Er=function(){try{var t=br(Object,"defineProperty");return t({},"",{}),t}catch(e){}}(),Sr=Er?function(t,e){return Er(t,"toString",{configurable:!0,enumerable:!1,value:(n=e,function(){return n}),writable:!0});var n}:ir,Dr=(mr=Sr,vr=0,jr=0,function(){var t=Ar(),e=16-(t-jr);if(jr=t,e>0){if(++vr>=800)return arguments[0]}else vr=0;return mr.apply(void 0,arguments)});function Ir(t){return t!=t}function Cr(t,e){return!(null==t||!t.length)&&function(t,e,n){return e==e?function(t,e,n){for(var r=n-1,i=t.length;++r<i;)if(t[r]===e)return r;return-1}(t,e,n):function(t,e,n){for(var r=t.length,i=n+-1;++i<r;)if(e(t[i],i,t))return i;return-1}(t,Ir,n)}(t,e,0)>-1}var Pr=/^(?:0|[1-9]\d*)$/;function Lr(t,e){var n=typeof t;return!!(e=null==e?9007199254740991:e)&&("number"==n||"symbol"!=n&&Pr.test(t))&&t>-1&&t%1==0&&t<e}function xr(t,e){return t===e||t!=t&&e!=e}var kr=Object.prototype.hasOwnProperty;function Tr(t,e,n){var r=t[e];kr.call(t,e)&&xr(r,n)&&(void 0!==n||e in t)||function(t,e,n){"__proto__"==e&&Er?Er(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n}(t,e,n)}var Mr=Math.max;function Rr(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=9007199254740991}function Nr(t){return null!=t&&Rr(t.length)&&!sr(t)}var $r=Object.prototype;function zr(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||$r)}function Fr(t){return er(t)&&"[object Arguments]"==tr(t)}var Wr=Object.prototype,Vr=Wr.hasOwnProperty,Ur=Wr.propertyIsEnumerable,Br=Fr(function(){return arguments}())?Fr:function(t){return er(t)&&Vr.call(t,"callee")&&!Ur.call(t,"callee")},qr="object"==typeof t&&t&&!t.nodeType&&t,Hr=qr&&"object"==typeof e&&e&&!e.nodeType&&e,Qr=Hr&&Hr.exports===qr?Hn.Buffer:void 0,Gr=(Qr?Qr.isBuffer:void 0)||function(){return!1},Kr={};function Jr(t){return function(e){return t(e)}}Kr["[object Float32Array]"]=Kr["[object Float64Array]"]=Kr["[object Int8Array]"]=Kr["[object Int16Array]"]=Kr["[object Int32Array]"]=Kr["[object Uint8Array]"]=Kr["[object Uint8ClampedArray]"]=Kr["[object Uint16Array]"]=Kr["[object Uint32Array]"]=!0,Kr["[object Arguments]"]=Kr["[object Array]"]=Kr["[object ArrayBuffer]"]=Kr["[object Boolean]"]=Kr["[object DataView]"]=Kr["[object Date]"]=Kr["[object Error]"]=Kr["[object Function]"]=Kr["[object Map]"]=Kr["[object Number]"]=Kr["[object Object]"]=Kr["[object RegExp]"]=Kr["[object Set]"]=Kr["[object String]"]=Kr["[object WeakMap]"]=!1;var Zr="object"==typeof t&&t&&!t.nodeType&&t,Xr=Zr&&"object"==typeof e&&e&&!e.nodeType&&e,Yr=Xr&&Xr.exports===Zr&&Bn.process,ti=function(){try{var t=Xr&&Xr.require&&Xr.require("util").types;return t||Yr&&Yr.binding&&Yr.binding("util")}catch(e){}}(),ei=ti&&ti.isTypedArray,ni=ei?Jr(ei):function(t){return er(t)&&Rr(t.length)&&!!Kr[tr(t)]},ri=Object.prototype.hasOwnProperty;function ii(t,e){var n=nr(t),r=!n&&Br(t),i=!n&&!r&&Gr(t),s=!n&&!r&&!i&&ni(t),o=n||r||i||s,a=o?function(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r}(t.length,String):[],c=a.length;for(var u in t)!ri.call(t,u)||o&&("length"==u||i&&("offset"==u||"parent"==u)||s&&("buffer"==u||"byteLength"==u||"byteOffset"==u)||Lr(u,c))||a.push(u);return a}function si(t,e){return function(n){return t(e(n))}}var oi=si(Object.keys,Object),ai=Object.prototype.hasOwnProperty;function ci(t){return Nr(t)?ii(t):function(t){if(!zr(t))return oi(t);var e=[];for(var n in Object(t))ai.call(t,n)&&"constructor"!=n&&e.push(n);return e}(t)}var ui=br(Object,"create"),li=Object.prototype.hasOwnProperty,hi=Object.prototype.hasOwnProperty;function di(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function pi(t,e){for(var n=t.length;n--;)if(xr(t[n][0],e))return n;return-1}di.prototype.clear=function(){this.__data__=ui?ui(null):{},this.size=0},di.prototype.delete=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},di.prototype.get=function(t){var e=this.__data__;if(ui){var n=e[t];return"__lodash_hash_undefined__"===n?void 0:n}return li.call(e,t)?e[t]:void 0},di.prototype.has=function(t){var e=this.__data__;return ui?void 0!==e[t]:hi.call(e,t)},di.prototype.set=function(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=ui&&void 0===e?"__lodash_hash_undefined__":e,this};var fi=Array.prototype.splice;function gi(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}gi.prototype.clear=function(){this.__data__=[],this.size=0},gi.prototype.delete=function(t){var e=this.__data__,n=pi(e,t);return!(n<0||(n==e.length-1?e.pop():fi.call(e,n,1),--this.size,0))},gi.prototype.get=function(t){var e=this.__data__,n=pi(e,t);return n<0?void 0:e[n][1]},gi.prototype.has=function(t){return pi(this.__data__,t)>-1},gi.prototype.set=function(t,e){var n=this.__data__,r=pi(n,t);return r<0?(++this.size,n.push([t,e])):n[r][1]=e,this};var yi=br(Hn,"Map");function bi(t,e){var n,r,i=t.__data__;return("string"==(r=typeof(n=e))||"number"==r||"symbol"==r||"boolean"==r?"__proto__"!==n:null===n)?i["string"==typeof e?"string":"hash"]:i.map}function mi(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function vi(t,e){for(var n=-1,r=e.length,i=t.length;++n<r;)t[i+n]=e[n];return t}mi.prototype.clear=function(){this.size=0,this.__data__={hash:new di,map:new(yi||gi),string:new di}},mi.prototype.delete=function(t){var e=bi(this,t).delete(t);return this.size-=e?1:0,e},mi.prototype.get=function(t){return bi(this,t).get(t)},mi.prototype.has=function(t){return bi(this,t).has(t)},mi.prototype.set=function(t,e){var n=bi(this,t),r=n.size;return n.set(t,e),this.size+=n.size==r?0:1,this};var ji=Qn?Qn.isConcatSpreadable:void 0;function wi(t){return nr(t)||Br(t)||!!(ji&&t&&t[ji])}var _i=si(Object.getPrototypeOf,Object);function Oi(t){var e=this.__data__=new gi(t);this.size=e.size}Oi.prototype.clear=function(){this.__data__=new gi,this.size=0},Oi.prototype.delete=function(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n},Oi.prototype.get=function(t){return this.__data__.get(t)},Oi.prototype.has=function(t){return this.__data__.has(t)},Oi.prototype.set=function(t,e){var n=this.__data__;if(n instanceof gi){var r=n.__data__;if(!yi||r.length<199)return r.push([t,e]),this.size=++n.size,this;n=this.__data__=new mi(r)}return n.set(t,e),this.size=n.size,this};var Ai="object"==typeof t&&t&&!t.nodeType&&t,Ei=Ai&&"object"==typeof e&&e&&!e.nodeType&&e,Si=Ei&&Ei.exports===Ai?Hn.Buffer:void 0;Si&&Si.allocUnsafe;var Di=Object.prototype.propertyIsEnumerable,Ii=Object.getOwnPropertySymbols,Ci=Ii?function(t){return null==t?[]:(t=Object(t),function(t,e){for(var n=-1,r=null==t?0:t.length,i=0,s=[];++n<r;){var o=t[n];e(o,n,t)&&(s[i++]=o)}return s}(Ii(t),(function(e){return Di.call(t,e)})))}:function(){return[]};function Pi(t){return function(t,e,n){var r=e(t);return nr(t)?r:vi(r,n(t))}(t,ci,Ci)}var Li=br(Hn,"DataView"),xi=br(Hn,"Promise"),ki=br(Hn,"Set"),Ti="[object Map]",Mi="[object Promise]",Ri="[object Set]",Ni="[object WeakMap]",$i="[object DataView]",zi=ur(Li),Fi=ur(yi),Wi=ur(xi),Vi=ur(ki),Ui=ur(wr),Bi=tr;(Li&&Bi(new Li(new ArrayBuffer(1)))!=$i||yi&&Bi(new yi)!=Ti||xi&&Bi(xi.resolve())!=Mi||ki&&Bi(new ki)!=Ri||wr&&Bi(new wr)!=Ni)&&(Bi=function(t){var e=tr(t),n="[object Object]"==e?t.constructor:void 0,r=n?ur(n):"";if(r)switch(r){case zi:return $i;case Fi:return Ti;case Wi:return Mi;case Vi:return Ri;case Ui:return Ni}return e});var qi=Object.prototype.hasOwnProperty,Hi=Hn.Uint8Array;function Qi(t){var e=new t.constructor(t.byteLength);return new Hi(e).set(new Hi(t)),e}var Gi=/\w*$/,Ki=Qn?Qn.prototype:void 0,Ji=Ki?Ki.valueOf:void 0;function Zi(t,e,n){var r,i,s,o,a,c=t.constructor;switch(e){case"[object ArrayBuffer]":return Qi(t);case"[object Boolean]":case"[object Date]":return new c(+t);case"[object DataView]":return a=Qi((o=t).buffer),new o.constructor(a,o.byteOffset,o.byteLength);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return function(t){var e=Qi(t.buffer);return new t.constructor(e,t.byteOffset,t.length)}(t);case"[object Map]":case"[object Set]":return new c;case"[object Number]":case"[object String]":return new c(t);case"[object RegExp]":return(s=new(i=t).constructor(i.source,Gi.exec(i))).lastIndex=i.lastIndex,s;case"[object Symbol]":return r=t,Ji?Object(Ji.call(r)):{}}}var Xi=ti&&ti.isMap,Yi=Xi?Jr(Xi):function(t){return er(t)&&"[object Map]"==Bi(t)},ts=ti&&ti.isSet,es=ts?Jr(ts):function(t){return er(t)&&"[object Set]"==Bi(t)},ns="[object Arguments]",rs="[object Function]",is="[object Object]",ss={};function os(t,e,n,r,i,s){var o;if(void 0!==o)return o;if(!rr(t))return t;var a=nr(t);if(a)o=function(t){var e=t.length,n=new t.constructor(e);return e&&"string"==typeof t[0]&&qi.call(t,"index")&&(n.index=t.index,n.input=t.input),n}(t);else{var c=Bi(t),u=c==rs||"[object GeneratorFunction]"==c;if(Gr(t))return t.slice();if(c==is||c==ns||u&&!i)o=u?{}:function(t){return"function"!=typeof t.constructor||zr(t)?{}:Or(_i(t))}(t);else{if(!ss[c])return i?t:{};o=Zi(t,c)}}s||(s=new Oi);var l=s.get(t);if(l)return l;s.set(t,o),es(t)?t.forEach((function(r){o.add(os(r,e,n,0,t,s))})):Yi(t)&&t.forEach((function(r,i){o.set(i,os(r,e,n,0,t,s))}));var h=a?void 0:Pi(t);return function(t,e){for(var n=-1,r=null==t?0:t.length;++n<r&&!1!==e(t[n],n,t););}(h||t,(function(r,i){h&&(r=t[i=r]),Tr(o,i,os(r,e,n,0,t,s))})),o}function as(t){return os(t,5)}function cs(t){var e=-1,n=null==t?0:t.length;for(this.__data__=new mi;++e<n;)this.add(t[e])}function us(t,e){return t.has(e)}function ls(t){var e=-1,n=Array(t.size);return t.forEach((function(t){n[++e]=t})),n}function hs(t){return er(t)&&Nr(t)}ss[ns]=ss["[object Array]"]=ss["[object ArrayBuffer]"]=ss["[object DataView]"]=ss["[object Boolean]"]=ss["[object Date]"]=ss["[object Float32Array]"]=ss["[object Float64Array]"]=ss["[object Int8Array]"]=ss["[object Int16Array]"]=ss["[object Int32Array]"]=ss["[object Map]"]=ss["[object Number]"]=ss[is]=ss["[object RegExp]"]=ss["[object Set]"]=ss["[object String]"]=ss["[object Symbol]"]=ss["[object Uint8Array]"]=ss["[object Uint8ClampedArray]"]=ss["[object Uint16Array]"]=ss["[object Uint32Array]"]=!0,ss["[object Error]"]=ss[rs]=ss["[object WeakMap]"]=!1,cs.prototype.add=cs.prototype.push=function(t){return this.__data__.set(t,"__lodash_hash_undefined__"),this},cs.prototype.has=function(t){return this.__data__.has(t)};var ds=ki&&1/ls(new ki([,-0]))[1]==1/0?function(t){return new ki(t)}:function(){},ps=function(t,e){return Dr(function(t,e,n){return e=Mr(void 0===e?t.length-1:e,0),function(){for(var r=arguments,i=-1,s=Mr(r.length-e,0),o=Array(s);++i<s;)o[i]=r[e+i];i=-1;for(var a=Array(e+1);++i<e;)a[i]=r[i];return a[e]=n(o),function(t,e,n){switch(n.length){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2])}return t.apply(e,n)}(t,this,a)}}(t,e,ir),t+"")}((function(t){return function(t,e,n){var r=-1,i=Cr,s=t.length,o=!0,a=[],c=a;if(s>=200){var u=ds(t);if(u)return ls(u);o=!1,i=us,c=new cs}else c=a;t:for(;++r<s;){var l=t[r],h=l;if(l=0!==l?l:0,o&&h==h){for(var d=c.length;d--;)if(c[d]===h)continue t;a.push(l)}else i(c,h,n)||(c!==a&&c.push(h),a.push(l))}return a}(function(t,e,n,r,i){var s=-1,o=t.length;for(n||(n=wi),i||(i=[]);++s<o;){var a=t[s];n(a)&&vi(i,a)}return i}(t,0,hs))}));class fs{}class gs extends fs{data={};event=(()=>new a.EventEmitter)();constructor(t){super(),this.data=t}update(t,e){e?Us(e,t,this.data):this.data=t;const n={updateData:t,path:e??""};e&&this.event.emit(e,n),this.event.emit("",n)}on(t,e){this.event.on(t,e)}off(t,e){this.event.off(t,e)}getData(t){return t?Vs(t,this.data):this.data}destroy(){}}class ys extends c{isInit=!1;app;mockData;#t="base";#e;#n;#r;#i=[];#s=[];constructor(t){super(),this.#e=t.schema.id,this.#n=t.schema,this.app=t.app,this.setFields(t.schema.fields),this.setMethods(t.schema.methods||[]);let e=t.initialData;const n=t.ObservedDataClass||gs;if("editor"===this.app.platform)this.mockData=t.schema.mocks?.find((t=>t.useInEditor))?.data||this.getDefaultData(),e=as(this.mockData);else if("boolean"==typeof t.useMock&&t.useMock)this.mockData=t.schema.mocks?.find((t=>t.enable))?.data,e=this.mockData||this.getDefaultData();else{if(t.initialData)return this.#r=new n(t.initialData??{}),void(this.isInit=!0);e=this.getDefaultData()}this.#r=new n(e??{})}get id(){return this.#e}get type(){return this.#t}get schema(){return this.#n}get fields(){return this.#i}get methods(){return this.#s}setFields(t){this.#i=t}setMethods(t){this.#s=t}get data(){return this.#r.getData("")}setData(t,e){this.#r.update(t,e);const n={updateData:t,path:e};this.emit("change",n)}setValue(t,e){return this.setData(e,t)}onDataChange(t,e){this.#r.on(t,e)}offDataChange(t,e){this.#r.off(t,e)}getDefaultData(){return Zs(this.#i)}async init(){this.isInit=!0}destroy(){this.#i=[],this.removeAllListeners(),this.#r.destroy()}}const bs=t=>Object.entries(t).reduce(((t,[e,n])=>{let r=n;return"object"==typeof n&&(r=JSON.stringify(n)),void 0!==n?`${t}${t?"&":""}${globalThis.encodeURIComponent(e)}=${globalThis.encodeURIComponent(`${r}`)}`:t}),""),ms=async t=>{const{url:e,method:n="GET",headers:r={},params:i={},data:s={},...o}=t,a=bs(i);let c=JSON.stringify(s);return r["Content-Type"]?.includes("application/x-www-form-urlencoded")&&(c=bs(s)),(await globalThis.fetch(a?`${e}?${a}`:e,{method:n,headers:r,body:"GET"===n?void 0:c,...o})).json()},vs=new Map,js=(t,e)=>{let n=!0;for(const{op:i,value:s,range:o,field:a}of t){const[t,...c]=a,u=e[t];if(!u||!c.length)break;try{const t=Vs(c.join("."),u);if(!Js(i,t,s,o)){n=!1;break}}catch(r){console.warn(r)}}return n},ws=(t,e)=>{if(!t[Cs]||!Array.isArray(t[Cs])||!t[Cs].length)return!0;for(const{cond:n}of t[Cs])if(n&&js(n,e))return!0;return!1},_s=(t,e)=>{if(zs(t)||Fs(t)){const n=e.items?.findIndex((e=>e.id===t.id));e.items.splice(n,1,t)}else Hs(t,e.items)},Os=(t,e,n=[],r={})=>{const i={...r,[e]:{}};let s=as(r[e]),o=i[e];return n.forEach(((e,r)=>{Object.assign(o,s),r!==n.length-1?(Array.isArray(s[e])&&(s[e]={},o[e]={}),s=s[e],o=o[e]):o[e]=t})),i},As=(t,e)=>t.replaceAll(to,((t,n)=>{try{return Vs(n,e)}catch(r){return t}})),Es=(t,e)=>"string"==typeof t?As(t,e):t?.isBindDataSource&&t.dataSourceId?e[t.dataSourceId]:t?.isBindDataSourceField&&t.dataSourceId&&"string"==typeof t.template?As(t.template,e[t.dataSourceId]):Array.isArray(t)&&"string"==typeof t[0]?((t,e)=>{const[n,...r]=t,i=n.indexOf(Xs);if(i>-1){const o=e[n.substring(i+Xs.length)];if(!o)return t;try{return Vs(r.join("."),o)}catch(s){return t}}return t})(t,e):t,Ss=({compile:t,dsId:e,item:n,deps:r,condDeps:i,inEditor:s,ctxData:o})=>{const{items:a,...c}=n,u=as(c);return i[c.id]?.keys.length&&!s&&(u.condResult=ws(c,o)),Array.isArray(a)&&a.length?u.items=a.map((n=>Ss({compile:t,dsId:e,item:n,deps:r,condDeps:i,inEditor:s,ctxData:o}))):a&&(u.items=a),r[u.id]?.keys.length?Ks(t,u,{[e]:r},e):u};class Ds extends c{static dataSourceClassMap=(()=>new Map)();static ObservedDataClass=(()=>gs)();static register(t,e){Ds.dataSourceClassMap.set(t,e)}static getDataSourceClass(t){return Ds.dataSourceClassMap.get(t)}static registerObservedData(t){Ds.ObservedDataClass=t}app;dataSourceMap=(()=>new Map)();data={};useMock=!1;constructor({app:t,useMock:e,initialData:n}){super(),this.app=t,this.useMock=e,n&&(this.data=n),t.dsl?.dataSources?.forEach((t=>{this.addDataSource(t)}));const r=Array.from(this.dataSourceMap);"function"==typeof Promise.allSettled?Promise.allSettled(r.map((([,t])=>this.init(t)))).then((t=>{const e={},n={};t.forEach(((t,i)=>{const s=r[i][0];"fulfilled"===t.status?this.data[s]?e[s]=this.data[s]:delete e[s]:"rejected"===t.status&&(delete e[s],n[s]=t.reason)})),this.emit("init",e,n)})):Promise.all(r.map((([,t])=>this.init(t)))).then((()=>{this.emit("init",this.data)})).catch((()=>{this.emit("init",this.data)}))}async init(t){if(!(t.isInit||this.app.jsEngine&&t.schema.disabledInitInJsEngine?.includes(this.app.jsEngine))){for(const e of t.methods){if("function"!=typeof e.content)return;"beforeInit"===e.timing&&await e.content({params:{},dataSource:t,app:this.app})}await t.init();for(const e of t.methods){if("function"!=typeof e.content)return;"afterInit"===e.timing&&await e.content({params:{},dataSource:t,app:this.app})}}}get(t){return this.dataSourceMap.get(t)}async addDataSource(t){if(!t)return;const e=new(Ds.dataSourceClassMap.get(t.type)||ys)({app:this.app,schema:t,request:this.app.request,useMock:this.useMock,initialData:this.data[t.id],ObservedDataClass:Ds.ObservedDataClass});this.dataSourceMap.set(t.id,e),this.data[e.id]=e.data,e.on("change",(t=>{this.setData(e,t)}))}setData(t,e){this.data[t.id]=t.data,this.emit("change",t.id,e)}removeDataSource(t){this.get(t)?.destroy(),delete this.data[t],this.dataSourceMap.delete(t)}updateSchema(t){t.forEach((t=>{if(!this.get(t.id))return;this.removeDataSource(t.id),this.addDataSource(t);const e=this.get(t.id);e&&this.init(e)}))}compiledNode({items:t,...e},n,r=!1){const i=as(e);return t&&(i.items=Array.isArray(t)&&r?t.map((t=>this.compiledNode(t,n,r))):t),!1===e.condResult||!1===e.visible?i:Ks((t=>Es(t,this.data)),i,this.app.dsl?.dataSourceDeps||{},n)}compliedConds(t){return ws(t,this.data)}compliedIteratorItemConds(t,e,n=[]){const[r,...i]=n,s=this.get(r);if(!s)return!0;const o=Os(t,s.id,i,this.data);return ws(e,o)}compliedIteratorItems(t,e,n=[]){const[r,...i]=n,s=this.get(r);if(!s)return e;const o="editor"===this.app.platform,a=Os(t,s.id,i,this.data),{deps:c={},condDeps:u={}}=((t,e,n)=>{let r;if(n){const n=[];e.forEach((t=>{eo(t,(t=>{n.push(t.id)}))})),r=`${t.id}:${n.join(":")}`}else r=`${t.id}:${e.map((t=>t.id)).join(":")}`;if(vs.has(r))return vs.get(r);const i=new co;i.addTarget(new ro({id:t.id,type:"data-source",isTarget:(e,n)=>!`${e}`.includes(Qs)&&so(t,e,n,!0)})),i.addTarget(new ro({id:t.id,type:"cond",isTarget:(e,n)=>oo(t,e,n,!0)})),i.collect(e,{},!0);const{deps:s}=i.getTarget(t.id,"data-source"),{deps:o}=i.getTarget(t.id,"cond"),a={deps:s,condDeps:o};return vs.set(r,a),a})(s.schema,e,o);return Object.keys(c).length||Object.keys(u).length?e.map((t=>Ss({compile:t=>Es(t,a),dsId:s.id,item:t,deps:c,condDeps:u,inEditor:o,ctxData:a}))):e}destroy(){this.removeAllListeners(),this.data={},this.dataSourceMap.forEach((t=>{t.destroy()})),this.dataSourceMap.clear()}onDataChange(t,e,n){return this.get(t)?.onDataChange(e,n)}offDataChange(t,e,n){return this.get(t)?.offDataChange(e,n)}}Ds.register("http",class extends ys{isLoading=!1;error;httpOptions;#o;#a=[];#c=[];#t="http";constructor(t){const{options:e}=t.schema;super(t),this.httpOptions=e,"function"==typeof t.request?this.#o=t.request:"function"==typeof globalThis.fetch&&(this.#o=ms),this.methods.forEach((t=>{"function"==typeof t.content&&("beforeRequest"===t.timing&&this.#a.push(t.content),"afterRequest"===t.timing&&this.#c.push(t.content))}))}get type(){return this.#t}async init(){this.schema.autoFetch&&await this.request(),super.init()}async request(t={}){this.isLoading=!0;const{url:e,params:n,data:r,headers:i,...s}=this.httpOptions;let o={url:"function"==typeof e?e({app:this.app,dataSource:this}):e,params:"function"==typeof n?n({app:this.app,dataSource:this}):n,data:"function"==typeof r?r({app:this.app,dataSource:this}):r,headers:"function"==typeof i?i({app:this.app,dataSource:this}):i,...s,...t};try{for(const t of this.#a)await t({options:o,params:{},dataSource:this,app:this.app});if("function"==typeof this.schema.beforeRequest&&(o=await this.schema.beforeRequest(o,{app:this.app,dataSource:this})),this.mockData)this.setData(this.mockData);else{let t=await(this.#o?.(o));for(const e of this.#c)await e({res:t,options:o,params:{},dataSource:this,app:this.app});if("function"==typeof this.schema.afterResponse&&(t=await this.schema.afterResponse(t,{app:this.app,dataSource:this,options:o})),this.schema.responseOptions?.dataPath){const e=Vs(this.schema.responseOptions.dataPath,t);this.setData(e)}else this.setData(t)}this.error=void 0}catch(a){this.error={msg:a.message},this.emit("error",a)}this.isLoading=!1}get(t){return this.request({...t,method:"GET"})}post(t){return this.request({...t,method:"POST"})}});var Is=(t=>(t.CONTAINER="container",t.PAGE="page",t.ROOT="app",t.PAGE_FRAGMENT="page-fragment",t))(Is||{});const Cs="displayConds";var Ps=(t=>(t.COMP="comp",t.CODE="code",t.DATA_SOURCE="data-source",t))(Ps||{}),Ls=(t=>(t.CODE="code",t))(Ls||{}),xs=(t=>(t.CODE="code",t.DATA_SOURCE_METHOD="data-source-method",t))(xs||{});const ks=t=>t?.dataset?.tmagicId,Ts=(t,e)=>t?.querySelector(`[data-tmagic-id="${e}"]`),Ms=()=>Ts,Rs=t("t",((t="")=>t.replace(/\B([A-Z])/g,"-$1").toLowerCase())),Ns=(t,e=[])=>{const n=[],r=function(t,e){if(!Array.isArray(e))return null;for(let i=0,s=e.length;i<s;i++){const s=e[i];if(n.push(s),`${s.id}`==`${t}`)return s;if(s.items){const e=r(t,s.items);if(e)return e}n.pop()}return null};return r(t,e),n},$s=t=>"[object Object]"===Object.prototype.toString.call(t),zs=t=>!!t&&Boolean(t.type?.toLowerCase()===Is.PAGE),Fs=t=>!!t&&Boolean(t.type?.toLowerCase()===Is.PAGE_FRAGMENT),Ws=t=>`${t}`.replaceAll(/\[(\d+)\]/g,".$1").split("."),Vs=(t="",e={})=>(Array.isArray(t)?t:Ws(t)).reduce(((n,r)=>{if($s(n))return n[r];if(Array.isArray(n)&&/^\d*$/.test(`${r}`))return n[r];throw new Error(`${e}中不存在${t}`)}),e),Us=(t,e,n={})=>Sn(n,t,e),Bs=(t,e=[])=>{const n=[],r=function(t,e){if(Array.isArray(e))for(let i=0,s=e.length;i<s;i++){const s=e[i],o=t.findIndex((t=>`${t}`==`${s.id}`));o>-1&&(t.slice(o,1),n.push(s)),s.items&&r(t,s.items)}};return r(t,e),n},qs=(t={})=>Array.from(Object.values(t).reduce(((t,e)=>(Object.keys(e).forEach((e=>{t.add(e)})),t)),new Set)),Hs=(t,e,n)=>{const r=Ns(t.id,e),i=r.pop();let s=r.pop();if(n&&(s=Ns(n,e).pop()),!i)throw new Error("未找到目标节点");if(!s)throw new Error("未找到父节点");const o=s.items?.findIndex((t=>t.id===i.id));s.items.splice(o,1,t)},Qs="__tmagic__",Gs="__tmagic__dslNode",Ks=(t,e,n={},r)=>{let i=[];if(r){const t=n[r];i=t?.[e.id].keys||[]}else i=((t={},e)=>Array.from(Object.values(t).reduce(((t,n)=>((n[e]?.keys||[]).forEach((e=>t.add(e))),t)),new Set)))(n,e.id);return i.forEach((n=>{const r=Ws(n),i=r.map(((t,e)=>e<r.length-1?t:`${Qs}${t}`));let s,o=Vs(i,e);if(void 0===o)try{const t=Vs(n,e);Us(i.join("."),t,e),o=t}catch(a){return void console.warn(a)}try{s=t(o)}catch(a){console.error(a),s=""}Us(n,s,e)})),e},Js=(t,e,n,r=[])=>{switch("string"==typeof e&&void 0===n&&(n=""),t){case"is":case"=":return e===n;case"not":case"!=":return e!==n;case">":return e>n;case">=":return e>=n;case"<":return e<n;case"<=":return e<=n;case"between":return r.length>1&&e>=r[0]&&e<=r[1];case"not_between":return r.length<2||e<r[0]||e>r[1];case"include":return e?.includes?.(n);case"not_include":return void 0===e||!e.includes?.(n)}return!1},Zs=t=>{const e={},n={string:void 0,object:{},array:[],boolean:void 0,number:void 0,null:null,any:void 0};return t.forEach((t=>{if(void 0===t.defaultValue)"object"!==t.type?t.type?e[t.name]=n[t.type]:e[t.name]=void 0:e[t.name]=t.fields?Zs(t.fields):n.object;else{if("array"===t.type&&!Array.isArray(t.defaultValue))return void(e[t.name]=n.array);if("object"===t.type&&!$s(t.defaultValue)){if("string"==typeof t.defaultValue){try{e[t.name]=JSON.parse(t.defaultValue)}catch(r){e[t.name]=n.object}return}return void(e[t.name]=n.object)}e[t.name]=wn(t.defaultValue)}})),e},Xs="ds-field::",Ys="ds-field-changed",to=/\$\{([\s\S]+?)\}/g,eo=(t("i",(t=>void 0===t[Gs]||!0===t[Gs])),(t,e,n=[])=>{e(t,n),Array.isArray(t.items)&&t.items.length&&(n.push(t),t.items.forEach((t=>{eo(t,e,[...n])})))});var no=(t=>(t.DEFAULT="default",t.CODE_BLOCK="code-block",t.DATA_SOURCE="data-source",t.DATA_SOURCE_METHOD="data-source-method",t.DATA_SOURCE_COND="data-source-cond",t))(no||{});class ro{isTarget;id;name;type=(()=>no.DEFAULT)();deps={};isCollectByDefault;constructor(t){this.isTarget=t.isTarget,this.id=t.id,this.name=t.name,this.isCollectByDefault=t.isCollectByDefault??!0,t.type&&(this.type=t.type),t.initialDeps&&(this.deps=t.initialDeps)}updateDep({id:t,name:e,key:n,data:r}){const i=this.deps[t]||{name:e,keys:[]};i.name=e,i.data=r,this.deps[t]=i,-1===i.keys.indexOf(n)&&i.keys.push(n)}removeDep(t,e){if(void 0===t)return void Object.keys(this.deps).forEach((t=>{delete this.deps[t]}));const n=this.deps[t];if(n)if(e){const r=n.keys.indexOf(e);n.keys.splice(r,1),0===n.keys.length&&delete this.deps[t]}else delete this.deps[t]}hasDep(t,e){const n=this.deps[t];return Boolean(n?.keys.find((t=>t===e)))}destroy(){this.deps={}}}const io=(t,e)=>{let n=e;return t.some(((e,r)=>{const i=n.find((({name:t})=>t===e));return n=i?.fields||[],i&&"array"===i.type&&/^(?!\d+$).*$/.test(`${t[r+1]}`)&&r<t.length-1}))},so=(t,e,n,r=!1)=>{if(`${e}`.startsWith(Cs))return!1;if("string"==typeof n)return((t,e,n=!1)=>{const r=t.match(to)||[];if(r.length<=0)return!1;const i=[],s=[];return r.forEach((t=>{const n=t.substring(2,t.length-1),r=Ws(n),o=r.shift();o&&o===e.id&&(io(r,e.fields)?i.push(t):s.push(t))})),n?i.length>0:s.length>0})(n,t,r);if($s(n)&&n?.isBindDataSource&&n.dataSourceId&&n.dataSourceId===t.id)return!0;if(((t,e)=>t?.isBindDataSourceField&&t.dataSourceId&&t.dataSourceId===e&&"string"==typeof t.template)(n,t.id))return!0;if(((t,e)=>{if(!Array.isArray(t)||"string"!=typeof t[0])return!1;const[n]=t,r=n.indexOf(Xs);return-1!==r&&n.substring(r+Xs.length)===e})(n,t.id)){const[,...e]=n,i=io(e,t.fields);return r?i:!i}return!1},oo=(t,e,n,r=!1)=>{if(!Array.isArray(n)||!t)return!1;const[i,...s]=n;if(i!==t.id||!`${e}`.startsWith(Cs))return!1;if(t.fields?.find((t=>t.name===s[0]))){const e=io(s,t.fields);return r?e:!e}return!1},ao=(t,e,n)=>{Object.values(t).forEach((t=>{Object.values(t).forEach((t=>{n&&t.type!==n||e(t)}))}))};class co{targetsList={};childrenProp="items";idProp="id";nameProp="name";constructor(t){t?.initialTargets&&(this.targetsList=t.initialTargets),t?.childrenProp&&(this.childrenProp=t.childrenProp)}getTargetsList(){return this.targetsList}getTargets(t=no.DEFAULT){return this.targetsList[t]||{}}addTarget(t){const e=this.getTargets(t.type)||{};this.targetsList[t.type]=e,e[t.id]=t}getTarget(t,e=no.DEFAULT){return this.getTargets(e)[t]}hasTarget(t,e=no.DEFAULT){return Boolean(this.getTarget(t,e))}hasSpecifiedTypeTarget(t=no.DEFAULT){return Object.keys(this.getTargets(t)).length>0}removeTarget(t,e=no.DEFAULT){const n=this.getTargets(e);n[t]&&(n[t].destroy(),delete n[t])}removeTargets(t=no.DEFAULT){const e=this.targetsList[t];if(e){for(const t of Object.values(e))t.destroy();delete this.targetsList[t]}}clearTargets(){Object.keys(this.targetsList).forEach((t=>{delete this.targetsList[t]}))}collect(t,e={},n=!1,r){this.collectByCallback(t,r,(({node:t,target:r})=>{this.removeTargetDep(r,t),this.collectItem(t,r,e,n)}))}collectByCallback(t,e,n){ao(this.targetsList,(r=>{(e||r.isCollectByDefault)&&t.forEach((t=>{n({node:t,target:r})}))}),e)}clear(t,e){let{targetsList:n}=this;e&&(n={[e]:this.getTargets(e)});const r=[];ao(n,(e=>{t?t.forEach((t=>{e.removeDep(t[this.idProp]),Array.isArray(t[this.childrenProp])&&t[this.childrenProp].length&&!r.includes(t[this.idProp])&&(r.push(t[this.idProp]),this.clear(t[this.childrenProp]))})):e.removeDep()}))}clearByType(t,e){this.clear(e,t)}collectItem(t,e,n={},r=!1){const i=(s,o="")=>{const a=(s,a)=>{const c=s===this.childrenProp,u=o?`${o}.${s}`:s;e.isTarget(u,a)?e.updateDep({id:t[this.idProp],name:`${t[this.nameProp]||t[this.idProp]}`,data:n,key:u}):!c&&Array.isArray(a)?a.forEach(((t,e)=>{$s(t)&&i(t,`${u}[${e}]`)})):$s(a)&&i(a,u),c&&r&&Array.isArray(a)&&a.forEach((t=>{this.collectItem(t,e,n,r)}))};Object.entries(s).forEach((([t,e])=>{void 0!==e&&""!==e&&a(t,e)}))};i(t)}removeTargetDep(t,e,n){t.removeDep(e[this.idProp],n),void 0===n&&Array.isArray(e[this.childrenProp])&&e[this.childrenProp].length&&e[this.childrenProp].forEach((e=>{this.removeTargetDep(t,e,n)}))}}class uo{isIos=!1;isIphone=!1;isIpad=!1;isAndroid=!1;isAndroidPad=!1;isMac=!1;isWin=!1;isMqq=!1;isWechat=!1;isWeb=!1;isOpenHarmony=!1;constructor(t=globalThis.navigator.userAgent,e={}){this.isIphone=t.indexOf("iPhone")>=0,this.isIpad=/(iPad).*OS\s([\d_]+)/.test(t),this.isIos=this.isIphone||this.isIpad,this.isAndroid=t.indexOf("Android")>=0,this.isAndroidPad=this.isAndroid&&t.indexOf("Mobile")<0,this.isMac=t.indexOf("Macintosh")>=0,this.isWin=t.indexOf("Windows")>=0,this.isMqq=/QQ\/([\d.]+)/.test(t),this.isWechat=t.indexOf("MicroMessenger")>=0&&t.indexOf("wxwork")<0,this.isOpenHarmony=t.includes("OpenHarmony"),this.isWeb=!(this.isIos||this.isAndroid||this.isOpenHarmony||/(WebOS|BlackBerry)/.test(t)),Object.entries(e).forEach((([t,e])=>{this[t]=e}))}}class lo{isAbort;constructor(){this.isAbort=!1}abort(){this.isAbort=!0}reset(){this.isAbort=!1}}const ho=(t,e)=>{if(!t)return{};let n={};const r={};n="string"==typeof t?(t=>{if("string"!=typeof t)return t;const e={};return t.split(";").forEach((t=>{if(!t)return;const n=t.split(":");let r=n.shift(),i=n.join(":");r&&(r=r.replace(/^\s*/,"").replace(/\s*$/,""),i=i.replace(/^\s*/,"").replace(/\s*$/,""),r=r.split("-").map(((t,e)=>e>0?`${t[0].toUpperCase()}${t.substr(1)}`:t)).join(""),e[r]=i)})),e})(t):{...t};const i="hippy"===e,s=["zIndex","opacity","fontWeight"];return Object.entries(n).forEach((([t,n])=>{"scale"===t&&!r.transform&&i?r.transform=[{scale:n}]:"backgroundImage"!==t||i?"transform"===t&&"string"!=typeof n?r[t]=((t,e)=>{if(!t)return[];const n=Object.entries(t).map((([t,n])=>n.trim()?("rotate"===t&&(t=>/^(-?\d+)(\.\d+)?$/.test(t))(n)&&(n=`${n}deg`),"hippy"!==e?`${t}(${n})`:{[t]:n}):""));if("hippy"===e)return n;const r=n.join(" ");return r.trim()?r:"none"})(n,e):!s.includes(t)&&n&&/^[-]?[0-9]*[.]?[0-9]*$/.test(n)?r[t]=i?n:n/100+"rem":r[t]=n:n&&(r[t]=(t=>!t||/^url/.test(t)||/^linear-gradient/.test(t)?t:`url(${t})`)(n))})),r},po="magic:common:events:",fo="magic:common:actions:",go="show",yo="hide",bo="scrollIntoView",mo="scrollToTop",vo=(t,e)=>{if(!t)return;const n=ks(t);return n?e.getNode(n,t.dataset.tmagicIteratorContainerId?.split(","),t.dataset.tmagicIteratorIndex?.split(",").map((t=>globalThis.parseInt(t,10)))):vo(t.parentElement,e)};class jo extends a.EventEmitter{app;nodeEventList=(()=>new Map)();dataSourceEventList=(()=>new Map)();constructor({app:t}){super(),this.app=t,globalThis.document.body.addEventListener("click",this.commonClickEventHandler)}destroy(){this.removeNodeEvents(),this.removeAllListeners(),globalThis.document.body.removeEventListener("click",this.commonClickEventHandler)}bindNodeEvents(t){t.events?.forEach(((e,n)=>{let r=`${e.name}_${t.data.id}`;const i=e.name.split(".");i.length>1&&(r=`${i[1]}_${i[0]}`);let s=Symbol(r);t.eventKeys.has(r)?s=t.eventKeys.get(r):t.eventKeys.set(r,s);const o=(e,...r)=>{this.eventHandler(n,t,r)};this.nodeEventList.set(o,s),this.on(s,o)}))}removeNodeEvents(){Array.from(this.nodeEventList.keys()).forEach((t=>{const e=this.nodeEventList.get(t);e&&this.off(e,t)})),this.nodeEventList.clear()}bindDataSourceEvents(t){this.removeDataSourceEvents(t),t.forEach((t=>{const e=this.dataSourceEventList.get(t.id)??new Map;(t.schema.events||[]).forEach((n=>{const[r,...i]=n.name?.split(".")||[];if(!r)return;const s=(...e)=>{this.eventHandler(n,t,e)};e.set(n.name,s),r===Ys?t?.onDataChange(i.join("."),s):t.on(r,s)})),this.dataSourceEventList.set(t.id,e)}))}removeDataSourceEvents(t){this.dataSourceEventList.size&&(t.forEach((t=>{const e=this.dataSourceEventList.get(t.id);e&&Array.from(e.keys()).forEach((n=>{const[r,...i]=n.split(".");r===Ys?t.offDataChange(i.join("."),e.get(n)):t.off(r,e.get(n))}))})),this.dataSourceEventList.clear())}async eventHandler(t,e,n){const r="number"==typeof t?e.events[t]:t;if(An(r,"actions")){const i=new lo,{actions:s}=r;for(let r=0;r<s.length&&!i?.isAbort;r++)if("number"==typeof t){const s=e.events[t].actions[r];this.actionHandler(s,e,n,i)}else this.actionHandler(s[r],e,n,i);i.reset()}else await this.compActionHandler(r,e,n)}async actionHandler(t,e,n,r){if(t.actionType===Ps.COMP){const r=t;await this.compActionHandler(r,e,n)}else if(t.actionType===Ps.CODE){const e=t;await this.app.runCode(e.codeId,e.params||{},n,r)}else if(t.actionType===Ps.DATA_SOURCE){const e=t,[i,s]=e.dataSourceMethod;await this.app.runDataSourceMethod(i,s,e.params||{},n,r)}}async compActionHandler(t,e,n){if(!this.app.page)throw new Error("当前没有页面");let{method:r,to:i}=t;Array.isArray(r)&&([i,r]=r);const s=this.app.getNode(i);if(!s)throw`ID为${i}的组件不存在`;if((t=>t.startsWith(fo))(r))return((t,e)=>{const{instance:n}=e;if(n)switch(t.replace(fo,"")){case go:n.show();break;case yo:n.hide();break;case bo:n.$el?.scrollIntoView({behavior:"smooth"});break;case mo:window.scrollTo({top:0,behavior:"smooth"})}})(r,s);s.instance?"function"==typeof s.instance[r]&&await s.instance[r](e,...n):s.addEventToQueue({method:r,fromCpt:e,args:n})}commonClickEventHandler=t=>{if(!t.target)return;const e=vo(t.target,this.app),n=`${r="click",r.startsWith(po)?r:`${po}${r}`}_${e?.data.id}`;var r;e?.eventKeys.has(n)&&this.emit(e.eventKeys.get(n),e)}}class wo{designWidth=375;tid;constructor(t){"complete"===globalThis.document.readyState?this.setBodyFontSize():globalThis.document.addEventListener("DOMContentLoaded",this.setBodyFontSize,!1),globalThis.addEventListener("resize",this.resizeHandler,!1),globalThis.addEventListener("pageshow",this.pageshowHandler,!1),void 0!==t?.designWidth&&this.setDesignWidth(t.designWidth)}destroy(){globalThis.document.removeEventListener("DOMContentLoaded",this.setBodyFontSize,!1),globalThis.removeEventListener("resize",this.resizeHandler,!1),globalThis.removeEventListener("pageshow",this.pageshowHandler,!1)}setDesignWidth(t){this.designWidth=t,this.refreshRem()}setBodyFontSize(){globalThis.document.body.style.fontSize=".12rem"}refreshRem(){const{width:t}=document.documentElement.getBoundingClientRect(),e=t/(this.designWidth/100);globalThis.document.documentElement.style.fontSize=`${e}px`,globalThis.document.documentElement.style.fontSize=`${this.correctRem(e)}px`}correctRem(t){const{document:e}=globalThis,n=e.createElement("div");n.style.cssText="width:1rem;height:0;overflow:hidden;position:absolute;z-index:-1;visibility:hidden;",e.documentElement.appendChild(n);const r=n.offsetWidth;return e.documentElement.removeChild(n),Math.abs(r-t)>1?t**2/r:t}resizeHandler=()=>{clearTimeout(this.tid),this.tid=setTimeout((()=>{this.refreshRem(),this.tid=void 0}),300)};pageshowHandler=t=>{t.persisted&&this.resizeHandler()}}class _o{data={};set(t,e){this.data[t]=e}get(t){return this.data[t]}}class Oo extends a.EventEmitter{data;style;events=[];instance;page;parent;app;store=(()=>new _o)();eventKeys=(()=>new Map)();eventQueue=[];constructor(t){super(),this.page=t.page,this.parent=t.parent,this.app=t.app,this.setData(t.config),this.listenLifeSafe()}setData(t){this.data=t;const{events:e,style:n}=t;this.events=e||[],this.style=n||{},this.emit("update-data",t)}addEventToQueue(t){this.eventQueue.push(t)}async runHookCode(t,e){if("function"==typeof this.data[t])return void(await this.data[t](this));const n=this.data[t];if(n?.hookType===Ls.CODE)for(const r of n.hookData){const{codeType:t=xs.CODE,codeId:n,params:i={}}=r;let s;const o={app:this.app,params:e||i};if(t===xs.CODE&&"string"==typeof n&&this.app.codeDsl?.[n])s=this.app.codeDsl[n].content;else if(t===xs.DATA_SOURCE_METHOD&&Array.isArray(n)&&n.length>1){const t=this.app.dataSourceManager?.get(n[0]);s=t?.methods.find((t=>t.name===n[1]))?.content,o.dataSource=t}s&&"function"==typeof s&&await s(o)}}destroy(){this.removeAllListeners()}listenLifeSafe(){this.once("created",(async t=>{this.once("destroy",(()=>{this.instance=null,"function"==typeof this.data.destroy&&this.data.destroy(this),this.listenLifeSafe()})),this.instance=t,await this.runHookCode("created")})),this.once("mounted",(async t=>{this.instance=t;for(let e=this.eventQueue.shift();e;e=this.eventQueue.shift())"function"==typeof t[e.method]&&await t[e.method](e.fromCpt,...e.args);await this.runHookCode("mounted")}))}}class Ao extends Oo{nodes=[];setData(t){this.resetNodes(),super.setData(t)}resetNodes(){this.nodes?.forEach((t=>{t.forEach((t=>{t.destroy()}))})),this.nodes=[]}initNode(t,e,n){if(n.has(t.id)&&n.get(t.id)?.destroy(),t.type&&this.app.iteratorContainerType.has(t.type)){const r=new Ao({config:t,parent:e,page:this.page,app:this.app});return n.set(t.id,r),void this.app.eventHelper?.bindNodeEvents(r)}const r=new Oo({config:t,parent:e,page:this.page,app:this.app});if(this.app.eventHelper?.bindNodeEvents(r),n.set(t.id,r),t.type&&this.app.pageFragmentContainerType.has(t.type)&&t.pageFragmentId){const e=this.app.dsl?.items?.find((e=>e.id===t.pageFragmentId));e&&(t.items=[e])}t.items?.forEach((t=>{this.initNode(t,r,n)}))}setNodes(t,e){const n=this.nodes[e]||new Map;t.forEach((t=>{this.initNode(t,this,n)})),this.nodes[e]=n}getNode(t,e){return this.nodes[e]?.get(t)}destroy(){super.destroy(),this.resetNodes()}}class Eo extends Oo{nodes=(()=>new Map)();constructor(t){super(t),this.setNode(t.config.id,this),t.config.items.forEach((t=>{this.initNode(t,this)}))}initNode(t,e){if(t.type&&this.app.iteratorContainerType.has(t.type))return void this.setNode(t.id,new Ao({config:t,parent:e,page:this,app:this.app}));const n=new Oo({config:t,parent:e,page:this,app:this.app});if(this.setNode(t.id,n),t.type&&this.app.pageFragmentContainerType.has(t.type)&&t.pageFragmentId){const e=this.app.dsl?.items?.find((e=>e.id===t.pageFragmentId));e&&(t.items=[e])}t.items?.forEach((t=>{this.initNode(t,n)}))}getNode(t,e,n){if(this.nodes.has(t))return this.nodes.get(t);if(Array.isArray(e)&&e.length&&Array.isArray(n)){let r=this.nodes.get(e[0]);for(let t=1,i=e.length;t<i;t++)r=r?.getNode(e[t],n[t-1]);return r?.getNode(t,n[n.length-1])}}setNode(t,e){this.nodes.set(t,e)}deleteNode(t){this.nodes.delete(t)}destroy(){super.destroy(),this.nodes.clear()}}class So extends a.EventEmitter{env=(()=>new uo)();dsl;codeDsl;dataSourceManager;page;useMock=!1;platform="mobile";jsEngine="browser";components=(()=>new Map)();pageFragmentContainerType=(()=>new Set(["page-fragment-container"]))();iteratorContainerType=(()=>new Set(["iterator-container"]))();request;transformStyle;eventHelper;flexible;constructor(t){super(),this.setEnv(t.ua),this.codeDsl=t.config?.codeBlocks,t.platform&&(this.platform=t.platform),t.jsEngine&&(this.jsEngine=t.jsEngine),t.pageFragmentContainerType&&(Array.isArray(t.pageFragmentContainerType)?t.pageFragmentContainerType:[t.pageFragmentContainerType]).forEach((t=>{this.pageFragmentContainerType.add(t)})),t.iteratorContainerType&&(Array.isArray(t.iteratorContainerType)?t.iteratorContainerType:[t.iteratorContainerType]).forEach((t=>{this.iteratorContainerType.add(t)})),"boolean"==typeof t.useMock&&(this.useMock=t.useMock),"browser"!==this.jsEngine||t.disabledFlexible||(this.flexible=new wo({designWidth:t.designWidth})),"editor"!==this.platform&&(this.eventHelper=new jo({app:this})),this.transformStyle=t.transformStyle||(t=>ho(t,this.jsEngine)),t.request&&(this.request=t.request),t.config&&this.setConfig(t.config,t.curPage)}setEnv(t){this.env=new uo(t)}setDesignWidth(t){this.flexible?.setDesignWidth(t)}setConfig(t,e){if(this.dsl=t,!e&&t.items.length&&(e=t.items[0].id),this.dataSourceManager&&this.dataSourceManager.destroy(),this.dataSourceManager=((t,e,n)=>{const{dsl:r,platform:i}=t;if(!r?.dataSources)return;const s=new Ds({app:t,useMock:e,initialData:n});return r.dataSources&&r.dataSourceCondDeps&&"editor"!==i&&Bs(qs(r.dataSourceCondDeps),r.items).forEach((t=>{t.condResult=s.compliedConds(t),_s(t,r)})),r.dataSources&&r.dataSourceDeps&&Bs(qs(r.dataSourceDeps),r.items).forEach((t=>{_s(s.compiledNode(t),r)})),"nodejs"!==t.jsEngine&&s.on("change",((e,n)=>{const i=r.dataSourceDeps?.[e]||{},o=r.dataSourceCondDeps?.[e]||{},a=ps([...Object.keys(o),...Object.keys(i)]),c=t.page?.data&&"editor"!==t.platform?[t.page.data]:r.items;s.emit("update-data",Bs(a,c).map((e=>{"editor"!==t.platform&&(e.condResult=s.compliedConds(e));const n=s.compiledNode(e);if("function"==typeof t.page?.setData)if(zs(n))t.page.setData(n);else{const r=t.page.getNode(e.id);r?.setData(n)}return n})),e,n)})),s})(this,this.useMock),this.codeDsl=t.codeBlocks,this.setPage(e||this.page?.data?.id),this.dataSourceManager){const t=Array.from(this.dataSourceManager.dataSourceMap.values());this.eventHelper?.bindDataSourceEvents(t)}}setPage(t){const e=this.dsl?.items.find((e=>`${e.id}`==`${t}`));if(!e)return this.deletePage(),void super.emit("page-change");e!==this.page?.data&&(this.page?.destroy(),this.page=new Eo({config:e,app:this}),this.eventHelper?.removeNodeEvents(),this.page.nodes.forEach((t=>{this.eventHelper?.bindNodeEvents(t)})),super.emit("page-change",this.page))}deletePage(){this.page?.destroy(),this.eventHelper?.removeNodeEvents(),this.page=void 0}getPage(t){return t?this.page&&`${this.page.data.id}`==`${t}`?this.page:void 0:this.page}getNode(t,e,n){return this.page?.getNode(t,e,n)}registerComponent(t,e){this.components.set(t,e)}unregisterComponent(t){this.components.delete(t)}resolveComponent(t){return this.components.get(t)}emit(t,...e){const[n,...r]=e;return this.eventHelper&&n instanceof Oo&&n.data?.id&&n.eventKeys.has(`${String(t)}_${n.data.id}`)?this.eventHelper?.emit(n.eventKeys.get(`${String(t)}_${n.data.id}`),n,...r):super.emit(t,...e)}async runCode(t,e,n,r){if(!t||function(t){if(null==t)return!0;if(ut(t)&&(E(t)||"string"==typeof t||"function"==typeof t.splice||jt(t)||It(t)||yt(t)))return!t.length;var e=xe(t);if("[object Map]"==e||"[object Set]"==e)return!t.size;if(ht(t))return!Tt(t).length;for(var n in t)if(En.call(t,n))return!1;return!0}(this.codeDsl))return;const i=this.codeDsl?.[t]?.content;"function"==typeof i&&await i({app:this,params:e,eventParams:n,flowState:r})}async runDataSourceMethod(t,e,n,r,i){if(!t||!e)return;const s=this.dataSourceManager?.get(t);if(!s)return;const o=(s.methods||[]).find((t=>t.name===e));o&&"function"==typeof o.content&&await o.content({app:this,params:n,dataSource:s,eventParams:r,flowState:i})}destroy(){this.removeAllListeners(),this.page=void 0,this.flexible?.destroy(),this.flexible=void 0,this.eventHelper?.destroy()}}const Do=(t,e=window)=>{const n=VueDemi.ref(),r=VueDemi.ref(),i=VueDemi.ref(),s=VueDemi.computed((()=>n.value?.items?.find((t=>t.id===r.value))||n.value?.items?.[0]));return VueDemi.watch(s,(async()=>{await VueDemi.nextTick();const t=document.querySelector(".magic-ui-page");t&&e.magic?.onPageElUpdate(t)})),e.magic?.onRuntimeReady({getApp:()=>t,updateRootConfig(e){n.value=e,t?.setConfig(e,r.value)},updatePageId(e){r.value=e,t?.setPage(e)},select(e){i.value=e,t?.getPage(e)&&this.updatePageId?.(e);const n=Ms()(document,`${e}`);return n||VueDemi.nextTick().then((()=>Ms()(document,`${e}`)))},add({config:e,parentId:r}){if(!n.value)throw new Error("error");if(!i.value)throw new Error("error");if(!r)throw new Error("error");const s=Ns(r,[n.value]).pop();if(!s)throw new Error("未找到父节点");if("page"!==e.type){const n=t?.page?.getNode(s.id);n&&t?.page?.initNode(e,n)}if(s.id!==i.value){const t=s.items?.findIndex((t=>t.id===i.value));s.items?.splice(t+1,0,e)}else s.items?.push(e)},update({config:e,parentId:r}){if(!n.value||!t)throw new Error("error");const i=t.dataSourceManager?.compiledNode(e,void 0,!0)||e;Hs(VueDemi.reactive(i),[n.value],r);const s=t.getNode(e.id);s&&s.setData(i),t.page?.data.id===e.id&&t.page.setData(i)},remove({id:e,parentId:r}){if(!n.value)throw new Error("error");const i=Ns(e,[n.value]).pop();if(!i)throw new Error("未找到目标元素");const s=Ns(r,[n.value]).pop();if(!s)throw new Error("未找到父元素");"page"===i.type?t?.deletePage():t?.page?.deleteNode(i.id);const o=s.items?.findIndex((t=>t.id===i.id));s.items.splice(o,1)}}),{pageConfig:s}};function Io({componentType:t,app:e}){return e?.resolveComponent(t)}const Co=Vue.defineComponent({__name:"App",setup(t){const e=Vue.inject("app"),{pageConfig:n}=Do(e),r=function(t=""){let e,n,r;return"string"==typeof t?e=t:({componentType:e,app:n}=t),e&&""!==e||(e="container"),n||(n=VueDemi.inject("app")),r=Io({componentType:e,app:n}),r||e.startsWith("magic-ui-")||(e=`magic-ui-${Rs(e)}`,r=Io({componentType:e,app:n})),r??e}("page");return(t,e)=>Vue.unref(n)?(Vue.openBlock(),Vue.createBlock(Vue.resolveDynamicComponent(Vue.unref(r)),{key:Vue.unref(n).id,config:Vue.unref(n)},null,8,["config"])):Vue.createCommentVNode("",!0)}});Ds.registerObservedData(class extends fs{state;subscribers=(()=>new Map)();constructor(t){super(),this.state=new Un(t)}update=(t,e)=>{this.state?.update(e??"",t)};on=(t,e)=>{const n=this.state.subscribe(t,(t=>{let e=0;return(...n)=>{if(0!==e)return t(...n);e+=1}})(e)),r=this.subscribers.get(t)??new Map;r.set(e,n),this.subscribers.set(t,r)};off=(t,e)=>{const n=this.subscribers.get(t);n&&(n.get(e)?.(),n.delete(e))};getData=t=>this.state?this.state?.get(t):{};destroy=()=>{this.subscribers.forEach((t=>{t.forEach((t=>t()))}))}}),Promise.all([r((()=>e.import("./comp-entry-legacy-XjimBR-b.js"))),r((()=>e.import("./plugin-entry-legacy-Du67ziIl.js"))),r((()=>e.import("./datasource-entry-legacy-Du67ziIl.js")))]).then((([t,e,n])=>{const r=Vue.createApp(Co),i=new So({ua:window.navigator.userAgent,platform:"editor"});i.env.isWeb&&i.setDesignWidth(window.document.documentElement.getBoundingClientRect().width),Object.entries(t.default).forEach((([t,e])=>{i.registerComponent(t,e)})),Object.entries(n.default).forEach((([t,e])=>{Ds.register(t,e)})),Object.values(e.default).forEach((t=>{r.use(t,{app:i})})),window.appInstance=i,r.config.globalProperties.app=i,r.provide("app",i),r.mount("#app")}))}}}));
//# sourceMappingURL=index-legacy-M36wLbff.js.map
